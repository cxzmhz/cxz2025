<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" id="viewportMeta"
    content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <title>防止输入法弹出时页面放大</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'PingFang SC', 'Helvetica Neue', Arial, sans-serif;
      line-height: 1.6;
      padding: 20px;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      color: #333;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    h1 {
      text-align: center;
      margin-bottom: 30px;
      color: #2c3e50;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
    }

    input,
    textarea,
    select {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 12px;
      /* 关键：至少16px避免iOS自动缩放 */
      transition: border-color 0.3s;
    }

    input:focus,
    textarea:focus,
    select:focus {
      border-color: #4a6cf7;
      outline: none;
      box-shadow: 0 0 0 2px rgba(74, 108, 247, 0.2);
    }

    textarea {
      min-height: 120px;
      resize: vertical;
    }

    .note {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 5px;
      margin-top: 30px;
      font-size: 14px;
      color: #666;
    }

    .note h3 {
      margin-bottom: 10px;
      color: #4a6cf7;
    }

    .status {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #4a6cf7;
      color: white;
      padding: 10px 15px;
      border-radius: 5px;
      font-size: 14px;
      display: none;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>防止输入法弹出时页面放大</h1>

    <form>
      <div class="form-group">
        <label for="name">姓名</label>
        <input type="text" id="name" placeholder="请输入您的姓名">
      </div>

      <div class="form-group">
        <label for="email">邮箱</label>
        <input type="email" id="email" placeholder="请输入您的邮箱">
      </div>

      <div class="form-group">
        <label for="phone">手机号</label>
        <input type="tel" id="phone" placeholder="请输入您的手机号">
      </div>

      <div class="form-group">
        <label for="message">留言</label>
        <textarea id="message" placeholder="请输入您的留言"></textarea>
      </div>

      <div class="form-group">
        <label for="city">城市</label>
        <select id="city">
          <option value="">请选择城市</option>
          <option value="beijing">北京</option>
          <option value="shanghai">上海</option>
          <option value="guangzhou">广州</option>
          <option value="shenzhen">深圳</option>
        </select>
      </div>
    </form>

    <div class="note">
      <h3>解决方案说明</h3>
      <p>1. 设置输入框字体大小为16px或以上，避免iOS自动缩放</p>
      <p>2. 使用JavaScript动态控制viewport，在输入框聚焦时禁止缩放</p>
      <p>3. 设置meta viewport的user-scalable=no（不推荐，影响用户体验）</p>
      <p>尝试点击上面的输入框，页面不会因为输入法弹出而放大。</p>
    </div>
  </div>

  <div class="status" id="status">输入框已聚焦，页面缩放已禁用</div>

  <script>
    // 防止页面缩放的核心功能
    function initPreventZoom() {
      const viewportMeta = document.getElementById('viewportMeta');
      const statusEl = document.getElementById('status');
      const originalViewport = viewportMeta.content;

      // 设置不允许缩放的viewport
      const preventZoomViewport = 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no';

      // 获取所有可输入元素
      const inputs = document.querySelectorAll('input, textarea, select');

      inputs.forEach(input => {
        // 聚焦时禁止缩放
        input.addEventListener('focus', function () {
          viewportMeta.setAttribute('content', preventZoomViewport);
          statusEl.style.display = 'block';

          // 3秒后隐藏状态提示
          setTimeout(() => {
            statusEl.style.display = 'none';
          }, 3000);
        });

        // 失焦时恢复原始设置
        input.addEventListener('blur', function () {
          viewportMeta.setAttribute('content', originalViewport);
          statusEl.style.display = 'none';
        });
      });

      // 处理页面可见性变化（例如用户切换应用后返回）
      document.addEventListener('visibilitychange', function () {
        if (!document.hidden) {
          // 页面重新可见时，检查是否有输入框处于聚焦状态
          const activeElement = document.activeElement;
          if (activeElement && (activeElement.tagName === 'INPUT' ||
            activeElement.tagName === 'TEXTAREA' ||
            activeElement.tagName === 'SELECT')) {
            viewportMeta.setAttribute('content', preventZoomViewport);
          } else {
            viewportMeta.setAttribute('content', originalViewport);
          }
        }
      });
    }

    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', initPreventZoom);
  </script>
</body>

</html>