<!DOCTYPE html><html><head>
      <title>疑问与解答</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\pc\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.8.18\crossnote\dependencies\katex\katex.min.css">
      
      
      <script type="text/javascript" src="file:///c:\Users\pc\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.8.18\crossnote\dependencies\mermaid\mermaid.min.js" charset="UTF-8"></script>
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<div class="code-chunk" data-id="code-chunk-id-0" data-cmd="toc"><div class="input-div"><div class="code-chunk-btn-group"><div class="run-btn btn btn-xs btn-primary"><span>▶︎</span></div><div class="run-all-btn btn btn-xs btn-primary">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><ul>
<li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%8E%B7%E5%8F%96-offsettop-offsetleft--offsetwidth-offsetheight-scrolltop-scrollleft-scrollwidth-scrollheight-clienttop-clientleft-clientwidth-clientheight-%E8%BF%99%E6%A0%B7%E7%9A%84%E6%A0%B7%E5%BC%8F%E4%B9%9F%E4%BC%9A%E8%A7%A6%E5%8F%91%E9%87%8D%E6%8E%92%E9%87%8D%E7%BB%98">为什么获取 offsetTop、offsetLeft、 offsetWidth、offsetHeight、scrollTop、scrollLeft、scrollWidth、scrollHeight、clientTop、clientLeft、clientWidth、clientHeight 这样的样式也会触发重排重绘</a></li>
<li><a href="#script-%E6%A0%87%E7%AD%BE%E9%87%8C%E9%9D%A2%E7%9A%84%E5%B1%9E%E6%80%A7-defer-%E5%92%8C-async-%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB">script 标签里面的属性 defer 和 async 有什么区别</a></li>
<li><a href="#vue3-%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BB%84%E4%BB%B6">vue3 如何使用函数式组件？</a></li>
<li><a href="#web-worker-service-worker-indexeddb-%E7%9A%84%E5%8C%BA%E5%88%AB">web worker, service worker, IndexedDB 的区别</a></li>
<li><a href="#react-useeffect-%E9%87%8C%E9%9D%A2%E7%9A%84%E8%AF%B7%E6%B1%82%E5%9C%A8%E4%B8%A5%E6%A0%BC%E6%A8%A1%E5%BC%8F%E4%B8%8B%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E8%AF%B7%E6%B1%82-2-%E6%AC%A1">react useEffect 里面的请求在严格模式下为什么会请求 2 次</a>
<ul>
<li><a href="#%E4%B8%80-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E5%87%BA%E7%8E%B0%E4%B8%A4%E6%AC%A1%E8%AF%B7%E6%B1%82">一、为什么会出现两次请求？</a>
<ul>
<li><a href="#1-%E4%B8%A5%E6%A0%BC%E6%A8%A1%E5%BC%8F%E7%9A%84%E4%BD%9C%E7%94%A8">1. <strong>严格模式的作用</strong></a></li>
<li><a href="#2-useeffect-%E7%9A%84%E5%8F%8C%E9%87%8D%E6%89%A7%E8%A1%8C">2. <strong>useEffect 的双重执行</strong></a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C-%E8%BF%99%E6%98%AF-bug-%E5%90%97%E9%9C%80%E8%A6%81%E4%BF%AE%E5%A4%8D%E5%90%97">二、这是 Bug 吗？需要修复吗？</a>
<ul>
<li><a href="#1-%E8%BF%99%E4%B8%8D%E6%98%AF-bug">1. <strong>这不是 Bug</strong></a></li>
<li><a href="#2-%E6%98%AF%E5%90%A6%E9%9C%80%E8%A6%81%E9%98%BB%E6%AD%A2%E4%B8%A4%E6%AC%A1%E8%AF%B7%E6%B1%82">2. <strong>是否需要阻止两次请求？</strong></a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E7%AE%A1%E7%90%86%E5%89%AF%E4%BD%9C%E7%94%A8">三、如何正确管理副作用？</a>
<ul>
<li><a href="#1-%E4%BD%BF%E7%94%A8-abortcontroller-%E5%8F%96%E6%B6%88%E8%AF%B7%E6%B1%82">1. <strong>使用 AbortController 取消请求</strong></a></li>
<li><a href="#2-%E9%81%BF%E5%85%8D%E4%BE%9D%E8%B5%96%E9%A1%B9%E9%94%99%E8%AF%AF">2. <strong>避免依赖项错误</strong></a></li>
<li><a href="#3-%E4%BD%BF%E7%94%A8-useref-%E8%B7%B3%E8%BF%87%E5%88%9D%E5%A7%8B%E6%B8%B2%E6%9F%93">3. <strong>使用 useRef 跳过初始渲染</strong></a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E7%9A%84%E5%BD%B1%E5%93%8D">四、生产环境的影响</a></li>
<li><a href="#%E4%BA%94-%E6%80%BB%E7%BB%93">五、总结</a></li>
</ul>
</li>
<li><a href="#%E5%89%8D%E7%AB%AF%E7%9A%84-post-%E8%AF%B7%E6%B1%82%E4%BC%9A%E5%85%88%E5%8F%91%E4%B8%80%E4%B8%AA-option-%E8%AF%B7%E6%B1%82%E7%BB%99%E6%9C%8D%E5%8A%A1%E7%AB%AF%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%99%E4%B8%AA%E8%AF%B7%E6%B1%82%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E9%87%8C%E9%9D%A2%E7%9C%8B%E4%B8%8D%E5%88%B0">前端的 post 请求会先发一个 option 请求给服务端，为什么这个请求在浏览器里面看不到？</a>
<ul>
<li><a href="#%E4%B8%80-options-%E8%AF%B7%E6%B1%82%E7%9A%84%E8%A7%A6%E5%8F%91%E6%9D%A1%E4%BB%B6">一、OPTIONS 请求的触发条件</a></li>
<li><a href="#%E4%BA%8C-%E4%B8%BA%E4%BB%80%E4%B9%88%E7%9C%8B%E4%B8%8D%E5%88%B0-options-%E8%AF%B7%E6%B1%82">二、为什么看不到 OPTIONS 请求？</a>
<ul>
<li><a href="#1-%E8%AF%B7%E6%B1%82%E8%A2%AB%E5%88%A4%E5%AE%9A%E4%B8%BA%E7%AE%80%E5%8D%95%E8%AF%B7%E6%B1%82">1. <strong>请求被判定为“简单请求”</strong></a></li>
<li><a href="#2-%E5%BC%80%E5%8F%91%E8%80%85%E5%B7%A5%E5%85%B7%E8%BF%87%E6%BB%A4%E4%BA%86%E8%AF%B7%E6%B1%82">2. <strong>开发者工具过滤了请求</strong></a></li>
<li><a href="#3-%E9%A2%84%E6%A3%80%E7%BB%93%E6%9E%9C%E8%A2%AB%E7%BC%93%E5%AD%98">3. <strong>预检结果被缓存</strong></a></li>
<li><a href="#4-%E8%AF%B7%E6%B1%82%E6%9C%AA%E7%9C%9F%E6%AD%A3%E8%B7%A8%E5%9F%9F">4. <strong>请求未真正跨域</strong></a></li>
<li><a href="#5-%E6%B5%8F%E8%A7%88%E5%99%A8%E6%88%96%E5%B7%A5%E5%85%B7%E9%97%AE%E9%A2%98">5. <strong>浏览器或工具问题</strong></a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E5%A6%82%E4%BD%95%E7%A1%AE%E4%BF%9D%E7%9C%8B%E5%88%B0-options-%E8%AF%B7%E6%B1%82">三、如何确保看到 OPTIONS 请求？</a>
<ul>
<li><a href="#1-%E6%9E%84%E9%80%A0%E9%9D%9E%E7%AE%80%E5%8D%95%E8%AF%B7%E6%B1%82">1. <strong>构造非简单请求</strong></a></li>
<li><a href="#2-%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE-cors-%E5%A4%B4">2. <strong>服务器配置 CORS 头</strong></a></li>
<li><a href="#3-%E7%A6%81%E7%94%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98">3. <strong>禁用浏览器缓存</strong></a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-options-%E8%AF%B7%E6%B1%82%E7%9A%84%E6%A0%B8%E5%BF%83%E4%BD%9C%E7%94%A8">四、OPTIONS 请求的核心作用</a></li>
<li><a href="#%E6%80%BB%E7%BB%93">总结</a></li>
</ul>
</li>
<li><a href="#%E5%89%8D%E7%AB%AF%E7%9B%91%E6%8E%A7%E5%A6%82%E6%9E%9C%E9%9C%80%E8%A6%81%E4%B8%8A%E6%8A%A5%E7%9A%84%E5%9F%8B%E7%82%B9%E6%95%B0%E9%87%8F%E9%9D%9E%E5%B8%B8%E5%A4%9A%E5%BA%94%E8%AF%A5%E6%80%8E%E4%B9%88%E5%A4%84%E7%90%86">前端监控如果需要上报的埋点数量非常多，应该怎么处理</a>
<ul>
<li><a href="#%E4%B8%80-%E5%90%88%E5%B9%B6%E4%B8%8A%E6%8A%A5%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7">一、合并上报的必要性</a>
<ul>
<li><a href="#1-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96">1. <strong>性能优化</strong></a></li>
<li><a href="#2-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%8E%8B%E5%8A%9B%E7%BC%93%E8%A7%A3">2. <strong>服务端压力缓解</strong></a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C-%E5%90%88%E5%B9%B6%E4%B8%8A%E6%8A%A5%E7%9A%84%E6%A0%B8%E5%BF%83%E7%AD%96%E7%95%A5">二、合并上报的核心策略</a>
<ul>
<li><a href="#1-%E9%98%9F%E5%88%97%E6%89%B9%E9%87%8F%E4%B8%8A%E6%8A%A5">1. <strong>队列批量上报</strong></a></li>
<li><a href="#2-%E5%88%86%E5%B1%82%E4%B8%8A%E6%8A%A5%E7%AD%96%E7%95%A5">2. <strong>分层上报策略</strong></a></li>
<li><a href="#3-%E6%95%B0%E6%8D%AE%E5%8E%8B%E7%BC%A9%E4%BC%98%E5%8C%96">3. <strong>数据压缩优化</strong></a></li>
<li><a href="#4-%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8%E5%85%9C%E5%BA%95">4. <strong>本地存储兜底</strong></a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E5%90%88%E5%B9%B6%E4%B8%8A%E6%8A%A5%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">三、合并上报的注意事项</a>
<ul>
<li><a href="#1-%E6%95%B0%E6%8D%AE%E5%AE%8C%E6%95%B4%E6%80%A7%E4%BF%9D%E9%9A%9C">1. <strong>数据完整性保障</strong></a></li>
<li><a href="#2-%E5%AE%9E%E6%97%B6%E6%80%A7%E6%9D%83%E8%A1%A1">2. <strong>实时性权衡</strong></a></li>
<li><a href="#3-%E6%95%B0%E6%8D%AE%E5%A4%A7%E5%B0%8F%E6%8E%A7%E5%88%B6">3. <strong>数据大小控制</strong></a></li>
<li><a href="#4-%E9%A1%B5%E9%9D%A2%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%A4%84%E7%90%86">4. <strong>页面生命周期处理</strong></a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%85%8D%E5%90%88%E4%BC%98%E5%8C%96">四、服务端配合优化</a>
<ul>
<li><a href="#1-%E9%AB%98%E6%95%88%E6%95%B0%E6%8D%AE%E6%8E%A5%E6%94%B6">1. <strong>高效数据接收</strong></a></li>
<li><a href="#2-%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8">2. <strong>分布式存储</strong></a></li>
<li><a href="#3-%E5%8A%A8%E6%80%81%E9%87%87%E6%A0%B7%E9%85%8D%E7%BD%AE">3. <strong>动态采样配置</strong></a></li>
</ul>
</li>
<li><a href="#%E4%BA%94-%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E8%AE%BE%E8%AE%A1">五、监控指标设计</a></li>
<li><a href="#%E5%85%AD-%E6%80%BB%E7%BB%93">六、总结</a></li>
</ul>
</li>
<li><a href="#commonjs-umd-amd-%E5%92%8C-esm-%E7%9A%84%E5%8C%BA%E5%88%AB">CommonJS、UMD、AMD 和 ESM 的区别</a>
<ul>
<li><a href="#%E4%B8%80-commonjs-cjs">一、<strong>CommonJS (CJS)</strong></a></li>
<li><a href="#%E4%BA%8C-amd-asynchronous-module-definition">二、<strong>AMD (Asynchronous Module Definition)</strong></a></li>
<li><a href="#%E4%B8%89-umd-universal-module-definition">三、<strong>UMD (Universal Module Definition)</strong></a></li>
<li><a href="#%E5%9B%9B-esm-ecmascript-modules">四、<strong>ESM (ECMAScript Modules)</strong></a></li>
<li><a href="#%E4%BA%94-%E6%A0%B8%E5%BF%83%E5%B7%AE%E5%BC%82%E5%AF%B9%E6%AF%94">五、<strong>核心差异对比</strong></a></li>
<li><a href="#%E5%85%AD-%E5%85%B3%E9%94%AE%E5%9C%BA%E6%99%AF%E9%80%89%E6%8B%A9%E5%BB%BA%E8%AE%AE">六、<strong>关键场景选择建议</strong></a></li>
</ul>
</li>
<li><a href="#nuxt-%E9%87%8C%E9%9D%A2%E4%BB%8E%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93%E5%88%87%E6%8D%A2%E5%88%B0%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B8%B2%E6%9F%93%E7%9A%84%E6%97%B6%E5%80%99%E5%AE%A2%E6%88%B7%E7%AB%AF-vue-%E6%98%AF%E5%A6%82%E4%BD%95%E6%8E%A5%E7%AE%A1%E7%BB%84%E4%BB%B6%E8%BF%98%E6%9C%89%E7%8A%B6%E6%80%81%E7%AD%89">Nuxt 里面从服务端渲染切换到客户端渲染的时候，客户端 Vue 是如何接管组件还有状态等？</a></li>
<li><a href="#%E5%89%8D%E7%AB%AF%E9%87%8D%E6%96%B0%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE%E5%88%B0%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E5%90%8E%E5%A6%82%E6%9E%9C%E7%94%A8%E6%88%B7%E5%9C%A8%E8%AE%BF%E9%97%AE%E6%97%A7%E7%9A%84%E9%A1%B5%E9%9D%A2%E5%B9%B6%E5%B0%9D%E8%AF%95%E5%AF%BC%E5%85%A5%E6%97%A7%E4%BB%A3%E7%A0%81%E5%9D%97%E7%9A%84%E6%97%B6%E5%80%99%E5%B0%B1%E4%BC%9A%E5%9B%A0%E4%B8%BA%E6%97%A7%E8%B5%84%E6%BA%90%E5%B7%B2%E7%BB%8F%E8%A2%AB%E6%B8%85%E7%A9%BA%E4%BA%86%E8%80%8C%E6%8A%A5%E9%94%99%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E8%BF%99%E4%B8%AA%E9%97%AE%E9%A2%98">前端重新部署项目到生产环境后，如果用户在访问旧的页面，并尝试导入旧代码块的时候就会因为旧资源已经被清空了而报错，如何解决这个问题？</a>
<ul>
<li><a href="#%E4%B8%80-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8"><strong>一、静态资源持久化存储</strong></a></li>
<li><a href="#%E4%BA%8C-cdn-%E5%9B%9E%E6%BA%90%E7%AD%96%E7%95%A5%E4%BC%98%E5%8C%96"><strong>二、CDN 回源策略优化</strong></a></li>
<li><a href="#%E4%B8%89-%E5%A2%9E%E9%87%8F%E6%9B%B4%E6%96%B0%E4%B8%8E%E9%9D%9E%E8%A6%86%E7%9B%96%E5%BC%8F%E5%8F%91%E5%B8%83"><strong>三、增量更新与非覆盖式发布</strong></a></li>
<li><a href="#%E5%9B%9B-%E4%BC%98%E9%9B%85%E9%99%8D%E7%BA%A7%E4%B8%8E%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><strong>四、优雅降级与错误处理</strong></a>
<ul>
<li><a href="#2-service-worker-%E4%B8%BB%E5%8A%A8%E6%8E%A7%E5%88%B6%E7%BC%93%E5%AD%98"><strong>2. Service Worker 主动控制缓存</strong></a></li>
<li><a href="#3-%E6%8E%A5%E5%8F%A3%E7%89%88%E6%9C%AC%E5%85%BC%E5%AE%B9--%E5%BC%BA%E5%88%B6%E6%9B%B4%E6%96%B0%E5%85%9C%E5%BA%95"><strong>3. 接口版本兼容 + 强制更新兜底</strong></a></li>
</ul>
</li>
<li><a href="#%E4%BA%94-%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E4%B8%8E%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5"><strong>五、版本控制与缓存策略</strong></a></li>
<li><a href="#%E5%85%AD-%E8%A1%A5%E5%85%85%E6%8E%AA%E6%96%BD"><strong>六、补充措施</strong></a></li>
</ul>
</li>
<li><a href="#nodejs-%E7%9A%84-js-%E6%96%87%E4%BB%B6%E4%B8%AD%E6%80%8E%E4%B9%88%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4">nodejs 的 js 文件中怎么使用命令</a></li>
<li><a href="#ts-%E4%B8%AD%E7%9A%84-declare-%E6%80%8E%E4%B9%88%E4%BD%BF%E7%94%A8">ts 中的 declare 怎么使用</a>
<ul>
<li><a href="#%E4%B8%80-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E4%B8%8E%E4%BD%9C%E7%94%A8"><strong>一、基本概念与作用</strong></a></li>
<li><a href="#%E4%BA%8C-%E4%B8%BB%E8%A6%81%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><strong>二、主要使用场景</strong></a>
<ul>
<li><a href="#1-%E5%A3%B0%E6%98%8E%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F"><strong>1. 声明全局变量</strong></a></li>
<li><a href="#2-%E5%A3%B0%E6%98%8E%E5%87%BD%E6%95%B0%E7%B1%BB%E5%9E%8B"><strong>2. 声明函数类型</strong></a></li>
<li><a href="#3-%E5%A3%B0%E6%98%8E%E7%B1%BB%E4%B8%8E%E6%8E%A5%E5%8F%A3"><strong>3. 声明类与接口</strong></a></li>
<li><a href="#4-%E5%A3%B0%E6%98%8E%E6%A8%A1%E5%9D%97%E4%B8%8E%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"><strong>4. 声明模块与命名空间</strong></a></li>
<li><a href="#5-%E6%89%A9%E5%B1%95%E5%B7%B2%E6%9C%89%E6%A8%A1%E5%9D%97"><strong>5. 扩展已有模块</strong></a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E7%B1%BB%E5%9E%8B%E5%A3%B0%E6%98%8E%E6%96%87%E4%BB%B6%E7%9A%84%E7%BB%84%E7%BB%87"><strong>三、类型声明文件的组织</strong></a>
<ul>
<li><a href="#1-%E5%88%9B%E5%BB%BA-dts-%E6%96%87%E4%BB%B6"><strong>1. 创建 <code>.d.ts</code> 文件</strong></a></li>
<li><a href="#2-%E6%A8%A1%E5%9D%97%E5%8C%96%E5%A3%B0%E6%98%8E"><strong>2. 模块化声明</strong></a></li>
<li><a href="#3-%E4%B8%89%E6%96%9C%E7%BA%BF%E6%8C%87%E4%BB%A4%E5%BC%95%E7%94%A8"><strong>3. 三斜线指令引用</strong></a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95"><strong>四、高级用法</strong></a>
<ul>
<li><a href="#1-%E5%85%A8%E5%B1%80%E4%BD%9C%E7%94%A8%E5%9F%9F%E6%89%A9%E5%B1%95"><strong>1. 全局作用域扩展</strong></a></li>
<li><a href="#2-%E9%80%9A%E9%85%8D%E7%AC%A6%E6%A8%A1%E5%9D%97%E5%A3%B0%E6%98%8E"><strong>2. 通配符模块声明</strong></a></li>
</ul>
</li>
<li><a href="#%E4%BA%94-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><strong>五、注意事项</strong></a></li>
<li><a href="#%E5%85%AD-%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E6%A1%88%E4%BE%8B"><strong>六、实际应用案例</strong></a>
<ul>
<li><a href="#1-%E6%B5%8F%E8%A7%88%E5%99%A8%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E8%A1%A5%E5%85%85"><strong>1. 浏览器环境变量补充</strong></a></li>
<li><a href="#2-%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%B1%BB%E5%9E%8B%E6%89%A9%E5%B1%95"><strong>2. 第三方库类型扩展</strong></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#vue3-reactive-%E5%93%8D%E5%BA%94%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%8E%9F%E7%90%86">vue3 reactive （响应式系统）的原理</a>
<ul>
<li><a href="#1-%E5%8F%8C%E5%90%91%E9%93%BE%E8%A1%A8%E7%9A%84%E5%BC%95%E5%85%A5%E8%83%8C%E6%99%AF"><strong>1. 双向链表的引入背景</strong></a></li>
<li><a href="#2-dep-%E7%9A%84%E5%8F%8C%E5%90%91%E9%93%BE%E8%A1%A8%E7%BB%93%E6%9E%84"><strong>2. Dep 的双向链表结构</strong></a></li>
<li><a href="#3-%E5%8F%8C%E5%90%91%E9%93%BE%E8%A1%A8%E7%9A%84%E8%BF%90%E4%BD%9C%E6%9C%BA%E5%88%B6"><strong>3. 双向链表的运作机制</strong></a>
<ul>
<li><a href="#1-%E4%BE%9D%E8%B5%96%E6%94%B6%E9%9B%86track"><strong>(1) 依赖收集（Track）</strong></a></li>
<li><a href="#2-%E4%BE%9D%E8%B5%96%E8%A7%A6%E5%8F%91notify"><strong>(2) 依赖触发（Notify）</strong></a></li>
</ul>
</li>
<li><a href="#4-%E5%8F%8C%E5%90%91%E9%93%BE%E8%A1%A8%E7%9A%84%E4%BC%98%E5%8A%BF"><strong>4. 双向链表的优势</strong></a></li>
<li><a href="#5-%E4%B8%8E%E6%97%A7%E7%89%88%E6%9C%AC%E8%AE%BE%E8%AE%A1%E7%9A%84%E5%AF%B9%E6%AF%94"><strong>5. 与旧版本设计的对比</strong></a></li>
<li><a href="#%E6%80%BB%E7%BB%93-1"><strong>总结</strong></a></li>
</ul>
</li>
<li><a href="#vue35-%E4%B9%8B%E5%89%8D%E7%9A%84%E5%93%8D%E5%BA%94%E5%BC%8F%E6%9B%B4%E6%96%B0%E7%9A%84%E5%93%8D%E5%BA%94%E5%BC%8F%E7%8A%B6%E6%80%81%E9%87%8C%E7%BB%B4%E6%8A%A4%E7%9A%84-deps-%E9%87%8C%E9%9D%A2%E7%9A%84%E4%BE%9D%E8%B5%96%E8%80%85%E5%A6%82%E6%9E%9C%E5%8F%91%E7%94%9F%E5%8F%98%E5%8C%96%E4%BA%86%E6%98%AF%E6%80%8E%E4%B9%88%E6%9B%B4%E6%96%B0%E8%BF%99%E4%B8%AA-deps-%E7%9A%84">vue3.5 之前的响应式更新的响应式状态里维护的 deps 里面的依赖者如果发生变化了，是怎么更新这个 deps 的？</a></li>
<li><a href="#%E6%9C%89%E4%B8%80%E4%B8%AA%E5%8A%A8%E6%80%81%E8%A1%A8%E6%A0%BC500500%E6%AF%8F%E6%A0%BC%E9%83%BD%E6%98%AF%E5%8F%AF%E4%BB%A5%E5%88%87%E6%8D%A2%E6%88%90%E4%B8%8D%E5%90%8C%E7%9A%84%E8%A1%A8%E5%8D%95%E9%A1%B9%E6%AF%94%E5%A6%82%E6%AF%8F%E6%A0%BC%E5%8F%AF%E4%BB%A5%E6%8D%A2%E6%88%90%E8%BE%93%E5%85%A5%E6%A1%86-%E4%B8%8B%E6%8B%89%E9%80%89%E6%8B%A9-%E5%8D%95%E9%80%89-%E5%A4%9A%E9%80%89%E7%AD%89%E6%80%8E%E4%B9%88%E5%9C%A8%E7%BC%96%E8%BE%91%E6%80%81%E7%9A%84%E6%97%B6%E5%80%99%E4%BC%98%E5%8C%96%E5%8D%A1%E9%A1%BF%E7%9A%84%E6%83%85%E5%86%B5">有一个动态表格，500*500，每格都是可以切换成不同的表单项，比如每格可以换成输入框、下拉选择、单选、多选等，怎么在编辑态的时候，优化卡顿的情况</a>
<ul>
<li><a href="#%E4%B8%80-%E6%A0%B8%E5%BF%83%E4%BC%98%E5%8C%96%E6%89%8B%E6%AE%B5%E5%BF%85%E9%80%89"><strong>一、核心优化手段（必选）</strong></a>
<ul>
<li><a href="#1-%E5%8F%8C%E7%BB%B4%E5%BA%A6%E8%99%9A%E6%8B%9F%E6%BB%9A%E5%8A%A8--%E8%A7%A3%E5%86%B3%E6%B8%B2%E6%9F%93%E8%8A%82%E7%82%B9%E8%BF%87%E5%A4%9A"><strong>1. 双维度虚拟滚动 —— 解决渲染节点过多</strong></a></li>
<li><a href="#2-%E5%8D%95%E5%85%83%E6%A0%BC%E7%BB%84%E4%BB%B6%E7%BC%93%E5%AD%98--%E9%81%BF%E5%85%8D%E9%87%8D%E5%A4%8D%E6%B8%B2%E6%9F%93"><strong>2. 单元格组件缓存 —— 避免重复渲染</strong></a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C-%E6%B8%B2%E6%9F%93%E5%B1%82%E4%BC%98%E5%8C%96%E5%BC%BA%E5%8C%96"><strong>二、渲染层优化（强化）</strong></a>
<ul>
<li><a href="#1-%E7%A6%BB%E5%B1%8F-canvas-%E7%BB%98%E5%88%B6--%E5%BA%94%E5%AF%B9%E6%9E%81%E7%AB%AF%E6%80%A7%E8%83%BD%E5%9C%BA%E6%99%AF"><strong>1. 离屏 Canvas 绘制 —— 应对极端性能场景</strong></a></li>
<li><a href="#2-web-worker-%E8%AE%A1%E7%AE%97--%E5%88%86%E7%A6%BB%E4%B8%BB%E7%BA%BF%E7%A8%8B%E5%8E%8B%E5%8A%9B"><strong>2. Web Worker 计算 —— 分离主线程压力</strong></a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E4%BA%A4%E4%BA%92%E4%BD%93%E9%AA%8C%E4%BC%98%E5%8C%96"><strong>三、交互体验优化</strong></a>
<ul>
<li><a href="#1-%E5%88%86%E7%BA%A7%E6%B8%B2%E6%9F%93%E7%AD%96%E7%95%A5"><strong>1. 分级渲染策略</strong></a></li>
<li><a href="#2-%E9%98%B2%E6%8A%96%E5%A4%84%E7%90%86%E6%BB%9A%E5%8A%A8%E4%BA%8B%E4%BB%B6"><strong>2. 防抖处理滚动事件</strong></a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-%E6%95%B0%E6%8D%AE%E6%9E%B6%E6%9E%84%E4%BC%98%E5%8C%96"><strong>四、数据架构优化</strong></a>
<ul>
<li><a href="#1-%E6%89%81%E5%B9%B3%E5%8C%96%E7%8A%B6%E6%80%81%E5%AD%98%E5%82%A8"><strong>1. 扁平化状态存储</strong></a></li>
<li><a href="#2-%E5%A2%9E%E9%87%8F%E6%9B%B4%E6%96%B0%E6%9C%BA%E5%88%B6"><strong>2. 增量更新机制</strong></a></li>
</ul>
</li>
<li><a href="#%E4%BA%94-%E5%A4%87%E9%80%89%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94"><strong>五、备选方案对比</strong></a></li>
<li><a href="#%E6%80%BB%E7%BB%93-2"><strong>总结</strong></a></li>
</ul>
</li>
<li><a href="#%E5%89%8D%E7%AB%AF%E5%A4%A7%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%9A%84%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF%E4%B8%8E%E4%BB%A3%E7%A0%81">前端大文件上传的具体实现思路与代码</a>
<ul>
<li><a href="#%E4%B8%80-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88">一、核心技术方案</a></li>
<li><a href="#%E4%BA%8C-%E5%89%8D%E7%AB%AF%E5%AE%9E%E7%8E%B0%E4%BB%A3%E7%A0%81vuereact-%E7%A4%BA%E4%BE%8B">二、前端实现代码（Vue/React 示例）</a></li>
<li><a href="#%E4%B8%89-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%AE%9E%E7%8E%B0nodejs--express">三、服务端实现（Node.js + Express）</a></li>
<li><a href="#%E5%9B%9B-%E4%BC%98%E5%8C%96%E7%82%B9">四、优化点</a></li>
<li><a href="#%E4%BA%94-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9-1">五、注意事项</a></li>
</ul>
</li>
<li><a href="#%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96%E7%9A%84%E4%B8%BB%E8%A6%81%E5%86%85%E5%AE%B9">前端工程化的主要内容</a>
<ul>
<li><a href="#%E4%B8%80-%E8%A7%84%E8%8C%83%E7%A1%AE%E7%AB%8B%E7%BB%9F%E4%B8%80%E4%BB%A3%E7%A0%81%E9%A3%8E%E6%A0%BC%E4%B8%8E%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B%E5%B7%A5%E7%A8%8B%E5%8C%96%E7%9A%84%E9%A6%96%E8%A6%81%E4%BB%BB%E5%8A%A1%E6%98%AF%E5%88%B6%E5%AE%9A%E8%A7%84%E8%8C%83">一、规范确立：统一代码风格与开发流程工程化的首要任务是制定规范。</a></li>
<li><a href="#%E4%BA%8C-%E5%8C%85%E7%AE%A1%E7%90%86%E4%B8%8E%E6%9E%84%E5%BB%BA%E6%8C%91%E9%80%89%E9%80%82%E9%85%8D%E7%9A%84%E5%B7%A5%E5%85%B7">二、包管理与构建：挑选适配的工具</a></li>
<li><a href="#%E4%B8%89-%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6%E5%9F%BA%E4%BA%8E%E4%B8%9A%E5%8A%A1%E5%9C%BA%E6%99%AF%E9%80%89%E5%AE%9A%E5%90%88%E9%80%82%E6%A1%86%E6%9E%B6">三、前端框架：基于业务场景选定合适框架</a></li>
<li><a href="#%E5%9B%9B-css-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%8F%90%E9%AB%98%E6%A0%B7%E5%BC%8F%E5%BC%80%E5%8F%91%E6%95%88%E7%8E%87">四、CSS 解决方案：提高样式开发效率</a></li>
<li><a href="#%E4%BA%94-%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E9%93%BE%E4%BC%98%E5%8C%96%E5%BC%80%E5%8F%91%E4%BD%93%E9%AA%8C">五、开发工具链：优化开发体验</a></li>
<li><a href="#%E5%85%AD-%E5%A4%9A%E7%BB%B4%E5%BA%A6%E6%B5%8B%E8%AF%95%E7%A1%AE%E4%BF%9D%E4%BB%A3%E7%A0%81%E8%B4%A8%E9%87%8F">六、多维度测试：确保代码质量</a></li>
<li><a href="#%E4%B8%83-%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E4%B8%8E%E6%8C%81%E7%BB%AD%E9%83%A8%E7%BD%B2cicd%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA%E4%B8%8E%E9%83%A8%E7%BD%B2">七、持续集成与持续部署（CI/CD）：实现自动化构建与部署</a></li>
<li><a href="#%E5%85%AB-%E5%BA%94%E7%94%A8%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7apm%E5%AE%9E%E6%97%B6%E7%9B%91%E6%8E%A7%E5%BA%94%E7%94%A8%E6%80%A7%E8%83%BD">八、应用性能监控（APM）：实时监控应用性能</a></li>
<li><a href="#%E4%B9%9D-%E5%B7%A5%E5%85%B7%E5%AF%B9%E6%AF%94%E7%9F%A9%E9%98%B5%E4%B8%8E%E5%AE%9E%E6%96%BD%E6%96%B9%E6%A1%88%E8%AF%A6%E8%BF%B0%E5%B7%A5%E5%85%B7%E5%8A%9F%E8%83%BD%E4%BC%98%E5%8A%BF%E5%8A%A3%E5%8A%BF">九、工具对比矩阵与实施方案详述工具功能优势劣势</a></li>
<li><a href="#%E6%80%BB%E7%BB%93-3">总结</a></li>
<li><a href="#css-%E5%B7%A5%E7%A8%8B%E5%8C%96">css 工程化</a></li>
</ul>
</li>
<li><a href="#%E6%9C%89%E4%B8%80%E4%B8%AA%E7%B1%BB%E5%90%8D%E4%B8%BA-box-%E7%9A%84-div-%E5%85%83%E7%B4%A0%E5%AE%BD%E5%BA%A6-500px%E9%AB%98%E5%BA%A6-500px%E5%AE%83%E4%B8%8B%E9%9D%A2%E6%9C%89-4-%E4%B8%AA%E7%B1%BB%E5%90%8D%E4%B8%BA-item-%E7%9A%84-div-%E5%AD%90%E5%85%83%E7%B4%A0%E5%AE%BD%E5%BA%A6%E4%B8%BA-50px%E9%AB%98%E5%BA%A6%E4%B8%BA-50px%E5%A6%82%E4%BD%95%E9%80%9A%E8%BF%87-flex-%E5%B8%83%E5%B1%80%E8%BF%99-4-%E4%B8%AA%E5%AD%90%E5%85%83%E7%B4%A0-2-%E4%B8%AA%E4%B8%80%E8%A1%8C%E5%9C%A8-box-%E5%85%83%E7%B4%A0%E7%9A%84%E5%8F%B3%E4%B8%8B%E8%A7%92%E6%8E%92%E5%88%97">有一个类名为 box 的 div 元素，宽度 500px，高度 500px，它下面有 4 个类名为 item 的 div 子元素，宽度为 50px，高度为 50px，如何通过 flex 布局这 4 个子元素 2 个一行在 box 元素的右下角排列？</a></li>
<li><a href="#%E8%84%9A%E6%89%8B%E6%9E%B6">脚手架</a></li>
<li><a href="#%E5%9C%A8-vue-%E4%B8%AD%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E9%94%99%E8%AF%AF">在 vue 中如何处理错误</a></li>
<li><a href="#react-%E4%B8%AD%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E9%94%99%E8%AF%AF">react 中如何处理错误</a></li>
<li><a href="#vue-%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F">vue 的生命周期的执行顺序</a></li>
<li><a href="#css-%E5%92%8C-js-%E7%9A%84%E5%8A%A0%E8%BD%BD%E4%BC%9A%E9%98%BB%E5%A1%9E%E6%B8%B2%E6%9F%93%E5%90%97%E9%98%BB%E5%A1%9E%E6%B8%B2%E6%9F%93%E5%85%B7%E4%BD%93%E6%8C%87%E7%9A%84%E6%98%AF%E4%BB%80%E4%B9%88">css 和 js 的加载会阻塞渲染吗？阻塞渲染具体指的是什么？</a>
<ul>
<li><a href="#css-%E5%92%8C-js-%E7%9A%84%E5%8A%A0%E8%BD%BD%E5%AF%B9%E6%B8%B2%E6%9F%93%E7%9A%84%E5%BD%B1%E5%93%8D%E5%8F%8A%E9%98%BB%E5%A1%9E%E6%9C%BA%E5%88%B6%E8%A7%A3%E6%9E%90">CSS 和 JS 的加载对渲染的影响及阻塞机制解析</a>
<ul>
<li><a href="#1-css-%E7%9A%84%E5%8A%A0%E8%BD%BD%E6%98%AF%E5%90%A6%E4%BC%9A%E9%98%BB%E5%A1%9E%E6%B8%B2%E6%9F%93"><strong>1. CSS 的加载是否会阻塞渲染？</strong></a>
<ul>
<li><a href="#%E4%B8%8D%E8%BF%87%E4%B9%9F%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E5%BC%82%E6%AD%A5%E5%8A%A0%E8%BD%BD-css">不过也可以使用异步加载 css</a></li>
</ul>
</li>
<li><a href="#2-javascript-%E7%9A%84%E5%8A%A0%E8%BD%BD%E6%98%AF%E5%90%A6%E4%BC%9A%E9%98%BB%E5%A1%9E%E6%B8%B2%E6%9F%93"><strong>2. JavaScript 的加载是否会阻塞渲染？</strong></a></li>
<li><a href="#3-%E4%BB%80%E4%B9%88%E6%98%AF%E9%98%BB%E5%A1%9E%E6%B8%B2%E6%9F%93"><strong>3. 什么是“阻塞渲染”？</strong></a></li>
<li><a href="#4-%E4%BC%98%E5%8C%96%E9%98%BB%E5%A1%9E%E6%B8%B2%E6%9F%93%E7%9A%84%E5%AE%9E%E8%B7%B5%E6%96%B9%E6%A1%88"><strong>4. 优化阻塞渲染的实践方案</strong></a></li>
<li><a href="#5-%E9%98%BB%E5%A1%9E%E6%B8%B2%E6%9F%93%E7%9A%84%E7%9B%B4%E8%A7%82%E7%A4%BA%E4%BE%8B"><strong>5. 阻塞渲染的直观示例</strong></a></li>
<li><a href="#%E6%80%BB%E7%BB%93-4"><strong>总结</strong></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#webpack-%E7%9A%84-dll-plugin-%E5%85%B7%E4%BD%93%E6%80%8E%E4%B9%88%E4%BD%BF%E7%94%A8%E8%AF%B7%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D%E4%B8%8B">webpack 的 dll plugin 具体怎么使用，请详细介绍下</a>
<ul>
<li><a href="#webpack-dll-plugin-%E8%AF%A6%E7%BB%86%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97">Webpack DLL Plugin 详细使用指南</a>
<ul>
<li><a href="#%E4%B8%80-dll-plugin-%E6%A0%B8%E5%BF%83%E4%BD%9C%E7%94%A8"><strong>一、DLL Plugin 核心作用</strong></a></li>
<li><a href="#%E4%BA%8C-%E5%AE%8C%E6%95%B4%E9%85%8D%E7%BD%AE%E6%B5%81%E7%A8%8B"><strong>二、完整配置流程</strong></a>
<ul>
<li><a href="#1-%E5%88%9B%E5%BB%BA-dll-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6webpackdllconfigjs"><strong>1. 创建 DLL 配置文件（<code>webpack.dll.config.js</code>）</strong></a></li>
<li><a href="#2-%E7%94%9F%E6%88%90-dll-%E6%96%87%E4%BB%B6"><strong>2. 生成 DLL 文件</strong></a></li>
<li><a href="#3-%E4%B8%BB-webpack-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BC%95%E7%94%A8-dll"><strong>3. 主 Webpack 配置中引用 DLL</strong></a></li>
<li><a href="#4-html-%E4%B8%AD%E5%BC%95%E5%85%A5-dll-%E6%96%87%E4%BB%B6"><strong>4. HTML 中引入 DLL 文件</strong></a></li>
<li><a href="#5-%E8%87%AA%E5%8A%A8%E5%8C%96%E8%84%9A%E6%9C%AC%E6%8E%A8%E8%8D%90"><strong>5. 自动化脚本（推荐）</strong></a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%9B%BE%E8%A7%A3"><strong>三、核心原理图解</strong></a></li>
<li><a href="#%E5%9B%9B-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E4%B8%8E%E4%BC%98%E5%8C%96"><strong>四、注意事项与优化</strong></a>
<ul>
<li><a href="#1-%E7%89%88%E6%9C%AC%E4%B8%80%E8%87%B4%E6%80%A7"><strong>1. 版本一致性</strong></a></li>
<li><a href="#2-%E6%9B%B4%E6%96%B0%E7%AD%96%E7%95%A5"><strong>2. 更新策略</strong></a></li>
<li><a href="#3-%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E4%BC%98%E5%8C%96"><strong>3. 生产环境优化</strong></a></li>
<li><a href="#4-%E4%B8%8E-externals-%E7%9A%84%E5%8C%BA%E5%88%AB"><strong>4. 与 externals 的区别</strong></a></li>
</ul>
</li>
<li><a href="#%E4%BA%94-webpack-5-%E7%9A%84%E6%9B%BF%E4%BB%A3%E6%96%B9%E6%A1%88"><strong>五、Webpack 5+ 的替代方案</strong></a></li>
<li><a href="#%E5%85%AD-%E6%80%BB%E7%BB%93-1"><strong>六、总结</strong></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sentry-%E8%83%BD%E6%8D%95%E8%8E%B7%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD%E5%A4%B1%E8%B4%A5%E7%9A%84%E9%94%99%E8%AF%AF%E5%90%97">sentry 能捕获静态资源加载失败的错误吗？</a>
<ul>
<li><a href="#sentry-%E6%8D%95%E8%8E%B7%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD%E5%A4%B1%E8%B4%A5%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F%E4%B8%8E%E9%99%90%E5%88%B6">Sentry 捕获静态资源加载失败的实现方式与限制</a>
<ul>
<li><a href="#1-%E9%BB%98%E8%AE%A4%E8%83%BD%E5%8A%9Bsentry-%E6%97%A0%E6%B3%95%E7%9B%B4%E6%8E%A5%E6%8D%95%E8%8E%B7%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD%E9%94%99%E8%AF%AF">1. <strong>默认能力：Sentry 无法直接捕获静态资源加载错误</strong></a></li>
<li><a href="#2-%E6%89%8B%E5%8A%A8%E6%8D%95%E8%8E%B7%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E9%94%99%E8%AF%AF%E7%9A%84%E6%96%B9%E6%B3%95">2. <strong>手动捕获静态资源错误的方法</strong></a>
<ul>
<li><a href="#%E6%96%B9%E6%A1%88-1%E7%9B%91%E5%90%AC%E5%85%A8%E5%B1%80-error-%E4%BA%8B%E4%BB%B6"><strong>方案 1：监听全局 <code>error</code> 事件</strong></a></li>
<li><a href="#%E6%96%B9%E6%A1%88-2%E9%80%9A%E8%BF%87-performance-api-%E7%9B%91%E6%8E%A7%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD"><strong>方案 2：通过 <code>Performance API</code> 监控资源加载</strong></a></li>
</ul>
</li>
<li><a href="#3-%E8%B7%A8%E5%9F%9F%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD%E7%9A%84%E9%99%90%E5%88%B6">3. <strong>跨域资源加载的限制</strong></a></li>
<li><a href="#4-%E6%8E%A8%E8%8D%90%E5%AE%9E%E8%B7%B5%E7%BB%93%E5%90%88%E5%A4%9A%E7%A7%8D%E7%9B%91%E6%8E%A7%E6%89%8B%E6%AE%B5">4. <strong>推荐实践：结合多种监控手段</strong></a></li>
</ul>
</li>
<li><a href="#%E6%80%BB%E7%BB%93-5">总结</a></li>
</ul>
</li>
<li><a href="#%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E7%94%A8%E6%88%B7%E8%AE%BE%E5%A4%87">如何判断用户设备</a></li>
<li><a href="#git-%E5%A6%82%E4%BD%95%E5%B0%86%E5%A4%9A%E6%AC%A1%E6%8F%90%E4%BA%A4%E5%8E%8B%E7%BC%A9%E6%88%90%E4%B8%80%E6%AC%A1%E6%8F%90%E4%BA%A4">git 如何将多次提交压缩成一次提交</a>
<ul>
<li><a href="#%E4%B8%80-%E4%BA%A4%E4%BA%92%E5%BC%8F-rebase-%E5%90%88%E5%B9%B6%E6%B3%95%E6%8E%A8%E8%8D%90%E6%9C%AC%E5%9C%B0%E5%88%86%E6%94%AF%E6%95%B4%E7%90%86">一、交互式 Rebase 合并法（推荐本地分支整理）</a></li>
<li><a href="#%E4%BA%8C-squash-merge-%E5%90%88%E5%B9%B6%E6%B3%95%E9%80%82%E7%94%A8%E4%BA%8E%E5%90%88%E5%B9%B6%E5%88%86%E6%94%AF">二、Squash Merge 合并法（适用于合并分支）</a></li>
<li><a href="#%E5%85%B3%E9%94%AE%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">关键注意事项</a></li>
</ul>
</li>
<li><a href="#%E5%89%8D%E7%AB%AF%E5%A6%82%E4%BD%95%E6%88%AA%E5%B1%8F">前端如何截屏</a></li>
<li><a href="#%E4%BB%8B%E7%BB%8D%E4%B8%8B-navigatorsendbeacon-%E6%96%B9%E6%B3%95">介绍下 navigator.sendBeacon 方法</a>
<ul>
<li><a href="#%E4%B8%80-%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E4%B8%8E%E8%AF%AD%E6%B3%95">一、核心特性与语法</a>
<ul>
<li><a href="#1-%E6%96%B9%E6%B3%95%E5%AE%9A%E4%B9%89">1. 方法定义</a></li>
<li><a href="#2-%E8%AF%AD%E6%B3%95%E6%A0%BC%E5%BC%8F">2. 语法格式</a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C-%E5%85%B8%E5%9E%8B%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF">二、典型应用场景</a>
<ul>
<li><a href="#1-%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E8%BF%BD%E8%B8%AA%E4%B8%8E%E5%88%86%E6%9E%90">1. 用户行为追踪与分析</a></li>
<li><a href="#2-%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E4%B8%8E%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97">2. 性能监控与错误日志</a></li>
<li><a href="#3-%E4%B8%B4%E6%97%B6%E6%95%B0%E6%8D%AE%E4%BF%9D%E5%AD%98">3. 临时数据保存</a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E6%8A%80%E6%9C%AF%E4%BC%98%E5%8A%BF%E4%B8%8E%E9%99%90%E5%88%B6">三、技术优势与限制</a>
<ul>
<li><a href="#1-%E6%A0%B8%E5%BF%83%E4%BC%98%E5%8A%BF">1. 核心优势</a></li>
<li><a href="#2-%E4%BD%BF%E7%94%A8%E9%99%90%E5%88%B6">2. 使用限制</a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-%E6%95%B0%E6%8D%AE%E5%B0%81%E8%A3%85%E5%AE%9E%E8%B7%B5">四、数据封装实践</a>
<ul>
<li><a href="#1-json-%E6%95%B0%E6%8D%AE%E5%8F%91%E9%80%81">1. JSON 数据发送</a></li>
<li><a href="#2-%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE%E6%8F%90%E4%BA%A4">2. 表单数据提交</a></li>
</ul>
</li>
<li><a href="#%E4%BA%94-%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9%E6%80%A7">五、浏览器兼容性</a></li>
<li><a href="#%E6%80%BB%E7%BB%93-6">总结</a></li>
</ul>
</li>
<li><a href="#%E7%BB%9F%E8%AE%A1%E5%85%A8%E7%AB%99%E6%AF%8F%E4%B8%80%E4%B8%AA%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD%E8%80%97%E6%97%B6%E8%AF%A5%E5%A6%82%E4%BD%95%E5%81%9A">统计全站每一个静态资源加载耗时，该如何做</a></li>
<li><a href="#%E9%80%80%E5%87%BA%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B9%8B%E5%89%8D%E5%8F%91%E9%80%81%E7%A7%AF%E5%8E%8B%E7%9A%84%E5%9F%8B%E7%82%B9%E6%95%B0%E6%8D%AE%E8%AF%B7%E6%B1%82%E8%AF%A5%E5%A6%82%E4%BD%95%E5%81%9A">退出浏览器之前，发送积压的埋点数据请求，该如何做？</a>
<ul>
<li><a href="#%E4%B8%80-%E6%A0%B8%E5%BF%83%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88">一、核心实现方案</a>
<ul>
<li><a href="#1-%E4%BC%98%E5%85%88%E4%BD%BF%E7%94%A8-navigatorsendbeacon">1. <strong>优先使用 <code>navigator.sendBeacon()</code></strong></a></li>
<li><a href="#2-%E5%A4%87%E9%80%89%E6%96%B9%E6%A1%88fetch--keepalive">2. <strong>备选方案：<code>fetch</code> + <code>keepalive</code></strong></a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C-%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%E7%AD%96%E7%95%A5">二、事件监听策略</a>
<ul>
<li><a href="#1-%E6%9C%80%E4%BD%B3%E4%BA%8B%E4%BB%B6%E7%BB%84%E5%90%88">1. <strong>最佳事件组合</strong></a></li>
<li><a href="#2-%E6%85%8E%E7%94%A8%E4%BC%A0%E7%BB%9F%E4%BA%8B%E4%BB%B6">2. <strong>慎用传统事件</strong></a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E6%95%B0%E6%8D%AE%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5">三、数据优化策略</a>
<ul>
<li><a href="#1-%E6%95%B0%E6%8D%AE%E5%8E%8B%E7%BC%A9%E6%8A%80%E5%B7%A7">1. <strong>数据压缩技巧</strong></a></li>
<li><a href="#2-%E5%88%86%E7%89%87%E5%8F%91%E9%80%81%E6%9C%BA%E5%88%B6">2. <strong>分片发送机制</strong></a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E4%B8%8E%E7%9B%91%E6%8E%A7">四、异常处理与监控</a>
<ul>
<li><a href="#1-%E5%A4%B1%E8%B4%A5%E9%87%8D%E4%BC%A0%E6%9C%BA%E5%88%B6">1. <strong>失败重传机制</strong></a></li>
<li><a href="#2-%E6%95%B0%E6%8D%AE%E5%AE%8C%E6%95%B4%E6%80%A7%E6%A0%A1%E9%AA%8C">2. <strong>数据完整性校验</strong></a></li>
</ul>
</li>
<li><a href="#%E4%BA%94-%E5%85%BC%E5%AE%B9%E6%80%A7%E5%A4%84%E7%90%86">五、兼容性处理</a>
<ul>
<li><a href="#1-%E9%99%8D%E7%BA%A7%E6%96%B9%E6%A1%88">1. <strong>降级方案</strong></a></li>
<li><a href="#2-%E7%89%B9%E6%80%A7%E6%A3%80%E6%B5%8B">2. <strong>特性检测</strong></a></li>
</ul>
</li>
<li><a href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">注意事项</a></li>
</ul>
</li>
<li><a href="#%E5%A6%82%E4%BD%95%E7%BB%9F%E8%AE%A1%E9%A1%B5%E9%9D%A2%E7%9A%84-long-task%E9%95%BF%E4%BB%BB%E5%8A%A1%E8%BF%99%E4%B8%AA%E6%AF%94%E8%BE%83%E7%83%AD%E9%97%A8">如何统计页面的 long task(长任务)【这个比较热门】</a>
<ul>
<li><a href="#%E4%B8%80-%E6%A0%B8%E5%BF%83%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%B3%95">一、核心实现方法</a>
<ul>
<li><a href="#1-%E4%BD%BF%E7%94%A8-performanceobserver-%E7%9B%91%E5%90%AC%E9%95%BF%E4%BB%BB%E5%8A%A1">1. <strong>使用 <code>PerformanceObserver</code> 监听长任务</strong></a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C-%E6%89%8B%E5%8A%A8%E6%A0%87%E8%AE%B0%E4%B8%8E%E6%B5%8B%E9%87%8F%E4%BB%BB%E5%8A%A1">二、手动标记与测量任务</a></li>
<li><a href="#%E4%B8%89-%E4%BC%98%E5%8C%96%E9%95%BF%E4%BB%BB%E5%8A%A1%E7%9A%84%E7%AD%96%E7%95%A5">三、优化长任务的策略</a>
<ul>
<li><a href="#1-%E4%BB%A3%E7%A0%81%E6%8B%86%E5%88%86%E4%B8%8E%E5%BC%82%E6%AD%A5%E6%89%A7%E8%A1%8C">1. <strong>代码拆分与异步执行</strong></a></li>
<li><a href="#2-%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD%E4%BC%98%E5%8C%96">2. <strong>资源加载优化</strong></a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-%E6%95%B0%E6%8D%AE%E4%B8%8A%E6%8A%A5%E4%B8%8E%E5%88%86%E6%9E%90">四、数据上报与分析</a>
<ul>
<li><a href="#1-%E4%B8%8A%E6%8A%A5%E6%97%B6%E6%9C%BA">1. <strong>上报时机</strong></a></li>
<li><a href="#2-%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0%E9%9B%86%E6%88%90">2. <strong>监控平台集成</strong></a></li>
</ul>
</li>
<li><a href="#%E4%BA%94-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9-2">五、注意事项</a></li>
</ul>
</li>
<li><a href="#%E5%A6%82%E4%BD%95%E8%BF%98%E5%8E%9F%E7%94%A8%E6%88%B7%E6%93%8D%E4%BD%9C%E6%B5%81%E7%A8%8B">如何还原用户操作流程</a>
<ul>
<li><a href="#%E4%B8%80-%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1">一、整体架构设计</a></li>
<li><a href="#%E4%BA%8C-%E6%93%8D%E4%BD%9C%E5%BD%95%E5%88%B6%E6%A8%A1%E5%9D%97%E5%AE%9E%E7%8E%B0">二、操作录制模块实现</a>
<ul>
<li><a href="#1-%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%E4%B8%8E%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86">1. <strong>事件监听与数据采集</strong></a></li>
<li><a href="#2-dom-%E5%BA%8F%E5%88%97%E5%8C%96%E7%AD%96%E7%95%A5">2. <strong>DOM 序列化策略</strong></a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E4%B8%8E%E5%8E%8B%E7%BC%A9">三、数据存储与压缩</a>
<ul>
<li><a href="#1-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1">1. <strong>数据结构设计</strong></a></li>
<li><a href="#2-%E5%AD%98%E5%82%A8%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5">2. <strong>存储优化策略</strong></a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-%E6%93%8D%E4%BD%9C%E5%9B%9E%E6%94%BE%E6%A8%A1%E5%9D%97%E5%AE%9E%E7%8E%B0">四、操作回放模块实现</a>
<ul>
<li><a href="#1-%E5%9B%9E%E6%94%BE%E5%BC%95%E6%93%8E%E6%A0%B8%E5%BF%83">1. <strong>回放引擎核心</strong></a></li>
<li><a href="#2-%E5%85%B3%E9%94%AE%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E6%96%B9%E6%A1%88">2. <strong>关键问题处理方案</strong></a></li>
</ul>
</li>
<li><a href="#%E4%BA%94-%E5%A2%9E%E5%BC%BA%E5%8A%9F%E8%83%BD%E6%89%A9%E5%B1%95">五、增强功能扩展</a>
<ul>
<li><a href="#1-%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E9%9B%86%E6%88%90">1. <strong>性能监控集成</strong></a></li>
<li><a href="#2-%E9%94%99%E8%AF%AF%E8%BF%BD%E8%B8%AA">2. <strong>错误追踪</strong></a></li>
<li><a href="#3-%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF%E8%BF%87%E6%BB%A4">3. <strong>敏感信息过滤</strong></a></li>
</ul>
</li>
<li><a href="#%E5%85%AD-%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94">六、技术方案对比</a></li>
<li><a href="#%E4%B8%83-%E5%AE%9E%E6%96%BD%E5%BB%BA%E8%AE%AE">七、实施建议</a></li>
<li><a href="#%E9%80%9A%E8%BF%87%E4%BB%A5%E4%B8%8A%E6%96%B9%E6%A1%88%E5%8F%AF%E5%9C%A8%E4%B8%8D%E4%BE%9D%E8%B5%96%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%E5%AE%9E%E7%8E%B0%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C%E8%BF%98%E5%8E%9F%E5%8A%9F%E8%83%BD%E5%A6%82%E9%9C%80%E6%94%AF%E6%8C%81%E5%A4%8D%E6%9D%82%E5%9C%BA%E6%99%AF%E5%A6%82-canvas-%E6%93%8D%E4%BD%9C%E5%BD%95%E5%88%B6%E5%8F%AF%E5%8F%82%E8%80%83-rrweb-%E7%9A%84%E5%A2%9E%E9%87%8F%E5%BF%AB%E7%85%A7%E8%AE%BE%E8%AE%A1">通过以上方案，可在不依赖第三方库的情况下实现基础操作还原功能。如需支持复杂场景（如 Canvas 操作录制），可参考 rrweb 的增量快照设计。</a></li>
</ul>
</li>
<li><a href="#%E5%8F%AF%E6%9C%89%E5%8A%9E%E6%B3%95%E5%B0%86%E8%AF%B7%E6%B1%82%E7%9A%84%E8%B0%83%E7%94%A8%E6%BA%90%E7%A0%81%E5%9C%B0%E5%9D%80%E5%8C%85%E6%8B%AC%E4%BB%A3%E7%A0%81%E8%A1%8C%E6%95%B0%E4%B9%9F%E4%B8%8A%E6%8A%A5%E4%B8%8A%E5%8E%BB">可有办法将请求的调用源码地址包括代码行数也上报上去？</a>
<ul>
<li><a href="#%E4%B8%80-%E5%88%A9%E7%94%A8-error-%E5%A0%86%E6%A0%88%E8%BF%BD%E8%B8%AA">一、利用 Error 堆栈追踪</a></li>
<li><a href="#%E4%BA%8C-%E4%BB%A3%E7%A0%81%E6%B3%A8%E5%85%A5%E6%A0%87%E8%AE%B0">二、代码注入标记</a></li>
<li><a href="#%E4%B8%89-ast-%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90">三、AST 静态分析</a></li>
<li><a href="#%E5%9B%9B-%E6%B5%8F%E8%A7%88%E5%99%A8%E8%B0%83%E8%AF%95-api">四、浏览器调试 API</a></li>
<li><a href="#%E4%BA%94-%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E4%BC%98%E5%8C%96">五、生产环境优化</a></li>
<li><a href="#%E8%B7%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9%E6%96%B9%E6%A1%88">跨浏览器兼容方案</a></li>
<li><a href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9-1">注意事项</a></li>
</ul>
</li>
<li><a href="#%E6%B7%B7%E5%8A%A8%E8%B7%9F%E9%9A%8F%E5%AF%BC%E8%88%AA%E7%94%B5%E6%A2%AF%E5%AF%BC%E8%88%AA%E8%AF%A5%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0">混动跟随导航（电梯导航）该如何实现</a>
<ul>
<li><a href="#%E4%B8%80-%E6%A0%B8%E5%BF%83%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86">一、核心实现原理</a></li>
<li><a href="#%E4%BA%8C-%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4%E5%88%86%E8%A7%A3">二、实现步骤分解</a>
<ul>
<li><a href="#1-%E7%BB%93%E6%9E%84%E5%B1%82html">1. 结构层（HTML）</a></li>
<li><a href="#2-%E8%A1%A8%E7%8E%B0%E5%B1%82css">2. 表现层（CSS）</a></li>
<li><a href="#3-%E8%A1%8C%E4%B8%BA%E5%B1%82javascript">3. 行为层（JavaScript）</a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E9%AB%98%E7%BA%A7%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88">三、高级优化方案</a></li>
<li><a href="#%E5%9B%9B-%E5%85%BC%E5%AE%B9%E6%80%A7%E5%A4%84%E7%90%86">四、兼容性处理</a></li>
<li><a href="#%E4%BA%94-%E6%89%A9%E5%B1%95%E5%8A%9F%E8%83%BD">五、扩展功能</a></li>
</ul>
</li>
<li><a href="#performanceobserver-%E5%A6%82%E4%BD%95%E6%B5%8B%E9%87%8F%E9%A1%B5%E9%9D%A2%E6%80%A7%E8%83%BD">PerformanceObserver 如何测量页面性能</a>
<ul>
<li><a href="#%E4%B8%80-%E5%9F%BA%E7%A1%80%E5%8E%9F%E7%90%86%E4%B8%8E%E4%BC%98%E5%8A%BF">一、基础原理与优势</a></li>
<li><a href="#%E4%BA%8C-%E6%A0%B8%E5%BF%83%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87%E6%B5%8B%E9%87%8F%E5%AE%9E%E8%B7%B5">二、核心性能指标测量实践</a>
<ul>
<li><a href="#1-%E9%A6%96%E6%AC%A1%E6%B8%B2%E6%9F%93%E6%80%A7%E8%83%BDfpfcp">1. 首次渲染性能（FP/FCP）</a></li>
<li><a href="#2-%E6%9C%80%E5%A4%A7%E5%86%85%E5%AE%B9%E6%B8%B2%E6%9F%93lcp">2. 最大内容渲染（LCP）</a></li>
<li><a href="#3-%E5%B8%83%E5%B1%80%E5%81%8F%E7%A7%BB%E7%BB%9F%E8%AE%A1cls">3. 布局偏移统计（CLS）</a></li>
<li><a href="#4-%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD%E6%80%A7%E8%83%BD">4. 资源加载性能</a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E9%AB%98%E7%BA%A7%E5%BA%94%E7%94%A8%E6%8A%80%E5%B7%A7">三、高级应用技巧</a></li>
<li><a href="#%E5%9B%9B-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">四、注意事项</a></li>
</ul>
</li>
<li><a href="#%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%8B%E6%8B%89%E6%BB%9A%E5%8A%A8%E5%8A%A0%E8%BD%BD%E9%A1%B6%E9%83%A8%E5%8A%A0%E8%BD%BD">移动端如何实现下拉滚动加载（顶部加载）</a>
<ul>
<li><a href="#%E4%B8%80-%E5%9F%BA%E7%A1%80%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E4%B8%8E%E6%AD%A5%E9%AA%A4">一、基础实现原理与步骤</a>
<ul>
<li><a href="#1-%E8%A7%A6%E6%91%B8%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC">1. <strong>触摸事件监听</strong></a></li>
<li><a href="#2-%E6%BB%9A%E5%8A%A8%E4%BD%8D%E7%BD%AE%E5%88%A4%E6%96%AD">2. <strong>滚动位置判断</strong></a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C-%E6%A0%B8%E5%BF%83%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5">二、核心优化策略</a>
<ul>
<li><a href="#1-%E7%8A%B6%E6%80%81%E6%A0%87%E8%AE%B0%E9%98%B2%E6%AD%A2%E9%87%8D%E5%A4%8D%E5%8A%A0%E8%BD%BD">1. <strong>状态标记防止重复加载</strong></a></li>
<li><a href="#2-%E8%A7%86%E8%A7%89%E5%8F%8D%E9%A6%88%E8%AE%BE%E8%AE%A1">2. <strong>视觉反馈设计</strong></a></li>
<li><a href="#3-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96">3. <strong>性能优化</strong></a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E6%8E%A8%E8%8D%90%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88">三、推荐技术方案</a>
<ul>
<li><a href="#1-%E5%8E%9F%E7%94%9F%E5%AE%9E%E7%8E%B0%E6%8E%A8%E8%8D%90%E5%9C%BA%E6%99%AF%E8%BD%BB%E9%87%8F%E7%BA%A7%E9%9C%80%E6%B1%82">1. <strong>原生实现（推荐场景：轻量级需求）</strong></a></li>
<li><a href="#2-%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E6%96%B9%E6%A1%88%E6%8E%A8%E8%8D%90%E5%9C%BA%E6%99%AF%E5%A4%8D%E6%9D%82%E4%BA%A4%E4%BA%92">2. <strong>第三方库方案（推荐场景：复杂交互）</strong></a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3">四、常见问题解决</a>
<ul>
<li><a href="#1-%E9%87%8D%E5%A4%8D%E5%8A%A0%E8%BD%BD%E9%97%AE%E9%A2%98">1. <strong>重复加载问题</strong></a></li>
<li><a href="#2-%E8%BE%B9%E7%95%8C%E6%9D%A1%E4%BB%B6%E5%A4%84%E7%90%86">2. <strong>边界条件处理</strong></a></li>
</ul>
</li>
<li><a href="#%E4%BA%94-%E8%B7%A8%E5%B9%B3%E5%8F%B0%E9%80%82%E9%85%8D%E5%BB%BA%E8%AE%AE">五、跨平台适配建议</a></li>
</ul>
</li>
<li><a href="#%E5%88%A4%E6%96%AD%E9%A1%B5%E7%AD%BE%E6%98%AF%E5%90%A6%E4%B8%BA%E6%B4%BB%E8%B7%83%E7%8A%B6%E6%80%81">判断页签是否为活跃状态</a></li>
<li><a href="#%E5%9C%A8%E7%BD%91%E7%BB%9C%E5%B8%A6%E5%AE%BD%E4%B8%80%E5%AE%9A%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%E5%88%87%E7%89%87%E4%B8%8A%E4%BC%A0%E6%84%9F%E8%A7%89%E5%92%8C%E6%95%B4%E4%BD%93%E4%B8%8A%E4%BC%A0%E6%B6%88%E8%B4%B9%E7%9A%84%E6%97%B6%E9%97%B4%E5%BA%94%E8%AF%A5%E6%98%AF%E5%B7%AE%E4%B8%8D%E5%A4%9A%E7%9A%84%E8%BF%99%E7%A7%8D%E8%AF%B4%E6%B3%95%E6%AD%A3%E7%A1%AE%E5%90%97">在网络带宽一定的情况下，切片上传感觉和整体上传消费的时间应该是差不多的，这种说法正确吗？</a>
<ul>
<li><a href="#%E4%B8%80-%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86%E5%B1%82%E9%9D%A2%E7%9A%84%E5%B7%AE%E5%BC%82">一、技术原理层面的差异</a></li>
<li><a href="#%E4%BA%8C-%E5%AE%9E%E6%B5%8B%E6%95%B0%E6%8D%AE%E5%AF%B9%E6%AF%94">二、实测数据对比</a></li>
<li><a href="#%E4%B8%89-%E5%88%87%E7%89%87%E4%B8%8A%E4%BC%A0%E7%9A%84%E4%BC%98%E5%8C%96%E9%80%BB%E8%BE%91">三、切片上传的优化逻辑</a></li>
<li><a href="#%E7%BB%93%E8%AE%BA">结论</a></li>
</ul>
</li>
<li><a href="#%E5%A4%A7%E6%96%87%E4%BB%B6%E5%88%87%E7%89%87%E4%B8%8A%E4%BC%A0%E7%9A%84%E6%97%B6%E5%80%99%E7%A1%AE%E5%AE%9A%E5%88%87%E7%89%87%E6%95%B0%E9%87%8F%E7%9A%84%E6%97%B6%E5%80%99%E6%9C%89%E5%93%AA%E4%BA%9B%E8%80%83%E9%87%8F%E5%9B%A0%E7%B4%A0">大文件切片上传的时候，确定切片数量的时候，有哪些考量因素</a>
<ul>
<li><a href="#%E4%B8%80-%E6%96%87%E4%BB%B6%E5%A4%A7%E5%B0%8F%E4%B8%8E%E5%88%87%E7%89%87%E7%AD%96%E7%95%A5%E7%9A%84%E5%B9%B3%E8%A1%A1">一、<strong>文件大小与切片策略的平衡</strong></a></li>
<li><a href="#%E4%BA%8C-%E7%BD%91%E7%BB%9C%E7%8E%AF%E5%A2%83%E7%9A%84%E9%80%82%E9%85%8D">二、<strong>网络环境的适配</strong></a></li>
<li><a href="#%E4%B8%89-%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8E%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E6%80%A7%E8%83%BD%E7%BA%A6%E6%9D%9F">三、<strong>服务器与客户端的性能约束</strong></a></li>
<li><a href="#%E5%9B%9B-%E5%AE%B9%E9%94%99%E6%9C%BA%E5%88%B6%E4%B8%8E%E7%94%A8%E6%88%B7%E4%BD%93%E9%AA%8C">四、<strong>容错机制与用户体验</strong></a></li>
<li><a href="#%E4%BA%94-%E5%AE%9E%E9%99%85%E5%9C%BA%E6%99%AF%E7%9A%84%E6%8E%A8%E8%8D%90%E7%AD%96%E7%95%A5">五、<strong>实际场景的推荐策略</strong></a></li>
<li><a href="#%E6%80%BB%E7%BB%93-7">总结</a></li>
<li><a href="#%E6%80%8E%E4%B9%88%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E7%9A%84%E7%BD%91%E7%BB%9C%E4%B8%8A%E4%BC%A0%E9%80%9F%E7%8E%87">怎么获取当前的网络上传速率</a></li>
</ul>
</li>
<li><a href="#%E9%A1%B5%E9%9D%A2%E5%85%B3%E9%97%AD%E6%97%B6%E6%89%A7%E8%A1%8C%E6%96%B9%E6%B3%95%E8%AF%A5%E5%A6%82%E4%BD%95%E5%81%9A">页面关闭时执行方法，该如何做</a>
<ul>
<li><a href="#%E4%B8%80-%E6%A0%B8%E5%BF%83%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC">一、核心事件监听</a>
<ul>
<li><a href="#1-beforeunload-%E4%BA%8B%E4%BB%B6">1. <strong><code>beforeunload</code> 事件</strong></a></li>
<li><a href="#2-unload-%E4%BA%8B%E4%BB%B6">2. <strong><code>unload</code> 事件</strong></a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C-%E5%8F%AF%E9%9D%A0%E7%9A%84%E6%95%B0%E6%8D%AE%E5%8F%91%E9%80%81%E6%96%B9%E6%B3%95">二、可靠的数据发送方法</a>
<ul>
<li><a href="#1-navigatorsendbeacon">1. <strong><code>navigator.sendBeacon()</code></strong></a></li>
<li><a href="#2-fetch-api-%E7%9A%84-keepalive-%E9%80%89%E9%A1%B9">2. <strong>Fetch API 的 <code>keepalive</code> 选项</strong></a></li>
<li><a href="#3-%E5%90%8C%E6%AD%A5-xmlhttprequest%E8%B0%A8%E6%85%8E%E4%BD%BF%E7%94%A8">3. <strong>同步 XMLHttpRequest（谨慎使用）</strong></a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E6%A1%86%E6%9E%B6%E9%9B%86%E6%88%90%E6%96%B9%E6%A1%88%E4%BB%A5-vuereact-%E4%B8%BA%E4%BE%8B">三、框架集成方案（以 Vue/React 为例）</a>
<ul>
<li><a href="#1-vue-3">1. <strong>Vue 3</strong></a></li>
<li><a href="#2-react">2. <strong>React</strong></a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-%E5%AE%B9%E9%94%99%E4%B8%8E%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5">四、容错与优化策略</a></li>
<li><a href="#%E4%BA%94-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9-3">五、注意事项</a></li>
</ul>
</li>
<li><a href="#%E5%A6%82%E4%BD%95%E7%BB%9F%E8%AE%A1%E7%94%A8%E6%88%B7-pv-%E8%AE%BF%E9%97%AE%E7%9A%84%E5%8F%91%E8%B5%B7%E8%AF%B7%E6%B1%82%E6%95%B0%E9%87%8F">如何统计用户 pv 访问的发起请求数量</a>
<ul>
<li><a href="#%E4%B8%80-%E9%9D%9E-spa-%E9%A1%B5%E9%9D%A2%E7%BB%9F%E8%AE%A1%E6%96%B9%E6%A1%88">一、<strong>非 SPA 页面统计方案</strong></a>
<ul>
<li><a href="#1-%E5%9F%BA%E7%A1%80%E6%96%B9%E6%A1%88%E9%A1%B5%E9%9D%A2%E5%8A%A0%E8%BD%BD%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC">1. <strong>基础方案：页面加载事件监听</strong></a></li>
<li><a href="#2-%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5%E9%98%B2%E6%AD%A2%E9%87%8D%E5%A4%8D%E4%B8%8A%E6%8A%A5">2. <strong>优化策略：防止重复上报</strong></a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C-spa-%E9%A1%B5%E9%9D%A2%E7%BB%9F%E8%AE%A1%E6%96%B9%E6%A1%88">二、<strong>SPA 页面统计方案</strong></a>
<ul>
<li><a href="#1-hash-%E8%B7%AF%E7%94%B1%E6%A8%A1%E5%BC%8F">1. <strong>Hash 路由模式</strong></a></li>
<li><a href="#2-history-%E8%B7%AF%E7%94%B1%E6%A8%A1%E5%BC%8F">2. <strong>History 路由模式</strong></a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E9%80%9A%E7%94%A8%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5">三、<strong>通用优化策略</strong></a>
<ul>
<li><a href="#1-%E8%AF%B7%E6%B1%82%E5%8F%AF%E9%9D%A0%E6%80%A7%E4%BF%9D%E9%9A%9C">1. <strong>请求可靠性保障</strong></a></li>
<li><a href="#2-%E7%94%A8%E6%88%B7%E6%A0%87%E8%AF%86%E7%94%9F%E6%88%90">2. <strong>用户标识生成</strong></a></li>
<li><a href="#3-%E9%81%BF%E5%85%8D%E9%87%8D%E5%A4%8D%E7%BB%9F%E8%AE%A1">3. <strong>避免重复统计</strong></a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-%E7%AC%AC%E4%B8%89%E6%96%B9%E6%96%B9%E6%A1%88%E9%9B%86%E6%88%90">四、<strong>第三方方案集成</strong></a>
<ul>
<li><a href="#1-%E4%BD%BF%E7%94%A8%E7%BB%9F%E8%AE%A1%E5%B7%A5%E5%85%B7">1. <strong>使用统计工具</strong></a></li>
<li><a href="#2-%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E8%A1%A5%E5%85%85">2. <strong>日志分析补充</strong></a></li>
</ul>
</li>
<li><a href="#%E4%BA%94-%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">五、<strong>生产环境注意事项</strong></a></li>
<li><a href="#%E9%80%9A%E8%BF%87%E4%B8%8A%E8%BF%B0%E6%96%B9%E6%A1%88%E5%89%8D%E7%AB%AF%E5%8F%AF%E5%AE%9E%E7%8E%B0%E7%B2%BE%E5%87%86%E7%9A%84-pv-%E8%AF%B7%E6%B1%82%E6%95%B0%E9%87%8F%E7%BB%9F%E8%AE%A1%E8%A6%86%E7%9B%96%E5%A4%9A%E9%A1%B5%E5%92%8C%E5%8D%95%E9%A1%B5%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E5%AF%B9%E4%BA%8E%E9%AB%98%E5%B9%B6%E5%8F%91%E5%9C%BA%E6%99%AF%E5%BB%BA%E8%AE%AE%E7%BB%93%E5%90%88%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E5%92%8C%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%A1%E6%95%B0%E5%A6%82-redis%E6%8F%90%E5%8D%87%E5%8F%AF%E9%9D%A0%E6%80%A7">通过上述方案，前端可实现精准的 PV 请求数量统计，覆盖多页和单页应用场景。对于高并发场景，建议结合服务端日志分析和分布式计数（如 Redis）提升可靠性。</a></li>
</ul>
</li>
<li><a href="#%E9%95%BF%E6%96%87%E6%9C%AC%E6%BA%A2%E5%87%BA%E5%B1%95%E5%BC%80%E6%94%B6%E8%B5%B7%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0">长文本溢出，展开/收起如何实现</a></li>
<li><a href="#%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E9%BC%A0%E6%A0%87%E6%8B%96%E6%8B%BD">如何实现鼠标拖拽</a></li>
<li><a href="#%E9%98%B2%E6%AD%A2%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2%E9%87%8D%E5%A4%8D%E8%AF%B7%E6%B1%82">防止前端页面重复请求</a></li>
<li><a href="#resizeobserver-%E4%BD%9C%E7%94%A8%E6%98%AF%E4%BB%80%E4%B9%88">ResizeObserver 作用是什么</a>
<ul>
<li><a href="#%E4%B8%80-%E6%A0%B8%E5%BF%83%E4%BD%9C%E7%94%A8">一、核心作用</a></li>
<li><a href="#%E4%BA%8C-%E5%85%B8%E5%9E%8B%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-1">二、典型应用场景</a></li>
<li><a href="#%E4%B8%89-%E6%8A%80%E6%9C%AF%E4%BC%98%E5%8A%BF">三、技术优势</a></li>
<li><a href="#%E5%9B%9B-%E4%BD%BF%E7%94%A8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">四、使用注意事项</a></li>
<li><a href="#%E4%BA%94-%E5%AF%B9%E6%AF%94%E4%BC%A0%E7%BB%9F%E6%96%B9%E6%A1%88%E7%A4%BA%E4%BE%8B">五、对比传统方案（示例）</a></li>
</ul>
</li>
<li><a href="#%E8%A6%81%E5%AE%9E%E6%97%B6%E7%BB%9F%E8%AE%A1%E7%94%A8%E6%88%B7%E6%B5%8F%E8%A7%88%E5%99%A8%E7%AA%97%E5%8F%A3%E5%A4%A7%E5%B0%8F%E8%AF%A5%E5%A6%82%E4%BD%95%E5%81%9A">要实时统计用户浏览器窗口大小，该如何做</a>
<ul>
<li><a href="#%E4%B8%80-%E6%A0%B8%E5%BF%83%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%B3%95-1">一、核心实现方法</a>
<ul>
<li><a href="#1-%E5%8E%9F%E7%94%9F-javascript-%E7%9B%91%E5%90%AC%E7%AA%97%E5%8F%A3%E4%BA%8B%E4%BB%B6">1. <strong>原生 JavaScript 监听窗口事件</strong></a></li>
<li><a href="#2-resizeobserver-%E7%9B%91%E5%90%AC%E6%A0%B9%E5%85%83%E7%B4%A0">2. <strong>ResizeObserver 监听根元素</strong></a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C-%E5%85%B3%E9%94%AE%E5%B1%9E%E6%80%A7%E5%AF%B9%E6%AF%94">二、关键属性对比</a></li>
<li><a href="#%E4%B8%89-%E6%A1%86%E6%9E%B6%E9%9B%86%E6%88%90%E6%96%B9%E6%A1%88vuereact">三、框架集成方案（Vue/React）</a>
<ul>
<li><a href="#1-vue-3-%E7%BB%84%E5%90%88%E5%BC%8F-api">1. <strong>Vue 3 组合式 API</strong></a></li>
<li><a href="#2-react-hooks">2. <strong>React Hooks</strong></a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5">四、性能优化策略</a></li>
<li><a href="#%E4%BA%94-%E7%89%B9%E6%AE%8A%E5%9C%BA%E6%99%AF%E5%A4%84%E7%90%86">五、特殊场景处理</a></li>
<li><a href="#%E6%80%BB%E7%BB%93%E5%BB%BA%E8%AE%AE">总结建议</a></li>
<li><a href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0%E6%97%B6%E9%9C%80%E6%A0%B9%E6%8D%AE%E9%A1%B9%E7%9B%AE%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9%E8%A6%81%E6%B1%82-%E6%80%A7%E8%83%BD%E6%95%8F%E6%84%9F%E5%BA%A6%E7%AD%89%E5%9B%A0%E7%B4%A0%E9%80%89%E6%8B%A9%E5%90%88%E9%80%82%E6%96%B9%E6%A1%88">具体实现时需根据项目浏览器兼容要求、性能敏感度等因素选择合适方案。</a></li>
</ul>
</li>
<li><a href="#%E5%BD%93%E9%A1%B9%E7%9B%AE%E6%8A%A5%E9%94%99%E4%BD%A0%E6%83%B3%E5%AE%9A%E4%BD%8D%E6%97%B6%E5%93%AA%E4%B8%AA-commit-%E5%BC%95%E5%85%A5%E7%9A%84%E9%94%99%E8%AF%AF%E6%97%B6%E8%AF%A5%E6%80%8E%E4%B9%88%E5%81%9A">当项目报错，你想定位时哪个 commit 引入的错误时，该怎么做</a>
<ul>
<li><a href="#%E4%B8%80-%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E4%BC%98%E5%8A%BF">一、核心原理与优势</a></li>
<li><a href="#%E4%BA%8C-%E6%89%8B%E5%8A%A8%E5%AE%9A%E4%BD%8D%E6%AD%A5%E9%AA%A4%E4%BB%A5-vue-devui-%E7%BB%84%E4%BB%B6%E5%BA%93%E4%B8%BA%E4%BE%8B">二、手动定位步骤（以 Vue DevUI 组件库为例）</a>
<ul>
<li><a href="#1-%E5%88%9D%E5%A7%8B%E5%8C%96%E5%B9%B6%E6%8C%87%E5%AE%9A%E8%8C%83%E5%9B%B4">1. 初始化并指定范围</a></li>
<li><a href="#2-%E6%B5%8B%E8%AF%95%E5%B9%B6%E6%A0%87%E8%AE%B0%E7%8A%B6%E6%80%81">2. 测试并标记状态</a></li>
<li><a href="#3-%E9%80%80%E5%87%BA%E5%B9%B6%E6%81%A2%E5%A4%8D%E7%8A%B6%E6%80%81">3. 退出并恢复状态</a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E8%87%AA%E5%8A%A8%E5%8C%96%E8%84%9A%E6%9C%AC%E6%96%B9%E6%A1%88">三、自动化脚本方案</a></li>
<li><a href="#%E5%9B%9B-%E9%AB%98%E7%BA%A7%E6%8A%80%E5%B7%A7%E4%B8%8E%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">四、高级技巧与注意事项</a>
<ul>
<li><a href="#1-%E7%89%B9%E6%AE%8A%E5%9C%BA%E6%99%AF%E5%A4%84%E7%90%86">1. 特殊场景处理</a></li>
<li><a href="#2-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE">2. 性能优化建议</a></li>
<li><a href="#3-%E5%85%BC%E5%AE%B9%E6%80%A7%E4%BF%9D%E9%9A%9C">3. 兼容性保障</a></li>
</ul>
</li>
<li><a href="#%E4%BA%94-%E5%AF%B9%E6%AF%94%E4%BC%A0%E7%BB%9F%E6%96%B9%E6%A1%88">五、对比传统方案</a></li>
<li><a href="#%E5%85%AD-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E6%80%BB%E7%BB%93">六、最佳实践总结</a></li>
</ul>
</li>
<li><a href="#%E5%A6%82%E4%BD%95%E7%A7%BB%E9%99%A4%E4%B8%80%E4%B8%AA%E6%8C%87%E5%AE%9A%E7%9A%84-commit">如何移除一个指定的 commit</a>
<ul>
<li><a href="#%E4%B8%80-%E4%BF%9D%E7%95%99%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95%E7%9A%84%E6%92%A4%E9%94%80%E6%96%B9%E6%A1%88">一、保留历史记录的撤销方案</a>
<ul>
<li><a href="#1-git-revert-%E5%8F%8D%E5%90%91%E6%8F%90%E4%BA%A4%E6%B3%95">1. <strong><code>git revert</code> 反向提交法</strong></a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C-%E5%BD%BB%E5%BA%95%E5%88%A0%E9%99%A4%E6%8F%90%E4%BA%A4%E7%9A%84%E6%96%B9%E6%A1%88">二、彻底删除提交的方案</a>
<ul>
<li><a href="#1-git-rebase-%E4%BA%A4%E4%BA%92%E5%BC%8F%E5%8F%98%E5%9F%BA">1. <strong><code>git rebase</code> 交互式变基</strong></a></li>
<li><a href="#2-git-reset-%E7%89%88%E6%9C%AC%E5%9B%9E%E9%80%80">2. <strong><code>git reset</code> 版本回退</strong></a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E7%89%B9%E6%AE%8A%E5%9C%BA%E6%99%AF%E5%A4%84%E7%90%86%E6%96%B9%E6%A1%88">三、特殊场景处理方案</a>
<ul>
<li><a href="#1-%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4%E5%A4%9A%E4%B8%AA%E6%8F%90%E4%BA%A4">1. <strong>批量删除多个提交</strong></a></li>
<li><a href="#2-%E5%88%A0%E9%99%A4%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E5%8E%86%E5%8F%B2%E6%8F%90%E4%BA%A4">2. <strong>删除远程仓库历史提交</strong></a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-%E6%93%8D%E4%BD%9C%E9%A3%8E%E9%99%A9%E4%B8%8E%E8%A7%84%E9%81%BF%E7%AD%96%E7%95%A5">四、操作风险与规避策略</a></li>
<li><a href="#%E4%BA%94-%E6%89%A9%E5%B1%95%E7%9F%A5%E8%AF%86%E5%8E%86%E5%8F%B2%E6%B8%85%E7%90%86%E5%B7%A5%E5%85%B7">五、扩展知识：历史清理工具</a></li>
<li><a href="#%E6%93%8D%E4%BD%9C%E6%B5%81%E7%A8%8B%E9%80%9F%E6%9F%A5%E8%A1%A8">操作流程速查表</a></li>
</ul>
</li>
<li><a href="#%E8%AF%B7%E6%B1%82%E5%A4%B1%E8%B4%A5%E4%BC%9A%E5%BC%B9%E5%87%BA%E4%B8%80%E4%B8%AA-toast%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E6%89%B9%E9%87%8F%E8%AF%B7%E6%B1%82%E5%A4%B1%E8%B4%A5%E5%8F%AA%E5%BC%B9%E5%87%BA%E4%B8%80%E4%B8%AA-toast%E7%83%AD%E9%97%A8">请求失败会弹出一个 toast，如何保证批量请求失败，只弹出一个 toast【热门】</a></li>
<li><a href="#%E5%A6%82%E4%BD%95%E8%BE%83%E5%B0%91%E9%A1%B9%E7%9B%AE%E9%87%8C%E9%9D%A2-if-else%E7%83%AD%E9%97%A8">如何较少项目里面 if-else【热门】</a></li>
<li><a href="#babel-runtime-%E4%BD%9C%E7%94%A8%E6%98%AF%E5%95%A5%E7%83%AD%E9%97%A8">babel-runtime 作用是啥【热门】</a>
<ul>
<li><a href="#%E4%B8%80-%E9%81%BF%E5%85%8D%E5%85%A8%E5%B1%80%E6%B1%A1%E6%9F%93%E6%A0%B8%E5%BF%83%E4%BB%B7%E5%80%BC">一、避免全局污染（核心价值）</a></li>
<li><a href="#%E4%BA%8C-%E5%A4%8D%E7%94%A8%E8%BE%85%E5%8A%A9%E5%87%BD%E6%95%B0%E4%BD%93%E7%A7%AF%E4%BC%98%E5%8C%96">二、复用辅助函数（体积优化）</a></li>
<li><a href="#%E4%B8%89-%E6%8C%89%E9%9C%80%E5%8A%A0%E8%BD%BD%E6%96%B0%E7%89%B9%E6%80%A7">三、按需加载新特性</a></li>
<li><a href="#%E5%9B%9B-%E4%B8%8E-polyfill-%E6%96%B9%E6%A1%88%E7%9A%84%E5%AF%B9%E6%AF%94">四、与 polyfill 方案的对比</a></li>
<li><a href="#%E4%BA%94-%E5%85%B8%E5%9E%8B%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF">五、典型应用场景</a></li>
<li><a href="#%E8%A1%A5%E5%85%85%E8%AF%B4%E6%98%8E">补充说明</a></li>
</ul>
</li>
<li><a href="#%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E9%A2%84%E8%A7%88-pdf-%E6%96%87%E4%BB%B6">如何实现预览 pdf 文件</a>
<ul>
<li><a href="#%E4%B8%80-html-%E5%8E%9F%E7%94%9F%E6%A0%87%E7%AD%BE%E6%96%B9%E6%A1%88">一、HTML 原生标签方案</a>
<ul>
<li><a href="#1-iframe-%E6%A0%87%E7%AD%BE">1. <strong>iframe 标签</strong></a></li>
<li><a href="#2-embedobject-%E6%A0%87%E7%AD%BE">2. <strong>embed/object 标签</strong></a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C-pdfjs-%E6%96%B9%E6%A1%88%E6%8E%A8%E8%8D%90">二、PDF.js 方案（推荐）</a>
<ul>
<li><a href="#1-%E5%9F%BA%E7%A1%80%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4">1. **基础实现步骤</a></li>
<li><a href="#2-%E8%B7%A8%E5%9F%9F%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">2. <strong>跨域解决方案</strong></a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-pdfobject-%E8%BD%BB%E9%87%8F%E6%96%B9%E6%A1%88">三、PDFObject 轻量方案</a></li>
<li><a href="#%E5%9B%9B-%E5%BE%AE%E8%BD%AF%E5%9C%A8%E7%BA%BF%E9%A2%84%E8%A7%88%E6%9C%8D%E5%8A%A1">四、微软在线预览服务</a></li>
<li><a href="#%E4%BA%94-%E6%96%87%E4%BB%B6%E8%BD%AC%E5%9B%BE%E7%89%87%E6%96%B9%E6%A1%88">五、文件转图片方案</a>
<ul>
<li><a href="#1-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%BD%AC%E6%8D%A2">1. 服务端转换</a></li>
<li><a href="#2-%E5%89%8D%E7%AB%AF%E8%BD%AC%E6%8D%A2%E9%9C%80-pdfjs-%E9%85%8D%E5%90%88">2. 前端转换（需 <code>pdf.js</code> 配合）</a></li>
</ul>
</li>
<li><a href="#%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94%E4%B8%8E%E9%80%89%E5%9E%8B%E5%BB%BA%E8%AE%AE">方案对比与选型建议</a></li>
<li><a href="#%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0%E6%8A%80%E5%B7%A7">高级功能实现技巧</a></li>
<li><a href="#%E9%83%A8%E7%BD%B2%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">部署注意事项</a></li>
<li><a href="#%E4%BB%A5%E4%B8%8A%E6%96%B9%E6%A1%88%E5%8F%AF%E6%A0%B9%E6%8D%AE%E9%A1%B9%E7%9B%AE%E9%9C%80%E6%B1%82%E7%BB%84%E5%90%88%E4%BD%BF%E7%94%A8%E4%BE%8B%E5%A6%82%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97%E4%BD%BF%E7%94%A8-pdfjs-%E5%AE%9E%E7%8E%B0%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD%E8%BE%85%E5%8A%A9%E6%A8%A1%E5%9D%97%E9%87%87%E7%94%A8%E5%BE%AE%E8%BD%AF%E5%9C%A8%E7%BA%BF%E9%A2%84%E8%A7%88%E6%9C%8D%E5%8A%A1%E9%99%8D%E4%BD%8E%E6%88%90%E6%9C%AC">以上方案可根据项目需求组合使用，例如：核心模块使用 PDF.js 实现高级功能，辅助模块采用微软在线预览服务降低成本。</a></li>
</ul>
</li>
<li><a href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E5%88%92%E8%AF%8D%E9%80%89%E6%8B%A9%E7%9A%84%E6%96%87%E6%9C%AC%E4%B8%8A%E6%B7%BB%E5%8A%A0%E5%8F%B3%E9%94%AE%E8%8F%9C%E5%8D%95%E5%88%92%E8%AF%8D%E9%BC%A0%E6%A0%87%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E4%B8%80%E7%BB%84%E5%AD%97%E7%AC%A6%E5%AF%B9%E8%BF%99%E7%BB%84%E5%AD%97%E7%AC%A6%E8%BF%9B%E8%A1%8C%E6%93%8D%E4%BD%9C%E7%83%AD%E9%97%A8">如何在划词选择的文本上添加右键菜单（划词：鼠标滑动选择一组字符，对这组字符进行操作）【热门】</a>
<ul>
<li><a href="#%E4%B8%80-%E6%A0%B8%E5%BF%83%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-1">一、核心实现原理</a></li>
<li><a href="#%E4%BA%8C-%E5%85%B3%E9%94%AE%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4">二、关键实现步骤</a>
<ul>
<li><a href="#1-%E8%87%AA%E5%AE%9A%E4%B9%89%E8%8F%9C%E5%8D%95%E7%BB%84%E4%BB%B6">1. 自定义菜单组件</a></li>
<li><a href="#2-%E7%B2%BE%E5%87%86%E5%AE%9A%E4%BD%8D%E7%AE%97%E6%B3%95">2. 精准定位算法</a></li>
<li><a href="#3-%E9%80%89%E4%B8%AD%E7%8A%B6%E6%80%81%E4%BF%9D%E6%8C%81">3. 选中状态保持</a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E8%BF%9B%E9%98%B6%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88">三、进阶优化方案</a>
<ul>
<li><a href="#1-%E8%B7%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9">1. 跨浏览器兼容</a></li>
<li><a href="#2-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96">2. 性能优化</a></li>
<li><a href="#3-%E5%8A%A8%E6%80%81%E8%8F%9C%E5%8D%95%E7%94%9F%E6%88%90">3. 动态菜单生成</a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-%E4%B8%BB%E6%B5%81%E6%A1%86%E6%9E%B6%E9%9B%86%E6%88%90">四、主流框架集成</a>
<ul>
<li><a href="#vue-%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88">Vue 实现方案</a></li>
<li><a href="#react-%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88">React 实现方案</a></li>
</ul>
</li>
<li><a href="#%E4%BA%94-%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7">五、调试技巧</a></li>
<li><a href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9-2">注意事项</a></li>
<li><a href="#%E4%BB%A5%E4%B8%8A%E6%96%B9%E6%A1%88%E7%BB%8F%E8%BF%87%E5%A4%9A%E5%9C%BA%E6%99%AF%E9%AA%8C%E8%AF%81%E6%94%AF%E6%8C%81%E5%9C%A8%E5%A4%8D%E6%9D%82%E5%AF%8C%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8-%E9%95%BF%E6%96%87%E6%A1%A3%E7%AD%89%E5%9C%BA%E6%99%AF%E4%B8%8B%E7%A8%B3%E5%AE%9A%E8%BF%90%E8%A1%8C%E5%A6%82%E9%9C%80%E5%A4%84%E7%90%86%E7%89%B9%E6%AE%8A%E6%A0%BC%E5%BC%8F%E6%96%87%E6%9C%AC%E5%A6%82%E8%A1%A8%E6%A0%BC-%E4%BB%A3%E7%A0%81%E5%9D%97%E5%8F%AF%E7%BB%93%E5%90%88-range-api-%E8%BF%9B%E8%A1%8C%E6%89%A9%E5%B1%95%E5%BC%80%E5%8F%91">以上方案经过多场景验证，支持在复杂富文本编辑器、长文档等场景下稳定运行。如需处理特殊格式文本（如表格、代码块），可结合 <code>Range</code> API 进行扩展开发。</a></li>
</ul>
</li>
<li><a href="#%E6%9C%89%E4%B8%80%E4%B8%AA%E5%8A%A8%E6%80%81%E8%A1%A8%E6%A0%BC500500%E6%AF%8F%E6%A0%BC%E9%83%BD%E6%98%AF%E5%8F%AF%E4%BB%A5%E5%88%87%E6%8D%A2%E6%88%90%E4%B8%8D%E5%90%8C%E7%9A%84%E8%A1%A8%E5%8D%95%E9%A1%B9%E6%AF%94%E5%A6%82%E6%AF%8F%E6%A0%BC%E5%8F%AF%E4%BB%A5%E6%8D%A2%E6%88%90%E8%BE%93%E5%85%A5%E6%A1%86-%E4%B8%8B%E6%8B%89%E9%80%89%E6%8B%A9-%E5%8D%95%E9%80%89-%E5%A4%9A%E9%80%89%E7%AD%89%E6%80%8E%E4%B9%88%E5%9C%A8%E7%BC%96%E8%BE%91%E6%80%81%E7%9A%84%E6%97%B6%E5%80%99%E4%BC%98%E5%8C%96%E5%8D%A1%E9%A1%BF%E7%9A%84%E6%83%85%E5%86%B5-1">有一个动态表格，500*500，每格都是可以切换成不同的表单项，比如每格可以换成输入框、下拉选择、单选、多选等，怎么在编辑态的时候，优化卡顿的情况</a>
<ul>
<li><a href="#%E4%B8%80-%E6%B8%B2%E6%9F%93%E7%AD%96%E7%95%A5%E4%BC%98%E5%8C%96">一、渲染策略优化</a></li>
<li><a href="#%E4%BA%8C-%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E4%BC%98%E5%8C%96">二、数据管理优化</a></li>
<li><a href="#%E4%B8%89-%E7%BB%84%E4%BB%B6%E7%BA%A7%E4%BC%98%E5%8C%96">三、组件级优化</a></li>
<li><a href="#%E5%9B%9B-%E6%9E%B6%E6%9E%84%E7%BA%A7%E4%BC%98%E5%8C%96">四、架构级优化</a></li>
<li><a href="#%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E6%96%B9%E6%A1%88">性能监控方案</a></li>
<li><a href="#%E4%BC%98%E5%8C%96%E6%95%88%E6%9E%9C%E5%AF%B9%E6%AF%94">优化效果对比</a></li>
</ul>
</li>
<li><a href="#%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7-vite-%E7%9A%84%E5%8E%9F%E7%90%86%E6%98%AF%E4%BB%80%E4%B9%88%E7%83%AD%E6%9B%B4%E6%96%B0%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%88%E6%98%AF%E4%BB%80%E4%B9%88">构建工具 Vite 的原理是什么？热更新的原理又是什么？</a>
<ul>
<li><a href="#%E4%B8%80-vite-%E7%9A%84%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86">一、Vite 的核心原理</a>
<ul>
<li><a href="#1-%E5%9F%BA%E4%BA%8E%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%94%9F-esm-%E7%9A%84%E6%8C%89%E9%9C%80%E7%BC%96%E8%AF%91">1. <strong>基于浏览器原生 ESM 的按需编译</strong></a></li>
<li><a href="#2-%E5%BC%80%E5%8F%91%E4%B8%8E%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E5%88%86%E7%A6%BB">2. <strong>开发与生产环境分离</strong></a></li>
<li><a href="#3-%E6%A8%A1%E5%9D%97%E4%BE%9D%E8%B5%96%E5%9B%BE%E4%B8%8E%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6">3. <strong>模块依赖图与缓存机制</strong></a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C-vite-%E7%9A%84%E7%83%AD%E6%9B%B4%E6%96%B0hmr%E5%8E%9F%E7%90%86">二、Vite 的热更新（HMR）原理</a>
<ul>
<li><a href="#1-%E9%80%9A%E4%BF%A1%E5%B1%82websocket-%E5%AE%9E%E6%97%B6%E5%8F%8C%E5%90%91%E9%80%9A%E4%BF%A1">1. <strong>通信层：WebSocket 实时双向通信</strong></a></li>
<li><a href="#2-%E6%9B%B4%E6%96%B0%E8%A7%A6%E5%8F%91%E4%B8%8E%E5%A4%84%E7%90%86">2. <strong>更新触发与处理</strong></a></li>
<li><a href="#3-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5">3. <strong>性能优化策略</strong></a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E4%B8%8E%E4%BC%A0%E7%BB%9F%E5%B7%A5%E5%85%B7%E5%A6%82-webpack%E7%9A%84%E5%AF%B9%E6%AF%94">三、与传统工具（如 Webpack）的对比</a></li>
<li><a href="#%E5%9B%9B-%E6%8A%80%E6%9C%AF%E4%BC%98%E5%8A%BF%E6%80%BB%E7%BB%93">四、技术优势总结</a></li>
<li><a href="#%E9%99%84vite-%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E7%A4%BA%E6%84%8F%E5%9B%BE">附：Vite 工作流程示意图</a></li>
</ul>
</li>
<li><a href="#%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%9A%84%E9%A6%96%E5%B1%8F%E5%8A%A0%E8%BD%BD%E9%80%9F%E5%BA%A6%E6%8F%90%E5%8D%87%E7%99%BE%E5%88%86%E4%B9%8B-40%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F%E6%98%AF%E4%BB%80%E4%B9%88">小程序的首屏加载速度提升百分之 40%的实现方式是什么？</a></li>
<li><a href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86%E6%98%AF%E4%BB%80%E4%B9%88%E5%89%8D%E7%AB%AF%E5%85%B7%E4%BD%93%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E7%9A%84">自动化部署的基本原理是什么？前端具体怎么实现的？</a>
<ul>
<li><a href="#%E4%B8%80-%E4%BB%A3%E7%A0%81%E7%AE%A1%E7%90%86%E4%B8%8E%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6">一、代码管理与版本控制</a></li>
<li><a href="#%E4%BA%8C-%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA%E4%B8%8E%E6%B5%8B%E8%AF%95">二、自动化构建与测试</a></li>
<li><a href="#%E4%B8%89-%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E4%B8%8E%E9%83%A8%E7%BD%B2cicd">三、持续集成与部署（CI/CD）</a></li>
<li><a href="#%E5%9B%9B-%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%E4%B8%8E%E7%9B%91%E6%8E%A7">四、服务器配置与监控</a></li>
<li><a href="#%E4%BA%94-%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5%E4%B8%8E%E5%B7%A5%E5%85%B7%E9%80%89%E5%9E%8B">五、优化策略与工具选型</a></li>
<li><a href="#%E5%85%AD-%E5%B7%A5%E5%85%B7%E9%93%BE%E5%AF%B9%E6%AF%94%E4%B8%8E%E6%8E%A8%E8%8D%90">六、工具链对比与推荐</a></li>
<li><a href="#%E6%80%BB%E7%BB%93%E5%BB%BA%E8%AE%AE-1">总结建议</a></li>
</ul>
</li>
<li><a href="#%E5%AF%B9%E4%BA%8E%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E4%BD%A0%E9%83%BD%E6%98%AF%E9%80%9A%E8%BF%87%E4%BB%80%E4%B9%88%E6%96%B9%E5%BC%8F%E9%A2%84%E9%98%B2%E6%88%96%E8%A7%84%E9%81%BF%E7%9A%84">对于内存泄漏，你都是通过什么方式预防或规避的？</a>
<ul>
<li><a href="#%E4%B8%80-%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E9%A2%84%E9%98%B2">一、编码规范预防</a></li>
<li><a href="#%E4%BA%8C-%E6%8A%80%E6%9C%AF%E7%AD%96%E7%95%A5%E4%BC%98%E5%8C%96">二、技术策略优化</a></li>
<li><a href="#%E4%B8%89-%E5%B7%A5%E5%85%B7%E9%93%BE%E6%94%AF%E6%8C%81">三、工具链支持</a></li>
<li><a href="#%E5%9B%9B-%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%BB%BA%E8%AE%AE">四、架构设计建议</a></li>
<li><a href="#%E5%85%B3%E9%94%AE%E5%B7%A5%E5%85%B7%E4%B8%8E%E6%A3%80%E6%B5%8B%E6%96%B9%E6%B3%95%E9%80%9F%E6%9F%A5%E8%A1%A8">关键工具与检测方法速查表</a></li>
</ul>
</li>
<li><a href="#%E5%89%8D%E7%AB%AF%E6%80%8E%E4%B9%88%E5%A4%84%E7%90%86%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F">前端怎么处理内存泄漏</a></li>
<li><a href="#vue20-%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E6%9C%89%E5%93%AA%E4%BA%9B%E5%88%86%E5%88%AB%E5%81%9A%E4%BA%86%E4%BB%80%E4%B9%88%E4%BA%8B%E6%83%85%E4%B8%8E-vue30-%E6%9C%89%E5%93%AA%E4%BA%9B%E5%8C%BA%E5%88%AB">Vue2.0 的生命周期有哪些？分别做了什么事情？与 Vue3.0 有哪些区别？</a>
<ul>
<li><a href="#vue20-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E8%AF%A6%E8%A7%A3">Vue2.0 生命周期详解</a>
<ul>
<li><a href="#%E4%B8%80-vue20-%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E9%92%A9%E5%AD%90%E5%8F%8A%E4%BD%9C%E7%94%A8">一、Vue2.0 的生命周期钩子及作用</a></li>
</ul>
</li>
<li><a href="#vue20-%E4%B8%8E-vue30-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%8C%BA%E5%88%AB">Vue2.0 与 Vue3.0 生命周期区别</a>
<ul>
<li><a href="#%E4%BA%8C-%E6%A0%B8%E5%BF%83%E5%B7%AE%E5%BC%82%E5%AF%B9%E6%AF%94">二、核心差异对比</a></li>
<li><a href="#%E4%B8%89-vue30-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E6%98%A0%E5%B0%84%E8%A1%A8">三、Vue3.0 生命周期映射表</a></li>
</ul>
</li>
<li><a href="#%E6%80%BB%E7%BB%93%E5%BB%BA%E8%AE%AE-2">总结建议</a></li>
</ul>
</li>
<li><a href="#%E5%AF%B9-react-%E4%B8%AD%E7%9A%84%E8%99%9A%E6%8B%9F-dom-%E6%98%AF%E6%80%8E%E4%B9%88%E7%90%86%E8%A7%A3%E7%9A%84react-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%BC%95%E8%BF%9B%E8%99%9A%E6%8B%9F-dom%E6%93%8D%E4%BD%9C%E8%99%9A%E6%8B%9F-dom-%E7%9A%84%E6%80%A7%E8%83%BD%E4%B8%80%E5%AE%9A%E4%BC%9A%E6%AF%94%E6%93%8D%E4%BD%9C%E5%AE%9E%E9%99%85-dom-%E7%9A%84%E6%80%A7%E8%83%BD%E8%A6%81%E5%A5%BD%E5%98%9B%E5%A6%82%E6%9E%9C%E5%9B%9E%E7%AD%94%E4%B8%8D%E4%B8%80%E5%AE%9A%E5%88%99%E4%BC%9A%E8%BF%BD%E9%97%AE%E8%AF%B7%E4%B8%BE%E4%B8%A4%E5%88%B0%E4%B8%89%E4%BE%8B%E5%AE%9E%E9%99%85%E5%9C%BA%E6%99%AF%E8%AF%B4%E6%98%8E">对 React 中的虚拟 Dom 是怎么理解的？React 为什么要引进虚拟 Dom？操作虚拟 Dom 的性能一定会比操作实际 Dom 的性能要好嘛？【如果回答不一定，则会追问：请举两到三例实际场景说明】</a>
<ul>
<li><a href="#%E4%B8%80-%E5%8D%95%E5%85%83%E7%B4%A0%E7%AE%80%E5%8D%95%E5%B1%9E%E6%80%A7%E4%BF%AE%E6%94%B9%E5%A6%82%E5%88%87%E6%8D%A2%E6%8C%89%E9%92%AE%E7%8A%B6%E6%80%81">一、单元素简单属性修改（如切换按钮状态）</a></li>
<li><a href="#%E4%BA%8C-%E9%AB%98%E9%A2%91%E5%8A%A8%E7%94%BB%E6%88%96%E7%94%A8%E6%88%B7%E4%BA%A4%E4%BA%92%E5%A6%82%E6%8B%96%E6%8B%BD-%E6%BB%9A%E5%8A%A8">二、高频动画或用户交互（如拖拽、滚动）</a></li>
<li><a href="#%E4%B8%89-%E7%8B%AC%E7%AB%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E9%9B%86%E6%88%90%E5%A6%82-d3js-echarts">三、独立第三方库集成（如 D3.js、ECharts）</a></li>
<li><a href="#%E6%80%BB%E7%BB%93%E6%80%A7%E8%83%BD%E5%8F%96%E8%88%8D%E7%9A%84%E5%85%B3%E9%94%AE%E5%9B%A0%E7%B4%A0">总结：性能取舍的关键因素</a></li>
<li><a href="#%E9%80%9A%E8%BF%87%E9%92%88%E5%AF%B9%E6%80%A7%E4%BC%98%E5%8C%96%E5%BC%80%E5%8F%91%E8%80%85%E5%8F%AF%E5%9C%A8%E7%89%B9%E5%AE%9A%E5%9C%BA%E6%99%AF%E4%B8%8B%E7%AA%81%E7%A0%B4%E8%99%9A%E6%8B%9F-dom-%E7%9A%84%E6%80%A7%E8%83%BD%E7%93%B6%E9%A2%88%E5%AE%9E%E7%8E%B0%E6%9B%B4%E6%9E%81%E8%87%B4%E7%9A%84%E4%BA%A4%E4%BA%92%E4%BD%93%E9%AA%8C">通过针对性优化，开发者可在特定场景下突破虚拟 DOM 的性能瓶颈，实现更极致的交互体验。</a></li>
</ul>
</li>
<li><a href="#%E6%9C%89%E6%B2%A1%E6%9C%89%E5%AF%B9-e-charts-%E7%9A%84%E9%9C%80%E6%B1%82%E5%81%9A%E8%BF%87%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%A6%82%E6%9E%9C%E6%95%B0%E6%8D%AE%E9%87%8F%E5%BE%88%E5%A4%9A%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%E6%AF%94%E5%A6%82-10000%E6%9D%A1%E6%95%B0%E6%8D%AE%E7%94%A8-e-charts-%E5%AE%9E%E7%8E%B0%E7%9A%84%E6%95%B0%E6%8D%AE%E6%A6%82%E8%A7%88%E6%98%BE%E7%A4%BA%E5%9C%A8%E9%AB%98%E6%B8%85%E5%A4%A7%E5%B1%8F%E4%B8%8A%E4%B8%94%E8%BF%99%E4%BA%9B%E6%95%B0%E6%8D%AE%E9%83%BD%E8%A6%81%E6%98%BE%E7%A4%BA%E5%9C%A8%E9%A1%B5%E9%9D%A2%E5%B7%A6%E5%8F%B3%E6%BB%91%E5%8A%A8%E7%9A%84%E8%BF%87%E7%A8%8B%E4%B8%AD%E4%BF%9D%E8%AF%81%E6%B5%81%E7%95%85%E7%BF%BB%E9%A1%B5%E8%AF%B7%E6%B1%82%E7%9A%84%E4%B8%8D%E7%AE%97%E5%AE%9E%E9%99%85%E4%B8%8A%E8%AF%B7%E6%B1%82%E6%B8%B2%E6%9F%93%E8%BF%87%E7%A8%8B%E4%B8%AD%E5%B9%B6%E4%B8%8D%E6%B5%81%E7%95%85%E6%9C%89%E6%B2%A1%E6%9C%89%E5%A5%BD%E7%9A%84%E6%80%9D%E8%B7%AF%E5%8E%BB%E5%AE%9E%E7%8E%B0">有没有对 E-charts 的需求做过性能优化？如果数据量很多的情况下，比如 10000+条数据，用 E-charts 实现的数据概览显示在高清大屏上，且这些数据都要显示，在页面左右滑动的过程中保证流畅（翻页请求的不算，实际上请求+渲染过程中并不流畅），有没有好的思路去实现？</a></li>
<li><a href="#%E8%99%9A%E6%8B%9F%E5%88%97%E8%A1%A8%E5%85%B7%E4%BD%93%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B%E5%90%8C%E6%A0%B7%E7%9A%84%E8%99%9A%E6%8B%9F%E5%88%97%E8%A1%A8%E5%9C%A8-pc-%E7%AB%AF%E6%97%B6%E6%98%BE%E7%A4%BA%E6%97%B6%E5%A6%82%E6%9E%9C%E7%94%A8%E6%88%B7%E5%B0%86%E6%BB%9A%E5%8A%A8%E6%9D%A1%E5%BF%AB%E9%80%9F%E7%9A%84%E4%B8%8B%E6%BB%91%E8%87%B3%E5%BA%95%E9%83%A8%E4%BD%A0%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E5%B9%B3%E6%BB%91%E8%BF%87%E6%B8%A1%E5%88%B0%E6%8C%87%E5%AE%9A%E7%9A%84%E4%BD%8D%E7%BD%AE%E5%B9%B6%E6%98%BE%E7%A4%BA%E8%8A%82%E7%82%B9%E6%AF%94%E5%A6%82%E5%83%8F%E6%B7%98%E5%AE%9D%E4%BA%AC%E4%B8%9C%E7%9A%84%E5%95%86%E5%93%81%E5%88%97%E8%A1%A8%E5%AE%9E%E7%8E%B0%E6%88%91%E8%BF%9B%E5%8E%BB%E7%9C%8B%E7%9A%84%E6%97%B6%E5%80%99%E6%80%8E%E4%B9%88%E4%B8%8D%E6%98%AF%E8%BF%99%E6%A0%B7%E7%9A%84%E4%B9%9F%E6%98%AF%E4%B8%80%E9%A1%B5%E4%B8%80%E9%A1%B5%E5%8A%A0%E8%BD%BD%E7%9A%84%E5%93%87%E9%9A%BE%E9%81%93%E6%88%91%E7%9C%8B%E7%9A%84%E6%98%AF%E5%81%87%E7%9A%84%E8%BF%99%E9%87%8C%E6%B3%A8%E6%84%8F%E9%9D%A2%E8%AF%95%E5%AE%98%E6%A0%B9%E6%8D%AE%E6%88%91%E7%9A%84%E5%9B%9E%E7%AD%94%E8%BF%BD%E9%97%AE%E4%BA%86%E4%B8%80%E4%BA%9B%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98%E6%9C%AC%E8%B4%A8%E6%A0%B8%E5%BF%83%E8%BF%98%E6%98%AF%E6%83%B3%E8%A6%81%E7%9F%A5%E9%81%93%E5%AF%B9%E4%BA%8E%E8%BF%99%E7%A7%8D%E9%97%AE%E9%A2%98%E4%BD%A0%E6%98%AF%E6%80%8E%E4%B9%88%E6%83%B3%E5%8A%9E%E6%B3%95%E5%81%9A%E5%88%B0%E5%B9%B3%E6%BB%91%E8%BF%87%E6%B8%A1%E8%BF%99%E9%87%8C%E7%9A%84%E5%B9%B3%E6%BB%91%E8%BF%87%E6%B8%A1%E4%B8%8D%E4%BB%85%E4%BB%85%E5%8F%AA%E6%98%AF%E6%98%BE%E7%A4%BA%E5%AF%B9%E5%BA%94%E7%9A%84%E6%95%B0%E6%8D%AE%E8%BF%98%E8%A6%81%E4%B8%9D%E6%BB%91%E7%9A%84%E6%B8%B2%E6%9F%93%E5%87%BA%E8%BF%99%E4%BA%9B%E5%AF%B9%E5%BA%94%E6%95%B0%E6%8D%AE%E8%BF%99%E4%BA%9B%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%83%BD%E5%8C%85%E5%90%AB%E5%9B%BE%E7%89%87-%E6%96%87%E6%A1%88-%E6%95%B0%E6%8D%AE%E7%AD%89%E7%AD%89%E5%BE%88%E5%A4%9A%E6%95%B0%E6%8D%AE">虚拟列表具体的实现过程？同样的虚拟列表在 PC 端时显示时，如果用户将滚动条快速的下滑至底部，你怎么实现平滑过渡到指定的位置并显示节点？（比如像淘宝，京东的商品列表实现【我进去看的时候怎么不是这样的？也是一页一页加载的哇，难道我看的是假的？？？】）【这里注意，面试官根据我的回答追问了一些相关问题，本质核心还是想要知道对于这种问题，你是怎么想办法做到平滑过渡，这里的平滑过渡不仅仅只是显示对应的数据，还要丝滑的渲染出这些对应数据，这些数据可能包含图片、文案、数据等等很多数据】</a></li>
<li><a href="#%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%9A%84%E5%88%86%E5%8C%85%E7%AD%96%E7%95%A5%E5%AE%9E%E9%99%85%E4%B8%8A%E6%98%AF%E5%81%9A%E4%BA%86%E4%BB%80%E4%B9%88">小程序的分包策略实际上是做了什么？</a>
<ul>
<li><a href="#%E4%B8%80-%E4%BB%A3%E7%A0%81%E4%B8%8E%E8%B5%84%E6%BA%90%E5%88%86%E5%89%B2">一、代码与资源分割</a></li>
<li><a href="#%E4%BA%8C-%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD%E4%B8%8E%E6%89%A7%E8%A1%8C">二、动态加载与执行</a></li>
<li><a href="#%E4%B8%89-%E7%BC%93%E5%AD%98%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96">三、缓存与性能优化</a></li>
<li><a href="#%E5%9B%9B-%E5%B7%A5%E7%A8%8B%E5%8C%96%E7%BA%A6%E6%9D%9F">四、工程化约束</a></li>
<li><a href="#%E4%BA%94-%E7%89%B9%E6%AE%8A%E5%9C%BA%E6%99%AF%E5%A4%84%E7%90%86-1">五、特殊场景处理</a></li>
<li><a href="#%E9%80%9A%E8%BF%87%E5%88%86%E5%8C%85%E7%AD%96%E7%95%A5%E5%BC%80%E5%8F%91%E8%80%85%E6%97%A2%E8%83%BD%E7%AA%81%E7%A0%B4%E5%8C%85%E4%BD%93%E7%A7%AF%E9%99%90%E5%88%B6%E5%8F%88%E8%83%BD%E5%AE%9E%E7%8E%B0%E5%90%AF%E5%8A%A8%E9%80%9F%E5%BA%A6%E6%8F%90%E5%8D%87-3-5-%E5%80%8D%E7%9A%84%E6%95%88%E6%9E%9C%E5%AE%9E%E9%99%85%E5%BC%80%E5%8F%91%E4%B8%AD%E5%BB%BA%E8%AE%AE%E7%BB%93%E5%90%88%E4%B8%9A%E5%8A%A1%E6%A8%A1%E5%9D%97%E5%88%92%E5%88%86%E5%88%86%E5%8C%85%E5%B9%B6%E9%80%9A%E8%BF%87%E9%A2%84%E5%8A%A0%E8%BD%BD%E5%B9%B3%E8%A1%A1%E7%94%A8%E6%88%B7%E4%BD%93%E9%AA%8C%E4%B8%8E%E6%B5%81%E9%87%8F%E6%B6%88%E8%80%97">通过分包策略，开发者既能突破包体积限制，又能实现启动速度提升 3-5 倍的效果。实际开发中建议结合业务模块划分分包，并通过预加载平衡用户体验与流量消耗。</a></li>
</ul>
</li>
<li><a href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86%E6%98%AF%E4%BB%80%E4%B9%88">自动化部署的基本原理是什么？</a>
<ul>
<li><a href="#%E4%B8%80-%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86">一、基本原理</a></li>
</ul>
</li>
<li><a href="#%E5%BD%93%E7%94%A8%E6%88%B7%E7%94%A8%E7%BD%91%E9%A1%B5%E7%B3%BB%E7%BB%9F%E6%97%B6%E5%8F%8D%E9%A6%88%E5%BE%88%E5%8D%A1%E4%BD%A0%E6%98%AF%E9%80%9A%E8%BF%87%E4%BB%80%E4%B9%88%E6%96%B9%E5%BC%8F%E5%AE%9A%E4%BD%8D%E9%97%AE%E9%A2%98%E5%85%B6%E5%AE%9E%E8%BF%99%E4%B8%AA%E9%97%AE%E9%A2%98%E4%B8%BB%E8%A6%81%E6%98%AF%E4%BD%A0%E4%BC%9A%E4%B8%8D%E4%BC%9A%E6%9C%9D%E9%9D%A2%E8%AF%95%E5%AE%98%E7%9A%84%E9%A2%84%E6%9C%9F%E7%AD%94%E6%A1%88%E5%9B%9E%E7%AD%94%E5%85%B6%E4%BB%96%E7%9A%84%E5%8F%AF%E5%AE%9A%E4%BD%8D%E9%97%AE%E9%A2%98%E7%9A%84%E5%8A%9E%E6%B3%95%E4%BB%96%E4%B8%8D%E5%9C%A8%E4%B9%8E">当用户用网页系统时反馈很卡，你是通过什么方式定位问题？【其实这个问题主要是你会不会朝面试官的预期答案回答，其他的可定位问题的办法他不在乎】</a></li>
<li><a href="#%E8%BF%98%E6%9C%89%E6%B2%A1%E6%9C%89%E5%85%B6%E4%BB%96%E7%9A%84%E4%BC%98%E5%8C%96%E5%9C%BA%E6%99%AF%E6%AF%94%E5%A6%82%E9%81%87%E5%88%B0%E8%BF%87%E7%9A%84%E9%A1%B5%E9%9D%A2%E5%8D%A1%E9%A1%BF%E9%97%AE%E9%A2%98%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9A%E4%BD%8D%E9%97%AE%E9%A2%98%E5%B9%B6%E8%A7%A3%E5%86%B3%E7%9A%84">还有没有其他的优化场景？比如遇到过的页面卡顿问题，是怎么定位问题并解决的？</a>
<ul>
<li><a href="#%E4%B8%80-%E7%94%A8%E6%88%B7%E4%BA%A4%E4%BA%92%E5%93%8D%E5%BA%94%E5%88%86%E6%9E%90">一、用户交互响应分析</a>
<ul>
<li><a href="#1-%E5%90%8C%E6%AD%A5%E4%BB%BB%E5%8A%A1%E9%98%BB%E5%A1%9E%E6%A3%80%E6%B5%8B">1. <strong>同步任务阻塞检测</strong></a></li>
<li><a href="#2-%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1%E5%8D%A1%E9%A1%BF%E5%AE%9A%E4%BD%8D">2. <strong>异步任务卡顿定位</strong></a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C-%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%80%A7%E8%83%BD%E5%89%96%E6%9E%90">二、代码执行性能剖析</a>
<ul>
<li><a href="#1-%E9%95%BF%E4%BB%BB%E5%8A%A1long-tasks%E6%A3%80%E6%B5%8B">1. <strong>长任务（Long Tasks）检测</strong></a></li>
<li><a href="#2-%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E6%8E%92%E6%9F%A5">2. <strong>内存泄漏排查</strong></a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E6%B8%B2%E6%9F%93%E6%B5%81%E7%A8%8B%E4%BC%98%E5%8C%96">三、渲染流程优化</a>
<ul>
<li><a href="#1-%E5%B8%83%E5%B1%80%E6%8A%96%E5%8A%A8layout-thrashing">1. <strong>布局抖动（Layout Thrashing）</strong></a></li>
<li><a href="#2-%E5%B8%A7%E7%8E%87fps%E7%9B%91%E6%B5%8B">2. <strong>帧率（FPS）监测</strong></a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-%E7%BD%91%E7%BB%9C%E4%B8%8E%E8%B5%84%E6%BA%90%E5%88%86%E6%9E%90">四、网络与资源分析</a>
<ul>
<li><a href="#1-%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD%E9%98%BB%E5%A1%9E">1. <strong>资源加载阻塞</strong></a></li>
<li><a href="#2-%E7%AC%AC%E4%B8%89%E6%96%B9%E8%84%9A%E6%9C%AC%E6%80%A7%E8%83%BD%E5%BD%B1%E5%93%8D">2. <strong>第三方脚本性能影响</strong></a></li>
</ul>
</li>
<li><a href="#%E4%BA%94-%E5%B7%A5%E5%85%B7%E9%93%BE%E8%BE%85%E5%8A%A9%E5%AE%9A%E4%BD%8D">五、工具链辅助定位</a>
<ul>
<li><a href="#1-chrome-devtools-%E6%B7%B1%E5%BA%A6%E5%88%86%E6%9E%90">1. <strong>Chrome DevTools 深度分析</strong></a></li>
<li><a href="#2-%E8%87%AA%E5%8A%A8%E5%8C%96%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0">2. <strong>自动化监控平台</strong></a></li>
</ul>
</li>
<li><a href="#%E5%85%AD-%E7%94%A8%E6%88%B7%E5%9C%BA%E6%99%AF%E5%A4%8D%E7%8E%B0%E7%AD%96%E7%95%A5">六、用户场景复现策略</a></li>
</ul>
</li>
<li><a href="#webpack-%E5%92%8C-vite-%E7%9A%84%E6%9E%84%E5%BB%BA%E5%8C%BA%E5%88%AB%E6%98%AF%E4%BB%80%E4%B9%88%E8%83%BD%E5%90%A6%E7%94%A8-webpack-%E5%AE%9E%E7%8E%B0%E5%89%8D%E7%AB%AF%E5%A4%A7%E4%BB%93%E5%BA%93%E9%87%8C%E5%8F%AA%E9%9C%80%E8%A6%81%E5%90%AF%E5%8A%A8-a-%E6%A8%A1%E5%9D%97%E4%BD%86%E6%98%AF-bcd-%E4%B8%8D%E5%90%AF%E5%8A%A8%E5%9B%A0%E4%B8%BA%E7%94%A8-webpack-%E6%89%93%E5%8C%85%E7%9A%84%E8%AF%9D%E6%98%AF%E5%85%A8%E9%87%8F%E7%9A%84%E6%9C%89%E6%B2%A1%E6%9C%89%E5%8A%9E%E6%B3%95%E5%AE%9E%E7%8E%B0%E5%8F%AA%E9%9C%80%E8%A6%81%E5%90%AF%E5%8A%A8-a-%E6%A8%A1%E5%9D%97%E4%BD%86%E6%98%AF-bcd-%E4%B8%8D%E5%90%AF%E5%8A%A8">Webpack 和 Vite 的构建区别是什么？能否用 Webpack 实现前端大仓库里只需要启动 A 模块，但是 B/C/D 不启动（因为用 Webpack 打包的话是全量的，有没有办法实现只需要启动 A 模块，但是 B/C/D 不启动）</a>
<ul>
<li><a href="#%E4%B8%80-webpack-%E4%B8%8E-vite-%E7%9A%84%E6%A0%B8%E5%BF%83%E6%9E%84%E5%BB%BA%E5%8C%BA%E5%88%AB">一、Webpack 与 Vite 的核心构建区别</a>
<ul>
<li><a href="#1-%E6%9E%84%E5%BB%BA%E6%9C%BA%E5%88%B6%E4%B8%8E%E9%80%9F%E5%BA%A6">1. <strong>构建机制与速度</strong></a></li>
<li><a href="#2-%E5%BC%80%E5%8F%91%E6%A8%A1%E5%BC%8F%E4%B8%8E%E7%83%AD%E6%9B%B4%E6%96%B0hmr">2. <strong>开发模式与热更新（HMR）</strong></a></li>
<li><a href="#3-%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E4%BC%98%E5%8C%96-1">3. <strong>生产环境优化</strong></a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C-webpack-%E5%AE%9E%E7%8E%B0%E6%A8%A1%E5%9D%97%E7%BA%A7%E6%8C%89%E9%9C%80%E5%90%AF%E5%8A%A8%E6%96%B9%E6%A1%88">二、Webpack 实现模块级按需启动方案</a>
<ul>
<li><a href="#1-%E4%BB%A3%E7%A0%81%E5%88%86%E5%89%B2code-splitting">1. <strong>代码分割（Code Splitting）</strong></a></li>
<li><a href="#2-%E4%BE%9D%E8%B5%96%E5%9B%BE%E4%BC%98%E5%8C%96">2. <strong>依赖图优化</strong></a></li>
<li><a href="#3-%E6%8C%89%E9%9C%80%E5%8A%A0%E8%BD%BD%E7%9A%84%E5%B7%A5%E7%A8%8B%E5%8C%96%E5%AE%9E%E8%B7%B5">3. <strong>按需加载的工程化实践</strong></a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-webpack-%E6%8C%89%E9%9C%80%E6%96%B9%E6%A1%88%E7%9A%84%E5%B1%80%E9%99%90%E6%80%A7%E5%8F%8A%E5%BB%BA%E8%AE%AE">三、Webpack 按需方案的局限性及建议</a>
<ul>
<li><a href="#1-%E4%B8%BB%E8%A6%81%E5%B1%80%E9%99%90">1. <strong>主要局限</strong></a></li>
<li><a href="#2-%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE">2. <strong>优化建议</strong></a></li>
</ul>
</li>
<li><a href="#%E5%BC%95%E7%94%A8%E6%9D%A5%E6%BA%90"><strong>引用来源</strong></a></li>
</ul>
</li>
<li><a href="#%E5%BD%93%E5%89%8D%E6%9C%89%E4%B8%80%E4%B8%AA-vue3-%E7%9A%84%E9%A1%B9%E7%9B%AE%E6%88%91%E6%83%B3%E5%9C%A8%E8%BF%99%E4%B8%AA%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9B%91%E6%8E%A7-fp-fcp-fmp-lcp-%E7%AD%89%E6%95%B0%E6%8D%AE%E5%BA%94%E8%AF%A5%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0">当前有一个 vue3 的项目，我想在这个项目中监控 fp, fcp, fmp, lcp 等数据，应该怎么实现？</a>
<ul>
<li><a href="#%E4%B8%80-%E4%BD%BF%E7%94%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%94%9F-performance-api%E5%8E%9F%E7%94%9F%E9%9B%86%E6%88%90%E6%96%B9%E6%A1%88">一、使用浏览器原生 Performance API（原生集成方案）</a>
<ul>
<li><a href="#1-fpfirst-paint%E4%B8%8E-fcpfirst-contentful-paint%E7%9B%91%E6%8E%A7">1. <strong>FP（First Paint）与 FCP（First Contentful Paint）监控</strong></a></li>
<li><a href="#2-lcplargest-contentful-paint%E7%9B%91%E6%8E%A7">2. <strong>LCP（Largest Contentful Paint）监控</strong></a></li>
<li><a href="#3-fmpfirst-meaningful-paint%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AE%A1%E7%AE%97">3. <strong>FMP（First Meaningful Paint）自定义计算</strong></a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C-%E9%9B%86%E6%88%90%E4%B8%93%E4%B8%9A%E7%9B%91%E6%8E%A7-sdk%E5%BC%80%E7%AE%B1%E5%8D%B3%E7%94%A8%E6%96%B9%E6%A1%88">二、集成专业监控 SDK（开箱即用方案）</a>
<ul>
<li><a href="#1-webtracing-%E4%B8%80%E7%AB%99%E5%BC%8F%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">1. <strong>WebTracing 一站式解决方案</strong></a></li>
<li><a href="#2-sentry-%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%A5%97%E4%BB%B6">2. <strong>Sentry 性能监控套件</strong></a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-vue-%E7%94%9F%E6%80%81%E5%AE%9A%E5%88%B6%E5%8C%96%E6%96%B9%E6%A1%88">三、Vue 生态定制化方案</a>
<ul>
<li><a href="#1-%E7%BB%84%E5%90%88%E5%BC%8F-api-%E5%B0%81%E8%A3%85%E7%9B%91%E6%8E%A7%E9%80%BB%E8%BE%91">1. <strong>组合式 API 封装监控逻辑</strong></a></li>
<li><a href="#2-%E8%B7%AF%E7%94%B1%E7%BA%A7%E6%80%A7%E8%83%BD%E9%87%87%E6%A0%B7">2. <strong>路由级性能采样</strong></a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%AA%8C%E8%AF%81%E4%B8%8E%E4%BC%98%E5%8C%96">四、开发环境验证与优化</a>
<ul>
<li><a href="#1-chrome-devtools-%E9%AA%8C%E8%AF%81">1. <strong>Chrome DevTools 验证</strong></a></li>
<li><a href="#2-%E6%9C%AC%E5%9C%B0%E6%A8%A1%E6%8B%9F%E5%BC%B1%E7%BD%91%E7%8E%AF%E5%A2%83">2. <strong>本地模拟弱网环境</strong></a></li>
</ul>
</li>
<li><a href="#%E6%95%B0%E6%8D%AE%E4%B8%8A%E6%8A%A5%E5%BB%BA%E8%AE%AE">数据上报建议</a></li>
<li><a href="#%E9%80%9A%E8%BF%87%E4%BB%A5%E4%B8%8A%E6%96%B9%E6%A1%88%E7%BB%84%E5%90%88%E6%97%A2%E5%8F%AF%E5%AE%9E%E7%8E%B0%E5%9F%BA%E7%A1%80%E7%9B%91%E6%8E%A7%E9%9C%80%E6%B1%82%E5%8F%88%E8%83%BD%E6%89%A9%E5%B1%95%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E6%A0%87%E5%BB%BA%E8%AE%AE%E4%BC%98%E5%85%88%E9%87%87%E7%94%A8-webtracing-%E6%88%96-sentry-%E6%96%B9%E6%A1%88%E7%BD%91%E9%A1%B5-17-%E9%99%8D%E4%BD%8E%E7%BB%B4%E6%8A%A4%E6%88%90%E6%9C%AC%E9%9C%80%E8%A6%81%E6%B7%B1%E5%BA%A6%E5%AE%9A%E5%88%B6%E6%97%B6%E5%86%8D%E7%BB%93%E5%90%88%E5%8E%9F%E7%94%9F-api-%E5%BC%80%E5%8F%91%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E9%9C%80%E9%85%8D%E5%90%88-nginx-%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E5%92%8C-grafana-%E7%9C%8B%E6%9D%BF%E5%AE%9E%E7%8E%B0%E5%85%A8%E9%93%BE%E8%B7%AF%E7%9B%91%E6%8E%A7">通过以上方案组合，既可实现基础监控需求，又能扩展自定义指标。建议优先采用 <strong>WebTracing 或 Sentry 方案</strong>（网页 1/7） 降低维护成本，需要深度定制时再结合原生 API 开发。生产环境需配合 Nginx 日志分析和 Grafana 看板实现全链路监控。</a></li>
</ul>
</li>
<li><a href="#js-%E4%B8%AD%E7%9A%84%E6%9C%80%E5%A4%A7%E6%95%B0%E6%98%AF%E5%A4%9A%E5%B0%91%E4%B8%BA%E4%BB%80%E4%B9%88">js 中的最大数是多少，为什么？</a></li>
<li><a href="#new-filereaderreadasdataurlcanvastodataurl-%E5%92%8C-urlcreateobjecturl-%E6%96%B9%E6%B3%95%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB">new FileReader().readAsDataURL，canvas.toDataURL 和 URL.createObjectURL 方法有什么区别</a></li>
<li><a href="#scss-loader-postcss-loader-css-loader-style-loader-%E7%9A%84%E4%BD%9C%E7%94%A8%E5%92%8C%E5%8C%BA%E5%88%AB">scss-loader, postcss-loader, css-loader, style-loader 的作用和区别</a>
<ul>
<li><a href="#%E4%B8%80-%E6%A0%B8%E5%BF%83%E4%BD%9C%E7%94%A8%E5%AF%B9%E6%AF%94">一、<strong>核心作用对比</strong></a></li>
<li><a href="#%E4%BA%8C-%E5%8D%8F%E4%BD%9C%E6%B5%81%E7%A8%8B%E4%B8%8E%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F">二、<strong>协作流程与执行顺序</strong></a>
<ul>
<li><a href="#1-%E5%85%B8%E5%9E%8B%E9%85%8D%E7%BD%AE%E9%93%BE">1. <strong>典型配置链</strong></a></li>
<li><a href="#2-%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F%E8%AF%B4%E6%98%8E">2. <strong>执行顺序说明</strong></a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E6%A0%B8%E5%BF%83%E5%8C%BA%E5%88%AB%E8%AF%A6%E8%A7%A3">三、<strong>核心区别详解</strong></a>
<ul>
<li><a href="#1-%E5%8A%9F%E8%83%BD%E8%BE%B9%E7%95%8C">1. <strong>功能边界</strong></a></li>
<li><a href="#2-%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB">2. <strong>依赖关系</strong></a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE">四、<strong>生产环境优化建议</strong></a></li>
<li><a href="#%E4%BA%94-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E4%B8%8E%E8%B0%83%E8%AF%95">五、<strong>常见问题与调试</strong></a>
<ul>
<li><a href="#1-loader-%E9%A1%BA%E5%BA%8F%E9%94%99%E8%AF%AF">1. <strong>Loader 顺序错误</strong></a></li>
<li><a href="#2-postcss-%E9%85%8D%E7%BD%AE%E7%BC%BA%E5%A4%B1">2. <strong>PostCSS 配置缺失</strong></a></li>
</ul>
</li>
<li><a href="#%E6%80%BB%E7%BB%93-8">总结</a></li>
</ul>
</li>
<li><a href="#axios-%E7%9A%84%E8%AF%B7%E6%B1%82%E6%8B%A6%E6%88%AA%E5%92%8C%E5%93%8D%E5%BA%94%E6%8B%A6%E6%88%AA%E5%AE%9E%E7%8E%B0">axios 的请求拦截和响应拦截实现</a></li>
<li><a href="#vue-%E5%92%8C-react-%E9%87%8C%E9%9D%A2%E5%B0%81%E8%A3%85-modal-%E8%BF%99%E6%A0%B7%E7%9A%84%E7%BB%84%E4%BB%B6%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E4%BB%80%E4%B9%88%E6%96%B9%E6%B3%95">vue 和 react 里面封装 Modal 这样的组件可以使用什么方法</a>
<ul>
<li><a href="#vue">vue</a></li>
<li><a href="#react">react</a></li>
</ul>
</li>
<li><a href="#%E4%B8%8A%E9%9D%A2%E8%AF%B4%E5%88%B0%E7%9A%84-amis-%E7%9A%84%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BA%BFevent-bus%E5%92%8C%E5%8A%A8%E4%BD%9C%E9%93%BEaction-chain%E5%8A%9F%E8%83%BD%E5%9C%A8-amis-%E7%9A%84%E6%BA%90%E7%A0%81%E9%87%8C%E9%9D%A2%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E7%9A%84">上面说到的 amis 的事件总线（Event Bus）和动作链（Action Chain）功能，在 amis 的源码里面是怎么实现的？</a>
<ul>
<li><a href="#%E4%B8%AA%E4%BA%BA%E6%80%BB%E7%BB%93">个人总结</a>
<ul>
<li><a href="#%E4%B8%80-%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BA%BFevent-bus%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86">一、事件总线（Event Bus）实现原理</a>
<ul>
<li><a href="#1-%E4%BA%8B%E4%BB%B6%E6%B4%BE%E5%8F%91dispatchevent">1. <strong>事件派发（<code>dispatchEvent</code>）</strong></a></li>
<li><a href="#2-%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AConevent">2. <strong>事件监听（<code>onEvent</code>）</strong></a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C-%E5%8A%A8%E4%BD%9C%E9%93%BEaction-chain%E6%89%A7%E8%A1%8C%E6%9C%BA%E5%88%B6">二、动作链（Action Chain）执行机制</a>
<ul>
<li><a href="#1-%E5%8A%A8%E4%BD%9C%E5%AE%9A%E4%B9%89%E4%B8%8E%E6%89%A7%E8%A1%8C">1. <strong>动作定义与执行</strong></a></li>
<li><a href="#2-%E5%8A%A8%E4%BD%9C%E9%93%BE%E9%A1%BA%E5%BA%8F%E6%8E%A7%E5%88%B6">2. <strong>动作链顺序控制</strong></a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E7%BB%84%E4%BB%B6%E9%97%B4%E9%80%9A%E4%BF%A1%E4%B8%8E%E6%95%B0%E6%8D%AE%E6%B5%81">三、组件间通信与数据流</a>
<ul>
<li><a href="#1-%E7%BB%84%E4%BB%B6%E6%A0%87%E8%AF%86%E4%B8%8E%E6%9F%A5%E6%89%BE">1. <strong>组件标识与查找</strong></a></li>
<li><a href="#2-%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0%E4%B8%8E%E5%93%8D%E5%BA%94">2. <strong>数据更新与响应</strong></a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7%E5%AE%9E%E7%8E%B0">四、高级特性实现</a>
<ul>
<li><a href="#1-%E8%B7%A8%E5%B1%82%E7%BA%A7%E9%80%9A%E4%BF%A1">1. <strong>跨层级通信</strong></a></li>
<li><a href="#2-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8A%A8%E4%BD%9C">2. <strong>自定义动作</strong></a></li>
</ul>
</li>
<li><a href="#%E4%BA%94-%E8%B0%83%E8%AF%95%E4%B8%8E%E6%89%A9%E5%B1%95">五、调试与扩展</a>
<ul>
<li><a href="#1-%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7">1. <strong>调试工具</strong></a></li>
<li><a href="#2-%E6%89%A9%E5%B1%95%E6%9C%BA%E5%88%B6">2. <strong>扩展机制</strong></a></li>
</ul>
</li>
<li><a href="#%E6%80%BB%E7%BB%93-9">总结</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#js-%E4%BD%BF%E7%94%A8-utf-16-%E8%BF%98%E6%98%AF-utf-8-%E7%BC%96%E7%A0%81">js 使用 utf-16 还是 utf-8 编码？</a>
<ul>
<li><a href="#%E4%B8%80-%E6%BA%90%E7%A0%81%E6%96%87%E4%BB%B6%E7%BC%96%E7%A0%81%E9%BB%98%E8%AE%A4%E6%94%AF%E6%8C%81-utf-8">一、源码文件编码：默认支持 UTF-8</a></li>
<li><a href="#%E4%BA%8C-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%86%85%E9%83%A8%E7%BC%96%E7%A0%81%E8%BF%90%E8%A1%8C%E6%97%B6%E4%BD%BF%E7%94%A8-utf-16">二、字符串内部编码：运行时使用 UTF-16</a></li>
<li><a href="#%E4%B8%89-%E7%BC%96%E7%A0%81%E5%B7%AE%E5%BC%82%E5%BC%95%E5%8F%91%E7%9A%84%E9%97%AE%E9%A2%98%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">三、编码差异引发的问题与解决方案</a></li>
<li><a href="#%E5%9B%9B-%E7%BC%96%E7%A0%81%E9%80%89%E6%8B%A9%E5%BB%BA%E8%AE%AE">四、编码选择建议</a></li>
<li><a href="#%E6%80%BB%E7%BB%93-10">总结</a></li>
</ul>
</li>
<li><a href="#%E5%B0%8F%E7%A8%8B%E5%BA%8F%E8%93%9D%E7%89%99%E5%BC%80%E9%97%A8%E7%9A%84%E9%A1%BA%E5%BA%8F">小程序蓝牙开门的顺序</a></li>
<li><a href="#%E6%9C%9D%E6%98%94%E9%97%AE%E5%8D%B7%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%A0%A1%E9%AA%8C%E9%80%BB%E8%BE%91">朝昔问卷系统的校验逻辑</a></li>
<li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%9C%A8-js-%E4%B8%AD--%E7%9A%84%E7%BB%93%E6%9E%9C%E6%98%AF-true">为什么在 js 中 ![]==[] 的结果是 true</a></li>
<li><a href="#sentry-%E5%8E%9F%E7%90%86">sentry 原理</a>
<ul>
<li><a href="#%E8%AF%A6%E7%BB%86%E8%AE%B2%E8%A7%A3">详细讲解</a></li>
</ul>
</li>
<li><a href="#nextjs-%E9%87%8C%E9%9D%A2%E4%BB%8E%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93%E5%88%87%E6%8D%A2%E5%88%B0%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B8%B2%E6%9F%93%E7%9A%84%E6%97%B6%E5%80%99%E5%AE%A2%E6%88%B7%E7%AB%AF-react-%E6%98%AF%E5%A6%82%E4%BD%95%E6%8E%A5%E7%AE%A1%E7%BB%84%E4%BB%B6%E8%BF%98%E6%9C%89%E7%8A%B6%E6%80%81%E7%AD%89">nextjs 里面从服务端渲染切换到客户端渲染的时候，客户端 React 是如何接管组件还有状态等？</a></li>
<li><a href="#%E5%9B%9B%E8%AF%B4%E4%B8%80%E8%AF%B4%E4%BB%8E%E8%BE%93%E5%85%A5-url-%E5%88%B0%E9%A1%B5%E9%9D%A2%E5%91%88%E7%8E%B0%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88">四.说一说从输入 URL 到页面呈现发生了什么</a>
<ul>
<li><a href="#%E5%90%88%E6%88%90%E5%B1%82">合成层</a></li>
<li><a href="#%E9%9A%90%E5%BC%8F%E5%90%88%E6%88%90">隐式合成</a></li>
<li><a href="#%E5%B1%82%E7%88%86%E7%82%B8%E4%B8%8E%E5%B1%82%E5%8E%8B%E7%BC%A9">层爆炸与层压缩</a></li>
<li><a href="#%E9%87%8D%E6%8E%92">重排</a></li>
<li><a href="#%E9%87%8D%E7%BB%98">重绘</a></li>
<li><a href="#%E5%90%88%E6%88%90">合成</a></li>
<li><a href="#css-%E5%8A%A8%E7%94%BB%E4%B8%BA%E4%BB%80%E4%B9%88%E6%AF%94-js-%E5%8A%A8%E7%94%BB%E9%AB%98%E6%95%88">css 动画为什么比 js 动画高效</a></li>
<li><a href="#%E9%A1%B5%E9%9D%A2%E6%B8%B2%E6%9F%93%E4%BC%98%E5%8C%96">页面渲染优化</a></li>
</ul>
</li>
<li><a href="#useeffect-%E5%92%8C-uselayouteffect-%E7%9A%84%E5%8C%BA%E5%88%AB">useEffect 和 useLayouteffect 的区别</a>
<ul>
<li><a href="#%E4%B8%80-%E6%89%A7%E8%A1%8C%E6%97%B6%E6%9C%BA">一、执行时机</a>
<ul>
<li><a href="#useeffect">useEffect</a></li>
<li><a href="#uselayouteffect">useLayoutEffect</a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C-%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF">二、使用场景</a>
<ul>
<li><a href="#%E7%A4%BA%E4%BE%8B%E5%AF%B9%E6%AF%94">示例对比：</a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E5%AF%B9%E6%B8%B2%E6%9F%93%E6%B5%81%E7%A8%8B%E7%9A%84%E5%BD%B1%E5%93%8D">三、对渲染流程的影响</a>
<ul>
<li><a href="#useeffect-1">useEffect</a></li>
<li><a href="#uselayouteffect-1">useLayoutEffect</a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F">四、执行顺序</a></li>
<li><a href="#%E4%BA%94-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93ssr">五、服务端渲染（SSR）</a></li>
<li><a href="#%E5%85%AD-%E6%80%A7%E8%83%BD%E4%B8%8E%E5%BB%BA%E8%AE%AE">六、性能与建议</a>
<ul>
<li><a href="#%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5">优化策略：</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#js-%E6%80%8E%E4%B9%88%E8%AE%A9%E4%B8%80%E4%B8%AA%E5%B1%9E%E6%80%A7%E5%8F%AA%E8%AF%BB">js 怎么让一个属性只读</a></li>
<li><a href="#%E5%89%8D%E7%AB%AF-ssr-%E6%80%8E%E4%B9%88%E8%AE%A9%E9%A1%B5%E9%9D%A2%E9%99%8D%E7%BA%A7%E4%B8%BA-csr-%E6%88%96-ssg">前端 ssr 怎么让页面降级为 csr 或 ssg</a>
<ul>
<li><a href="#%E4%B8%80-ssr-%E9%99%8D%E7%BA%A7%E4%B8%BA-csr-%E7%9A%84%E6%A0%B8%E5%BF%83%E6%80%9D%E8%B7%AF"><strong>一、SSR 降级为 CSR 的核心思路</strong></a>
<ul>
<li><a href="#1-%E9%94%99%E8%AF%AF%E6%8D%95%E8%8E%B7%E9%99%8D%E7%BA%A7">1. <strong>错误捕获降级</strong></a></li>
<li><a href="#2-%E6%80%A7%E8%83%BD%E9%98%88%E5%80%BC%E9%99%8D%E7%BA%A7">2. <strong>性能阈值降级</strong></a></li>
<li><a href="#3-%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%BF%80%E6%B4%BB-csr">3. <strong>客户端激活 CSR</strong></a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C-ssr-%E9%99%8D%E7%BA%A7%E4%B8%BA-ssg-%E7%9A%84%E5%AE%9E%E8%B7%B5%E6%96%B9%E6%A1%88"><strong>二、SSR 降级为 SSG 的实践方案</strong></a>
<ul>
<li><a href="#1-%E6%9E%84%E5%BB%BA%E6%97%B6%E9%A2%84%E7%94%9F%E6%88%90%E9%9D%99%E6%80%81%E9%A1%B5%E9%9D%A2">1. <strong>构建时预生成静态页面</strong></a></li>
<li><a href="#2-%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BC%98%E5%85%88%E4%BD%BF%E7%94%A8%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6">2. <strong>服务器优先使用静态文件</strong></a></li>
<li><a href="#3-%E6%B7%B7%E5%90%88%E6%B8%B2%E6%9F%93%E7%AD%96%E7%95%A5">3. <strong>混合渲染策略</strong></a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E5%8A%A8%E6%80%81%E9%99%8D%E7%BA%A7%E7%AD%96%E7%95%A5%E5%AE%9E%E7%8E%B0"><strong>三、动态降级策略实现</strong></a>
<ul>
<li><a href="#1-%E8%AF%B7%E6%B1%82%E5%A4%B4%E6%8E%A7%E5%88%B6%E6%A8%A1%E5%BC%8F">1. <strong>请求头控制模式</strong></a></li>
<li><a href="#2-%E5%8A%9F%E8%83%BD%E5%BC%80%E5%85%B3%E7%B3%BB%E7%BB%9F">2. <strong>功能开关系统</strong></a></li>
<li><a href="#3-ab-%E6%B5%8B%E8%AF%95%E5%88%86%E6%B5%81">3. <strong>A/B 测试分流</strong></a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-%E5%85%B3%E9%94%AE%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><strong>四、关键注意事项</strong></a></li>
<li><a href="#%E4%BA%94-%E7%8E%B0%E4%BB%A3%E6%A1%86%E6%9E%B6%E9%9B%86%E6%88%90%E6%96%B9%E6%A1%88"><strong>五、现代框架集成方案</strong></a>
<ul>
<li><a href="#1-nextjs-%E8%87%AA%E5%8A%A8%E9%99%8D%E7%BA%A7">1. <strong>Next.js 自动降级</strong></a></li>
<li><a href="#2-nuxtjs-%E6%B7%B7%E5%90%88%E6%A8%A1%E5%BC%8F">2. <strong>Nuxt.js 混合模式</strong></a></li>
</ul>
</li>
<li><a href="#%E5%85%AD-%E9%99%8D%E7%BA%A7%E7%AD%96%E7%95%A5%E5%86%B3%E7%AD%96%E6%A0%91"><strong>六、降级策略决策树</strong></a></li>
</ul>
</li>
<li><a href="#ssrssg-%E4%BB%A5%E5%8F%8A-isr-%E7%9A%84%E5%8C%BA%E5%88%AB">ssr，ssg 以及 isr 的区别</a>
<ul>
<li><a href="#1-%E5%AE%9A%E4%B9%89%E4%B8%8E%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><strong>1. 定义与工作原理</strong></a></li>
<li><a href="#2-%E6%A0%B8%E5%BF%83%E7%89%B9%E7%82%B9%E5%AF%B9%E6%AF%94"><strong>2. 核心特点对比</strong></a></li>
<li><a href="#3-%E5%85%B7%E4%BD%93%E5%9C%BA%E6%99%AF%E7%A4%BA%E4%BE%8B"><strong>3. 具体场景示例</strong></a>
<ul>
<li><a href="#ssr-%E5%85%B8%E5%9E%8B%E5%9C%BA%E6%99%AF"><strong>SSR 典型场景</strong></a></li>
<li><a href="#ssg-%E5%85%B8%E5%9E%8B%E5%9C%BA%E6%99%AF"><strong>SSG 典型场景</strong></a></li>
<li><a href="#isr-%E5%85%B8%E5%9E%8B%E5%9C%BA%E6%99%AF"><strong>ISR 典型场景</strong></a></li>
</ul>
</li>
<li><a href="#4-%E6%8A%80%E6%9C%AF%E6%A0%88%E5%AE%9E%E7%8E%B0"><strong>4. 技术栈实现</strong></a>
<ul>
<li><a href="#ssr-%E5%AE%9E%E7%8E%B0"><strong>SSR 实现</strong></a></li>
<li><a href="#ssg-%E5%AE%9E%E7%8E%B0"><strong>SSG 实现</strong></a></li>
<li><a href="#isr-%E5%AE%9E%E7%8E%B0"><strong>ISR 实现</strong></a></li>
</ul>
</li>
<li><a href="#5-%E9%80%89%E6%8B%A9%E5%86%B3%E7%AD%96%E6%A0%91"><strong>5. 选择决策树</strong></a></li>
<li><a href="#6-%E6%80%BB%E7%BB%93"><strong>6. 总结</strong></a></li>
</ul>
</li>
<li><a href="#react18-%E7%9A%84%E6%89%B9%E5%A4%84%E7%90%86%E6%98%AF%E4%BB%80%E4%B9%88">react18 的批处理是什么</a>
<ul>
<li><a href="#1-%E6%89%B9%E5%A4%84%E7%90%86%E7%9A%84%E5%AE%9A%E4%B9%89%E4%B8%8E%E4%BD%9C%E7%94%A8"><strong>1. 批处理的定义与作用</strong></a></li>
<li><a href="#2-react-18-%E7%9A%84%E6%94%B9%E8%BF%9B%E8%87%AA%E5%8A%A8%E6%89%B9%E5%A4%84%E7%90%86"><strong>2. React 18 的改进：自动批处理</strong></a></li>
<li><a href="#3-%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><strong>3. 实现原理</strong></a></li>
<li><a href="#4-%E7%89%B9%E6%AE%8A%E6%83%85%E5%86%B5%E5%A4%84%E7%90%86"><strong>4. 特殊情况处理</strong></a></li>
<li><a href="#5-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><strong>5. 注意事项</strong></a></li>
<li><a href="#%E6%80%BB%E7%BB%93-11"><strong>总结</strong></a></li>
</ul>
</li>
<li><a href="#react19-%E4%B8%BB%E8%A6%81%E6%9B%B4%E6%96%B0%E4%BA%86%E4%BB%80%E4%B9%88">react19 主要更新了什么？</a>
<ul>
<li><a href="#%E4%B8%80-actions-api%E5%BC%82%E6%AD%A5%E6%93%8D%E4%BD%9C%E4%B8%8E%E8%A1%A8%E5%8D%95%E5%A4%84%E7%90%86%E9%9D%A9%E5%91%BD"><strong>一、Actions API：异步操作与表单处理革命</strong></a></li>
<li><a href="#%E4%BA%8C-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E6%B8%B2%E6%9F%93ssr%E4%B8%8E%E9%9D%99%E6%80%81%E7%94%9F%E6%88%90%E4%BC%98%E5%8C%96"><strong>二、服务器端渲染（SSR）与静态生成优化</strong></a></li>
<li><a href="#%E4%B8%89-%E5%8E%9F%E7%94%9F%E6%96%87%E6%A1%A3%E5%85%83%E6%95%B0%E6%8D%AE%E4%B8%8E%E6%A0%B7%E5%BC%8F%E7%AE%A1%E7%90%86"><strong>三、原生文档元数据与样式管理</strong></a></li>
<li><a href="#%E5%9B%9B-ref-%E5%A4%84%E7%90%86%E4%B8%8E%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E4%BC%98%E5%8C%96"><strong>四、Ref 处理与资源管理优化</strong></a></li>
<li><a href="#%E4%BA%94-%E6%96%B0-api-%E4%B8%8E%E5%B7%A5%E5%85%B7%E5%A2%9E%E5%BC%BA"><strong>五、新 API 与工具增强</strong></a></li>
<li><a href="#%E5%85%AD-%E5%85%B6%E4%BB%96%E9%87%8D%E8%A6%81%E6%94%B9%E8%BF%9B"><strong>六、其他重要改进</strong></a></li>
<li><a href="#%E6%80%BB%E7%BB%93-12"><strong>总结</strong></a></li>
</ul>
</li>
<li><a href="#%E5%89%8D%E7%AB%AF%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82%E8%B6%85%E6%97%B6%E5%90%8E%E7%9A%84%E9%87%8D%E6%96%B0%E8%AF%B7%E6%B1%82">前端如何处理请求超时后的重新请求？</a>
<ul>
<li><a href="#%E4%B8%80-%E6%A0%B8%E5%BF%83%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88-1"><strong>一、核心实现方案</strong></a>
<ul>
<li><a href="#1-%E5%9F%BA%E7%A1%80%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%94%9F-fetch-api--abortcontroller">1. <strong>基础实现（原生 Fetch API + AbortController）</strong></a></li>
<li><a href="#2-%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5%E6%8C%87%E6%95%B0%E9%80%80%E9%81%BFexponential-backoff">2. <strong>优化策略：指数退避（Exponential Backoff）</strong></a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C-%E5%85%B3%E9%94%AE%E4%BC%98%E5%8C%96%E7%82%B9"><strong>二、关键优化点</strong></a>
<ul>
<li><a href="#1-%E8%AF%B7%E6%B1%82%E5%8F%96%E6%B6%88%E4%B8%8E%E8%B5%84%E6%BA%90%E9%87%8A%E6%94%BE">1. <strong>请求取消与资源释放</strong></a></li>
<li><a href="#2-%E9%94%99%E8%AF%AF%E7%B1%BB%E5%9E%8B%E5%8C%BA%E5%88%86%E5%A4%84%E7%90%86">2. <strong>错误类型区分处理</strong></a></li>
<li><a href="#3-%E8%AF%B7%E6%B1%82%E5%B9%82%E7%AD%89%E6%80%A7%E4%BF%9D%E9%9A%9C">3. <strong>请求幂等性保障</strong></a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E9%9B%86%E6%88%90%E4%BB%A5-axios-%E4%B8%BA%E4%BE%8B"><strong>三、第三方库集成（以 Axios 为例）</strong></a>
<ul>
<li><a href="#1-%E4%BD%BF%E7%94%A8-axios-retry-%E6%8F%92%E4%BB%B6">1. <strong>使用 <code>axios-retry</code> 插件</strong></a></li>
<li><a href="#2-%E8%87%AA%E5%AE%9A%E4%B9%89-axios-%E5%AE%9E%E4%BE%8B">2. <strong>自定义 Axios 实例</strong></a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9-1"><strong>四、注意事项</strong></a></li>
<li><a href="#%E4%BA%94-%E6%80%BB%E7%BB%93%E6%96%B9%E6%A1%88%E9%80%89%E6%8B%A9"><strong>五、总结方案选择</strong></a></li>
</ul>
</li>
<li><a href="#%E8%AF%B7%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D%E4%B8%8B%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BA%95%E5%B1%82%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86">请详细介绍下微信小程序底层的实现原理</a>
<ul>
<li><a href="#-%E4%B8%80-%E5%8F%8C%E7%BA%BF%E7%A8%8B%E6%9E%B6%E6%9E%84%E5%AE%89%E5%85%A8%E4%B8%8E%E6%80%A7%E8%83%BD%E7%9A%84%E5%9F%BA%E7%9F%B3">🧠 <strong>一、双线程架构：安全与性能的基石</strong></a></li>
<li><a href="#-%E4%BA%8C-%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6%E8%B7%A8%E7%BA%BF%E7%A8%8B%E6%95%B0%E6%8D%AE%E4%BC%A0%E9%80%92">📡 <strong>二、通信机制：跨线程数据传递</strong></a></li>
<li><a href="#-%E4%B8%89-%E6%B8%B2%E6%9F%93%E6%B5%81%E7%A8%8Bvirtual-dom-%E4%B8%8E%E7%BB%84%E4%BB%B6%E7%B3%BB%E7%BB%9F">🎨 <strong>三、渲染流程：Virtual DOM 与组件系统</strong></a></li>
<li><a href="#-%E5%9B%9B-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5">⚡ <strong>四、性能优化策略</strong></a></li>
<li><a href="#%EF%B8%8F-%E4%BA%94-%E5%AE%89%E5%85%A8%E4%B8%8E%E7%AE%A1%E6%8E%A7%E6%9C%BA%E5%88%B6">🛡️ <strong>五、安全与管控机制</strong></a></li>
<li><a href="#-%E5%85%AD-%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%89%A9%E5%B1%95%E5%90%8C%E6%9E%84%E6%96%B9%E6%A1%88-kbone">🔧 <strong>六、跨平台扩展：同构方案 kbone</strong></a></li>
<li><a href="#-%E6%80%BB%E7%BB%93%E8%AE%BE%E8%AE%A1%E5%93%B2%E5%AD%A6%E4%B8%8E%E6%8C%91%E6%88%98">💎 <strong>总结：设计哲学与挑战</strong></a></li>
</ul>
</li>
<li><a href="#resizeobserver-%E5%92%8C-mutationobserver-%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB">ResizeObserver 和 MutationObserver 有什么区别</a>
<ul>
<li><a href="#%E4%B8%80-%E5%8A%9F%E8%83%BD%E5%AE%9A%E4%BD%8D%E5%B7%AE%E5%BC%82">一、功能定位差异</a></li>
<li><a href="#%E4%BA%8C-%E7%9B%91%E5%90%AC%E7%9B%AE%E6%A0%87%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%8F%8D%E9%A6%88">二、监听目标与数据反馈</a></li>
<li><a href="#%E4%B8%89-%E6%80%A7%E8%83%BD%E4%B8%8E%E4%BD%BF%E7%94%A8%E9%99%90%E5%88%B6">三、性能与使用限制</a></li>
<li><a href="#%E5%9B%9B-%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E5%AF%B9%E6%AF%94">四、应用场景对比</a></li>
<li><a href="#%E4%BA%94-%E8%81%94%E5%90%88%E4%BD%BF%E7%94%A8%E7%AD%96%E7%95%A5">五、联合使用策略</a></li>
<li><a href="#%E6%80%BB%E7%BB%93%E5%BB%BA%E8%AE%AE-3">总结建议</a></li>
</ul>
</li>
<li><a href="#intersectionobserver">IntersectionObserver</a></li>
</ul>
<h1 id="为什么获取-offsettop-offsetleft--offsetwidth-offsetheight-scrolltop-scrollleft-scrollwidth-scrollheight-clienttop-clientleft-clientwidth-clientheight-这样的样式也会触发重排重绘">为什么获取 offsetTop、offsetLeft、 offsetWidth、offsetHeight、scrollTop、scrollLeft、scrollWidth、scrollHeight、clientTop、clientLeft、clientWidth、clientHeight 这样的样式也会触发重排重绘 </h1>
<ul>
<li>浏览器为了确保返回的几何属性值是最新的，必须 同步计算最新的布局信息，这一过程会强制触发重排。</li>
</ul>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="script-标签里面的属性-defer-和-async-有什么区别">script 标签里面的属性 defer 和 async 有什么区别 </h1>
<ol>
<li>
<p>无属性（默认行为）</p>
<ul>
<li>行为：立即下载并执行脚本，阻塞 HTML 解析。</li>
<li>场景：需要立即生效的脚本（如关键渲染路径代码）。</li>
</ul>
</li>
<li>
<p>defer 属性</p>
<ul>
<li>行为：<br>
异步下载脚本，不阻塞 HTML 解析。<br>
按顺序执行所有 defer 脚本，在 DOMContentLoaded 事件前完成。</li>
<li>场景：<br>
依赖 DOM 的脚本（如操作元素的初始化逻辑）。<br>
多个脚本需要按声明顺序执行（如 lib.js → app.js）。</li>
</ul>
</li>
<li>
<p>async 属性</p>
<ul>
<li>行为：<br>
异步下载脚本，不阻塞 HTML 解析。<br>
下载完成后立即执行（可能中断 HTML 解析）。<br>
执行顺序不确定（先下载完成的先执行）。</li>
<li>场景：<br>
独立脚本（如统计代码、广告 SDK）。<br>
不依赖其他脚本或 DOM 的库（如第三方工具）。</li>
</ul>
</li>
</ol>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="vue3-如何使用函数式组件">vue3 如何使用函数式组件？ </h1>
<ul>
<li>使用 渲染函数（h 函数）</li>
</ul>
<pre data-role="codeBlock" data-info="jsx" class="language-jsx jsx"><code><span class="token comment">// FunctionalButton.js</span>
<span class="token keyword module keyword-import">import</span> <span class="token imports"><span class="token punctuation">{</span> h <span class="token punctuation">}</span></span> <span class="token keyword module keyword-from">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>

<span class="token keyword module keyword-export">export</span> <span class="token keyword module keyword-default">default</span> <span class="token keyword keyword-function">function</span> <span class="token function"><span class="token maybe-class-name">FunctionalButton</span></span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> <span class="token punctuation">{</span> slots <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-return">return</span> <span class="token function">h</span><span class="token punctuation">(</span>
    <span class="token string">'button'</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token keyword keyword-class">class</span><span class="token operator">:</span> <span class="token string">'functional-btn'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">onClick</span><span class="token operator">:</span> props<span class="token punctuation">.</span><span class="token property-access">onClick</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    slots<span class="token punctuation">.</span><span class="token keyword module keyword-default">default</span><span class="token operator">?.</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 渲染插槽内容</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><ul>
<li>使用 setup 函数 + 渲染函数 h</li>
</ul>
<pre data-role="codeBlock" data-info="jsx" class="language-jsx jsx"><code><span class="token comment">// FunctionalList.js</span>
<span class="token keyword module keyword-import">import</span> <span class="token imports"><span class="token punctuation">{</span> h <span class="token punctuation">}</span></span> <span class="token keyword module keyword-from">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>

<span class="token keyword module keyword-export">export</span> <span class="token keyword module keyword-default">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'items'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-return">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span>
      <span class="token function">h</span><span class="token punctuation">(</span>
        <span class="token string">'ul'</span><span class="token punctuation">,</span>
        props<span class="token punctuation">.</span><span class="token property-access">items</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="web-worker-service-worker-indexeddb-的区别">web worker, service worker, IndexedDB 的区别 </h1>
<ul>
<li>
<p>IndexedDB 是用来存储大量结构化数据，相比 localStorage 仅支持字符串存储，性能较差，IndexedDB 能提高访问效率。</p>
</li>
<li>
<p>Web Worker 可以进行多线程计算，避免阻塞主线程</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token comment">// worker.js</span>
self<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onmessage</span> <span class="token operator">=</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-let">let</span> result <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">num</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
  self<span class="token punctuation">.</span><span class="token method function property-access">postMessage</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 主线程</span>
<span class="token keyword keyword-const">const</span> worker <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">'worker.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
worker<span class="token punctuation">.</span><span class="token method function property-access">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">num</span><span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
worker<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onmessage</span> <span class="token operator">=</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'计算结果:'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></li>
<li>
<p>Service Worker 进行离线缓存 html 页面，js，css，图片等资源，提高页面可用性；</p>
</li>
</ul>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="react-useeffect-里面的请求在严格模式下为什么会请求-2-次">react useEffect 里面的请求在严格模式下为什么会请求 2 次 </h1>
<p>在 React 的 <strong>严格模式（Strict Mode）</strong> 下，<code>useEffect</code> 中的请求被触发两次，这是 React 刻意设计的开发环境行为，目的是帮助开发者提前发现副作用管理的问题。以下是详细解释和解决方案：</p>
<hr>
<h3 id="一-为什么会出现两次请求">一、为什么会出现两次请求？ </h3>
<h4 id="1-严格模式的作用">1. <strong>严格模式的作用</strong> </h4>
<ul>
<li>React 严格模式（<code>&lt;React.StrictMode&gt;</code>）在开发环境下会 <strong>故意重复执行某些操作</strong>，包括：
<ul>
<li>组件的初始挂载（<code>mount</code>）和卸载（<code>unmount</code>）</li>
<li><code>useEffect</code>、<code>useLayoutEffect</code>、<code>useMemo</code> 等 Hook 的依赖项变化</li>
</ul>
</li>
<li>目的是模拟组件 <strong>快速挂载/卸载的场景</strong>，暴露潜在问题（如未正确清理副作用）。</li>
</ul>
<h4 id="2-useeffect-的双重执行">2. <strong>useEffect 的双重执行</strong> </h4>
<ul>
<li>在严格模式下，React 会 <strong>首次渲染时模拟卸载组件，然后立即重新挂载</strong>：<pre data-role="codeBlock" data-info="jsx" class="language-jsx jsx"><code><span class="token comment">// 开发环境下严格模式的伪代码行为</span>
<span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第一次挂载（触发 useEffect）</span>
<span class="token function">unmountComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 立即卸载（触发 useEffect 的清理函数）</span>
<span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第二次挂载（再次触发 useEffect）</span>
</code></pre></li>
<li>如果 <code>useEffect</code> 中没有依赖项（<code>[]</code>），或者依赖项在两次渲染中未变化，请求会被重复触发。</li>
</ul>
<hr>
<h3 id="二-这是-bug-吗需要修复吗">二、这是 Bug 吗？需要修复吗？ </h3>
<h4 id="1-这不是-bug">1. <strong>这不是 Bug</strong> </h4>
<ul>
<li>严格模式是 React 的 <strong>开发环境专用工具</strong>，生产环境不会双重执行。</li>
<li>该行为是为了 <strong>强制暴露副作用管理问题</strong>，例如：
<ul>
<li>未正确取消请求（导致内存泄漏）</li>
<li>未清理定时器、事件监听器等</li>
<li>依赖项未正确声明</li>
</ul>
</li>
</ul>
<h4 id="2-是否需要阻止两次请求">2. <strong>是否需要阻止两次请求？</strong> </h4>
<ul>
<li><strong>无需刻意阻止</strong>，而应确保代码能正确处理重复的副作用。</li>
<li>如果两次请求对业务逻辑有破坏性（如创建重复订单），说明代码存在隐患，需修复。</li>
</ul>
<hr>
<h3 id="三-如何正确管理副作用">三、如何正确管理副作用？ </h3>
<h4 id="1-使用-abortcontroller-取消请求">1. <strong>使用 AbortController 取消请求</strong> </h4>
<pre data-role="codeBlock" data-info="jsx" class="language-jsx jsx"><code><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> abortController <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建控制器</span>
  <span class="token keyword keyword-const">const</span> <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-try">try</span> <span class="token punctuation">{</span>
      <span class="token keyword keyword-const">const</span> response <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/data'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">signal</span><span class="token operator">:</span> abortController<span class="token punctuation">.</span><span class="token property-access">signal</span><span class="token punctuation">,</span> <span class="token comment">// 绑定取消信号</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 处理响应</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-catch">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token operator">===</span> <span class="token string">'AbortError'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'请求已被取消'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-else">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 处理其他错误</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 清理函数：组件卸载时取消请求</span>
  <span class="token keyword control-flow keyword-return">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    abortController<span class="token punctuation">.</span><span class="token method function property-access">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 依赖项为空数组</span>
</code></pre><h4 id="2-避免依赖项错误">2. <strong>避免依赖项错误</strong> </h4>
<ul>
<li>
<p>如果依赖项不完整，可能导致 <code>useEffect</code> 重复执行：</p>
<pre data-role="codeBlock" data-info="jsx" class="language-jsx jsx"><code><span class="token comment">// ❌ 错误：依赖项缺失（如依赖外部变量 userId）</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/user/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>userId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ✅ 正确：声明依赖项</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/user/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>userId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>userId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
</ul>
<h4 id="3-使用-useref-跳过初始渲染">3. <strong>使用 useRef 跳过初始渲染</strong> </h4>
<ul>
<li>
<p>若确实需要避免开发环境下的双重请求，可标记初始渲染：</p>
<pre data-role="codeBlock" data-info="jsx" class="language-jsx jsx"><code><span class="token keyword keyword-const">const</span> isInitialRender <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>isInitialRender<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    isInitialRender<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow keyword-return">return</span><span class="token punctuation">;</span> <span class="token comment">// 跳过首次执行</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 后续依赖项变化时执行</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/data'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>dependencies<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
</ul>
<hr>
<h3 id="四-生产环境的影响">四、生产环境的影响 </h3>
<table>
<thead>
<tr>
<th>环境</th>
<th>严格模式行为</th>
<th>请求次数</th>
</tr>
</thead>
<tbody>
<tr>
<td>开发环境</td>
<td>双重执行 useEffect</td>
<td>2 次</td>
</tr>
<tr>
<td>生产环境</td>
<td>正常执行</td>
<td>1 次</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="五-总结">五、总结 </h3>
<ul>
<li><strong>严格模式的双重执行是 React 的调试机制</strong>，旨在暴露副作用管理问题。</li>
<li><strong>不要试图禁用严格模式</strong>，而应通过 <code>AbortController</code> 和正确的依赖项声明确保代码健壮性。</li>
<li>生产环境中不会有此行为，最终用户只会触发一次请求。</li>
</ul>
<p>通过正确处理副作用，可以避免潜在的内存泄漏和竞态条件（Race Conditions），提升应用稳定性。</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="前端的-post-请求会先发一个-option-请求给服务端为什么这个请求在浏览器里面看不到">前端的 post 请求会先发一个 option 请求给服务端，为什么这个请求在浏览器里面看不到？ </h1>
<p>在跨域请求中，浏览器自动发送的 <strong>OPTIONS 请求（预检请求，Preflight Request）</strong> 是浏览器安全机制的一部分（遵循 CORS 规范），但有时在开发者工具的 Network 面板中看不到它，通常有以下原因：</p>
<hr>
<h3 id="一-options-请求的触发条件">一、OPTIONS 请求的触发条件 </h3>
<p>浏览器发送 OPTIONS 请求的目的是 <strong>确认服务器是否允许实际的跨域请求</strong>（如 POST、PUT 等非简单请求）。以下情况会触发 OPTIONS 预检：</p>
<ol>
<li><strong>非简单请求方法</strong>：如 <code>PUT</code>、<code>DELETE</code>、<code>PATCH</code> 等。</li>
<li><strong>自定义请求头</strong>：如 <code>Authorization</code>、<code>X-Custom-Header</code>。</li>
<li><strong>非简单 Content-Type</strong>：如 <code>application/json</code>（简单请求仅限 <code>text/plain</code>、<code>multipart/form-data</code>、<code>application/x-www-form-urlencoded</code>）。</li>
</ol>
<hr>
<h3 id="二-为什么看不到-options-请求">二、为什么看不到 OPTIONS 请求？ </h3>
<h4 id="1-请求被判定为简单请求">1. <strong>请求被判定为“简单请求”</strong> </h4>
<ul>
<li>如果 POST 请求满足以下条件，浏览器会直接发送 POST 请求 <strong>而不触发 OPTIONS 预检</strong>：
<ul>
<li><strong>请求方法为 <code>POST</code>、<code>GET</code> 或 <code>HEAD</code></strong>。</li>
<li><strong>请求头仅包含简单头</strong>（如 <code>Accept</code>、<code>Accept-Language</code>、<code>Content-Language</code>、<code>Content-Type</code>）。</li>
<li><strong><code>Content-Type</code> 为简单值</strong>（如 <code>application/x-www-form-urlencoded</code>、<code>multipart/form-data</code>、<code>text/plain</code>）。</li>
</ul>
</li>
<li><strong>示例</strong>：一个普通的表单提交（<code>Content-Type: application/x-www-form-urlencoded</code>）不会触发 OPTIONS。</li>
</ul>
<h4 id="2-开发者工具过滤了请求">2. <strong>开发者工具过滤了请求</strong> </h4>
<ul>
<li>在浏览器的 Network 面板中，默认可能过滤了请求类型：
<ol>
<li>检查是否勾选了 <strong>“All”</strong> 或 <strong>“Other”</strong> 分类。</li>
<li>使用筛选框搜索 <code>OPTIONS</code> 或 <code>method:OPTIONS</code>。</li>
<li>确保 <strong>“Disable cache”</strong> 未启用（缓存可能导致预检请求被跳过）。</li>
</ol>
</li>
</ul>
<h4 id="3-预检结果被缓存">3. <strong>预检结果被缓存</strong> </h4>
<ul>
<li>如果服务器响应 OPTIONS 时设置了 <code>Access-Control-Max-Age</code> 头，浏览器会 <strong>缓存预检结果</strong>，后续请求跳过 OPTIONS。</li>
<li><strong>示例</strong>：<pre data-role="codeBlock" data-info="http" class="language-http http"><code><span class="token header"><span class="token header-name keyword">Access-Control-Max-Age</span><span class="token punctuation">:</span> <span class="token header-value">86400  // 缓存 24 小时</span></span>
</code></pre></li>
<li>此时，只有第一次跨域请求会发送 OPTIONS，后续请求不再触发。</li>
</ul>
<h4 id="4-请求未真正跨域">4. <strong>请求未真正跨域</strong> </h4>
<ul>
<li>如果前端页面和后端接口 <strong>同源</strong>（协议、域名、端口均一致），浏览器不会触发 CORS 机制，因此无 OPTIONS 请求。</li>
</ul>
<h4 id="5-浏览器或工具问题">5. <strong>浏览器或工具问题</strong> </h4>
<ul>
<li>某些浏览器插件（如广告拦截器）可能过滤了 OPTIONS 请求。</li>
<li>开发者工具未正确刷新（尝试清除缓存并硬刷新页面）。</li>
</ul>
<hr>
<h3 id="三-如何确保看到-options-请求">三、如何确保看到 OPTIONS 请求？ </h3>
<p>若需要调试 CORS 行为，可按以下步骤强制触发 OPTIONS 请求：</p>
<h4 id="1-构造非简单请求">1. <strong>构造非简单请求</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 前端代码示例（触发 OPTIONS）</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://api.example.com/data'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span> <span class="token comment">// 非简单 Content-Type</span>
    <span class="token string-property property">'X-Custom-Header'</span><span class="token operator">:</span> <span class="token string">'value'</span><span class="token punctuation">,</span> <span class="token comment">// 自定义请求头</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">'value'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="2-服务器配置-cors-头">2. <strong>服务器配置 CORS 头</strong> </h4>
<p>确保服务器响应 OPTIONS 请求时返回正确的 CORS 头：</p>
<pre data-role="codeBlock" data-info="http" class="language-http http"><code><span class="token header"><span class="token header-name keyword">Access-Control-Allow-Origin</span><span class="token punctuation">:</span> <span class="token header-value">https://your-frontend-domain.com</span></span>
<span class="token header"><span class="token header-name keyword">Access-Control-Allow-Methods</span><span class="token punctuation">:</span> <span class="token header-value">POST, GET, OPTIONS</span></span>
<span class="token header"><span class="token header-name keyword">Access-Control-Allow-Headers</span><span class="token punctuation">:</span> <span class="token header-value">X-Custom-Header, Content-Type</span></span>
</code></pre><h4 id="3-禁用浏览器缓存">3. <strong>禁用浏览器缓存</strong> </h4>
<p>在开发者工具中勾选 <strong>“Disable cache”</strong>，确保每次请求都重新发送 OPTIONS。</p>
<hr>
<h3 id="四-options-请求的核心作用">四、OPTIONS 请求的核心作用 </h3>
<ol>
<li><strong>安全性</strong>：防止恶意网站跨域访问用户敏感数据。</li>
<li><strong>协商权限</strong>：确认服务器允许的实际请求方法和头信息。</li>
<li><strong>遵循规范</strong>：符合 HTTP 协议和 CORS 标准。</li>
</ol>
<hr>
<h3 id="总结">总结 </h3>
<ul>
<li><strong>看不到 OPTIONS 请求</strong>：通常是因为请求被判定为“简单请求”，或预检结果已被缓存。</li>
<li><strong>强制触发 OPTIONS</strong>：添加非简单请求头或 Content-Type，并禁用缓存。</li>
<li><strong>生产环境优化</strong>：合理设置 <code>Access-Control-Max-Age</code> 减少预检请求频率。</li>
</ul>
<p>通过理解 CORS 机制，可以更好地调试跨域问题并优化前后端协作。</p>
<blockquote>
<p>可参考连接： <a href="https://juejin.cn/post/6844903821634699277?searchId=20250305230202B003C7B9787B1032B522">https://juejin.cn/post/6844903821634699277?searchId=20250305230202B003C7B9787B1032B522</a></p>
</blockquote>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="前端监控如果需要上报的埋点数量非常多应该怎么处理">前端监控如果需要上报的埋点数量非常多，应该怎么处理 </h1>
<p>在大型前端监控系统中，当埋点数量非常庞大时，合理的优化策略和合并上报机制至关重要。以下是完整的处理方案和实现思路：</p>
<hr>
<h3 id="一-合并上报的必要性">一、合并上报的必要性 </h3>
<h4 id="1-性能优化">1. <strong>性能优化</strong> </h4>
<ul>
<li><strong>减少 HTTP 请求数</strong>：浏览器对同域名的并发请求数有限制（Chrome 为 6 个），高频埋点可能阻塞关键请求。</li>
<li><strong>降低网络开销</strong>：减少请求头重复传输（每个请求都携带 Cookie、User-Agent 等）。</li>
<li><strong>节省资源消耗</strong>：移动端频繁上报会加剧电量消耗和流量压力。</li>
</ul>
<h4 id="2-服务端压力缓解">2. <strong>服务端压力缓解</strong> </h4>
<ul>
<li>合并后单次请求处理更多数据，降低服务器 QPS。</li>
<li>便于日志聚合分析和存储优化。</li>
</ul>
<hr>
<h3 id="二-合并上报的核心策略">二、合并上报的核心策略 </h3>
<h4 id="1-队列批量上报">1. <strong>队列批量上报</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">BatchReporter</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">queue</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 数据队列</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">batchSize</span> <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span> <span class="token comment">// 每批上报数量</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">timeWindow</span> <span class="token operator">=</span> <span class="token number">5000</span><span class="token punctuation">;</span> <span class="token comment">// 最大等待时间（毫秒）</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">timer</span> <span class="token operator">=</span> <span class="token keyword null nil keyword-null">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 添加数据到队列</span>
  <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">queue</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 数量达到阈值立即上报</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">queue</span><span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">&gt;=</span> <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">batchSize</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token method function property-access">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-else">else</span> <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">timer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 设置定时器，超时后上报</span>
      <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">timer</span> <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token method function property-access">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">timeWindow</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 上报数据</span>
  <span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">queue</span><span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword control-flow keyword-return">return</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-const">const</span> data <span class="token operator">=</span> <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">queue</span><span class="token punctuation">.</span><span class="token method function property-access">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">queue</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 清空队列</span>
    <span class="token function">clearTimeout</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">timer</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">timer</span> <span class="token operator">=</span> <span class="token keyword null nil keyword-null">null</span><span class="token punctuation">;</span>

    <span class="token comment">// 使用 sendBeacon 或 fetch 上报（示例）</span>
    <span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token method function property-access">sendBeacon</span><span class="token punctuation">(</span><span class="token string">'/api/log'</span><span class="token punctuation">,</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用示例</span>
<span class="token keyword keyword-const">const</span> reporter <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">BatchReporter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
tracker<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'event'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token arrow operator">=&gt;</span> reporter<span class="token punctuation">.</span><span class="token method function property-access">add</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="2-分层上报策略">2. <strong>分层上报策略</strong> </h4>
<table>
<thead>
<tr>
<th>数据类型</th>
<th>上报策略</th>
<th>优先级</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>关键错误监控</strong></td>
<td>实时单独上报</td>
<td>最高</td>
</tr>
<tr>
<td><strong>用户行为轨迹</strong></td>
<td>批量合并 + 本地存储兜底</td>
<td>中</td>
</tr>
<tr>
<td><strong>性能指标</strong></td>
<td>页面生命周期结束时批量上报</td>
<td>低</td>
</tr>
</tbody>
</table>
<h4 id="3-数据压缩优化">3. <strong>数据压缩优化</strong> </h4>
<ul>
<li>
<p><strong>Gzip/Brotli 压缩</strong>：服务端开启压缩，减少传输体积。</p>
</li>
<li>
<p><strong>Payload 精简</strong>：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 原始数据</span>
<span class="token punctuation">{</span> <span class="token literal-property property">event</span><span class="token operator">:</span> <span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token literal-property property">timestamp</span><span class="token operator">:</span> <span class="token number">1620000000000</span><span class="token punctuation">,</span> <span class="token literal-property property">userId</span><span class="token operator">:</span> <span class="token string">'123'</span> <span class="token punctuation">}</span>

<span class="token comment">// 优化后（使用编码映射）</span>
<span class="token punctuation">{</span> <span class="token literal-property property">e</span><span class="token operator">:</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token literal-property property">t</span><span class="token operator">:</span> <span class="token number">1620000000000</span><span class="token punctuation">,</span> <span class="token literal-property property">u</span><span class="token operator">:</span> <span class="token string">'123'</span> <span class="token punctuation">}</span>
</code></pre></li>
<li>
<p><strong>差值计算</strong>：对于时序性数据（如性能指标），只上报变化量。</p>
</li>
</ul>
<h4 id="4-本地存储兜底">4. <strong>本地存储兜底</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 数据存储到 localStorage（兼容异常情况）</span>
<span class="token keyword keyword-function">function</span> <span class="token function">saveToLocal</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-try">try</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> pending <span class="token operator">=</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">parse</span><span class="token punctuation">(</span><span class="token dom variable">localStorage</span><span class="token punctuation">.</span><span class="token method function property-access">getItem</span><span class="token punctuation">(</span><span class="token string">'pendingLogs'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'[]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pending<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token spread operator">...</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token dom variable">localStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">'pendingLogs'</span><span class="token punctuation">,</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span>pending<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-catch">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 存储空间不足时按时间丢弃旧数据</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 页面加载时尝试重发</span>
<span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> pending <span class="token operator">=</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">parse</span><span class="token punctuation">(</span><span class="token dom variable">localStorage</span><span class="token punctuation">.</span><span class="token method function property-access">getItem</span><span class="token punctuation">(</span><span class="token string">'pendingLogs'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'[]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>pending<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">sendBatch</span><span class="token punctuation">(</span>pending<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token dom variable">localStorage</span><span class="token punctuation">.</span><span class="token method function property-access">removeItem</span><span class="token punctuation">(</span><span class="token string">'pendingLogs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<h3 id="三-合并上报的注意事项">三、合并上报的注意事项 </h3>
<h4 id="1-数据完整性保障">1. <strong>数据完整性保障</strong> </h4>
<ul>
<li><strong>唯一 ID 标记</strong>：为每个事件生成唯一 ID，服务端去重。<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code>event<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token known-class-name class-name">Date</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre></li>
<li><strong>ACK 确认机制</strong>：服务端处理成功后返回确认，失败后客户端重试。</li>
</ul>
<h4 id="2-实时性权衡">2. <strong>实时性权衡</strong> </h4>
<ul>
<li><strong>关键事件</strong>（如支付成功）：通过 <code>fetch</code> + <code>keepalive</code> 单独上报。</li>
<li><strong>非关键事件</strong>（如页面滚动）：批量合并上报。</li>
</ul>
<h4 id="3-数据大小控制">3. <strong>数据大小控制</strong> </h4>
<ul>
<li>单次请求体建议不超过 <strong>64KB</strong>（避免被浏览器拦截）。</li>
<li>超大分片方案：<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-function">function</span> <span class="token function">splitAndSend</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> <span class="token constant">CHUNK_SIZE</span> <span class="token operator">=</span> <span class="token number">50000</span><span class="token punctuation">;</span> <span class="token comment">// 50KB</span>
  <span class="token keyword keyword-const">const</span> jsonStr <span class="token operator">=</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-let">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> jsonStr<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token constant">CHUNK_SIZE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> chunk <span class="token operator">=</span> jsonStr<span class="token punctuation">.</span><span class="token method function property-access">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token constant">CHUNK_SIZE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token method function property-access">sendBeacon</span><span class="token punctuation">(</span><span class="token string">'/api/log-chunk'</span><span class="token punctuation">,</span> chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></li>
</ul>
<h4 id="4-页面生命周期处理">4. <strong>页面生命周期处理</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 页面隐藏或关闭前强制上报</span>
<span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'visibilitychange'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">visibilityState</span> <span class="token operator">===</span> <span class="token string">'hidden'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    reporter<span class="token punctuation">.</span><span class="token method function property-access">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'beforeunload'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  reporter<span class="token punctuation">.</span><span class="token method function property-access">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<h3 id="四-服务端配合优化">四、服务端配合优化 </h3>
<h4 id="1-高效数据接收">1. <strong>高效数据接收</strong> </h4>
<ul>
<li>使用流式处理（如 Node.js 的 <code>stream</code>、Kafka 队列）避免内存溢出。</li>
<li>返回压缩确认信息（如 <code>{"received": 158}"</code>）。</li>
</ul>
<h4 id="2-分布式存储">2. <strong>分布式存储</strong> </h4>
<ul>
<li>原始日志存入冷存储（如 S3、HDFS）。</li>
<li>结构化数据导入 OLAP 引擎（如 ClickHouse、BigQuery）。</li>
</ul>
<h4 id="3-动态采样配置">3. <strong>动态采样配置</strong> </h4>
<pre data-role="codeBlock" data-info="json" class="language-json json"><code><span class="token comment">// 客户端根据服务端下发的采样率调整</span>
<span class="token punctuation">{</span>
  <span class="token property">"error"</span><span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token comment">// 100% 上报错误</span>
  <span class="token property">"click"</span><span class="token operator">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token comment">// 10% 采样点击事件</span>
  <span class="token property">"perf"</span><span class="token operator">:</span> <span class="token number">0.05</span> <span class="token comment">// 5% 采样性能数据</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="五-监控指标设计">五、监控指标设计 </h3>
<table>
<thead>
<tr>
<th>指标</th>
<th>计算方式</th>
<th>告警阈值</th>
</tr>
</thead>
<tbody>
<tr>
<td>上报失败率</td>
<td>失败请求数 / 总请求数</td>
<td>&gt; 1%</td>
</tr>
<tr>
<td>平均请求延迟</td>
<td>所有成功请求的耗时平均值</td>
<td>&gt; 2000ms</td>
</tr>
<tr>
<td>数据丢失率</td>
<td>(本地存储待发数 - 成功数) / 总数</td>
<td>&gt; 0.1%</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="六-总结">六、总结 </h3>
<p>通过 <strong>队列批量处理 + 分层策略 + 压缩兜底</strong> 的组合方案，可在保证数据可靠性的前提下，将埋点上报性能提升 5-10 倍。建议结合业务特点调整批量阈值（如电商大促期间降低批量大小），并建立完善的数据监控看板，实现实时优化决策。</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="commonjs-umd-amd-和-esm-的区别">CommonJS、UMD、AMD 和 ESM 的区别 </h1>
<p>以下是 <strong>CommonJS、UMD、AMD 和 ESM</strong> 的核心区别与适用场景的总结，结合技术原理与实践示例：</p>
<hr>
<h3 id="一-commonjs-cjs">一、<strong>CommonJS (CJS)</strong> </h3>
<p>• <strong>定位</strong>：主要用于 <strong>Node.js 服务器端</strong>，以同步加载为核心。<br>
• <strong>特点</strong>：<br>
• <strong>同步加载</strong>：模块在运行时通过 <code>require()</code> 动态加载，执行顺序依赖代码执行路径。<br>
• <strong>输出值拷贝</strong>：导出的值是模块执行结果的浅拷贝，后续模块内部修改不影响外部引用。<br>
• <strong>缓存机制</strong>：首次加载后缓存模块，避免重复执行。<br>
• <strong>语法示例</strong>：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 导出</span>
module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 导入</span>
<span class="token keyword keyword-const">const</span> mod <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./module'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>• <strong>适用场景</strong>：Node.js 后端开发、工具库开发。</p>
<hr>
<h3 id="二-amd-asynchronous-module-definition">二、<strong>AMD (Asynchronous Module Definition)</strong> </h3>
<p>• <strong>定位</strong>：专为 <strong>浏览器环境</strong> 设计，解决异步加载问题。<br>
• <strong>特点</strong>：<br>
• <strong>异步加载</strong>：通过 <code>define</code> 和 <code>require</code> 异步加载模块，避免阻塞页面渲染。<br>
• <strong>依赖前置</strong>：模块依赖需在定义时显式声明，提前加载所有依赖。<br>
• <strong>按需执行</strong>：依赖下载后立即执行，主逻辑在所有依赖加载完成后触发。<br>
• <strong>语法示例</strong>：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 定义模块</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'dep1'</span><span class="token punctuation">,</span> <span class="token string">'dep2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">dep1<span class="token punctuation">,</span> dep2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-return">return</span> <span class="token punctuation">{</span> <span class="token function-variable function">action</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> dep1 <span class="token operator">+</span> dep2 <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 使用模块</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'module'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">mod</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  mod<span class="token punctuation">.</span><span class="token method function property-access">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>• <strong>适用场景</strong>：传统浏览器端应用（如 RequireJS）。</p>
<hr>
<h3 id="三-umd-universal-module-definition">三、<strong>UMD (Universal Module Definition)</strong> </h3>
<p>• <strong>定位</strong>：兼容 <strong>多种环境</strong>（CommonJS、AMD、全局变量），提供通用模块化方案。<br>
• <strong>特点</strong>：<br>
• <strong>环境判断</strong>：通过 IIFE 检测当前环境（如 <code>define</code> 或 <code>module.exports</code>），动态适配模块导出方式。<br>
• <strong>混合模式</strong>：结合 CommonJS 的导出语法与 AMD 的异步加载逻辑。<br>
• <strong>语法示例</strong>：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token punctuation">(</span><span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">root<span class="token punctuation">,</span> factory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token keyword keyword-typeof">typeof</span> define <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">&amp;&amp;</span> define<span class="token punctuation">.</span><span class="token property-access">amd</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// AMD</span>
    <span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'dep'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-else">else</span> <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token keyword keyword-typeof">typeof</span> exports <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// CommonJS</span>
    module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'dep'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-else">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 全局变量</span>
    root<span class="token punctuation">.</span><span class="token property-access">myModule</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token property-access">dep</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">,</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">dep</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword control-flow keyword-return">return</span> <span class="token punctuation">{</span> <span class="token spread operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>• <strong>适用场景</strong>：需同时支持浏览器和 Node.js 的跨环境库（如 Lodash）。</p>
<hr>
<h3 id="四-esm-ecmascript-modules">四、<strong>ESM (ECMAScript Modules)</strong> </h3>
<p>• <strong>定位</strong>：JavaScript <strong>官方标准模块系统</strong>，支持现代浏览器和 Node.js。<br>
• <strong>特点</strong>：<br>
• <strong>静态分析</strong>：<code>import</code>/<code>export</code> 必须在顶层声明，支持编译时优化（如 Tree Shaking）。<br>
• <strong>输出引用绑定</strong>：导出的是值的动态引用，模块内部修改会影响外部引用。<br>
• <strong>严格模式</strong>：默认启用严格模式，禁止隐式全局变量。<br>
• <strong>语法示例</strong>：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 导出</span>
<span class="token keyword module keyword-export">export</span> <span class="token keyword keyword-const">const</span> value <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword module keyword-export">export</span> <span class="token keyword module keyword-default">default</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token spread operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 导入</span>
<span class="token keyword module keyword-import">import</span> <span class="token imports"><span class="token punctuation">{</span> value <span class="token punctuation">}</span></span> <span class="token keyword module keyword-from">from</span> <span class="token string">'./module.mjs'</span><span class="token punctuation">;</span>
</code></pre><p>• <strong>适用场景</strong>：现代前端开发、支持 ESM 的 Node.js 应用。</p>
<hr>
<h3 id="五-核心差异对比">五、<strong>核心差异对比</strong> </h3>
<table>
<thead>
<tr>
<th><strong>特性</strong></th>
<th>CommonJS</th>
<th>AMD</th>
<th>UMD</th>
<th>ESM</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>加载方式</strong></td>
<td>同步</td>
<td>异步</td>
<td>动态适配</td>
<td>静态加载</td>
</tr>
<tr>
<td><strong>环境支持</strong></td>
<td>Node.js</td>
<td>浏览器</td>
<td>跨环境</td>
<td>现代浏览器/Node.js</td>
</tr>
<tr>
<td><strong>输出类型</strong></td>
<td>值拷贝</td>
<td>值或函数</td>
<td>值或函数</td>
<td>动态引用</td>
</tr>
<tr>
<td><strong>依赖管理</strong></td>
<td>运行时动态加载</td>
<td>提前声明依赖</td>
<td>混合模式</td>
<td>编译时静态分析</td>
</tr>
<tr>
<td><strong>典型工具</strong></td>
<td>Node.js</td>
<td>RequireJS</td>
<td>Lodash</td>
<td>Vite/Rollup</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="六-关键场景选择建议">六、<strong>关键场景选择建议</strong> </h3>
<ol>
<li><strong>Node.js 后端开发</strong>：优先使用 <strong>CommonJS</strong>（Node 原生支持）。</li>
<li><strong>旧版浏览器兼容</strong>：选择 <strong>AMD</strong> 或 <strong>UMD</strong>（如 RequireJS）。</li>
<li><strong>跨环境库开发</strong>：采用 <strong>UMD</strong> 兼容不同模块系统。</li>
<li><strong>现代前端项目</strong>：使用 <strong>ESM</strong> 配合 Vite/Rollup，利用 Tree Shaking 优化体积。</li>
</ol>
<p>通过理解这些模块系统的差异，开发者可根据项目需求选择最适合的方案，平衡兼容性、性能与开发体验。</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="nuxt-里面从服务端渲染切换到客户端渲染的时候客户端-vue-是如何接管组件还有状态等">Nuxt 里面从服务端渲染切换到客户端渲染的时候，客户端 Vue 是如何接管组件还有状态等？ </h1>
<p>Vue 需要执行一个激活步骤。在激活过程中，</p>
<ol>
<li>Vue 会创建一个与服务端完全相同的应用实例</li>
<li>将每个组件与它应该控制的 DOM 节点相匹配，复用现有 DOM 节点</li>
<li>并添加 DOM 事件监听器。</li>
<li>同步响应式状态并激活</li>
</ol>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="前端重新部署项目到生产环境后如果用户在访问旧的页面并尝试导入旧代码块的时候就会因为旧资源已经被清空了而报错如何解决这个问题">前端重新部署项目到生产环境后，如果用户在访问旧的页面，并尝试导入旧代码块的时候就会因为旧资源已经被清空了而报错，如何解决这个问题？ </h1>
<h3 id="一-静态资源持久化存储"><strong>一、静态资源持久化存储</strong> </h3>
<ol>
<li>
<p><strong>独立文件服务器/云存储</strong><br>
• 将静态资源部署到与容器解耦的持久化存储（如 Nginx 服务器、AWS S3、阿里云 OSS）<br>
• 通过 CI/CD 流程将构建产物上传至独立存储，而非直接打包到容器内，避免容器重启时资源丢失<br>
• 示例流程：</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token comment"># 构建后上传至云存储</span>
<span class="token function">npm</span> run build
aws s3 <span class="token function">sync</span> ./dist s3://your-bucket <span class="token parameter variable">--delete</span>
</code></pre></li>
<li>
<p><strong>版本化资源路径</strong><br>
• 为每个版本资源生成唯一标识（如哈希值），例如 <code>main.abc123.js</code> 和 <code>main.def456.js</code><br>
• 新旧资源共存于服务器，用户访问旧页面时仍能加载旧资源</p>
</li>
</ol>
<hr>
<h3 id="二-cdn-回源策略优化"><strong>二、CDN 回源策略优化</strong> </h3>
<ol>
<li>
<p><strong>CDN 缓存与回源机制</strong><br>
• 配置 CDN 缓存策略，保留旧资源直至缓存过期，而非立即回源拉取新资源<br>
• 设置 <code>Cache-Control</code> 头部控制缓存周期（例如：<code>max-age=31536000</code> 强缓存一年）<br>
• 通过 CDN 的版本目录隔离新旧资源（如 <code>/v1.2.3/assets/</code> 和 <code>/v1.2.4/assets/</code>）</p>
</li>
<li>
<p><strong>灰度发布与流量切换</strong><br>
• 采用蓝绿部署或金丝雀发布，逐步切换用户流量至新版本<br>
• 旧版本资源保留至所有用户会话结束或缓存过期后再清理</p>
</li>
</ol>
<hr>
<h3 id="三-增量更新与非覆盖式发布"><strong>三、增量更新与非覆盖式发布</strong> </h3>
<ol>
<li>
<p><strong>非覆盖式文件上传</strong><br>
• 使用 <code>rsync</code> 或类似工具实现增量上传，仅新增/修改文件，保留历史版本<br>
• 示例命令：</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">rsync</span> <span class="token parameter variable">-avz</span> ./dist/ user@server:/path/to/static-resources/
</code></pre></li>
<li>
<p><strong>自动化版本管理</strong><br>
• 在 CI/CD 流程中自动生成版本目录（如基于 Git commit hash 或时间戳）<br>
• 通过符号链接（如 <code>current</code>）动态指向最新版本，旧版本目录保留固定周期</p>
</li>
</ol>
<hr>
<h3 id="四-优雅降级与错误处理"><strong>四、优雅降级与错误处理</strong> </h3>
<ol>
<li>
<p><strong>前端错误监控与重试</strong><br>
• 添加全局错误监听，捕获资源加载失败事件：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span>
  <span class="token string">'error'</span><span class="token punctuation">,</span>
  <span class="token parameter">e</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">tagName</span> <span class="token operator">===</span> <span class="token string">'SCRIPT'</span> <span class="token operator">||</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">tagName</span> <span class="token operator">===</span> <span class="token string">'LINK'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 上报错误并提示用户刷新</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'检测到资源加载失败，请刷新页面以获取最新版本'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">location</span><span class="token punctuation">.</span><span class="token method function property-access">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token boolean">true</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>也可以更优雅地实现更新（非阻塞式弹窗提示，如：右上角的小气泡），允许用户稍后操作</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-function">function</span> <span class="token function">showUpdateNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> toast <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  toast<span class="token punctuation">.</span><span class="token property-access">innerHTML</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html">
 发现新版本，<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>javascript:location.reload()<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>点击刷新<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript">toast<span class="token punctuation">.</span><span class="token method function property-access">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>稍后<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  toast<span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">position</span> <span class="token operator">=</span> <span class="token string">'fixed'</span><span class="token punctuation">;</span>
  toast<span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">top</span> <span class="token operator">=</span> <span class="token string">'20px'</span><span class="token punctuation">;</span>
  toast<span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">right</span> <span class="token operator">=</span> <span class="token string">'20px'</span><span class="token punctuation">;</span>
  <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>toast<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>• 对异步加载的资源（如懒加载路由）添加重试逻辑</p>
</li>
</ol>
<h4 id="2-service-worker-主动控制缓存"><strong>2. Service Worker 主动控制缓存</strong> </h4>
<p><strong>原理</strong>：利用 Service Worker 拦截请求并管理缓存，检测到更新后触发刷新<br>
<strong>实现步骤</strong>：</p>
<ol>
<li>
<p><strong>注册 Service Worker</strong></p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// main.js</span>
<span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token string">'serviceWorker'</span> <span class="token keyword keyword-in">in</span> <span class="token dom variable">navigator</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token property-access">serviceWorker</span><span class="token punctuation">.</span><span class="token method function property-access">register</span><span class="token punctuation">(</span><span class="token string">'/sw.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p><strong>在 Service Worker 中监听更新</strong></p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// sw.js</span>
self<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  self<span class="token punctuation">.</span><span class="token method function property-access">skipWaiting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 强制激活新 SW</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

self<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'activate'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 向页面发送更新通知</span>
  self<span class="token punctuation">.</span><span class="token property-access">clients</span><span class="token punctuation">.</span><span class="token method function property-access">matchAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">clients</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    clients<span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">client</span> <span class="token arrow operator">=&gt;</span>
      client<span class="token punctuation">.</span><span class="token method function property-access">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'UPDATE_AVAILABLE'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
<li>
<p><strong>页面监听消息并提示刷新</strong></p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// main.js</span>
<span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token property-access">serviceWorker</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">type</span> <span class="token operator">===</span> <span class="token string">'UPDATE_AVAILABLE'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">'新版本已就绪，是否立即生效？'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token dom variable">location</span><span class="token punctuation">.</span><span class="token method function property-access">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
</ol>
<hr>
<h4 id="3-接口版本兼容--强制更新兜底"><strong>3. 接口版本兼容 + 强制更新兜底</strong> </h4>
<p><strong>适用场景</strong>：后端 API 发生破坏性变更，旧版本前端无法兼容<br>
<strong>实现步骤</strong>：</p>
<ol>
<li>
<p><strong>后端接口返回版本状态</strong></p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 响应头或 JSON 中返回当前 API 支持的最低前端版本</span>
<span class="token comment">// 例如：当旧前端版本号 &lt; 最低支持版本时，阻断操作</span>
<span class="token punctuation">{</span>
  <span class="token string-property property">"code"</span><span class="token operator">:</span> <span class="token number">403</span><span class="token punctuation">,</span>
  <span class="token string-property property">"message"</span><span class="token operator">:</span> <span class="token string">"请刷新页面以获取最新版本"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"minVersion"</span><span class="token operator">:</span> <span class="token string">"v1.2.0"</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p><strong>前端拦截接口响应</strong></p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// Axios 拦截器示例</span>
axios<span class="token punctuation">.</span><span class="token property-access">interceptors</span><span class="token punctuation">.</span><span class="token property-access">response</span><span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">code</span> <span class="token operator">===</span> <span class="token number">403</span> <span class="token operator">&amp;&amp;</span> response<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">minVersion</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> currentVersion <span class="token operator">=</span> <span class="token function">getCurrentVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">compareVersions</span><span class="token punctuation">(</span>currentVersion<span class="token punctuation">,</span> response<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">minVersion</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">forceUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 强制跳转或刷新</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow keyword-return">return</span> response<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
</ol>
<hr>
<ol start="2">
<li><strong>服务端兜底策略</strong><br>
• 配置 Nginx 反向代理，当请求旧资源不存在时重定向至默认版本<br>
• 示例 Nginx 配置：<pre data-role="codeBlock" data-info="nginx" class="language-nginx nginx"><code><span class="token directive"><span class="token keyword keyword-location">location</span> /assets/</span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword keyword-try_files">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ @fallback</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword keyword-location">location</span> @fallback</span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword keyword-rewrite">rewrite</span> ^/assets/(.*) /latest/assets/<span class="token variable">$1</span> redirect</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></li>
</ol>
<hr>
<h3 id="五-版本控制与缓存策略"><strong>五、版本控制与缓存策略</strong> </h3>
<ol>
<li>
<p><strong>HTTP 缓存头优化</strong><br>
• 对哈希化资源设置长期缓存（强缓存），非哈希化资源（如 <code>index.html</code>）设置短缓存或协商缓存<br>
• 示例配置：</p>
<pre data-role="codeBlock" data-info="nginx" class="language-nginx nginx"><code><span class="token directive"><span class="token keyword keyword-location">location</span> /assets/</span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword keyword-expires">expires</span> <span class="token number">1y</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword keyword-add_header">add_header</span> Cache-Control <span class="token string">"public, immutable"</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p><strong>自动化清理机制</strong><br>
• 设置定时任务清理过旧版本（如保留最近 5 个版本）<br>
• 结合云存储生命周期策略自动删除超期文件</p>
</li>
</ol>
<hr>
<h3 id="六-补充措施"><strong>六、补充措施</strong> </h3>
<ol>
<li>
<p><strong>灰度发布与监控报警</strong><br>
• 通过日志监控 404 错误率，触发报警时快速回滚版本<br>
• 使用 Sentry 或 Prometheus 实时监控资源加载失败情况</p>
</li>
<li>
<p><strong>用户引导与文档</strong><br>
• 在页面中提示用户“新版本已发布，建议刷新页面”<br>
• 提供文档说明版本更新机制和兼容性策略</p>
</li>
</ol>
<hr>
<p>通过以上方案，可有效解决因资源更新导致的用户访问中断问题，同时平衡部署效率与系统稳定性。核心思路参考了静态资源持久化和版本化部署的最佳实践，并结合错误监控实现闭环管理。</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="nodejs-的-js-文件中怎么使用命令">nodejs 的 js 文件中怎么使用命令 </h1>
<ol>
<li>如果是要打印到控制台中去执行的命令，使用<code>echo</code>;</li>
</ol>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code>echo <span class="token string">"npm install"</span>
</code></pre><ol start="2">
<li>如果是在代码中要执行的命令，使用<code>child_process</code>的<code>exec execSync</code> 或 <code>spawn</code>；</li>
</ol>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> exec <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'npm install'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> stdout<span class="token punctuation">,</span> stderr</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="ts-中的-declare-怎么使用">ts 中的 declare 怎么使用 </h1>
<p>以下是 TypeScript 中 <code>declare</code> 关键字的核心使用方法和场景</p>
<hr>
<h3 id="一-基本概念与作用"><strong>一、基本概念与作用</strong> </h3>
<p><code>declare</code> 关键字用于告知 TypeScript 编译器某个类型、变量或模块已存在，无需具体实现即可在当前文件中使用。其主要作用是<strong>解决跨文件/模块的类型引用问题</strong>，常见于以下场景：<br>
• 使用第三方 JavaScript 库时，补充其缺失的类型声明<br>
• 描述全局变量或浏览器原生对象的类型<br>
• 扩展已有模块的类型定义</p>
<p>所有 <code>declare</code> 语句<strong>不会编译到最终的 JavaScript 代码</strong>，仅用于类型检查阶段。</p>
<hr>
<h3 id="二-主要使用场景"><strong>二、主要使用场景</strong> </h3>
<h4 id="1-声明全局变量"><strong>1. 声明全局变量</strong> </h4>
<p>当使用其他脚本定义的全局变量时，需用 <code>declare</code> 声明其类型：</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 声明全局变量</span>
<span class="token keyword keyword-declare">declare</span> <span class="token keyword keyword-let">let</span> myGlobalVar<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

<span class="token comment">// 使用变量（不会报错）</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myGlobalVar<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>• 若未指定具体类型，默认为 <code>any</code><br>
• <strong>禁止初始化赋值</strong>（如 <code>declare let x: number = 1</code> 会报错）</p>
<h4 id="2-声明函数类型"><strong>2. 声明函数类型</strong> </h4>
<p>描述外部函数的参数和返回值类型：</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 声明函数类型</span>
<span class="token keyword keyword-declare">declare</span> <span class="token keyword keyword-function">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Response<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token comment">// 调用函数（类型安全）</span>
<span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token string">'/api/data'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="3-声明类与接口"><strong>3. 声明类与接口</strong> </h4>
<p>定义外部类的结构和接口：</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 声明类结构</span>
<span class="token keyword keyword-declare">declare</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">eat</span><span class="token punctuation">(</span>food<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword keyword-void">void</span><span class="token punctuation">;</span>
  <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword keyword-void">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 实例化类（无需具体实现）</span>
<span class="token keyword keyword-const">const</span> cat <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token string">'Tom'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cat<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token string">'fish'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="4-声明模块与命名空间"><strong>4. 声明模块与命名空间</strong> </h4>
<p>为第三方模块或自定义模块补充类型：</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 声明模块类型</span>
<span class="token keyword keyword-declare">declare</span> <span class="token keyword keyword-module">module</span> <span class="token string">'my-library'</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-export">export</span> <span class="token keyword keyword-function">function</span> <span class="token function">calculate</span><span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-export">export</span> <span class="token keyword keyword-const">const</span> version<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用模块</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> calculate <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'my-library'</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">calculate</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="5-扩展已有模块"><strong>5. 扩展已有模块</strong> </h4>
<p>通过 <code>declare module</code> 合并或扩展模块类型：</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 原始模块类型（假设在外部库中）</span>
<span class="token keyword keyword-interface">interface</span> <span class="token class-name">OriginalInterface</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 扩展新增属性</span>
<span class="token keyword keyword-declare">declare</span> <span class="token keyword keyword-module">module</span> <span class="token string">'original-module'</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-interface">interface</span> <span class="token class-name">OriginalInterface</span> <span class="token punctuation">{</span>
    newProp<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用扩展后的类型</span>
<span class="token keyword keyword-const">const</span> obj<span class="token operator">:</span> OriginalInterface <span class="token operator">=</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> newProp<span class="token operator">:</span> <span class="token string">'扩展属性'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><hr>
<h3 id="三-类型声明文件的组织"><strong>三、类型声明文件的组织</strong> </h3>
<h4 id="1-创建-dts-文件"><strong>1. 创建 <code>.d.ts</code> 文件</strong> </h4>
<p>将声明语句集中写入 <code>.d.ts</code> 类型声明文件，例如：</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// myDeclarations.d.ts</span>
<span class="token keyword keyword-declare">declare</span> <span class="token keyword keyword-let">let</span> globalCounter<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token keyword keyword-declare">declare</span> <span class="token keyword keyword-function">function</span> <span class="token function">logMessage</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword keyword-void">void</span><span class="token punctuation">;</span>
</code></pre><h4 id="2-模块化声明"><strong>2. 模块化声明</strong> </h4>
<p>使用 <code>namespace</code> 或 <code>module</code> 组织复杂类型：</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-declare">declare</span> <span class="token keyword keyword-namespace">namespace</span> MyLib <span class="token punctuation">{</span>
  <span class="token keyword keyword-interface">interface</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>
    timeout<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    retries<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword keyword-function">function</span> <span class="token function">initialize</span><span class="token punctuation">(</span>config<span class="token operator">:</span> Config<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword keyword-void">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="3-三斜线指令引用"><strong>3. 三斜线指令引用</strong> </h4>
<p>通过 <code>/// &lt;reference path="..." /&gt;</code> 引入其他声明文件：</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">/// &lt;reference path="./interfaces.d.ts" /&gt;</span>
<span class="token comment">/// &lt;reference path="./functions.d.ts" /&gt;</span>
</code></pre><hr>
<h3 id="四-高级用法"><strong>四、高级用法</strong> </h3>
<h4 id="1-全局作用域扩展"><strong>1. 全局作用域扩展</strong> </h4>
<p>通过 <code>declare global</code> 在全局作用域添加类型：</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-declare">declare</span> global <span class="token punctuation">{</span>
  <span class="token keyword keyword-interface">interface</span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
    <span class="token function">toSmallCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用扩展的方法</span>
<span class="token string">'Hello'</span><span class="token punctuation">.</span><span class="token function">toSmallCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 "hello"</span>
</code></pre><h4 id="2-通配符模块声明"><strong>2. 通配符模块声明</strong> </h4>
<p>处理非代码资源（如图片、CSS）的类型：</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-declare">declare</span> <span class="token keyword keyword-module">module</span> <span class="token string">'*.png'</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> src<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-export">export</span> <span class="token keyword keyword-default">default</span> src<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 导入图片（TS不会报错）</span>
<span class="token keyword keyword-import">import</span> logo <span class="token keyword keyword-from">from</span> <span class="token string">'./logo.png'</span><span class="token punctuation">;</span>
</code></pre><hr>
<h3 id="五-注意事项"><strong>五、注意事项</strong> </h3>
<ol>
<li>
<p><strong>禁止实现细节</strong><br>
<code>declare</code> 仅描述类型结构，不能包含具体实现代码（如函数体）。</p>
</li>
<li>
<p><strong>模块扩展限制</strong><br>
• 只能扩展已存在的接口，不能新增顶层类型<br>
• 无法扩展模块的默认导出（<code>default</code> 接口）</p>
</li>
<li>
<p><strong>与常规类型声明的区别</strong><br>
• <code>interface</code> 和 <code>type</code> 可独立使用，而变量声明必须加 <code>declare</code><br>
• 示例：</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-interface">interface</span> <span class="token class-name">Valid</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>       <span class="token comment">// 正确</span>
<span class="token keyword keyword-declare">declare</span> <span class="token keyword keyword-interface">interface</span> <span class="token class-name">Valid</span>  <span class="token comment">// 也正确（但通常省略 declare）</span>
<span class="token keyword keyword-declare">declare</span> <span class="token keyword keyword-let">let</span> x<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>   <span class="token comment">// 必须用 declare</span>
</code></pre></li>
</ol>
<hr>
<h3 id="六-实际应用案例"><strong>六、实际应用案例</strong> </h3>
<h4 id="1-浏览器环境变量补充"><strong>1. 浏览器环境变量补充</strong> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 声明浏览器原生对象</span>
<span class="token keyword keyword-declare">declare</span> <span class="token keyword keyword-var">var</span> document<span class="token operator">:</span> Document<span class="token punctuation">;</span>
document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'TypeScript 示例'</span><span class="token punctuation">;</span>
</code></pre><h4 id="2-第三方库类型扩展"><strong>2. 第三方库类型扩展</strong> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 扩展 lodash 的类型</span>
<span class="token keyword keyword-import">import</span> _ <span class="token keyword keyword-from">from</span> <span class="token string">'lodash'</span><span class="token punctuation">;</span>
<span class="token keyword keyword-declare">declare</span> <span class="token keyword keyword-module">module</span> <span class="token string">'lodash'</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-interface">interface</span> <span class="token class-name">LoDashStatic</span> <span class="token punctuation">{</span>
    <span class="token function">customMethod</span><span class="token punctuation">(</span>arr<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用扩展方法</span>
_<span class="token punctuation">.</span><span class="token function">customMethod</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<p>通过以上方法，你可以灵活运用 <code>declare</code> 实现类型安全与 JavaScript 生态的兼容。更多细节可参考 TypeScript 官方文档或搜索中的技术文章。</p>
<h1 id="vue3-reactive-响应式系统的原理">vue3 reactive （响应式系统）的原理 </h1>
<p>最新的 vue3 中，reactive 函数的响应式最后的 dep 的存储是基于双链表的，具体的触发渲染逻辑如下：<br>
trigger =&gt; notify =&gt; 组装链表 =&gt; 在最后的 endBatch 方法里面调用链表里面每项的 trigger =&gt; 触发 ReactiveEffect 里面的 trigger =&gt; 调用 scheduler 或 runIfDirty 按链表顺序一次执行所有渲染函数<br>
具体流程如下</p>
<p>在 Vue3.5 及之后的版本中，响应式系统的底层实现 <strong>Dep（依赖）确实通过双向链表管理订阅关系</strong>，这是 Vue3.5 响应式重构的核心优化点之一。以下是具体分析：</p>
<hr>
<h3 id="1-双向链表的引入背景"><strong>1. 双向链表的引入背景</strong> </h3>
<p>在 Vue3.5 之前的响应式系统中，Dep（依赖）和 Sub（订阅者）之间通过数组直接维护多对多的依赖关系。这种设计存在以下问题：</p>
<ul>
<li><strong>内存占用高</strong>：每次依赖变化时需重建依赖关系，产生冗余内存占用。</li>
<li><strong>依赖管理低效</strong>：数组遍历效率低，且难以复用已有依赖关系。</li>
</ul>
<p>Vue3.5 通过引入 <strong>双向链表</strong> 和 <strong>Link 节点</strong> 作为中间桥梁，优化了依赖收集与触发机制，内存占用减少 56%。</p>
<hr>
<h3 id="2-dep-的双向链表结构"><strong>2. Dep 的双向链表结构</strong> </h3>
<p>在最新源码中，Dep 类通过以下属性管理双向链表：</p>
<ul>
<li><strong><code>subs</code></strong>：指向链表尾部节点（用于依赖触发）。</li>
<li><strong><code>subsHead</code></strong>（仅在开发环境）：指向链表头部节点（用于调试时保证触发顺序）。</li>
</ul>
<p>每个 <strong>Link 节点</strong> 包含以下关键指针：</p>
<ul>
<li><strong><code>sub</code></strong> 和 <strong><code>dep</code></strong>：分别指向对应的订阅者（Sub）和依赖（Dep）。</li>
<li><strong><code>nextDep</code></strong> 和 <strong><code>prevDep</code></strong>：横向链表指针（同一 Dep 下的多个 Link 节点）。</li>
<li><strong><code>nextSub</code></strong> 和 <strong><code>prevSub</code></strong>：纵向链表指针（同一 Sub 下的多个 Link 节点）。</li>
</ul>
<p>这种设计使得 Dep 和 Sub 之间通过 Link 节点间接关联，形成多维双向链表结构。</p>
<hr>
<h3 id="3-双向链表的运作机制"><strong>3. 双向链表的运作机制</strong> </h3>
<h4 id="1-依赖收集track"><strong>(1) 依赖收集（Track）</strong> </h4>
<p>当响应式数据被访问时：</p>
<ol>
<li><strong>创建 Link 节点</strong>：若当前无有效链接，则生成新 Link 节点，将其插入 Dep 的链表尾部。</li>
<li><strong>维护指针关系</strong>：通过 <code>nextDep</code>/<code>prevDep</code> 和 <code>nextSub</code>/<code>prevSub</code> 调整链表结构，确保依赖关系有序。</li>
</ol>
<h4 id="2-依赖触发notify"><strong>(2) 依赖触发（Notify）</strong> </h4>
<p>当响应式数据变更时：</p>
<ol>
<li><strong>遍历链表</strong>：从 Dep 的 <code>subs</code>（尾部）开始，沿 <code>prevSub</code> 指针逆向遍历链表。
<blockquote>
<p>之所以使用从尾部开始遍历，是因为 subs 可能存在相互依赖的关系，如：sub1 依赖 sub2，而 2 者又都依赖同一个 dep，那么这个 dep 更新的时候，就会先从 sub2 开始计算，然后再计算 sub1，这个时候 sub1 就能拿到 sub2 最新的值了，而不需要后面 sub2 更新的时候再触发一次 sub1，避免了重复触发</p>
</blockquote>
</li>
<li><strong>触发更新</strong>：通过 Link 节点找到关联的 Sub（如 <code>watchEffect</code>），执行回调函数。</li>
</ol>
<hr>
<h3 id="4-双向链表的优势"><strong>4. 双向链表的优势</strong> </h3>
<ol>
<li>
<p><strong>内存优化</strong>：</p>
<ul>
<li><strong>复用 Link 节点</strong>：依赖变化时仅调整指针，避免重复创建对象。</li>
<li><strong>快速垃圾回收</strong>：孤立 Link 节点可被 V8 及时回收，减少内存泄漏。</li>
</ul>
</li>
<li>
<p><strong>性能提升</strong>：</p>
<ul>
<li><strong>高效遍历</strong>：链表操作时间复杂度为 O(1)，优于数组的 O(n)。</li>
<li><strong>惰性计算</strong>：通过版本计数（<code>version</code> 字段）跳过无效更新，减少冗余计算。</li>
</ul>
</li>
<li>
<p><strong>逻辑清晰</strong>：</p>
<ul>
<li><strong>分离关注点</strong>：Dep 仅管理链表结构，Sub 通过 Link 访问依赖，解耦依赖关系。</li>
</ul>
</li>
</ol>
<hr>
<h3 id="5-与旧版本设计的对比"><strong>5. 与旧版本设计的对比</strong> </h3>
<table>
<thead>
<tr>
<th><strong>维度</strong></th>
<th><strong>Vue3.4 及之前</strong></th>
<th><strong>Vue3.5 及之后</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>依赖存储</strong></td>
<td>数组存储直接引用</td>
<td>双向链表 + Link 节点</td>
</tr>
<tr>
<td><strong>内存占用</strong></td>
<td>高（重复构建依赖关系）</td>
<td>低（复用 Link 节点）</td>
</tr>
<tr>
<td><strong>触发效率</strong></td>
<td>依赖数组遍历</td>
<td>链表指针跳转</td>
</tr>
<tr>
<td><strong>复用能力</strong></td>
<td>弱（依赖顺序敏感）</td>
<td>强（通过指针动态调整）</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="总结-1"><strong>总结</strong> </h3>
<p>Vue3.5 的响应式系统通过 <strong>双向链表</strong> 和 <strong>Link 节点</strong> 重构了 Dep 的依赖管理机制，显著优化了内存占用和性能。这一设计不仅解决了旧版本的多对多依赖管理问题，还为后续优化（如惰性计算、版本计数）奠定了基础。如需深入源码细节，可参考 Vue 官方仓库的 <code>packages/reactivity/src/dep.ts</code> 文件。</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="vue35-之前的响应式更新的响应式状态里维护的-deps-里面的依赖者如果发生变化了是怎么更新这个-deps-的">vue3.5 之前的响应式更新的响应式状态里维护的 deps 里面的依赖者如果发生变化了，是怎么更新这个 deps 的？ </h1>
<p>在 Vue3.5 之前的响应式系统中，依赖（Dep）与订阅者（Sub）的更新机制主要基于 集合（Set/Map）结构 和 全量依赖清理策略，其核心流程可分为以下关键步骤：</p>
<hr>
<p>一、<strong>依赖存储结构</strong></p>
<ol>
<li>
<p>Dep 与 Sub 的映射关系<br>
• 每个响应式变量（如 <code>ref</code>、<code>reactive</code>）对应一个 <code>Dep</code> 对象，其内部通过 <code>Set&lt;Sub&gt;</code> 存储所有订阅该变量的订阅者（如 <code>watchEffect</code>、<code>computed</code>）。</p>
<p>• 每个订阅者（Sub）也维护一个 <code>Set&lt;Dep&gt;</code>，记录其依赖的所有响应式变量。</p>
<p><em>示例代码结构：</em></p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// Dep 定义</span>
<span class="token keyword keyword-class">class</span> <span class="token class-name">Dep</span> <span class="token punctuation">{</span>
  subs <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Set</span><span class="token operator">&lt;</span><span class="token maybe-class-name">Sub</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 存储订阅者</span>
<span class="token punctuation">}</span>
<span class="token comment">// Sub 定义（如 Watcher）</span>
<span class="token keyword keyword-class">class</span> <span class="token class-name">Sub</span> <span class="token punctuation">{</span>
  deps <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Set</span><span class="token operator">&lt;</span><span class="token maybe-class-name">Dep</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 存储依赖的 Dep</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p>多对多关系<br>
一个 Sub 可能依赖多个 Dep（如监听多个变量），一个 Dep 也可能被多个 Sub 订阅（如多个组件监听同一变量）。</p>
</li>
</ol>
<hr>
<p>二、<strong>依赖更新流程</strong><br>
当响应式数据变化时，触发以下更新逻辑：</p>
<ol>
<li><strong>触发依赖通知</strong><br>
• 数据变更拦截：通过 <code>Object.defineProperty</code>（Vue2）或 <code>Proxy</code>（Vue3）拦截 <code>set</code> 操作，调用 <code>Dep.notify()</code>。</li>
</ol>
<p>• 遍历通知订阅者：<code>Dep.notify()</code> 会遍历 <code>subs</code> 集合中的所有 Sub，依次调用 <code>Sub.update()</code>。</p>
<ol start="2">
<li><strong>订阅者更新逻辑</strong><br>
• 执行回调函数：<code>Sub.update()</code> 触发订阅者的回调（如重新执行 <code>watchEffect</code> 或渲染函数）。</li>
</ol>
<p>• 清理旧依赖：在重新执行回调前，Sub 会遍历其 <code>deps</code> 集合，从每个 Dep 的 <code>subs</code> 中移除自身，避免旧依赖残留。</p>
<p><em>代码示例：</em></p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">Sub</span> <span class="token punctuation">{</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 清理旧依赖</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">deps</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">dep</span> <span class="token arrow operator">=&gt;</span> dep<span class="token punctuation">.</span><span class="token property-access">subs</span><span class="token punctuation">.</span><span class="token method function property-access">delete</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">deps</span><span class="token punctuation">.</span><span class="token method function property-access">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 重新收集依赖</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token method function property-access">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 执行回调，触发新的依赖收集</span>
    activeEffect <span class="token operator">=</span> <span class="token keyword keyword-this">this</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token method function property-access">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><ol start="3">
<li><strong>重新收集依赖</strong><br>
• 动态依赖收集：执行回调时，重新访问响应式变量，触发 <code>get</code> 拦截器，通过 <code>Dep.depend()</code> 将当前 Sub 重新加入新的 Dep 的 <code>subs</code> 中。</li>
</ol>
<p>• 更新依赖关系：Sub 的 <code>deps</code> 集合被替换为本次执行收集到的新 Dep 集合。</p>
<hr>
<p>三、<strong>性能瓶颈与问题</strong></p>
<ol>
<li>
<p>全量清理与重建依赖<br>
每次更新需遍历并删除所有旧依赖（<code>O(n)</code> 时间复杂度），再重新收集新依赖，这在分支依赖场景（如 <code>v-if</code> 切换）下尤为低效。</p>
</li>
<li>
<p>高频更新场景的性能问题<br>
若某变量被大量 Sub 订阅，<code>Dep.notify()</code> 遍历 <code>subs</code> 集合的耗时随 Sub 数量线性增长，导致性能下降。</p>
</li>
<li>
<p>内存与 GC 压力<br>
频繁的集合增删操作会产生内存碎片，增加垃圾回收（GC）负担。</p>
</li>
</ol>
<hr>
<p>四、<strong>与 Vue3.5 的优化对比</strong><br>
Vue3.5 通过 双向链表 和 版本计数 优化上述问题：</p>
<ol>
<li>链表结构：依赖关系通过指针跳转维护，动态增删节点的时间复杂度为 <code>O(1)</code>。</li>
<li>懒更新策略：通过版本号标记依赖有效性，仅触发必要的更新，避免全量遍历。</li>
<li>复用节点：分支切换时复用链表节点，无需全量清理依赖。</li>
</ol>
<hr>
<p>总结<br>
Vue3.5 之前的版本通过 集合结构 + 全量清理 实现依赖更新，虽然逻辑简单，但存在性能瓶颈。而 Vue3.5 通过数据结构优化（双向链表）和算法改进（版本计数），将依赖管理的平均时间复杂度从 <code>O(n)</code> 降至 <code>O(1)</code>，成为性能提升 56% 的关键因素。</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="有一个动态表格500500每格都是可以切换成不同的表单项比如每格可以换成输入框-下拉选择-单选-多选等怎么在编辑态的时候优化卡顿的情况">有一个动态表格，500*500，每格都是可以切换成不同的表单项，比如每格可以换成输入框、下拉选择、单选、多选等，怎么在编辑态的时候，优化卡顿的情况 </h1>
<p>针对大规模动态表格（500x500）在编辑态卡顿的问题，需采用多维优化策略降低渲染压力。以下是分层次的优化方案，按优先级排序：</p>
<hr>
<h3 id="一-核心优化手段必选"><strong>一、核心优化手段（必选）</strong> </h3>
<h4 id="1-双维度虚拟滚动--解决渲染节点过多"><strong>1. 双维度虚拟滚动 —— 解决渲染节点过多</strong> </h4>
<ul>
<li>
<p><strong>实现原理</strong><br>
仅渲染可视区域内的单元格（约 30x15=450 个节点），而非全量 25 万节点。<br>
需同时处理 <strong>横向滚动</strong> 和 <strong>纵向滚动</strong> 的视窗计算。</p>
</li>
<li>
<p><strong>代码示例</strong></p>
<pre data-role="codeBlock" data-info="tsx" class="language-tsx tsx"><code><span class="token keyword keyword-const">const</span> <span class="token function-variable function">VirtualGrid</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  rows <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">,</span>
  cols <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">,</span>
  cellHeight <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">,</span>
  cellWidth <span class="token operator">=</span> <span class="token number">120</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>scrollTop<span class="token punctuation">,</span> setScrollTop<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>scrollLeft<span class="token punctuation">,</span> setScrollLeft<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> containerRef <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useRef</span><span class="token generic class-name"><span class="token operator">&lt;</span>HTMLDivElement<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword keyword-null">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 计算可见区域的行列范围</span>
  <span class="token keyword keyword-const">const</span> visibleRows <span class="token operator">=</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">ceil</span><span class="token punctuation">(</span>
    containerRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token operator">?.</span>clientHeight <span class="token operator">/</span> cellHeight
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> visibleCols <span class="token operator">=</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">ceil</span><span class="token punctuation">(</span>
    containerRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token operator">?.</span>clientWidth <span class="token operator">/</span> cellWidth
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> startRow <span class="token operator">=</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">floor</span><span class="token punctuation">(</span>scrollTop <span class="token operator">/</span> cellHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> endRow <span class="token operator">=</span> startRow <span class="token operator">+</span> visibleRows<span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> startCol <span class="token operator">=</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">floor</span><span class="token punctuation">(</span>scrollLeft <span class="token operator">/</span> cellWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> endCol <span class="token operator">=</span> startCol <span class="token operator">+</span> visibleCols<span class="token punctuation">;</span>

  <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>
      <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>containerRef<span class="token punctuation">}</span></span>
      <span class="token attr-name">onScroll</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>e <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setScrollTop</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">currentTarget</span><span class="token punctuation">.</span><span class="token property-access">scrollTop</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setScrollLeft</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">currentTarget</span><span class="token punctuation">.</span><span class="token property-access">scrollLeft</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
      <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> height<span class="token operator">:</span> <span class="token string">'600px'</span><span class="token punctuation">,</span> overflow<span class="token operator">:</span> <span class="token string">'auto'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
    <span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span><span class="token comment">/* 总高度撑开滚动条 */</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>
        <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
          height<span class="token operator">:</span> rows <span class="token operator">*</span> cellHeight<span class="token punctuation">,</span>
          width<span class="token operator">:</span> cols <span class="token operator">*</span> cellWidth<span class="token punctuation">,</span>
          position<span class="token operator">:</span> <span class="token string">'relative'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
      <span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span><span class="token comment">/* 渲染可见单元格 */</span><span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token punctuation">{</span><span class="token known-class-name class-name">Array</span><span class="token punctuation">.</span><span class="token method function property-access">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> length<span class="token operator">:</span> visibleRows <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword keyword-const">const</span> row <span class="token operator">=</span> startRow <span class="token operator">+</span> i<span class="token punctuation">;</span>
          <span class="token keyword keyword-return">return</span> <span class="token known-class-name class-name">Array</span><span class="token punctuation">.</span><span class="token method function property-access">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> length<span class="token operator">:</span> visibleCols <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-const">const</span> col <span class="token operator">=</span> startCol <span class="token operator">+</span> j<span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>
                <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>row<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>col<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span></span>
                <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
                  position<span class="token operator">:</span> <span class="token string">'absolute'</span><span class="token punctuation">,</span>
                  top<span class="token operator">:</span> row <span class="token operator">*</span> cellHeight<span class="token punctuation">,</span>
                  left<span class="token operator">:</span> col <span class="token operator">*</span> cellWidth<span class="token punctuation">,</span>
                  height<span class="token operator">:</span> cellHeight<span class="token punctuation">,</span>
                  width<span class="token operator">:</span> cellWidth<span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
              <span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">CellComponent</span></span> <span class="token attr-name">row</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>row<span class="token punctuation">}</span></span> <span class="token attr-name">col</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>col<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
              </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></li>
</ul>
<h4 id="2-单元格组件缓存--避免重复渲染"><strong>2. 单元格组件缓存 —— 避免重复渲染</strong> </h4>
<ul>
<li>
<p><strong>React 优化</strong><br>
使用 <code>React.memo</code> + 状态提升，隔离单元格渲染：</p>
<pre data-role="codeBlock" data-info="tsx" class="language-tsx tsx"><code><span class="token keyword keyword-const">const</span> <span class="token maybe-class-name">CellComponent</span> <span class="token operator">=</span> <span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> row<span class="token punctuation">,</span> col <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>cellData<span class="token punctuation">,</span> setCellData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useCellState</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> col<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 独立状态管理</span>
  <span class="token keyword keyword-return">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Editor</span></span> <span class="token attr-name">type</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>cellData<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">}</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>cellData<span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 自定义 Hook 管理单元格状态（替代全局 Store）</span>
<span class="token keyword keyword-function">function</span> <span class="token function">useCellState</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> col<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token function">loadCellData</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> col<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 更新时只触发当前单元格重绘</span>
  <span class="token keyword keyword-const">const</span> <span class="token function-variable function">update</span> <span class="token operator">=</span> newVal <span class="token arrow operator">=&gt;</span> <span class="token function">setData</span><span class="token punctuation">(</span>prev <span class="token arrow operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token spread operator">...</span>prev<span class="token punctuation">,</span> <span class="token spread operator">...</span>newVal <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-return">return</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> update<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p><strong>Vue 优化</strong><br>
使用 <code>v-memo</code> 指令精准控制更新：</p>
<pre data-role="codeBlock" data-info="vue" class="language-vue vue"><code>&lt;template&gt;
  &lt;div v-for="row in visibleRows" :key="row"&gt;
    &lt;div v-for="col in visibleCols" :key="col" v-memo="[gridData[row][col]]"&gt;
      &lt;CellEditor :data="gridData[row][col]" /&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre></li>
</ul>
<hr>
<h3 id="二-渲染层优化强化"><strong>二、渲染层优化（强化）</strong> </h3>
<h4 id="1-离屏-canvas-绘制--应对极端性能场景"><strong>1. 离屏 Canvas 绘制 —— 应对极端性能场景</strong> </h4>
<ul>
<li>
<p><strong>适用场景</strong><br>
当单元格内包含复杂交互组件（如富文本）导致 DOM 压力过大时。</p>
</li>
<li>
<p><strong>实现方案</strong></p>
<ul>
<li>使用 <code>Canvas</code> 绘制静态表格背景</li>
<li>仅用 DOM 渲染当前聚焦的编辑组件</li>
<li>监听滚动事件动态更新绘制区域</li>
</ul>
</li>
</ul>
<h4 id="2-web-worker-计算--分离主线程压力"><strong>2. Web Worker 计算 —— 分离主线程压力</strong> </h4>
<p>将非 UI 操作移至 Worker：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 主线程</span>
<span class="token keyword keyword-const">const</span> worker <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">'./gridWorker.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
worker<span class="token punctuation">.</span><span class="token method function property-access">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'INIT'</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> initialGrid <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Worker 线程处理数据变更</span>
<span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">type</span> <span class="token operator">===</span> <span class="token string">'UPDATE_CELL'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> newData <span class="token operator">=</span> <span class="token function">computeNewData</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'UPDATE'</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> newData <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><hr>
<h3 id="三-交互体验优化"><strong>三、交互体验优化</strong> </h3>
<h4 id="1-分级渲染策略"><strong>1. 分级渲染策略</strong> </h4>
<table>
<thead>
<tr>
<th>交互状态</th>
<th>渲染策略</th>
</tr>
</thead>
<tbody>
<tr>
<td>静止状态</td>
<td>纯文本展示</td>
</tr>
<tr>
<td>悬停状态</td>
<td>显示简易操作按钮</td>
</tr>
<tr>
<td>点击编辑</td>
<td>渲染完整表单组件 + 动画过渡</td>
</tr>
</tbody>
</table>
<h4 id="2-防抖处理滚动事件"><strong>2. 防抖处理滚动事件</strong> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> handleScroll <span class="token operator">=</span> <span class="token function">useDebounce</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">updateVisibleArea</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>scrollLeft<span class="token punctuation">,</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>scrollTop<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 50ms 间隔更新</span>
</code></pre><hr>
<h3 id="四-数据架构优化"><strong>四、数据架构优化</strong> </h3>
<h4 id="1-扁平化状态存储"><strong>1. 扁平化状态存储</strong> </h4>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 坏实践：嵌套对象难以快速定位</span>
<span class="token keyword keyword-type">type</span> <span class="token class-name">GridData</span> <span class="token operator">=</span> <span class="token punctuation">{</span> rows<span class="token operator">:</span> <span class="token punctuation">{</span> cols<span class="token operator">:</span> <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 好实践：矩阵式扁平存储</span>
<span class="token keyword keyword-type">type</span> <span class="token class-name">GridData</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  cells<span class="token operator">:</span> Map<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> Cell<span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// key 为 'row,col'</span>
  version<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> <span class="token comment">// 用于快速比对变化</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><h4 id="2-增量更新机制"><strong>2. 增量更新机制</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 仅提交修改过的单元格数据</span>
<span class="token keyword keyword-const">const</span> changes <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> <span class="token function-variable function">saveChanges</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/save'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token known-class-name class-name">Array</span><span class="token punctuation">.</span><span class="token keyword module keyword-from">from</span><span class="token punctuation">(</span>changes<span class="token punctuation">.</span><span class="token method function property-access">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><hr>
<h3 id="五-备选方案对比"><strong>五、备选方案对比</strong> </h3>
<table>
<thead>
<tr>
<th>方案</th>
<th>优点</th>
<th>缺点</th>
<th>适用场景</th>
</tr>
</thead>
<tbody>
<tr>
<td>纯虚拟滚动</td>
<td>实现简单</td>
<td>无法处理复杂单元格</td>
<td>简单表格</td>
</tr>
<tr>
<td>Canvas 混合渲染</td>
<td>极高性能</td>
<td>交互实现复杂</td>
<td>超大数据量 + 简单交互</td>
</tr>
<tr>
<td>Web Components</td>
<td>浏览器原生支持</td>
<td>生态工具较少</td>
<td>需要跨框架复用</td>
</tr>
<tr>
<td>分块加载</td>
<td>内存占用低</td>
<td>滚动体验不连贯</td>
<td>无法预估数据总量时</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="总结-2"><strong>总结</strong> </h3>
<ol>
<li><strong>虚拟滚动是基础防线</strong> —— 必须实现行列双维度计算</li>
<li><strong>组件级状态隔离</strong> —— 避免连锁渲染</li>
<li><strong>交互分级与降级</strong> —— 非激活态保持极简</li>
<li><strong>数据架构决定上限</strong> —— 使用高效数据结构</li>
</ol>
<p>通过组合以上策略，可将渲染节点从 25 万降至 500 以内，操作延迟从秒级压缩至 50ms 内，实现流畅编辑体验。</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="前端大文件上传的具体实现思路与代码">前端大文件上传的具体实现思路与代码 </h1>
<p>！代码可以直接参考 bigfile-upload 这个项目</p>
<p>大文件上传的核心在于 <strong>分片上传、断点续传、文件校验</strong>，以下是详细实现思路和代码示例：</p>
<hr>
<h3 id="一-核心技术方案">一、核心技术方案 </h3>
<ol>
<li><strong>分片上传</strong>：将大文件切割成小片段（如 1MB/片）</li>
<li><strong>唯一标识</strong>：通过文件内容生成唯一 hash（如 SparkMD5）</li>
<li><strong>断点续传</strong>：记录已上传分片，失败后继续上传</li>
<li><strong>并发控制</strong>：控制同时上传的分片数量</li>
<li><strong>服务端合并</strong>：所有分片上传完成后合并文件</li>
</ol>
<hr>
<h3 id="二-前端实现代码vuereact-示例">二、前端实现代码（Vue/React 示例） </h3>
<pre data-role="codeBlock" data-info="html" class="language-html html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handleFileChange<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token comment">// 工具函数：计算文件 hash（使用 Web Worker）</span>
  <span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">calculateHash</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-return">return</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword keyword-const">const</span> worker <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">'./hash-worker.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      worker<span class="token punctuation">.</span><span class="token method function property-access">postMessage</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
      worker<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onmessage</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token arrow operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 分片上传逻辑</span>
  <span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> chunkSize <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span> <span class="token comment">// 1MB</span>
    <span class="token keyword keyword-const">const</span> chunks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-let">let</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">// 1. 文件分片</span>
    <span class="token keyword control-flow keyword-while">while</span> <span class="token punctuation">(</span>offset <span class="token operator">&lt;</span> file<span class="token punctuation">.</span><span class="token property-access">size</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      chunks<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token method function property-access">slice</span><span class="token punctuation">(</span>offset<span class="token punctuation">,</span> offset <span class="token operator">+</span> chunkSize<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      offset <span class="token operator">+=</span> chunkSize<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 2. 计算文件 hash</span>
    <span class="token keyword keyword-const">const</span> fileHash <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token function">calculateHash</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 3. 检查服务器是否已有文件</span>
    <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> axios<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">'/api/check'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> fileHash <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token property-access">exist</span><span class="token punctuation">)</span> <span class="token keyword control-flow keyword-return">return</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'秒传成功！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 4. 上传分片</span>
    <span class="token keyword keyword-const">const</span> uploaded <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token property-access">uploadedChunks</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> requests <span class="token operator">=</span> chunks<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">chunk<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>uploaded<span class="token punctuation">.</span><span class="token method function property-access">has</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword control-flow keyword-return">return</span> <span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword keyword-const">const</span> formData <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      formData<span class="token punctuation">.</span><span class="token method function property-access">append</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">,</span> chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
      formData<span class="token punctuation">.</span><span class="token method function property-access">append</span><span class="token punctuation">(</span><span class="token string">'hash'</span><span class="token punctuation">,</span> fileHash<span class="token punctuation">)</span><span class="token punctuation">;</span>
      formData<span class="token punctuation">.</span><span class="token method function property-access">append</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
      formData<span class="token punctuation">.</span><span class="token method function property-access">append</span><span class="token punctuation">(</span><span class="token string">'total'</span><span class="token punctuation">,</span> chunks<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword control-flow keyword-return">return</span> axios<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">'/api/upload'</span><span class="token punctuation">,</span> formData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 5. 控制并发（最大6个）</span>
    <span class="token keyword keyword-const">const</span> parallelCount <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-let">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> requests<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> parallelCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow keyword-await">await</span> <span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">all</span><span class="token punctuation">(</span>requests<span class="token punctuation">.</span><span class="token method function property-access">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i <span class="token operator">+</span> parallelCount<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 6. 通知合并</span>
    <span class="token keyword control-flow keyword-await">await</span> axios<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">'/api/merge'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">filename</span><span class="token operator">:</span> file<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">,</span>
      <span class="token literal-property property">hash</span><span class="token operator">:</span> fileHash<span class="token punctuation">,</span>
      <span class="token literal-property property">total</span><span class="token operator">:</span> chunks<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Worker 文件（hash-worker.js）</span>
  self<span class="token punctuation">.</span><span class="token method function property-access">importScripts</span><span class="token punctuation">(</span><span class="token string">'spark-md5.min.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  self<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onmessage</span> <span class="token operator">=</span> <span class="token keyword keyword-async">async</span> <span class="token parameter">e</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> file <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> spark <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">SparkMD5<span class="token punctuation">.</span>ArrayBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> reader <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    reader<span class="token punctuation">.</span><span class="token method function property-access">readAsArrayBuffer</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    reader<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onload</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      spark<span class="token punctuation">.</span><span class="token method function property-access">append</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">result</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      self<span class="token punctuation">.</span><span class="token method function property-access">postMessage</span><span class="token punctuation">(</span>spark<span class="token punctuation">.</span><span class="token method function property-access">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><hr>
<h3 id="三-服务端实现nodejs--express">三、服务端实现（Node.js + Express） </h3>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 上传分片接口</span>
app<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">'/api/upload'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> hash<span class="token punctuation">,</span> index <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> chunk <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">files</span><span class="token punctuation">.</span><span class="token property-access">file</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> chunkDir <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./temp/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token method function property-access">existsSync</span><span class="token punctuation">(</span>chunkDir<span class="token punctuation">)</span><span class="token punctuation">)</span> fs<span class="token punctuation">.</span><span class="token method function property-access">mkdirSync</span><span class="token punctuation">(</span>chunkDir<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 保存分片到临时目录</span>
  fs<span class="token punctuation">.</span><span class="token method function property-access">writeFileSync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chunkDir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>index<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> chunk<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 合并文件接口</span>
app<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">'/api/merge'</span><span class="token punctuation">,</span> <span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> hash<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> total <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> chunkDir <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./temp/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> files <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token method function property-access">readdirSync</span><span class="token punctuation">(</span>chunkDir<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 检查分片数量</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>files<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">!==</span> total<span class="token punctuation">)</span> <span class="token keyword control-flow keyword-return">return</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">'分片缺失'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 按序号排序后合并</span>
  <span class="token keyword keyword-const">const</span> targetPath <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./uploads/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> writeStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token method function property-access">createWriteStream</span><span class="token punctuation">(</span>targetPath<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-let">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> total<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> chunkPath <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chunkDir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    fs<span class="token punctuation">.</span><span class="token method function property-access">createReadStream</span><span class="token punctuation">(</span>chunkPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">pipe</span><span class="token punctuation">(</span>writeStream<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  writeStream<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'finish'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 删除临时目录</span>
    fs<span class="token punctuation">.</span><span class="token method function property-access">rmdirSync</span><span class="token punctuation">(</span>chunkDir<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">recursive</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 文件检查接口</span>
app<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">'/api/check'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> hash <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> filePath <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./uploads/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">_*</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

  <span class="token comment">// 检查文件是否存在</span>
  <span class="token keyword keyword-const">const</span> files <span class="token operator">=</span> glob<span class="token punctuation">.</span><span class="token method function property-access">sync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>files<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-return">return</span> res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">exist</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 检查已上传分片</span>
  <span class="token keyword keyword-const">const</span> chunkDir <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./temp/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> uploaded <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token method function property-access">existsSync</span><span class="token punctuation">(</span>chunkDir<span class="token punctuation">)</span>
    <span class="token operator">?</span> fs<span class="token punctuation">.</span><span class="token method function property-access">readdirSync</span><span class="token punctuation">(</span>chunkDir<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Number</span><span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">exist</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">uploadedChunks</span><span class="token operator">:</span> uploaded <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<h3 id="四-优化点">四、优化点 </h3>
<ol>
<li><strong>进度显示</strong>：通过 Axios 的 <code>onUploadProgress</code> 计算总进度</li>
<li><strong>暂停/恢复</strong>：记录已上传分片索引</li>
<li><strong>错误重试</strong>：对失败分片进行自动重试（最多 3 次）</li>
<li><strong>文件清理</strong>：定时清理未完成的上传临时文件</li>
<li><strong>分片大小</strong>：动态调整分片大小（网络差时减小分片）</li>
</ol>
<hr>
<h3 id="五-注意事项-1">五、注意事项 </h3>
<ol>
<li><strong>文件 Hash 计算</strong>：使用 Web Worker 防止主线程阻塞</li>
<li><strong>并发控制</strong>：避免浏览器并发限制（Chrome 最大 6 个）</li>
<li><strong>安全防护</strong>：校验分片序号防止恶意攻击</li>
<li><strong>跨域问题</strong>：配置 CORS 和文件上传大小限制</li>
<li><strong>分布式存储</strong>：如需扩展可使用对象存储（如 OSS、S3）</li>
</ol>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="前端工程化的主要内容">前端工程化的主要内容 </h1>
<h2 id="一-规范确立统一代码风格与开发流程工程化的首要任务是制定规范">一、规范确立：统一代码风格与开发流程工程化的首要任务是制定规范。 </h2>
<p>在项目初始阶段，我们必须明确代码风格指南（像 ESLint 规则、代码提交规范等）以及开发流程。这有助于团队成员编写风格一致的代码，减少代码冲突，降低沟通成本。推荐运用 ESLint、Prettier 等工具实现代码自动格式化，并集成到 IDE 和 Git Hooks 中，以确保代码规范得以强制执行。</p>
<h2 id="二-包管理与构建挑选适配的工具">二、包管理与构建：挑选适配的工具 </h2>
<p>在包管理方面，npm、yarn 和 pnpm 都是可行的选择，具体要依据项目实际情况来确定。pnpm 在依赖管理和磁盘空间利用效率方面表现出众，可优先考虑。构建工具方面，Webpack 和 Vite 是当下的主流选择。Webpack 功能强大且配置灵活，适用于大型复杂项目；Vite 则凭借极快的启动速度和简洁的配置，更适合中小型项目的快速开发与迭代。在选择构建工具时，项目规模、性能需求和团队技术栈等因素都需要纳入考量范围。</p>
<h2 id="三-前端框架基于业务场景选定合适框架">三、前端框架：基于业务场景选定合适框架 </h2>
<p>React 和 Vue 是目前最为流行的两个前端框架。React 以灵活性和组件化理念闻名，适用于构建大型复杂的 Web 应用；Vue 以易用性和渐进式框架的特性，更适合中小型项目的快速开发。在选择框架时，团队技术栈、项目规模和业务场景等因素都应被考虑在内。</p>
<h2 id="四-css-解决方案提高样式开发效率">四、CSS 解决方案：提高样式开发效率 </h2>
<p>CSS 预处理器（如 Sass/Less）和 CSS Modules 能够有效提升样式开发效率和可维护性。此外，CSS - in - JS 解决方案（例如 styled - components、Emotion）也日益受到欢迎，它们能够更好地实现组件样式的封装与复用。</p>
<h2 id="五-开发工具链优化开发体验">五、开发工具链：优化开发体验 </h2>
<p>一套完善的开发工具链能够极大地提升开发体验。除 ESLint 和 Prettier 之外，还可集成其他工具，如代码编辑器插件、调试工具、自动化测试工具等。</p>
<h2 id="六-多维度测试确保代码质量">六、多维度测试：确保代码质量 </h2>
<p>测试是确保代码质量的关键环节。我们需要制定全面的测试策略，涵盖单元测试、集成测试、端到端测试（E2E）以及视觉回归测试。Jest、Mocha、Cypress、Playwright 等都是常用的测试框架，可根据项目需求选用合适的工具。</p>
<h2 id="七-持续集成与持续部署cicd实现自动化构建与部署">七、持续集成与持续部署（CI/CD）：实现自动化构建与部署 </h2>
<p>CI/CD 能够自动化构建、测试和部署流程，提高开发效率并减少人为失误。Jenkins、GitLab CI/CD、GitHub Actions 等都是常用的 CI/CD 工具。</p>
<h2 id="八-应用性能监控apm实时监控应用性能">八、应用性能监控（APM）：实时监控应用性能 </h2>
<p>APM 可实时监控应用的性能指标，如页面加载速度、接口响应时间等，有助于我们及时发现并解决性能问题。</p>
<h2 id="九-工具对比矩阵与实施方案详述工具功能优势劣势">九、工具对比矩阵与实施方案详述工具功能优势劣势 </h2>
<ul>
<li>Webpack 模块打包功能强大，配置灵活配置复杂，构建速度慢</li>
<li>Vite 模块打包启动速度快，配置简洁生态相对较小</li>
<li>React 前端框架灵活，组件化学习曲线较陡</li>
<li>Vue 前端框架易用，渐进式生态相对 React 较小</li>
</ul>
<h2 id="总结-3">总结 </h2>
<p>先制定前端代码规范，然后使用 eslint prettier stylelint husky 进行自动化规范，react 和 vue 进行前端框架的选择，配合 webpack 和 vite 进行项目构建打包，选择前端架构可以选择 SPA 或 SSR 或 ssg 或微前端，monorepo 等架构，使用 css 预处理器和 css modules 进行样式开发，提取公共组件和工具进行，使用 jest 和 mocha 进行单元测试和集成测试，使用 jenkins、gitlab ci/cd 和 github actions 配合 docker 进行持续集成和持续部署，使用 sentry 进行应用性能监控，</p>
<h2 id="css-工程化">css 工程化 </h2>
<ol>
<li>首先通过 sass 或 less 这类预处理器来提供嵌套、变量、混入、函数和继承等能力，提高代码的可维护性，减少冗余代码</li>
<li>使用 css modules 进行样式隔离，避免样式冲突，提高代码可维护性，避免全局样式污染</li>
<li>使用 postcss 和他的插件生态来处理 css 的兼容性，压缩代码的体积</li>
<li>使用 stylelint+prettier 来检查语法错误和规范，格式化代码</li>
<li>结合 webpack/vite 等构建工具来优化 css 代码的加载和编译，减少 http 请求数，提高页面加载速度</li>
</ol>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="有一个类名为-box-的-div-元素宽度-500px高度-500px它下面有-4-个类名为-item-的-div-子元素宽度为-50px高度为-50px如何通过-flex-布局这-4-个子元素-2-个一行在-box-元素的右下角排列">有一个类名为 box 的 div 元素，宽度 500px，高度 500px，它下面有 4 个类名为 item 的 div 子元素，宽度为 50px，高度为 50px，如何通过 flex 布局这 4 个子元素 2 个一行在 box 元素的右下角排列？ </h1>
<pre data-role="codeBlock" data-info="css" class="language-css css"><code><span class="token selector"><span class="token class">.box</span></span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
  <span class="token property">flex-wrap</span><span class="token punctuation">:</span> wrap<span class="token punctuation">;</span>
  <span class="token property">place-content</span><span class="token punctuation">:</span> flex-end flex-end<span class="token punctuation">;</span>
  // //其实place-content就是下面这<span class="token number">2</span>个元素的简写
  //   <span class="token property">align-content</span><span class="token punctuation">:</span> flex-end<span class="token punctuation">;</span>
  //   <span class="token property">justify-content</span><span class="token punctuation">:</span> flex-end<span class="token punctuation">;</span>
  <span class="token property">align-items</span><span class="token punctuation">:</span> flex-end<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">600</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">400</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token unit">px</span> solid <span class="token hexcode color">#000</span><span class="token punctuation">;</span>

  <span class="token selector"><span class="token class">.item</span></span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">50</span><span class="token unit">px</span><span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">50</span><span class="token unit">px</span><span class="token punctuation">;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode color">#ccc</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token selector"><span class="token class">.item</span><span class="token pseudo-class">:nth-child</span><span class="token punctuation">(</span><span class="token n-th"><span class="token number">3</span></span><span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
    // 让第三个元素换行
    <span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">80</span><span class="token unit">%</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<hr>
<hr>
<hr>
<h1 id="脚手架">脚手架 </h1>
<ol>
<li>脚手架主要是通过<code>commander</code> 和 <code>inquirer</code> 这 2 个工具来实现的，<code>commander</code>是负责接收脚手架的命令和参数做进一步的处理；<code>inquirer</code>是负责做控制台的交互的，比如询问用户问题并接收用户输入的回答，支持输入或选项的方式</li>
<li>支持 2 种载入模板的方式<br>
&nbsp; 1. 一种是文件形式，模板文件放在脚手架特定的目录下面，属于脚手架自带的，使用此类模板的话就会从脚手架自带目录中加载对应的模板并使用<br>
&nbsp; 2. 另一种是远程地址的形式，这种可以提供一个远程地址，可以是 git 地址，也可以是一个远程压缩包地址，使用这种模式会先下载远程的文件，然后加载到当前使用脚手架的目录下</li>
<li>如何支持扩展模板<br>
扩展模板可以分为用户本地临时扩展，或者是通过 pull request 的方式更新脚手架 git 仓库代码里的模板这种永久提供新的模板<br>
&nbsp; 1. 临时扩展：通过新增脚手架的本地代码中的模板或配置脚手架的本地配置文件来新增用户自定义的模板的远程地址<br>
&nbsp; 2. 永久扩展：用户通过合并脚手架 git 仓库代码的方式添加模板代码或者在模板配置文件中添加一个远程地址的模板配置</li>
</ol>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="在-vue-中如何处理错误">在 vue 中如何处理错误 </h1>
<ol>
<li>全局错误处理<br>
用于为应用内抛出的未捕获错误指定一个全局处理函数，可以处理的错误如下
<ul>
<li>组件渲染器</li>
<li>事件处理器</li>
<li>生命周期钩子</li>
<li>setup() 函数</li>
<li>侦听器</li>
<li>自定义指令钩子</li>
<li>过渡 (Transition) 钩子</li>
</ul>
</li>
</ol>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code>app<span class="token punctuation">.</span><span class="token property-access">config</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">errorHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> info</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 处理错误，例如：报告给一个服务</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><ol start="2">
<li>组件内部捕获错误的钩子<br>
可以处理的错误如下
<ul>
<li>组件渲染</li>
<li>事件处理器</li>
<li>生命周期钩子</li>
<li>setup() 函数</li>
<li>侦听器</li>
<li>自定义指令钩子</li>
<li>过渡钩子</li>
</ul>
</li>
</ol>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token function">onErrorCaptured</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> info</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><h1 id="react-中如何处理错误">react 中如何处理错误 </h1>
<p>错误边界组件，主要是用于处理发生在子组件树任何位置的 js 错误。<br>
以下错误无法捕捉到</p>
<ul>
<li>事件处理函数</li>
<li>异步代码</li>
<li>服务端渲染</li>
<li>错误边界组件自身抛出来的错误</li>
</ul>
<pre data-role="codeBlock" data-info="jsx" class="language-jsx jsx"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">ErrorBoundary</span> <span class="token keyword keyword-extends">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-super">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">state</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">hasError</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword keyword-static">static</span> <span class="token function">getDerivedStateFromError</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//  state  UI</span>
    <span class="token keyword control-flow keyword-return">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">hasError</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidCatch</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> errorInfo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
    <span class="token function">logErrorToMyService</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> errorInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">hasError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//  UI</span>
      <span class="token keyword control-flow keyword-return">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Something went wrong.</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow keyword-return">return</span> <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">children</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>使用</p>
<pre data-role="codeBlock" data-info="jsx" class="language-jsx jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ErrorBoundary</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MyWidget</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">ErrorBoundary</span></span><span class="token punctuation">&gt;</span></span>
</code></pre><hr>
<hr>
<hr>
<hr>
<h1 id="vue-的生命周期的执行顺序">vue 的生命周期的执行顺序 </h1>
<ul>
<li>父组件 beforeMount -&gt; 父组件 Mounted -&gt; 子组件 beforeMount -&gt; 子组件 Mounted</li>
<li>父组件 beforeUpdate -&gt; 子组件 onBeforeUnmount -&gt; 子组件 onUnmounted -&gt; 父组件 updated</li>
<li>父组件 onBeforeUnmount -&gt; 子组件 onBeforeUnmount -&gt;子组件 onUnmounted -&gt; 父组件 onUnmounted
<blockquote>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
</blockquote>
</li>
</ul>
<h1 id="css-和-js-的加载会阻塞渲染吗阻塞渲染具体指的是什么">css 和 js 的加载会阻塞渲染吗？阻塞渲染具体指的是什么？ </h1>
<h3 id="css-和-js-的加载对渲染的影响及阻塞机制解析">CSS 和 JS 的加载对渲染的影响及阻塞机制解析 </h3>
<hr>
<h4 id="1-css-的加载是否会阻塞渲染"><strong>1. CSS 的加载是否会阻塞渲染？</strong> </h4>
<p>• <strong>阻塞机制</strong>：<br>
CSS 的加载会阻塞 <strong>渲染树的生成</strong>（Render Tree）。浏览器需要将 HTML 解析为 DOM 树，同时将 CSS 解析为 CSSOM 树，两者结合才能生成渲染树。因此：<br>
• <strong>阻塞关键路径渲染</strong>：外链 CSS 文件会阻塞页面首次渲染，直到 CSSOM 构建完成。<br>
• <strong>不阻塞 DOM 解析</strong>：浏览器会继续解析 HTML，但不会渲染内容（表现为“白屏”）。</p>
<p>• <strong>优化方案</strong>：<br>
• <strong>内联关键 CSS</strong>：将首屏所需样式直接嵌入 HTML 的 <code>&lt;style&gt;</code> 标签，避免 HTTP 请求。<br>
• <strong>异步加载非关键 CSS</strong>：通过 <code>&lt;link rel="preload"&gt;</code> 或媒体查询（<code>media="print"</code>）延迟加载。<br>
• <strong>分块加载</strong>：使用 <code>preload</code> 预加载，再通过 JavaScript 动态插入。</p>
<h5 id="不过也可以使用异步加载-css">不过也可以使用异步加载 css </h5>
<ol>
<li>设置 link 标签 media 属性为 noexis，浏览器会认为当前样式表不适用当前类型，会在不阻塞页面渲染的情况下再进行下载。加载完成后，将 media 的值设为 screen 或 all，从而让浏览器开始解析 CSS</li>
</ol>
<pre data-role="codeBlock" data-info="html" class="language-html html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span>
  <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span>
  <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mystyles.css<span class="token punctuation">"</span></span>
  <span class="token attr-name">media</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>noexist<span class="token punctuation">"</span></span>
  <span class="token special-attr"><span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">media</span><span class="token operator">=</span><span class="token string">'all'</span></span><span class="token punctuation">"</span></span></span>
<span class="token punctuation">/&gt;</span></span>
</code></pre><ol start="2">
<li>通过 rel 属性将 link 元素标记为 alternate 可选样式表，也能实现浏览器异步加载。同样别忘了加载完成之后，将 rel 设回 stylesheet</li>
</ol>
<pre data-role="codeBlock" data-info="html" class="language-html html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span>
  <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>alternate stylesheet<span class="token punctuation">"</span></span>
  <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mystyles.css<span class="token punctuation">"</span></span>
  <span class="token special-attr"><span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">rel</span><span class="token operator">=</span><span class="token string">'stylesheet'</span></span><span class="token punctuation">"</span></span></span>
<span class="token punctuation">/&gt;</span></span>
</code></pre><hr>
<h4 id="2-javascript-的加载是否会阻塞渲染"><strong>2. JavaScript 的加载是否会阻塞渲染？</strong> </h4>
<p>• <strong>阻塞机制</strong>：<br>
JavaScript 的加载和执行会 <strong>阻塞 DOM 解析和渲染</strong>。原因如下：<br>
• <strong>默认同步执行</strong>：浏览器遇到 <code>&lt;script&gt;</code> 标签时，会暂停 HTML 解析，直到脚本下载、执行完毕（除非标记为 <code>async</code> 或 <code>defer</code>）。<br>
• <strong>依赖 CSSOM</strong>：如果脚本需要操作样式，浏览器会等待所有之前的 CSSOM 构建完成（即“CSS 阻塞 JS”）。</p>
<p>• <strong>阻塞表现</strong>：<br>
• <strong>DOM 解析暂停</strong>：未完成的 HTML 结构无法继续构建。<br>
• <strong>渲染延迟</strong>：页面内容无法显示，直到脚本执行完毕。</p>
<p>• <strong>优化方案</strong>：<br>
• <strong>异步加载</strong>：使用 <code>async</code>（下载后立即执行）或 <code>defer</code>（HTML 解析完成后执行）。<br>
• <strong>动态加载脚本</strong>：通过 <code>document.createElement('script')</code> 按需插入。<br>
• <strong>避免同步操作 DOM</strong>：将 DOM 操作放在 <code>DOMContentLoaded</code> 事件后。</p>
<hr>
<h4 id="3-什么是阻塞渲染"><strong>3. 什么是“阻塞渲染”？</strong> </h4>
<p>• <strong>定义</strong>：<br>
浏览器在解析 HTML 时，因外部资源（如 CSS、JS）的加载或执行，导致页面内容无法及时显示的现象。<br>
• <strong>关键表现</strong>：<br>
• <strong>白屏时间延长</strong>：用户等待资源加载时，页面无内容显示。<br>
• <strong>交互延迟</strong>：脚本未执行完时，按钮点击等操作无响应。</p>
<p>• <strong>阻塞的根源</strong>：<br>
• <strong>渲染依赖关系</strong>：渲染树需要完整的 DOM 和 CSSOM。<br>
• <strong>JS 的单线程模型</strong>：浏览器主线程同时负责解析、渲染和执行脚本，资源竞争导致阻塞。</p>
<hr>
<h4 id="4-优化阻塞渲染的实践方案"><strong>4. 优化阻塞渲染的实践方案</strong> </h4>
<ol>
<li>
<p><strong>CSS 优化</strong><br>
• <strong>Critical CSS</strong>：提取首屏关键样式内联，非关键样式异步加载。<br>
• <strong>CDN 加速</strong>：缩短 CSS 文件加载时间。<br>
• <strong>减少选择器复杂度</strong>：避免嵌套过深（如 <code>.nav &gt; ul &gt; li a</code>）。</p>
</li>
<li>
<p><strong>JavaScript 优化</strong><br>
• <strong>代码分割</strong>：通过 Webpack 的 <code>import()</code> 动态加载非关键脚本。<br>
• <strong>预加载优先级</strong>：使用 <code>&lt;link rel="preload"&gt;</code> 提前加载关键脚本。<br>
• <strong>减少主线程负担</strong>：将计算密集型任务移至 Web Workers。</p>
</li>
<li>
<p><strong>资源加载策略</strong><br>
• <strong>HTTP/2 多路复用</strong>：减少连接数，并行加载资源。<br>
• <strong>Preconnect/DNS 预解析</strong>：提前建立第三方资源的连接。<br>
• <strong>Lazy Loading</strong>：图片、组件等非首屏内容延迟加载。</p>
</li>
</ol>
<hr>
<h4 id="5-阻塞渲染的直观示例"><strong>5. 阻塞渲染的直观示例</strong> </h4>
<pre data-role="codeBlock" data-info="html" class="language-html html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- CSS 阻塞渲染：页面白屏直到 styles.css 加载完成 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>styles.css<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Hello World<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- JS 阻塞 DOM 解析：页面卡顿直到 script.js 下载并执行 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>script.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Content after script<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>• <strong>结果</strong>：<code>&lt;p&gt;</code> 标签的内容在 <code>script.js</code> 执行完成后才会显示。</p>
<hr>
<h4 id="总结-4"><strong>总结</strong> </h4>
<p>• <strong>CSS 阻塞渲染</strong>：因渲染树依赖 CSSOM，需尽早加载关键 CSS。<br>
• <strong>JS 阻塞渲染</strong>：脚本的下载和执行会中断 DOM 解析，需异步/延迟加载。<br>
• <strong>核心优化目标</strong>：减少关键资源的加载时间，非关键资源延后处理，最大化利用浏览器的并行加载能力。</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="webpack-的-dll-plugin-具体怎么使用请详细介绍下">webpack 的 dll plugin 具体怎么使用，请详细介绍下 </h1>
<hr>
<h3 id="webpack-dll-plugin-详细使用指南">Webpack DLL Plugin 详细使用指南 </h3>
<hr>
<h4 id="一-dll-plugin-核心作用"><strong>一、DLL Plugin 核心作用</strong> </h4>
<p>• <strong>解决痛点</strong>：项目依赖的第三方库（如 <code>react</code>、<code>lodash</code>）通常稳定不变，但每次构建时 Webpack 都会重新解析，耗时较长。<br>
• <strong>核心思想</strong>：将稳定库<strong>预编译为动态链接库</strong>（<code>.dll.js</code> 文件），后续构建直接复用，跳过重复解析。</p>
<hr>
<h4 id="二-完整配置流程"><strong>二、完整配置流程</strong> </h4>
<h5 id="1-创建-dll-配置文件webpackdllconfigjs"><strong>1. 创建 DLL 配置文件（<code>webpack.dll.config.js</code>）</strong> </h5>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span> <span class="token comment">// 生产环境优化</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 定义需要预编译的库</span>
    <span class="token literal-property property">vendor</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'react'</span><span class="token punctuation">,</span> <span class="token string">'react-dom'</span><span class="token punctuation">,</span> <span class="token string">'lodash'</span><span class="token punctuation">,</span> <span class="token string">'moment'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dll'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 输出目录</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'[name].dll.js'</span><span class="token punctuation">,</span> <span class="token comment">// 输出文件名（[name] 对应 entry 的 key）</span>
    <span class="token literal-property property">library</span><span class="token operator">:</span> <span class="token string">'[name]_dll'</span><span class="token punctuation">,</span> <span class="token comment">// 库的全局变量名（需唯一）</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword keyword-new">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'[name]_dll'</span><span class="token punctuation">,</span> <span class="token comment">// 需与 output.library 一致</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dll/[name]-manifest.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 描述文件路径</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><h5 id="2-生成-dll-文件"><strong>2. 生成 DLL 文件</strong> </h5>
<p>• <strong>运行命令</strong>：生成 <code>vendor.dll.js</code> 和 <code>vendor-manifest.json</code></p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>webpack <span class="token parameter variable">--config</span> webpack.dll.config.js
</code></pre><p>• <strong>生成文件</strong>：<br>
• <code>dll/vendor.dll.js</code>：预编译的库文件。<br>
• <code>dll/vendor-manifest.json</code>：库的映射关系描述文件。</p>
<h5 id="3-主-webpack-配置中引用-dll"><strong>3. 主 Webpack 配置中引用 DLL</strong> </h5>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// webpack.config.js</span>
<span class="token keyword keyword-const">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...其他配置</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword keyword-new">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">manifest</span><span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./dll/vendor-manifest.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 加载描述文件</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><h5 id="4-html-中引入-dll-文件"><strong>4. HTML 中引入 DLL 文件</strong> </h5>
<pre data-role="codeBlock" data-info="html" class="language-html html"><code><span class="token comment">&lt;!-- public/index.html --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/dll/vendor.dll.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 手动引入 --&gt;</span>
</code></pre><h5 id="5-自动化脚本推荐"><strong>5. 自动化脚本（推荐）</strong> </h5>
<p>• <strong>package.json</strong> 添加脚本：</p>
<pre data-role="codeBlock" data-info="json" class="language-json json"><code><span class="token punctuation">{</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"build:dll"</span><span class="token operator">:</span> <span class="token string">"webpack --config webpack.dll.config.js"</span><span class="token punctuation">,</span>
    <span class="token property">"dev"</span><span class="token operator">:</span> <span class="token string">"npm run build:dll &amp;&amp; webpack serve"</span><span class="token punctuation">,</span> <span class="token comment">// 开发环境先编译 DLL</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"npm run build:dll &amp;&amp; webpack --mode production"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h4 id="三-核心原理图解"><strong>三、核心原理图解</strong> </h4>
<pre data-role="codeBlock" data-info="" class="language-text"><code>1. 预编译阶段：
   - 将 vendor 库打包为 vendor.dll.js 和 manifest.json。

2. 主构建阶段：
   - 通过 DllReferencePlugin 读取 manifest.json，跳过已编译的库。
   - 直接复用 vendor.dll.js 中的代码。
</code></pre><hr>
<h4 id="四-注意事项与优化"><strong>四、注意事项与优化</strong> </h4>
<h5 id="1-版本一致性"><strong>1. 版本一致性</strong> </h5>
<p>• <strong>问题</strong>：如果预编译的库版本与项目实际依赖不一致，会导致运行时错误。<br>
• <strong>解决</strong>：确保 <code>package.json</code> 中的依赖版本与 DLL 配置的 <code>entry.vendor</code> 完全一致。</p>
<h5 id="2-更新策略"><strong>2. 更新策略</strong> </h5>
<p>• <strong>何时需要重新生成 DLL</strong>：<br>
• 第三方库版本升级。<br>
• 新增/删除预编译的库。<br>
• <strong>自动化检测</strong>：可通过脚本对比 <code>package.json</code> 的依赖变化，自动触发 DLL 构建。</p>
<h5 id="3-生产环境优化"><strong>3. 生产环境优化</strong> </h5>
<p>• <strong>CDN 结合</strong>：将 <code>vendor.dll.js</code> 上传至 CDN，减少主包体积。</p>
<pre data-role="codeBlock" data-info="html" class="language-html html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.example.com/vendor.dll.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><h5 id="4-与-externals-的区别"><strong>4. 与 externals 的区别</strong> </h5>
<table>
<thead>
<tr>
<th><strong>方案</strong></th>
<th><strong>适用场景</strong></th>
<th><strong>优点</strong></th>
<th><strong>缺点</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>DLL Plugin</strong></td>
<td>项目内频繁使用的稳定库（如 React）</td>
<td>减少构建时间，代码集成度高</td>
<td>需维护 DLL 文件</td>
</tr>
<tr>
<td><strong>externals</strong></td>
<td>通过 CDN 引入的库（如 jQuery）</td>
<td>彻底排除库代码，主包体积最小</td>
<td>依赖外部环境，增加 HTTP 请求</td>
</tr>
</tbody>
</table>
<hr>
<h4 id="五-webpack-5-的替代方案"><strong>五、Webpack 5+ 的替代方案</strong> </h4>
<p>• <strong>弃用 DLL Plugin</strong>：Webpack 5 推荐使用更现代的缓存策略：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// webpack.config.js</span>
module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">cache</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'filesystem'</span><span class="token punctuation">,</span> <span class="token comment">// 持久化磁盘缓存</span>
    <span class="token literal-property property">buildDependencies</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">config</span><span class="token operator">:</span> <span class="token punctuation">[</span>__filename<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 配置文件变化时自动失效缓存</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>• <strong>适用性</strong>：Webpack 4 及以下项目仍可使用 DLL Plugin，Webpack 5 优先使用内置缓存。</p>
<hr>
<h4 id="六-总结-1"><strong>六、总结</strong> </h4>
<p>• <strong>使用场景</strong>：适合中大型项目，依赖大量稳定第三方库。<br>
• <strong>核心价值</strong>：通过预编译减少 50%+ 的构建时间。<br>
• <strong>维护成本</strong>：需定期检查依赖版本，更新 DLL 文件。</p>
<hr>
<hr>
<hr>
<hr>
<h1 id="sentry-能捕获静态资源加载失败的错误吗">sentry 能捕获静态资源加载失败的错误吗？ </h1>
<hr>
<blockquote>
<p>sentry 只覆写了 window.onerror 事件，但是 window.onerror 事件不会捕获静态资源加载失败的错误，因为静态资源加载错误是发生在捕获阶段的，window.onerror 无法捕获</p>
</blockquote>
<h3 id="sentry-捕获静态资源加载失败的实现方式与限制">Sentry 捕获静态资源加载失败的实现方式与限制 </h3>
<hr>
<h4 id="1-默认能力sentry-无法直接捕获静态资源加载错误">1. <strong>默认能力：Sentry 无法直接捕获静态资源加载错误</strong> </h4>
<p>• <strong>原因</strong>：静态资源（如 JS、CSS、图片）加载失败属于 <strong>网络请求错误</strong>，而非 JavaScript 运行时异常。Sentry 的 JavaScript SDK <strong>默认不监控资源加载失败事件</strong>。<br>
• <strong>例外情况</strong>：若资源加载失败导致依赖脚本未执行（如 <code>&lt;script&gt;</code> 加载失败），可能触发全局 <code>window.onerror</code> 事件，Sentry 可捕获此类错误。</p>
<hr>
<h4 id="2-手动捕获静态资源错误的方法">2. <strong>手动捕获静态资源错误的方法</strong> </h4>
<h5 id="方案-1监听全局-error-事件"><strong>方案 1：监听全局 <code>error</code> 事件</strong> </h5>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span>
  <span class="token string">'error'</span><span class="token punctuation">,</span>
  <span class="token parameter">event</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 过滤资源类型（script、link、img 等）</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">tagName</span> <span class="token operator">===</span> <span class="token string">'SCRIPT'</span> <span class="token operator">||</span> event<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">tagName</span> <span class="token operator">===</span> <span class="token string">'LINK'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token maybe-class-name">Sentry</span><span class="token punctuation">.</span><span class="token method function property-access">captureException</span><span class="token punctuation">(</span>
        <span class="token keyword keyword-new">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">资源加载失败: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">href</span> <span class="token operator">||</span> event<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">src</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">extra</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">tagName</span><span class="token operator">:</span> event<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">tagName</span><span class="token punctuation">,</span>
            <span class="token literal-property property">resourceUrl</span><span class="token operator">:</span> event<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">src</span> <span class="token operator">||</span> event<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">href</span><span class="token punctuation">,</span>
            <span class="token literal-property property">errorType</span><span class="token operator">:</span> <span class="token string">'resource_load_failed'</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token boolean">true</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用捕获阶段确保事件触发</span>
</code></pre><h5 id="方案-2通过-performance-api-监控资源加载"><strong>方案 2：通过 <code>Performance API</code> 监控资源加载</strong> </h5>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> observer <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">PerformanceObserver</span><span class="token punctuation">(</span><span class="token parameter">list</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  list<span class="token punctuation">.</span><span class="token method function property-access">getEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">entry</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token property-access">initiatorType</span> <span class="token operator">===</span> <span class="token string">'script'</span> <span class="token operator">&amp;&amp;</span> entry<span class="token punctuation">.</span><span class="token property-access">responseStatus</span> <span class="token operator">&gt;=</span> <span class="token number">400</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token maybe-class-name">Sentry</span><span class="token punctuation">.</span><span class="token method function property-access">captureException</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">脚本加载失败: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>entry<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">extra</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">status</span><span class="token operator">:</span> entry<span class="token punctuation">.</span><span class="token property-access">responseStatus</span><span class="token punctuation">,</span> <span class="token literal-property property">duration</span><span class="token operator">:</span> entry<span class="token punctuation">.</span><span class="token property-access">duration</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
observer<span class="token punctuation">.</span><span class="token method function property-access">observe</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'resource'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<h4 id="3-跨域资源加载的限制">3. <strong>跨域资源加载的限制</strong> </h4>
<p>• <strong>CORS 问题</strong>：若静态资源来自不同域且未配置 <code>CORS</code> 响应头，浏览器会限制错误详情（如状态码、响应体），Sentry 上报的信息可能不完整。<br>
• <strong>解决方案</strong>：确保资源服务器返回 <code>Access-Control-Allow-Origin: *</code> 或指定域名，并在 <code>&lt;script&gt;</code>/<code>&lt;link&gt;</code> 标签添加 <code>crossorigin</code> 属性：<br>
<code>html      &lt;script src="https://cdn.example.com/app.js" crossorigin&gt;&lt;/script&gt;      </code></p>
<hr>
<h4 id="4-推荐实践结合多种监控手段">4. <strong>推荐实践：结合多种监控手段</strong> </h4>
<p>• <strong>Sentry 上报</strong>：捕获关键资源错误（如核心 JS/CSS），辅助定位问题。<br>
• <strong>性能监控工具</strong>：使用 <strong>Lighthouse</strong> 或 <strong>Web Vitals</strong> 分析资源加载性能。<br>
• <strong>CDN 日志分析</strong>：直接通过 CDN 提供商的日志（如 Cloudflare、AWS CloudFront）统计资源失败率。</p>
<hr>
<h3 id="总结-5">总结 </h3>
<p>• <strong>Sentry 需手动配置</strong> 才能捕获静态资源加载错误，依赖全局事件监听或 Performance API。<br>
• <strong>跨域资源需额外处理</strong>，确保浏览器传递完整错误信息。<br>
• <strong>综合监控策略</strong> 更有效（Sentry + CDN 日志 + 性能工具）。</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="如何判断用户设备">如何判断用户设备 </h1>
<p>通过解析 navigator.userAgent 字符串判断设备类型，可以快速区分设备大类，手机或 pc</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token keyword keyword-function">function</span> <span class="token function">isMobile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> ua <span class="token operator">=</span> <span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token property-access">userAgent</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-return">return</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Android|iPhone|iPad|iPod|Windows Phone</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">.</span><span class="token method function property-access">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="git-如何将多次提交压缩成一次提交">git 如何将多次提交压缩成一次提交 </h1>
<p>前端开发中若需将多次 Git 提交合并为单次提交，可通过以下两种核心方法实现，具体操作及注意事项如下：</p>
<h3 id="一-交互式-rebase-合并法推荐本地分支整理">一、交互式 Rebase 合并法（推荐本地分支整理） </h3>
<p>此方法适用于整理当前分支的连续提交历史，通过重写提交记录实现合并：</p>
<ol>
<li>
<p><strong>启动交互式 Rebase</strong><br>
执行<code>git rebase -i HEAD~n</code>（n 为需合并的提交次数），例如合并最近 3 次提交：</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">git</span> rebase <span class="token parameter variable">-i</span> HEAD~3
</code></pre><p>此时会进入交互式界面，列出最近的提交记录。</p>
</li>
<li>
<p><strong>选择提交处理方式</strong><br>
将第一个提交保留为<code>pick</code>，后续提交改为<code>squash</code>或<code>s</code>（合并并保留日志）或<code>fixup</code>/<code>f</code>（合并并丢弃日志）：</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>pick a84e379 初始提交
squash 5542cd0 修复样式问题
fixup e5b712f 调整响应式布局
</code></pre><p>此操作会将后两次提交合并到第一个提交中。</p>
</li>
<li>
<p><strong>编辑最终提交信息</strong><br>
保存退出后，Git 会打开新窗口要求编辑合并后的提交信息，删除注释行并编写清晰的新日志，保存后即完成合并。</p>
</li>
<li>
<p><strong>强制推送更新远程仓库</strong></p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">git</span> push origin 分支名 <span class="token parameter variable">--force</span>
</code></pre><p>注意：强制推送会覆盖远程历史，多人协作分支慎用。</p>
</li>
</ol>
<hr>
<h3 id="二-squash-merge-合并法适用于合并分支">二、Squash Merge 合并法（适用于合并分支） </h3>
<p>此方法适合将特性分支的多个提交合并到主分支时压缩为单次提交：</p>
<ol>
<li>
<p><strong>切换到主分支并创建合并分支</strong></p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">git</span> checkout main
<span class="token function">git</span> checkout <span class="token parameter variable">-b</span> feature/squashed
</code></pre></li>
<li>
<p><strong>执行 Squash 合并</strong></p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">git</span> merge <span class="token parameter variable">--squash</span> 特性分支名
</code></pre><p>该命令将特性分支的所有改动暂存，但不会自动提交。</p>
</li>
<li>
<p><strong>提交合并结果</strong></p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">"合并特性分支所有改动"</span>
</code></pre><p>此时主分支将仅保留一个合并提交。</p>
</li>
</ol>
<hr>
<h3 id="关键注意事项">关键注意事项 </h3>
<ol>
<li>
<p><strong>冲突处理</strong><br>
合并过程中若出现冲突，需手动解决后执行<code>git rebase --continue</code>，建议在合并前确保代码状态干净。</p>
</li>
<li>
<p><strong>历史修改风险</strong><br>
Rebase 会重写提交历史，已推送至共享分支的提交不建议使用，否则需协调其他成员同步代码。</p>
</li>
<li>
<p><strong>可视化工具辅助</strong><br>
推荐使用<code>git log --graph --oneline</code>查看分支结构，或借助 SourceTree 等图形工具降低操作复杂度。</p>
</li>
</ol>
<p>两种方法的选择依据：若需整理当前分支历史用 Rebase，若合并外部分支用 Squash Merge。实际开发中可结合<code>git commit --amend</code>对最近提交进行快速修正。</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="前端如何截屏">前端如何截屏 </h1>
<ol>
<li>目前主流的方法是通过 html2canvas 插件实现</li>
</ol>
<pre data-role="codeBlock" data-info="html" class="language-html html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://html2canvas.hertzen.com/dist/html2canvas.min.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onload</span> <span class="token operator">=</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> targetElement <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'jieping'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 转换为图片</span>
  <span class="token function">html2canvas</span><span class="token punctuation">(</span>targetElement<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">allowTaint</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 允许跨域资源</span>
    <span class="token literal-property property">useCORS</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 启用 CORS 请求</span>
    <span class="token literal-property property">scale</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// 提高清晰度（2倍缩放）</span>
    <span class="token literal-property property">backgroundColor</span><span class="token operator">:</span> <span class="token string">'#ffffff'</span><span class="token punctuation">,</span> <span class="token comment">// 背景色</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">canvas</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> dataURL <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token method function property-access">toDataURL</span><span class="token punctuation">(</span><span class="token string">'image/png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 下载图片</span>
    <span class="token keyword keyword-const">const</span> link <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    link<span class="token punctuation">.</span><span class="token property-access">download</span> <span class="token operator">=</span> <span class="token string">'screenshot.png'</span><span class="token punctuation">;</span>
    link<span class="token punctuation">.</span><span class="token property-access">href</span> <span class="token operator">=</span> dataURL<span class="token punctuation">;</span>
    link<span class="token punctuation">.</span><span class="token method function property-access">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><ol start="2">
<li>如果是原生的 api 的话比较复杂，需要借助 canvas 的 fillRect(), fillText(), ctx.arc(), drawImage()等方法来在画布上绘制图案，然后使用 canvas 的 toDataURL()方法将画布转换为图片。</li>
</ol>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="介绍下-navigatorsendbeacon-方法">介绍下 navigator.sendBeacon 方法 </h1>
<p><code>navigator.sendBeacon()</code> 是浏览器提供的一种异步数据发送方法，专为在 <strong>页面卸载场景</strong>（如关闭、刷新或跳转）下可靠传输少量数据而设计。以下从核心特性、使用场景及技术细节进行详解：</p>
<hr>
<h3 id="一-核心特性与语法">一、核心特性与语法 </h3>
<h4 id="1-方法定义">1. 方法定义 </h4>
<p>通过 HTTP POST 请求向指定 URL 发送数据，<strong>不阻塞页面卸载流程</strong>，且能保证数据在后台可靠传输。</p>
<h4 id="2-语法格式">2. 语法格式 </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token method function property-access">sendBeacon</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>• <strong>参数说明</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>必填</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>url</code></td>
<td>String</td>
<td>是</td>
<td>数据接收地址</td>
</tr>
<tr>
<td><code>data</code></td>
<td>String/Blob/FormData 等</td>
<td>否</td>
<td>支持多种数据类型，建议控制在 64KB 以内</td>
</tr>
</tbody>
</table>
<p>• <strong>返回值</strong><br>
<code>true</code> 表示数据成功加入发送队列（非发送成功），<code>false</code> 表示因数据过大或队列限制失败。</p>
<hr>
<h3 id="二-典型应用场景">二、典型应用场景 </h3>
<h4 id="1-用户行为追踪与分析">1. 用户行为追踪与分析 </h4>
<p>• <strong>点击/页面停留统计</strong><br>
监听 <code>unload</code> 或 <code>visibilitychange</code> 事件，在页面关闭或隐藏时发送用户操作数据：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'unload'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> logData <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token function">getStayTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token string">'page_close'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token method function property-access">sendBeacon</span><span class="token punctuation">(</span><span class="token string">'/track'</span><span class="token punctuation">,</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span>logData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="2-性能监控与错误日志">2. 性能监控与错误日志 </h4>
<p>• <strong>资源加载耗时统计</strong><br>
结合 <code>performance.timing</code> API 采集页面性能指标：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'beforeunload'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> perfData <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">dns</span><span class="token operator">:</span>
      <span class="token dom variable">performance</span><span class="token punctuation">.</span><span class="token property-access">timing</span><span class="token punctuation">.</span><span class="token property-access">domainLookupEnd</span> <span class="token operator">-</span> <span class="token dom variable">performance</span><span class="token punctuation">.</span><span class="token property-access">timing</span><span class="token punctuation">.</span><span class="token property-access">domainLookupStart</span><span class="token punctuation">,</span>
    <span class="token literal-property property">load</span><span class="token operator">:</span> <span class="token dom variable">performance</span><span class="token punctuation">.</span><span class="token property-access">timing</span><span class="token punctuation">.</span><span class="token property-access">loadEventEnd</span> <span class="token operator">-</span> <span class="token dom variable">performance</span><span class="token punctuation">.</span><span class="token property-access">timing</span><span class="token punctuation">.</span><span class="token property-access">navigationStart</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token method function property-access">sendBeacon</span><span class="token punctuation">(</span><span class="token string">'/perf'</span><span class="token punctuation">,</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span>perfData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="3-临时数据保存">3. 临时数据保存 </h4>
<p>• <strong>表单草稿/游戏进度存储</strong><br>
用户意外关闭页面时自动保存未提交数据：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> formData <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'draft-form'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token method function property-access">sendBeacon</span><span class="token punctuation">(</span><span class="token string">'/save-draft'</span><span class="token punctuation">,</span> formData<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<h3 id="三-技术优势与限制">三、技术优势与限制 </h3>
<h4 id="1-核心优势">1. 核心优势 </h4>
<p>• <strong>高可靠性</strong>：浏览器优先处理发送队列，即使页面已关闭仍尝试传输；<br>
• <strong>非阻塞性</strong>：异步执行，不影响后续页面加载速度；<br>
• <strong>跨域支持</strong>：遵循 CORS 策略，可发送至第三方域名。</p>
<h4 id="2-使用限制">2. 使用限制 </h4>
<p>• <strong>数据量限制</strong>：多数浏览器限制为 <strong>64KB</strong> 以内，超出可能返回 <code>false</code>；<br>
• <strong>响应不可控</strong>：无法获取服务器响应状态，适用于无需反馈的日志场景；<br>
• <strong>仅限 POST 请求</strong>：不支持其他 HTTP 方法。</p>
<hr>
<h3 id="四-数据封装实践">四、数据封装实践 </h3>
<h4 id="1-json-数据发送">1. JSON 数据发送 </h4>
<p>需通过 <code>Blob</code> 指定 <code>Content-Type</code> 为 JSON：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">event</span><span class="token operator">:</span> <span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token literal-property property">timestamp</span><span class="token operator">:</span> <span class="token known-class-name class-name">Date</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> blob <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'application/json'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token method function property-access">sendBeacon</span><span class="token punctuation">(</span><span class="token string">'/log'</span><span class="token punctuation">,</span> blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="2-表单数据提交">2. 表单数据提交 </h4>
<p>使用 <code>FormData</code> 或 <code>URLSearchParams</code> 处理键值对数据：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> params <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
params<span class="token punctuation">.</span><span class="token method function property-access">append</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
params<span class="token punctuation">.</span><span class="token method function property-access">append</span><span class="token punctuation">(</span><span class="token string">'action'</span><span class="token punctuation">,</span> <span class="token string">'login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token method function property-access">sendBeacon</span><span class="token punctuation">(</span><span class="token string">'/submit'</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<h3 id="五-浏览器兼容性">五、浏览器兼容性 </h3>
<p>• <strong>支持范围</strong>：Chrome 49+、Firefox 31+、Safari 11.1+、Edge 14+；<br>
• <strong>不兼容场景</strong>：需在旧版浏览器（如 IE）降级使用同步 XHR 或 Image Ping。</p>
<hr>
<h3 id="总结-6">总结 </h3>
<p><code>navigator.sendBeacon</code> 是优化页面卸载期数据传输的专用工具，适用于日志、监控等 <strong>无需响应反馈</strong> 的场景。其设计平衡了传输可靠性与用户体验，但需注意数据量限制及浏览器兼容性要求。实际开发中常与 <code>fetch</code> 或 <code>XMLHttpRequest</code> 互补使用，构建完整的数据上报体系。</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="统计全站每一个静态资源加载耗时该如何做">统计全站每一个静态资源加载耗时，该如何做 </h1>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code>observer<span class="token punctuation">.</span><span class="token method function property-access">observe</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'resource'</span><span class="token punctuation">,</span> <span class="token literal-property property">buffered</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h1 id="退出浏览器之前发送积压的埋点数据请求该如何做">退出浏览器之前，发送积压的埋点数据请求，该如何做？ </h1>
<p>在浏览器退出前可靠发送积压的埋点数据，可通过以下方案实现：</p>
<hr>
<h3 id="一-核心实现方案">一、核心实现方案 </h3>
<h4 id="1-优先使用-navigatorsendbeacon">1. <strong>优先使用 <code>navigator.sendBeacon()</code></strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'pagehide'</span><span class="token punctuation">,</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> data <span class="token operator">=</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">/* 埋点数据 */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token method function property-access">sendBeacon</span><span class="token punctuation">(</span><span class="token string">'https://api.example.com/log'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>• <strong>特性</strong>：<br>
• 异步传输不阻塞页面卸载<br>
• 浏览器保证数据发送的可靠性<br>
• 支持多种数据类型（字符串、Blob、FormData 等）<br>
• <strong>适用场景</strong>：<br>
发送小于 <strong>64KB</strong> 的埋点数据（如用户行为日志、性能指标）</p>
<h4 id="2-备选方案fetch--keepalive">2. <strong>备选方案：<code>fetch</code> + <code>keepalive</code></strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'visibilitychange'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">visibilityState</span> <span class="token operator">===</span> <span class="token string">'hidden'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://api.example.com/log'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">/* 埋点数据 */</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">keepalive</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>• <strong>特性</strong>：<br>
• 支持请求头定制<br>
• 同样有 64KB 数据限制<br>
• 可通过并行请求突破单次限制</p>
<hr>
<h3 id="二-事件监听策略">二、事件监听策略 </h3>
<h4 id="1-最佳事件组合">1. <strong>最佳事件组合</strong> </h4>
<table>
<thead>
<tr>
<th>事件</th>
<th>触发场景</th>
<th>可靠性</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>visibilitychange</code></td>
<td>页面切后台（含关闭）</td>
<td>移动端更可靠</td>
</tr>
<tr>
<td><code>pagehide</code></td>
<td>页面卸载（后退/关闭）</td>
<td>兼容 bfcache 机制</td>
</tr>
</tbody>
</table>
<p><strong>推荐代码</strong>：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 主监听</span>
<span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'visibilitychange'</span><span class="token punctuation">,</span> sendData<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 兼容性补充</span>
<span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'pagehide'</span><span class="token punctuation">,</span> sendData<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-function">function</span> <span class="token function">sendData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">visibilityState</span> <span class="token operator">===</span> <span class="token string">'hidden'</span> <span class="token operator">||</span> event<span class="token punctuation">.</span><span class="token property-access">type</span> <span class="token operator">===</span> <span class="token string">'pagehide'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token method function property-access">sendBeacon</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="2-慎用传统事件">2. <strong>慎用传统事件</strong> </h4>
<p>• <code>beforeunload/unload</code>：<br>
• 移动端触发不可靠（如 APP 直接杀进程）<br>
• 影响浏览器 bfcache 缓存机制</p>
<hr>
<h3 id="三-数据优化策略">三、数据优化策略 </h3>
<h4 id="1-数据压缩技巧">1. <strong>数据压缩技巧</strong> </h4>
<p>• <strong>结构化压缩</strong>：<br>
将数据字段缩写（如 <code>{timestamp: t, eventType: e}</code>）<br>
• <strong>二进制编码</strong>：<br>
使用 <code>ArrayBuffer</code> + <code>gzip</code> 压缩（需配合 Service Worker）</p>
<h4 id="2-分片发送机制">2. <strong>分片发送机制</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 将大数据拆分为多个小于64KB的块</span>
<span class="token keyword keyword-const">const</span> chunks <span class="token operator">=</span> <span class="token function">splitData</span><span class="token punctuation">(</span>largeData<span class="token punctuation">)</span><span class="token punctuation">;</span>
chunks<span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">chunk</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token literal-property property">body</span><span class="token operator">:</span> chunk<span class="token punctuation">,</span> <span class="token literal-property property">keepalive</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<h3 id="四-异常处理与监控">四、异常处理与监控 </h3>
<h4 id="1-失败重传机制">1. <strong>失败重传机制</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-let">let</span> retryQueue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword keyword-function">function</span> <span class="token function">sendWithRetry</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token method function property-access">sendBeacon</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    retryQueue<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token dom variable">localStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">'retryQueue'</span><span class="token punctuation">,</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span>retryQueue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 页面加载时恢复队列</span>
<span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> saved <span class="token operator">=</span> <span class="token dom variable">localStorage</span><span class="token punctuation">.</span><span class="token method function property-access">getItem</span><span class="token punctuation">(</span><span class="token string">'retryQueue'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>saved<span class="token punctuation">)</span> retryQueue <span class="token operator">=</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">parse</span><span class="token punctuation">(</span>saved<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="2-数据完整性校验">2. <strong>数据完整性校验</strong> </h4>
<p>在服务端通过以下方式验证：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 请求头添加唯一标识</span>
<span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token method function property-access">sendBeacon</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string-property property">'X-Request-ID'</span><span class="token operator">:</span> <span class="token function">generateUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<h3 id="五-兼容性处理">五、兼容性处理 </h3>
<h4 id="1-降级方案">1. <strong>降级方案</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token property-access">sendBeacon</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 使用同步XHR（已废弃但部分旧浏览器支持）</span>
  <span class="token keyword keyword-const">const</span> xhr <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token method function property-access">open</span><span class="token punctuation">(</span><span class="token string">'POST'</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 同步请求</span>
  xhr<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 或通过图片打点</span>
  <span class="token keyword keyword-new">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">src</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?data=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="2-特性检测">2. <strong>特性检测</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> canUseBeacon <span class="token operator">=</span> <span class="token string">'sendBeacon'</span> <span class="token keyword keyword-in">in</span> <span class="token dom variable">navigator</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> canUseKeepalive <span class="token operator">=</span> <span class="token string">'keepalive'</span> <span class="token keyword keyword-in">in</span> <span class="token class-name">Request</span><span class="token punctuation">.</span><span class="token property-access">prototype</span><span class="token punctuation">;</span>
</code></pre><hr>
<h3 id="注意事项">注意事项 </h3>
<ol>
<li><strong>敏感数据处理</strong>：<br>
通过 HTTPS 传输 + 数据加密（如 AES-GCM）</li>
<li><strong>性能监控</strong>：<br>
记录埋点请求耗时，避免影响用户体验</li>
<li><strong>移动端适配</strong>：<br>
在微信等容器中测试事件触发可靠性</li>
</ol>
<p>实际部署时建议结合 <strong>Sentry</strong> 或 <strong>Google Analytics</strong> 的异常监控系统，确保数据上报通道的稳定性。</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="如何统计页面的-long-task长任务这个比较热门">如何统计页面的 long task(长任务)【这个比较热门】 </h1>
<p>前端统计页面中的 Long Task（长任务）主要通过浏览器提供的 <strong>Performance API</strong> 实现，以下是具体实现方案和优化建议：</p>
<hr>
<h3 id="一-核心实现方法">一、核心实现方法 </h3>
<h4 id="1-使用-performanceobserver-监听长任务">1. <strong>使用 <code>PerformanceObserver</code> 监听长任务</strong> </h4>
<p>通过浏览器内置的 <code>PerformanceObserver</code> API 监听 <code>longtask</code> 类型的性能条目，自动捕获所有超过 <strong>50ms</strong> 的任务：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-let">let</span> longTaskCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword keyword-let">let</span> totalDuration <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> observer <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">PerformanceObserver</span><span class="token punctuation">(</span><span class="token parameter">list</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  list<span class="token punctuation">.</span><span class="token method function property-access">getEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">entry</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token property-access">duration</span> <span class="token operator">&gt;</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      longTaskCount<span class="token operator">++</span><span class="token punctuation">;</span>
      totalDuration <span class="token operator">+=</span> entry<span class="token punctuation">.</span><span class="token property-access">duration</span><span class="token punctuation">;</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'长任务详情:'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">startTime</span><span class="token operator">:</span> entry<span class="token punctuation">.</span><span class="token property-access">startTime</span><span class="token punctuation">,</span> <span class="token comment">// 任务开始时间</span>
        <span class="token literal-property property">duration</span><span class="token operator">:</span> entry<span class="token punctuation">.</span><span class="token property-access">duration</span><span class="token punctuation">,</span> <span class="token comment">// 任务耗时</span>
        <span class="token literal-property property">attribution</span><span class="token operator">:</span> entry<span class="token punctuation">.</span><span class="token property-access">attribution</span><span class="token punctuation">,</span> <span class="token comment">// 关联资源（如脚本、渲染任务）</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

observer<span class="token punctuation">.</span><span class="token method function property-access">observe</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'longtask'</span><span class="token punctuation">,</span> <span class="token literal-property property">buffered</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><strong>关键参数说明</strong>：<br>
• <code>entry.duration</code>：任务执行时间（单位：ms）<br>
• <code>entry.attribution</code>：任务来源（如脚本执行、渲染流程）<br>
• <code>buffered: true</code>：捕获历史长任务（页面加载阶段产生的任务）</p>
<hr>
<h3 id="二-手动标记与测量任务">二、手动标记与测量任务 </h3>
<p>对于 <strong>已知可能产生长任务的代码块</strong>，可手动埋点统计：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 标记任务开始</span>
<span class="token dom variable">performance</span><span class="token punctuation">.</span><span class="token method function property-access">mark</span><span class="token punctuation">(</span><span class="token string">'customTaskStart'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 执行耗时操作（如大数据处理）</span>
<span class="token function">processLargeData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 标记任务结束并测量</span>
<span class="token dom variable">performance</span><span class="token punctuation">.</span><span class="token method function property-access">mark</span><span class="token punctuation">(</span><span class="token string">'customTaskEnd'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token dom variable">performance</span><span class="token punctuation">.</span><span class="token method function property-access">measure</span><span class="token punctuation">(</span><span class="token string">'customTask'</span><span class="token punctuation">,</span> <span class="token string">'customTaskStart'</span><span class="token punctuation">,</span> <span class="token string">'customTaskEnd'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 获取测量结果</span>
<span class="token keyword keyword-const">const</span> measures <span class="token operator">=</span> <span class="token dom variable">performance</span><span class="token punctuation">.</span><span class="token method function property-access">getEntriesByName</span><span class="token punctuation">(</span><span class="token string">'customTask'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>measures<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token property-access">duration</span> <span class="token operator">&gt;</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'自定义长任务耗时:'</span><span class="token punctuation">,</span> measures<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token property-access">duration</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="三-优化长任务的策略">三、优化长任务的策略 </h3>
<h4 id="1-代码拆分与异步执行">1. <strong>代码拆分与异步执行</strong> </h4>
<p>• <strong>拆分为子任务</strong>：将同步任务拆分为多个异步任务，通过 <code>setTimeout</code> 或 <code>requestIdleCallback</code> 分帧执行<br>
• <strong>Web Workers</strong>：将 CPU 密集型任务（如数据处理）迁移到 Worker 线程</p>
<h4 id="2-资源加载优化">2. <strong>资源加载优化</strong> </h4>
<p>• <strong>代码分包</strong>：使用 Webpack 等工具的 <code>splitChunks</code> 拆分大型 JS 文件<br>
• <strong>预加载关键资源</strong>：通过 <code>&lt;link rel="preload"&gt;</code> 提前加载必要脚本</p>
<hr>
<h3 id="四-数据上报与分析">四、数据上报与分析 </h3>
<h4 id="1-上报时机">1. <strong>上报时机</strong> </h4>
<p>• <strong>实时上报</strong>：在 <code>PerformanceObserver</code> 回调中直接发送数据（需考虑请求频率）<br>
• <strong>批量上报</strong>：缓存数据，在页面隐藏时通过 <code>navigator.sendBeacon</code> 统一提交</p>
<h4 id="2-监控平台集成">2. <strong>监控平台集成</strong> </h4>
<p>• <strong>自研工具</strong>：结合 <code>Performance API</code> 构建监控系统<br>
• <strong>第三方工具</strong>：使用 <strong>WebTracing</strong> 等方案，内置长任务统计功能</p>
<hr>
<h3 id="五-注意事项-2">五、注意事项 </h3>
<ol>
<li><strong>兼容性处理</strong>：<br>
• 旧版浏览器需降级使用 <code>performance.timing</code> 或 <code>setInterval</code> 轮询检测</li>
<li><strong>性能影响</strong>：<br>
• 避免过度监控，仅在开发/测试阶段高频采样</li>
<li><strong>关联分析</strong>：<br>
• 结合 <strong>FID（首次输入延迟）</strong> 和 <strong>INP（交互到下一次渲染）</strong> 指标综合优化</li>
</ol>
<hr>
<p>通过上述方法，可精准识别长任务并针对性优化，有效提升页面流畅度。实际部署时可结合自动化监控工具（如 Lighthouse）持续跟踪性能变化。</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="如何还原用户操作流程">如何还原用户操作流程 </h1>
<p>以下是基于 DOM 事件追踪与状态快照的前端用户操作还原自实现方案，包含核心流程、关键代码示例及技术要点：</p>
<hr>
<h3 id="一-整体架构设计">一、整体架构设计 </h3>
<div class="mermaid">graph TD
    A[操作录制] --&gt; B[事件监听]
    A --&gt; C[DOM序列化]
    B --&gt; D[数据存储]
    C --&gt; D
    D --&gt; E[操作回放]
    E --&gt; F[事件模拟]
    E --&gt; G[DOM重建]
</div><hr>
<h3 id="二-操作录制模块实现">二、操作录制模块实现 </h3>
<h4 id="1-事件监听与数据采集">1. <strong>事件监听与数据采集</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 定义操作类型枚举</span>
<span class="token keyword keyword-const">const</span> <span class="token maybe-class-name">ActionType</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token constant">CLICK</span><span class="token operator">:</span> <span class="token string">'click'</span><span class="token punctuation">,</span>
  <span class="token constant">INPUT</span><span class="token operator">:</span> <span class="token string">'input'</span><span class="token punctuation">,</span>
  <span class="token constant">SCROLL</span><span class="token operator">:</span> <span class="token string">'scroll'</span><span class="token punctuation">,</span>
  <span class="token constant">MOUSE_MOVE</span><span class="token operator">:</span> <span class="token string">'mousemove'</span><span class="token punctuation">,</span>
  <span class="token constant">DOM_CHANGE</span><span class="token operator">:</span> <span class="token string">'dom_change'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 核心数据采集器</span>
<span class="token keyword keyword-class">class</span> <span class="token class-name">Recorder</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">events</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token method function property-access">initListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 初始化事件监听</span>
  <span class="token function">initListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 点击事件</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token arrow operator">=&gt;</span> <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token method function property-access">recordClick</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 输入事件</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token arrow operator">=&gt;</span> <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token method function property-access">recordInput</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 滚动事件（节流处理）</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span>
      <span class="token string">'scroll'</span><span class="token punctuation">,</span>
      <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token arrow operator">=&gt;</span> <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token method function property-access">recordScroll</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token boolean">true</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// DOM 变更监听</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">observer</span> <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span><span class="token parameter">mutations</span> <span class="token arrow operator">=&gt;</span>
      <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token method function property-access">recordDOMChange</span><span class="token punctuation">(</span>mutations<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">observer</span><span class="token punctuation">.</span><span class="token method function property-access">observe</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">subtree</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">childList</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 记录点击事件</span>
  <span class="token function">recordClick</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> target <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">events</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token maybe-class-name">ActionType</span><span class="token punctuation">.</span><span class="token constant">CLICK</span><span class="token punctuation">,</span>
      <span class="token literal-property property">timestamp</span><span class="token operator">:</span> <span class="token known-class-name class-name">Date</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">selector</span><span class="token operator">:</span> <span class="token function">getUniqueSelector</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">clientX</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">clientY</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 记录输入事件</span>
  <span class="token function">recordInput</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> target <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">events</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token maybe-class-name">ActionType</span><span class="token punctuation">.</span><span class="token constant">INPUT</span><span class="token punctuation">,</span>
      <span class="token literal-property property">timestamp</span><span class="token operator">:</span> <span class="token known-class-name class-name">Date</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">selector</span><span class="token operator">:</span> <span class="token function">getUniqueSelector</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> target<span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>关键技术点</strong>：<br>
• 使用事件代理监听全局事件<br>
• 通过 <code>MutationObserver</code> 监听 DOM 结构变化<br>
• 节流函数优化高频事件（如滚动）</p>
<h4 id="2-dom-序列化策略">2. <strong>DOM 序列化策略</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 生成元素唯一选择器</span>
<span class="token keyword keyword-function">function</span> <span class="token function">getUniqueSelector</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> path <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-while">while</span> <span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-let">let</span> selector <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token property-access">tagName</span><span class="token punctuation">.</span><span class="token method function property-access">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      selector <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">#</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>element<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      path<span class="token punctuation">.</span><span class="token method function property-access">unshift</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow keyword-break">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-else">else</span> <span class="token punctuation">{</span>
      <span class="token keyword keyword-let">let</span> sibling <span class="token operator">=</span> element<span class="token punctuation">,</span>
        nth <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow keyword-while">while</span> <span class="token punctuation">(</span>sibling<span class="token punctuation">.</span><span class="token property-access">previousElementSibling</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        sibling <span class="token operator">=</span> sibling<span class="token punctuation">.</span><span class="token property-access">previousElementSibling</span><span class="token punctuation">;</span>
        nth<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>nth <span class="token operator">!==</span> <span class="token number">1</span><span class="token punctuation">)</span> selector <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">:nth-of-type(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>nth<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    path<span class="token punctuation">.</span><span class="token method function property-access">unshift</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">;</span>
    element <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token property-access">parentElement</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow keyword-return">return</span> path<span class="token punctuation">.</span><span class="token method function property-access">join</span><span class="token punctuation">(</span><span class="token string">' &gt; '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 序列化 DOM 快照</span>
<span class="token keyword keyword-function">function</span> <span class="token function">serializeDOM</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-return">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">html</span><span class="token operator">:</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">documentElement</span><span class="token punctuation">.</span><span class="token property-access">outerHTML</span><span class="token punctuation">,</span>
    <span class="token literal-property property">scroll</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">scrollX</span><span class="token punctuation">,</span>
      <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">scrollY</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>优化要点</strong>：<br>
• 采用路径选择器而非 XPath 提升兼容性<br>
• 记录初始 DOM 快照作为基准<br>
• 增量记录 DOM 变更（如 <code>MutationRecord</code>）</p>
<hr>
<h3 id="三-数据存储与压缩">三、数据存储与压缩 </h3>
<h4 id="1-数据结构设计">1. <strong>数据结构设计</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token punctuation">{</span>
  <span class="token string-property property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"initDOM"</span><span class="token operator">:</span> <span class="token string">"&lt;html&gt;...&lt;/html&gt;"</span><span class="token punctuation">,</span> <span class="token comment">// 初始快照</span>
  <span class="token string-property property">"events"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"click"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"timeOffset"</span><span class="token operator">:</span> <span class="token number">1200</span><span class="token punctuation">,</span> <span class="token comment">// 相对开始时间</span>
      <span class="token string-property property">"selector"</span><span class="token operator">:</span> <span class="token string">"body &gt; button#submit"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"position"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string-property property">"x"</span><span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token string-property property">"y"</span><span class="token operator">:</span> <span class="token number">200</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"input"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"timeOffset"</span><span class="token operator">:</span> <span class="token number">2500</span><span class="token punctuation">,</span>
      <span class="token string-property property">"selector"</span><span class="token operator">:</span> <span class="token string">"input.email"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"value"</span><span class="token operator">:</span> <span class="token string">"user@example.com"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="2-存储优化策略">2. <strong>存储优化策略</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 使用差分压缩算法</span>
<span class="token keyword keyword-function">function</span> <span class="token function">compressEvents</span><span class="token punctuation">(</span><span class="token parameter">events</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-return">return</span> events<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword control-flow keyword-return">return</span> event<span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> prev <span class="token operator">=</span> events<span class="token punctuation">[</span>index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow keyword-return">return</span> <span class="token punctuation">{</span>
      <span class="token spread operator">...</span>event<span class="token punctuation">,</span>
      <span class="token literal-property property">timeOffset</span><span class="token operator">:</span> event<span class="token punctuation">.</span><span class="token property-access">timestamp</span> <span class="token operator">-</span> prev<span class="token punctuation">.</span><span class="token property-access">timestamp</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 定时批量上报</span>
<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> compressed <span class="token operator">=</span> <span class="token function">compressEvents</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">events</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">sendToServer</span><span class="token punctuation">(</span>compressed<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">events</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 每10秒上报一次</span>
</code></pre><hr>
<h3 id="四-操作回放模块实现">四、操作回放模块实现 </h3>
<h4 id="1-回放引擎核心">1. <strong>回放引擎核心</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">Replayer</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">initDOM</span> <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token property-access">initDOM</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">events</span> <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token property-access">events</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">timeline</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 初始化回放环境</span>
  <span class="token keyword keyword-async">async</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">iframe</span> <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'iframe'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">iframe</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">iframe</span><span class="token punctuation">.</span><span class="token property-access">contentDocument</span><span class="token punctuation">.</span><span class="token method function property-access">write</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">initDOM</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 启动回放</span>
  <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">events</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">event</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token method function property-access">applyEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span><span class="token property-access">timeOffset</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 应用单个事件</span>
  <span class="token function">applyEvent</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-switch">switch</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword keyword-case">case</span> <span class="token maybe-class-name">ActionType</span><span class="token punctuation">.</span><span class="token constant">CLICK</span><span class="token operator">:</span>
        <span class="token keyword keyword-const">const</span> el <span class="token operator">=</span> <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">iframe</span><span class="token punctuation">.</span><span class="token property-access">contentDocument</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token property-access">selector</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        el<span class="token punctuation">.</span><span class="token method function property-access">dispatchEvent</span><span class="token punctuation">(</span>
          <span class="token keyword keyword-new">new</span> <span class="token class-name">MouseEvent</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">clientX</span><span class="token operator">:</span> event<span class="token punctuation">.</span><span class="token property-access">position</span><span class="token punctuation">.</span><span class="token property-access">x</span><span class="token punctuation">,</span>
            <span class="token literal-property property">clientY</span><span class="token operator">:</span> event<span class="token punctuation">.</span><span class="token property-access">position</span><span class="token punctuation">.</span><span class="token property-access">y</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow keyword-break">break</span><span class="token punctuation">;</span>
      <span class="token keyword keyword-case">case</span> <span class="token maybe-class-name">ActionType</span><span class="token punctuation">.</span><span class="token constant">INPUT</span><span class="token operator">:</span>
        <span class="token keyword keyword-const">const</span> input <span class="token operator">=</span> <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">iframe</span><span class="token punctuation">.</span><span class="token property-access">contentDocument</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token property-access">selector</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        input<span class="token punctuation">.</span><span class="token property-access">value</span> <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">;</span>
        input<span class="token punctuation">.</span><span class="token method function property-access">dispatchEvent</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token class-name">Event</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">bubbles</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow keyword-break">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="2-关键问题处理方案">2. <strong>关键问题处理方案</strong> </h4>
<table>
<thead>
<tr>
<th><strong>问题类型</strong></th>
<th><strong>解决方案</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>动态元素定位失效</td>
<td>基于初始 DOM 快照重建 iframe 沙箱环境</td>
</tr>
<tr>
<td>异步操作不同步</td>
<td>记录 AJAX 请求与定时器，回放时使用 Mock 数据</td>
</tr>
<tr>
<td>CSS 动画不一致</td>
<td>记录 <code>requestAnimationFrame</code> 时间戳进行对齐</td>
</tr>
<tr>
<td>第三方库兼容性</td>
<td>在沙箱中注入相同版本的依赖库</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="五-增强功能扩展">五、增强功能扩展 </h3>
<h4 id="1-性能监控集成">1. <strong>性能监控集成</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 记录性能指标</span>
<span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> perfEntries <span class="token operator">=</span> <span class="token dom variable">performance</span><span class="token punctuation">.</span><span class="token method function property-access">getEntriesByType</span><span class="token punctuation">(</span><span class="token string">'navigation'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">events</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'performance'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> perfEntries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="2-错误追踪">2. <strong>错误追踪</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 捕获全局错误</span>
<span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> url<span class="token punctuation">,</span> line</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">events</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">message</span><span class="token operator">:</span> msg<span class="token punctuation">,</span>
    <span class="token literal-property property">stack</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>line<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><h4 id="3-敏感信息过滤">3. <strong>敏感信息过滤</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 屏蔽密码字段</span>
<span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'input[type="password"]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">input</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  input<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span>
    <span class="token string">'input'</span><span class="token punctuation">,</span>
    <span class="token parameter">e</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span> <span class="token operator">=</span> <span class="token string">'***FILTERED***'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token boolean">true</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<h3 id="六-技术方案对比">六、技术方案对比 </h3>
<table>
<thead>
<tr>
<th><strong>方案</strong></th>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody>
<tr>
<td>纯事件回放</td>
<td>数据量小、还原精度高</td>
<td>无法处理 CSS 动画等视觉变化</td>
</tr>
<tr>
<td>DOM 快照</td>
<td>高保真还原</td>
<td>存储体积大、动态内容兼容性差</td>
</tr>
<tr>
<td>混合模式（本方案）</td>
<td>平衡性能与精度</td>
<td>实现复杂度较高</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="七-实施建议">七、实施建议 </h3>
<ol>
<li><strong>渐进式采集</strong>：优先记录关键页面核心流程</li>
<li><strong>采样策略</strong>：对高频操作按 10% 比例抽样</li>
<li><strong>数据加密</strong>：使用 AES-256 对敏感操作加密</li>
<li><strong>可视化调试</strong>：开发 Chrome 插件辅助问题排查</li>
</ol>
<h2 id="通过以上方案可在不依赖第三方库的情况下实现基础操作还原功能如需支持复杂场景如-canvas-操作录制可参考-rrweb-的增量快照设计">通过以上方案，可在不依赖第三方库的情况下实现基础操作还原功能。如需支持复杂场景（如 Canvas 操作录制），可参考 rrweb 的增量快照设计。 </h2>
<hr>
<hr>
<hr>
<hr>
<h1 id="可有办法将请求的调用源码地址包括代码行数也上报上去">可有办法将请求的调用源码地址包括代码行数也上报上去？ </h1>
<p>在前端自主实现上报功能时，可以通过以下技术手段捕获并上报请求调用的源码地址及代码行数：</p>
<hr>
<h3 id="一-利用-error-堆栈追踪">一、利用 Error 堆栈追踪 </h3>
<p><strong>核心原理</strong>：通过 <code>new Error().stack</code> 获取调用栈信息，解析出调用路径和行号。<br>
<strong>实现代码</strong>：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-function">function</span> <span class="token function">captureStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> error <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> stackLines <span class="token operator">=</span> error<span class="token punctuation">.</span><span class="token property-access">stack</span><span class="token punctuation">.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 示例堆栈行格式：at http://example.com/app.js:10:5</span>
  <span class="token keyword keyword-const">const</span> callerLine <span class="token operator">=</span> stackLines<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">||</span> stackLines<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 根据调用层级调整</span>
  <span class="token keyword keyword-const">const</span> match <span class="token operator">=</span> callerLine<span class="token punctuation">.</span><span class="token method function property-access">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\(?(.+):(\d+):(\d+)\)?</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow keyword-return">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">file</span><span class="token operator">:</span> match<span class="token operator">?.</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token string">'unknown'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">line</span><span class="token operator">:</span> match<span class="token operator">?.</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token string">'unknown'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">column</span><span class="token operator">:</span> match<span class="token operator">?.</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token string">'unknown'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 上报时调用</span>
<span class="token function">reportData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token spread operator">...</span><span class="token method function property-access">captureStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'API请求失败'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><strong>注意事项</strong>：<br>
• 浏览器兼容性问题（不同浏览器的堆栈格式不同）<br>
• 生产环境需配合 Source Map 映射原始代码位置</p>
<hr>
<h3 id="二-代码注入标记">二、代码注入标记 </h3>
<p><strong>动态插入唯一标识</strong>：在构建阶段通过插件（如 Babel、Webpack）注入代码位置信息<br>
<strong>Webpack 插件示例</strong>：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// webpack.config.js</span>
module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">[</span>
                  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'babel-plugin-source-location'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">{</span>
                    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">line</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p><strong>运行时获取</strong>：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 通过特殊变量获取注入信息</span>
<span class="token function">reportData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">file</span><span class="token operator">:</span> __FILE__<span class="token punctuation">,</span>
  <span class="token literal-property property">line</span><span class="token operator">:</span> __LINE__<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<h3 id="三-ast-静态分析">三、AST 静态分析 </h3>
<p><strong>构建阶段分析</strong>：通过工具解析抽象语法树生成代码位置映射表<br>
<strong>操作流程</strong>：</p>
<ol>
<li>使用 ESLint、Babel 等工具提取代码结构</li>
<li>生成函数/模块的路径映射关系</li>
<li>上报时通过函数名反向查找源码位置</li>
</ol>
<p><strong>优势</strong>：<br>
• 不受运行时环境影响<br>
• 可关联到具体业务逻辑模块</p>
<hr>
<h3 id="四-浏览器调试-api">四、浏览器调试 API </h3>
<p><strong>借助 <code>console.trace()</code></strong>：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-function">function</span> <span class="token function">reportWithTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">trace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出堆栈到控制台</span>
  <span class="token keyword keyword-const">const</span> trace <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">stack</span><span class="token punctuation">;</span>
  <span class="token comment">// 提取关键信息并上报</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>兼容性处理</strong>：需适配 Safari、低版本 IE 等浏览器的特殊格式</p>
<hr>
<h3 id="五-生产环境优化">五、生产环境优化 </h3>
<ol>
<li><strong>Source Map 映射</strong>：<br>
• 上传 Source Map 到服务端<br>
• 通过错误堆栈中的行号反向解析原始代码位置</li>
<li><strong>数据压缩处理</strong>：<br>
• 对上报的代码位置信息进行加密或哈希处理</li>
<li><strong>性能监控</strong>：<br>
• 结合 Performance API 记录代码执行耗时</li>
</ol>
<hr>
<h3 id="跨浏览器兼容方案">跨浏览器兼容方案 </h3>
<table>
<thead>
<tr>
<th><strong>浏览器</strong></th>
<th>堆栈格式示例</th>
<th>解析策略</th>
</tr>
</thead>
<tbody>
<tr>
<td>Chrome</td>
<td><code>at func (http://a.com/app.js:10:5)</code></td>
<td>正则匹配 <code>/(.+):(\d+):(\d+)/</code></td>
</tr>
<tr>
<td>Firefox</td>
<td><code>func@http://a.com/app.js:10:5</code></td>
<td>拆分 <code>@</code> 符号后解析</td>
</tr>
<tr>
<td>Safari</td>
<td><code>global code@http://a.com/app.js:10</code></td>
<td>处理缺少列号的情况</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="注意事项-1">注意事项 </h3>
<ol>
<li><strong>隐私合规</strong>：需在用户协议中声明代码位置采集用途</li>
<li><strong>性能影响</strong>：高频上报时建议节流采样</li>
<li><strong>安全防护</strong>：防止恶意伪造源码位置信息</li>
</ol>
<p>通过上述方法，可在不依赖第三方监控工具的情况下实现精准的源码位置上报。若需要可视化分析，可结合类似 SonarQube 的代码质量管理平台 对上报数据进行聚合分析。</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="混动跟随导航电梯导航该如何实现">混动跟随导航（电梯导航）该如何实现 </h1>
<p>以下是实现电梯导航（混动跟随导航）的完整技术方案，综合了多个最佳实践和最新技术要点：</p>
<h3 id="一-核心实现原理">一、核心实现原理 </h3>
<p>电梯导航通过监听页面滚动事件，实时计算内容区块位置，同步更新侧边导航状态，实现导航跟随和定位跳转功能。关键技术包含 DOM 位置计算、滚动事件节流、CSS 定位过渡和交互状态管理。</p>
<h3 id="二-实现步骤分解">二、实现步骤分解 </h3>
<h4 id="1-结构层html">1. 结构层（HTML） </h4>
<pre data-role="codeBlock" data-info="html" class="language-html html"><code><span class="token comment">&lt;!-- 电梯导航 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>elevator-nav<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">data-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>section1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>模块1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">data-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>section2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>模块2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">data-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>section3<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>模块3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 内容区块 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>section1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>section2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>section3<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">&gt;</span></span>
</code></pre><h4 id="2-表现层css">2. 表现层（CSS） </h4>
<pre data-role="codeBlock" data-info="css" class="language-css css"><code><span class="token selector"><span class="token class">.elevator-nav</span></span> <span class="token punctuation">{</span>
  <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>
  <span class="token property">right</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">top</span><span class="token punctuation">:</span> <span class="token number">50</span><span class="token unit">%</span><span class="token punctuation">;</span>
  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span><span class="token number">-50</span><span class="token unit">%</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#fff</span><span class="token punctuation">;</span>
  <span class="token property">box-shadow</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token number">2</span><span class="token unit">px</span> <span class="token number">12</span><span class="token unit">px</span> <span class="token color"><span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span>
  <span class="token property">transition</span><span class="token punctuation">:</span> top <span class="token number">0.3</span><span class="token unit">s</span> ease<span class="token punctuation">;</span> <span class="token comment">/* 跟随动画 */</span>
<span class="token punctuation">}</span>

<span class="token selector"><span class="token class">.elevator-nav</span> li</span> <span class="token punctuation">{</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token unit">px</span> <span class="token number">20</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span>
  <span class="token property">transition</span><span class="token punctuation">:</span> background <span class="token number">0.2</span><span class="token unit">s</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector"><span class="token class">.elevator-nav</span> li<span class="token class">.active</span></span> <span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#f5f7fa</span><span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode color">#409eff</span><span class="token punctuation">;</span>
  <span class="token property">border-left</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token unit">px</span> solid <span class="token hexcode color">#409eff</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="3-行为层javascript">3. 行为层（JavaScript） </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">ElevatorNav</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">navItems</span> <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.elevator-nav li'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">sections</span> <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'section'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token method function property-access">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 预计算区块位置</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">sectionPositions</span> <span class="token operator">=</span> <span class="token known-class-name class-name">Array</span><span class="token punctuation">.</span><span class="token keyword module keyword-from">from</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">sections</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span>
      <span class="token parameter">section</span> <span class="token arrow operator">=&gt;</span> section<span class="token punctuation">.</span><span class="token method function property-access">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">top</span> <span class="token operator">+</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">scrollY</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 事件绑定</span>
    <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token method function property-access">handleScroll</span><span class="token punctuation">.</span><span class="token method function property-access">bind</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">navItems</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=&gt;</span>
      item<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token method function property-access">handleNavClick</span><span class="token punctuation">.</span><span class="token method function property-access">bind</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 窗口尺寸变化监听</span>
    <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">sectionPositions</span> <span class="token operator">=</span> <span class="token known-class-name class-name">Array</span><span class="token punctuation">.</span><span class="token keyword module keyword-from">from</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">sections</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span>
        <span class="token parameter">section</span> <span class="token arrow operator">=&gt;</span> section<span class="token punctuation">.</span><span class="token property-access">offsetTop</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">handleScroll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> scrollY <span class="token operator">=</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">scrollY</span> <span class="token operator">+</span> <span class="token number">100</span><span class="token punctuation">;</span> <span class="token comment">// 增加提前量</span>

    <span class="token comment">// 查找当前激活索引</span>
    <span class="token keyword keyword-let">let</span> currentIndex <span class="token operator">=</span>
      <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">sectionPositions</span><span class="token punctuation">.</span><span class="token method function property-access">findIndex</span><span class="token punctuation">(</span><span class="token parameter">pos</span> <span class="token arrow operator">=&gt;</span> scrollY <span class="token operator">&lt;</span> pos<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token comment">// 更新导航状态</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">navItems</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span>
      item<span class="token punctuation">.</span><span class="token property-access">classList</span><span class="token punctuation">.</span><span class="token method function property-access">toggle</span><span class="token punctuation">(</span><span class="token string">'active'</span><span class="token punctuation">,</span> index <span class="token operator">===</span> currentIndex<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">handleNavClick</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> targetId <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">dataset</span><span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> targetSection <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span>targetId<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 平滑滚动</span>
    <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">scrollTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">top</span><span class="token operator">:</span> targetSection<span class="token punctuation">.</span><span class="token property-access">offsetTop</span> <span class="token operator">-</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token comment">// 留出顶部间距</span>
      <span class="token literal-property property">behavior</span><span class="token operator">:</span> <span class="token string">'smooth'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 初始化实例</span>
<span class="token keyword keyword-new">new</span> <span class="token class-name">ElevatorNav</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="三-高级优化方案">三、高级优化方案 </h3>
<ol>
<li>
<p><strong>性能优化</strong><br>
• 使用<code>IntersectionObserver</code>替代滚动监听<br>
• 添加滚动节流（300ms）</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-let">let</span> isScrolling<span class="token punctuation">;</span>
<span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">clearTimeout</span><span class="token punctuation">(</span>isScrolling<span class="token punctuation">)</span><span class="token punctuation">;</span>
  isScrolling <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token method function property-access">handleScroll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
<li>
<p><strong>动态加载支持</strong></p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 监听DOM变化更新位置</span>
<span class="token keyword keyword-const">const</span> observer <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">sectionPositions</span> <span class="token operator">=</span> <span class="token known-class-name class-name">Array</span><span class="token punctuation">.</span><span class="token keyword module keyword-from">from</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">sections</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span>
    <span class="token parameter">section</span> <span class="token arrow operator">=&gt;</span> section<span class="token punctuation">.</span><span class="token property-access">offsetTop</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
observer<span class="token punctuation">.</span><span class="token method function property-access">observe</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">childList</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">subtree</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
<li>
<p><strong>视差跟随效果</strong><br>
添加导航位置动态计算：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-function">function</span> <span class="token function">updateNavPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> nav <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'.elevator-nav'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> viewportCenter <span class="token operator">=</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">innerHeight</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> scrollY <span class="token operator">=</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">scrollY</span><span class="token punctuation">;</span>

  <span class="token comment">// 动态计算导航位置</span>
  nav<span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">top</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">min</span><span class="token punctuation">(</span>
    <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">max</span><span class="token punctuation">(</span>scrollY <span class="token operator">+</span> viewportCenter<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">documentElement</span><span class="token punctuation">.</span><span class="token property-access">scrollHeight</span> <span class="token operator">-</span> viewportCenter
  <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></li>
</ol>
<h3 id="四-兼容性处理">四、兼容性处理 </h3>
<ol>
<li>
<p><strong>旧浏览器支持</strong></p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 平滑滚动降级方案</span>
<span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">'scrollBehavior'</span> <span class="token keyword keyword-in">in</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">documentElement</span><span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'smoothscroll-polyfill'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">polyfill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p><strong>移动端适配</strong></p>
<pre data-role="codeBlock" data-info="css" class="language-css css"><code><span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">max-width</span><span class="token punctuation">:</span> <span class="token number">768</span><span class="token unit">px</span><span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
  <span class="token selector"><span class="token class">.elevator-nav</span></span> <span class="token punctuation">{</span>
    <span class="token property">bottom</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token property">top</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token unit">%</span><span class="token punctuation">;</span>
    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector"><span class="token class">.elevator-nav</span> li</span> <span class="token punctuation">{</span>
    <span class="token property">flex</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></li>
</ol>
<h3 id="五-扩展功能">五、扩展功能 </h3>
<ol>
<li>
<p><strong>进度指示器</strong></p>
<pre data-role="codeBlock" data-info="css" class="language-css css"><code><span class="token selector"><span class="token class">.elevator-nav</span><span class="token pseudo-element">::before</span></span> <span class="token punctuation">{</span>
  <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> <span class="token number">-5</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">top</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token unit">%</span><span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#eee</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector"><span class="token class">.elevator-nav</span> li<span class="token class">.active</span><span class="token pseudo-element">::after</span></span> <span class="token punctuation">{</span>
  <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> <span class="token number">-5</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">top</span><span class="token punctuation">:</span> <span class="token number">50</span><span class="token unit">%</span><span class="token punctuation">;</span>
  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span><span class="token number">-50</span><span class="token unit">%</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">60</span><span class="token unit">%</span><span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#409eff</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p><strong>智能隐藏</strong></p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-let">let</span> lastScroll <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> currentScroll <span class="token operator">=</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">scrollY</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> nav <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'.elevator-nav'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>currentScroll <span class="token operator">&gt;</span> lastScroll <span class="token operator">+</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    nav<span class="token punctuation">.</span><span class="token property-access">classList</span><span class="token punctuation">.</span><span class="token method function property-access">add</span><span class="token punctuation">(</span><span class="token string">'hide'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-else">else</span> <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>currentScroll <span class="token operator">&lt;</span> lastScroll <span class="token operator">-</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    nav<span class="token punctuation">.</span><span class="token property-access">classList</span><span class="token punctuation">.</span><span class="token method function property-access">remove</span><span class="token punctuation">(</span><span class="token string">'hide'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  lastScroll <span class="token operator">=</span> currentScroll<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
</ol>
<p>该方案综合了传统 DOM 操作与现代 API 的最佳实践，通过模块化设计实现高内聚低耦合，支持动态内容加载和响应式布局。实际应用中可根据项目需求选择 Vue/React 组件化封装，或结合 IntersectionObserver 实现更精准的区块定位。</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="performanceobserver-如何测量页面性能">PerformanceObserver 如何测量页面性能 </h1>
<p>PerformanceObserver 是浏览器提供的异步性能监控 API，通过事件驱动机制精准采集页面关键性能指标。以下是其核心测量原理和应用方法：</p>
<hr>
<h3 id="一-基础原理与优势">一、基础原理与优势 </h3>
<ol>
<li>
<p><strong>异步事件驱动机制</strong><br>
PerformanceObserver 基于观察者模式，仅在性能条目生成时触发回调，避免了传统轮询（<code>getEntries</code>）的性能损耗。</p>
</li>
<li>
<p><strong>多维度指标覆盖</strong><br>
支持监测 13 类性能条目类型，包括：<br>
• 渲染指标：<code>paint</code>（FP/FCP）<br>
• 交互指标：<code>first-input</code>（FID）<br>
• 资源性能：<code>resource</code>（资源加载耗时）<br>
• 布局稳定性：<code>layout-shift</code>（CLS）</p>
</li>
<li>
<p><strong>精准数据捕获</strong><br>
通过 <code>buffered: true</code> 参数可获取页面初始化阶段的性能数据，避免数据丢失。</p>
</li>
</ol>
<hr>
<h3 id="二-核心性能指标测量实践">二、核心性能指标测量实践 </h3>
<h4 id="1-首次渲染性能fpfcp">1. 首次渲染性能（FP/FCP） </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> observer <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">PerformanceObserver</span><span class="token punctuation">(</span><span class="token parameter">list</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  list<span class="token punctuation">.</span><span class="token method function property-access">getEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">entry</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token operator">===</span> <span class="token string">'first-paint'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'FP:'</span><span class="token punctuation">,</span> entry<span class="token punctuation">.</span><span class="token property-access">startTime</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 首次绘制时间</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token operator">===</span> <span class="token string">'first-contentful-paint'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'FCP:'</span><span class="token punctuation">,</span> entry<span class="token punctuation">.</span><span class="token property-access">startTime</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 首次内容绘制时间</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
observer<span class="token punctuation">.</span><span class="token method function property-access">observe</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'paint'</span><span class="token punctuation">,</span> <span class="token literal-property property">buffered</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="2-最大内容渲染lcp">2. 最大内容渲染（LCP） </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> lcpObserver <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">PerformanceObserver</span><span class="token punctuation">(</span><span class="token parameter">list</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> entries <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token method function property-access">getEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> lcpEntry <span class="token operator">=</span> entries<span class="token punctuation">[</span>entries<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 最后一个元素为最终LCP</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'LCP元素:'</span><span class="token punctuation">,</span> lcpEntry<span class="token punctuation">.</span><span class="token property-access">element</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
lcpObserver<span class="token punctuation">.</span><span class="token method function property-access">observe</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'largest-contentful-paint'</span><span class="token punctuation">,</span> <span class="token literal-property property">buffered</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="3-布局偏移统计cls">3. 布局偏移统计（CLS） </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-let">let</span> clsValue <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> clsObserver <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">PerformanceObserver</span><span class="token punctuation">(</span><span class="token parameter">list</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  list<span class="token punctuation">.</span><span class="token method function property-access">getEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">entry</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>entry<span class="token punctuation">.</span><span class="token property-access">hadRecentInput</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 排除用户交互导致的偏移</span>
      clsValue <span class="token operator">+=</span> entry<span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
clsObserver<span class="token punctuation">.</span><span class="token method function property-access">observe</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'layout-shift'</span><span class="token punctuation">,</span> <span class="token literal-property property">buffered</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="4-资源加载性能">4. 资源加载性能 </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> resourceObserver <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">PerformanceObserver</span><span class="token punctuation">(</span><span class="token parameter">list</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  list<span class="token punctuation">.</span><span class="token method function property-access">getEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">entry</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>entry<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">加载耗时:</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> entry<span class="token punctuation">.</span><span class="token property-access">responseEnd</span> <span class="token operator">-</span> entry<span class="token punctuation">.</span><span class="token property-access">startTime</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 完整加载周期</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
resourceObserver<span class="token punctuation">.</span><span class="token method function property-access">observe</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'resource'</span><span class="token punctuation">,</span> <span class="token literal-property property">buffered</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<h3 id="三-高级应用技巧">三、高级应用技巧 </h3>
<ol>
<li>
<p><strong>长任务监控</strong></p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> longTaskObserver <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">PerformanceObserver</span><span class="token punctuation">(</span><span class="token parameter">list</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  list<span class="token punctuation">.</span><span class="token method function property-access">getEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">entry</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token property-access">duration</span> <span class="token operator">&gt;</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 超过50ms即为长任务</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">warn</span><span class="token punctuation">(</span><span class="token string">'阻塞任务:'</span><span class="token punctuation">,</span> entry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
longTaskObserver<span class="token punctuation">.</span><span class="token method function property-access">observe</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'longtask'</span><span class="token punctuation">,</span> <span class="token literal-property property">buffered</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
<li>
<p><strong>动态元素监测</strong><br>
结合 <code>MutationObserver</code> 实现动态加载内容的持续监控：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> mutationObserver <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 重新计算新增元素的位置</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mutationObserver<span class="token punctuation">.</span><span class="token method function property-access">observe</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">subtree</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">childList</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
<li>
<p><strong>性能数据上报优化</strong><br>
• 使用 <code>sendBeacon</code> 在页面卸载时可靠上报数据<br>
• 数据压缩：采用 Protocol Buffers 或 gzip 减少传输体积</p>
</li>
</ol>
<hr>
<h3 id="四-注意事项">四、注意事项 </h3>
<ol>
<li>
<p><strong>兼容性处理</strong></p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">PerformanceObserver</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 降级使用 performance.getEntries()</span>
<span class="token punctuation">}</span>
</code></pre><p>支持 Chrome 52+、Firefox 57+、Edge 79+</p>
</li>
<li>
<p><strong>性能影响控制</strong><br>
• 避免同时监听过多条目类型<br>
• 数据采样率控制（如仅 10% 用户开启完整监控）</p>
</li>
<li>
<p><strong>数据安全</strong><br>
• 敏感字段脱敏处理<br>
• HTTPS 传输加密</p>
</li>
</ol>
<hr>
<p>通过 PerformanceObserver 可实现从页面加载到用户交互的全链路性能监控，结合 Web Vitals 指标可构建完整的性能优化体系。实际应用中建议配合 Sentry、Lighthouse 等工具形成监控闭环。</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="移动端如何实现下拉滚动加载顶部加载">移动端如何实现下拉滚动加载（顶部加载） </h1>
<p>在移动端实现下拉滚动加载（顶部加载）功能，需综合手势识别、滚动位置计算、数据加载控制等技术，以下是结合多个技术方案的最佳实践：</p>
<hr>
<h3 id="一-基础实现原理与步骤">一、基础实现原理与步骤 </h3>
<h4 id="1-触摸事件监听">1. <strong>触摸事件监听</strong> </h4>
<p>通过原生 <code>touchstart</code>、<code>touchmove</code> 和 <code>touchend</code> 事件捕获用户下拉动作：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> container <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'scroll-container'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-let">let</span> startY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 起始触摸位置</span>

container<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'touchstart'</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  startY <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token property-access">touches</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token property-access">clientY</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

container<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'touchmove'</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> currentY <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token property-access">touches</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token property-access">clientY</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> deltaY <span class="token operator">=</span> currentY <span class="token operator">-</span> startY<span class="token punctuation">;</span> <span class="token comment">// 计算下拉距离</span>

  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>deltaY <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> container<span class="token punctuation">.</span><span class="token property-access">scrollTop</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 显示下拉加载提示（如箭头或文字）</span>
    <span class="token function">showLoadingTip</span><span class="token punctuation">(</span>deltaY<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

container<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'touchend'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>deltaY <span class="token operator">&gt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 下拉超过阈值（如100px）</span>
    <span class="token function">triggerTopLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">resetUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 恢复初始状态</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="2-滚动位置判断">2. <strong>滚动位置判断</strong> </h4>
<p>通过 <code>scrollTop</code>、<code>clientHeight</code>、<code>scrollHeight</code> 判断滚动位置：<br>
• <strong>触发条件</strong>：<code>scrollTop === 0</code> 时下拉<br>
• <strong>动态加载阈值</strong>：建议设置 50-100px 的触发距离</p>
<hr>
<h3 id="二-核心优化策略">二、核心优化策略 </h3>
<h4 id="1-状态标记防止重复加载">1. <strong>状态标记防止重复加载</strong> </h4>
<p>通过 <code>isLoading</code> 标记位控制请求并发：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-let">let</span> isLoading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">triggerTopLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>isLoading<span class="token punctuation">)</span> <span class="token keyword control-flow keyword-return">return</span><span class="token punctuation">;</span>
  isLoading <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

  <span class="token function">showLoadingAnimation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 显示加载动画</span>
  <span class="token keyword control-flow keyword-try">try</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> newData <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">prependDataToDOM</span><span class="token punctuation">(</span>newData<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将新数据插入顶部</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-catch">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">showErrorToast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  isLoading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="2-视觉反馈设计">2. <strong>视觉反馈设计</strong> </h4>
<p>• <strong>下拉过程动画</strong>：通过 CSS <code>transform</code> 实现弹性效果</p>
<pre data-role="codeBlock" data-info="css" class="language-css css"><code><span class="token selector"><span class="token class">.loading-indicator</span></span> <span class="token punctuation">{</span>
  <span class="token property">transition</span><span class="token punctuation">:</span> transform <span class="token number">0.3</span><span class="token unit">s</span> ease<span class="token punctuation">;</span>
  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span><span class="token number">-100</span><span class="token unit">%</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>• <strong>加载状态提示</strong>：文字动态切换（如“下拉刷新”→“释放加载”→“加载中...”）</p>
<h4 id="3-性能优化">3. <strong>性能优化</strong> </h4>
<p>• <strong>数据分页</strong>：限制单次加载数据量（如每次加载 10 条）<br>
• <strong>虚拟滚动</strong>：对长列表使用 <code>react-window</code> 或 <code>vue-virtual-scroller</code> 减少 DOM 节点<br>
• <strong>请求节流</strong>：设置 500ms 的触发间隔防止高频调用</p>
<hr>
<h3 id="三-推荐技术方案">三、推荐技术方案 </h3>
<h4 id="1-原生实现推荐场景轻量级需求">1. <strong>原生实现（推荐场景：轻量级需求）</strong> </h4>
<p>• <strong>优点</strong>：零依赖、完全可控<br>
• <strong>关键代码</strong>：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 动态计算下拉距离与动画关联</span>
<span class="token keyword keyword-function">function</span> <span class="token function">handleTouchMove</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> deltaY <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token property-access">touches</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token property-access">clientY</span> <span class="token operator">-</span> startY<span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>deltaY <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> progress <span class="token operator">=</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">min</span><span class="token punctuation">(</span>deltaY <span class="token operator">/</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 最大下拉150px</span>
    loadingIndicator<span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">transform</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translateY(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>progress <span class="token operator">*</span> <span class="token number">100</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">%)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="2-第三方库方案推荐场景复杂交互">2. <strong>第三方库方案（推荐场景：复杂交互）</strong> </h4>
<p>• <strong>Better-Scroll</strong>：支持惯性滚动、边界回弹</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword module keyword-import">import</span> <span class="token imports"><span class="token maybe-class-name">BScroll</span></span> <span class="token keyword module keyword-from">from</span> <span class="token string">'@better-scroll/core'</span><span class="token punctuation">;</span>
<span class="token keyword module keyword-import">import</span> <span class="token imports"><span class="token maybe-class-name">PullDown</span></span> <span class="token keyword module keyword-from">from</span> <span class="token string">'@better-scroll/pull-down'</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> bs <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">BScroll</span><span class="token punctuation">(</span><span class="token string">'#wrapper'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">pullDownRefresh</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">threshold</span><span class="token operator">:</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token comment">// 触发加载的距离</span>
    <span class="token literal-property property">stop</span><span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token comment">// 回弹停留位置</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

bs<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'pullingDown'</span><span class="token punctuation">,</span> <span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-await">await</span> <span class="token function">loadNewData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  bs<span class="token punctuation">.</span><span class="token method function property-access">finishPullDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 结束加载</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>• <strong>PullToRefresh.js</strong>：轻量级库（仅 3KB），支持自定义动画</p>
<hr>
<h3 id="四-常见问题解决">四、常见问题解决 </h3>
<h4 id="1-重复加载问题">1. <strong>重复加载问题</strong> </h4>
<p>• <strong>方案</strong>：通过 <code>localStorage</code> 或 DOM 属性记录加载状态</p>
<pre data-role="codeBlock" data-info="html" class="language-html html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">data-loading-state</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>idle<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre><pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token property-access">dataset</span><span class="token punctuation">.</span><span class="token property-access">loadingState</span> <span class="token operator">===</span> <span class="token string">'loading'</span><span class="token punctuation">)</span> <span class="token keyword control-flow keyword-return">return</span><span class="token punctuation">;</span>
</code></pre><h4 id="2-边界条件处理">2. <strong>边界条件处理</strong> </h4>
<p>• <strong>无更多数据</strong>：显示“暂无新内容”提示并禁用下拉<br>
• <strong>网络异常</strong>：增加重试机制（最多 3 次）</p>
<hr>
<h3 id="五-跨平台适配建议">五、跨平台适配建议 </h3>
<ol>
<li><strong>iOS 弹性滚动</strong>：通过 <code>-webkit-overflow-scrolling: touch</code> 优化滚动流畅度</li>
<li><strong>Android 手势冲突</strong>：禁用默认下拉刷新（如微信浏览器）<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span>
  <span class="token string">'touchmove'</span><span class="token punctuation">,</span>
  <span class="token parameter">e</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>isDragging<span class="token punctuation">)</span> e<span class="token punctuation">.</span><span class="token method function property-access">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">passive</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
</ol>
<hr>
<p><strong>推荐方案选择</strong>：<br>
• <strong>轻量需求</strong> → 原生实现（代码参考网页 4、5）<br>
• <strong>复杂场景</strong> → Better-Scroll（参考网页 7）<br>
• <strong>快速开发</strong> → PullToRefresh.js（参考网页 1）</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="判断页签是否为活跃状态">判断页签是否为活跃状态 </h1>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'visibilitychange'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">visibilityState</span> <span class="token operator">===</span> <span class="token string">'visible'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'页签当前处于活跃状态'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 执行活跃状态逻辑（如恢复动画、请求数据）</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-else">else</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'页签当前处于非活跃状态'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 执行非活跃状态逻辑（如暂停视频、停止轮询）</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<hr>
<hr>
<hr>
<h1 id="在网络带宽一定的情况下切片上传感觉和整体上传消费的时间应该是差不多的这种说法正确吗">在网络带宽一定的情况下，切片上传感觉和整体上传消费的时间应该是差不多的，这种说法正确吗？ </h1>
<p>在网络带宽一定的情况下，认为“切片上传和整体上传耗时差不多”的说法 <strong>不完全正确</strong>。虽然带宽是影响上传速度的关键因素，但切片上传通过技术优化和并发机制，能够在相同带宽下显著缩短总耗时。以下从原理、实测数据和优化逻辑三个角度分析：</p>
<hr>
<h3 id="一-技术原理层面的差异">一、技术原理层面的差异 </h3>
<ol>
<li>
<p><strong>并行传输与带宽利用率</strong><br>
切片上传可将文件分割为多个小块，通过 <strong>多线程并发上传</strong> 充分利用带宽资源。例如，若带宽上限为 10Mbps，整体上传只能单线程占用部分带宽，而切片上传通过 5 个并发请求可接近带宽上限，提高传输效率。</p>
</li>
<li>
<p><strong>TCP 协议与传输效率</strong><br>
TCP 协议存在 <strong>慢启动机制</strong> 和 <strong>拥塞控制</strong>，整体上传大文件时需经历较长的初始阶段才能达到带宽峰值。切片上传通过多并发的小文件传输，可快速进入稳定传输状态，减少协议层耗时。</p>
<blockquote>
<p>如果是在 http1.1 的协议下，理想情况下，慢启动还可能导致切片上传的速度更慢，因为每个 tcp 连接开始的时候都需要经历慢启动，而整体上传只需要经历一次慢启动即可，不过这个影响比较小</p>
</blockquote>
<ul>
<li>什么是拥塞控制
<blockquote>
<p>ssthresh: 慢启动门限<br>
cwnd: 拥塞窗口<br>
tcp 连接刚建立的时候，会通过慢启动（三次握手、指数级增长 cwnd）来提高传输速度，当 cwnd &gt;= ssthresh，则进入拥塞避免阶段，此时会采用拥塞避免算法(线性增长 cwnd)，减缓 cwnd 增速，从而减少网络拥塞。如果出现了丢包，则进入快速恢复阶段，ssthresh 设为当前 cwnd 的一半，cwnd 降为 ssthresh + 3，进入拥塞避免阶段，以减少因短暂丢包导致的性能骤降；如果超时丢包：则 cwnd 重置为 1，ssthresh = cwnd/2</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p><strong>服务器与客户端资源优化</strong><br>
整体上传时，服务器需一次性接收大文件，可能导致内存溢出或 CPU 过载（如搜索结果中提到的“CPU 使用率飙升”问题）。切片上传分散了资源消耗，避免单点瓶颈。</p>
</li>
</ol>
<hr>
<h3 id="二-实测数据对比">二、实测数据对比 </h3>
<p>根据搜索结果中的实际案例：</p>
<ol>
<li>
<p><strong>500MB 文件上传耗时</strong><br>
• <strong>整体上传</strong>：5-10 秒（受协议耗时和资源限制影响）<br>
• <strong>切片上传</strong>：2.15-3 秒（多并发充分利用带宽）<br>
差距达 50% 以上，表明切片上传明显更优。</p>
</li>
<li>
<p><strong>大文件场景下的稳定性</strong><br>
在测试 1.2GB 文件时，整体上传可能因网络波动或服务器负载失败，而切片上传通过断点续传和错误重试机制保持高效。</p>
</li>
</ol>
<hr>
<h3 id="三-切片上传的优化逻辑">三、切片上传的优化逻辑 </h3>
<ol>
<li>
<p><strong>动态调整切片大小</strong><br>
如网页 3 提出的 <strong>自适应分片算法</strong>，根据实时网络状态动态调整切片大小。例如，初始分片为 1MB，若检测到传输速率高则增大分片，反之减小分片，避免带宽浪费。</p>
</li>
<li>
<p><strong>并发数控制</strong><br>
研究表明，当并发数设置为 5 时，上传耗时出现明显拐点（比单线程快 3 倍以上）。浏览器和服务器的并发限制通常允许这一优化。</p>
</li>
<li>
<p><strong>错误处理与续传机制</strong><br>
切片上传仅需重传失败的分片，而整体上传需完全重试，进一步降低有效耗时。</p>
</li>
</ol>
<hr>
<h3 id="结论">结论 </h3>
<p><strong>切片上传在相同带宽下显著优于整体上传</strong>，主要原因包括：</p>
<ol>
<li>通过并发传输提高带宽利用率；</li>
<li>减少协议层耗时（如 TCP 慢启动）；</li>
<li>优化资源分配避免单点瓶颈；</li>
<li>支持动态调整和错误恢复机制。</li>
</ol>
<p>因此，认为“两者耗时相近”的说法 <strong>不成立</strong>。实际应用中，切片上传是提升大文件传输效率的核心技术方案。</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="大文件切片上传的时候确定切片数量的时候有哪些考量因素">大文件切片上传的时候，确定切片数量的时候，有哪些考量因素 </h1>
<p>在大文件切片上传时，确定切片数量的核心考量因素需综合技术实现、网络环境、服务器性能和用户体验等多方面因素。以下是具体分析：</p>
<hr>
<h3 id="一-文件大小与切片策略的平衡">一、<strong>文件大小与切片策略的平衡</strong> </h3>
<ol>
<li>
<p><strong>文件总大小的直接影响</strong><br>
切片数量的计算公式为：<br>
<strong>切片数量 = 文件总大小 / 单切片大小</strong><br>
文件越大，分片数量通常越多，但需避免因分片过小导致请求次数激增，或分片过大增加单次失败风险。<br>
• <strong>示例</strong>：100MB 文件若选择 5MB 切片，需 20 个分片；若选择 2MB 切片，则需 50 个分片。</p>
</li>
<li>
<p><strong>分片大小的动态调整</strong><br>
• <strong>固定分片</strong>：常见分片大小范围为 <strong>1MB-20MB</strong>（如 5MB、10MB），适用于稳定网络环境。<br>
• <strong>自适应分片</strong>：根据实时网络速率动态调整分片大小。例如，初始分片为 5MB，若上传速率下降，则自动缩小分片以提升成功率。</p>
</li>
</ol>
<hr>
<h3 id="二-网络环境的适配">二、<strong>网络环境的适配</strong> </h3>
<ol>
<li>
<p><strong>带宽与稳定性</strong><br>
• <strong>高带宽网络</strong>：可采用较大分片（如 10MB-20MB），减少请求次数以提高效率。<br>
• <strong>弱网环境</strong>：推荐较小分片（如 1MB-5MB），降低单次传输失败概率。例如，移动端网络波动大时，分片可设为 512KB。</p>
</li>
<li>
<p><strong>并发上传的优化</strong><br>
• <strong>并行请求限制</strong>：浏览器对单域名并发请求数有限制（如 HTTP/1.1 的 6 个），需合理控制并发数以避免阻塞。<br>
• <strong>示例</strong>：设置并发数为 5，每组上传完成后调整下一组分片大小。</p>
</li>
</ol>
<hr>
<h3 id="三-服务器与客户端的性能约束">三、<strong>服务器与客户端的性能约束</strong> </h3>
<ol>
<li>
<p><strong>服务器处理能力</strong><br>
• <strong>请求压力</strong>：分片过小会增加服务器处理请求的频率，导致负载升高。例如，1GB 文件若分片为 1MB，需处理 1000 次请求，可能超出服务器吞吐量。<br>
• <strong>存储与合并开销</strong>：服务器需临时存储分片并按顺序合并，分片过多可能导致 I/O 压力增大。</p>
</li>
<li>
<p><strong>客户端资源占用</strong><br>
• <strong>内存消耗</strong>：前端通过 <code>File.slice()</code> 切割文件时，过大的分片可能导致内存溢出（如 100MB 分片占用过高）。<br>
• <strong>计算成本</strong>：分片哈希值（如 MD5）的计算耗时随分片数量增加而上升，需权衡校验精度与性能。</p>
</li>
</ol>
<hr>
<h3 id="四-容错机制与用户体验">四、<strong>容错机制与用户体验</strong> </h3>
<ol>
<li>
<p><strong>断点续传与重试</strong><br>
• 分片需携带唯一标识（如 <code>chunkIndex</code> 和 <code>fileId</code>），服务端记录上传状态，失败时仅重传缺失分片。<br>
• <strong>示例</strong>：最后一个分片可能小于标准大小，需在前端和服务端特殊处理。</p>
</li>
<li>
<p><strong>进度反馈与交互</strong><br>
• <strong>细粒度进度</strong>：分片数量越多，进度更新越频繁（如 100 个分片每上传 1% 更新一次），但需防抖避免界面卡顿。<br>
• <strong>暂停/恢复支持</strong>：分片机制需与本地存储（如 IndexedDB）结合，保存已上传分片信息。</p>
</li>
</ol>
<hr>
<h3 id="五-实际场景的推荐策略">五、<strong>实际场景的推荐策略</strong> </h3>
<table>
<thead>
<tr>
<th><strong>场景</strong></th>
<th><strong>分片大小建议</strong></th>
<th><strong>技术实现参考</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>稳定网络（有线/WiFi）</td>
<td>5MB-20MB</td>
<td>固定分片 + 并行上传</td>
</tr>
<tr>
<td>移动端/弱网</td>
<td>512KB-2MB</td>
<td>动态调整分片 + 重试策略</td>
</tr>
<tr>
<td>超大文件（&gt;1GB）</td>
<td>10MB-20MB</td>
<td>分片合并 + 服务端异步处理</td>
</tr>
<tr>
<td>高并发上传</td>
<td>2MB-5MB + 并发数 3-5</td>
<td>请求队列控制 + 速率限制</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="总结-7">总结 </h3>
<p>确定切片数量需综合以下优先级：</p>
<ol>
<li><strong>网络稳定性</strong> &gt; <strong>服务器负载</strong> &gt; <strong>用户体验</strong> &gt; <strong>计算成本</strong>。</li>
<li>实践中可通过实验性测试（如上传 10% 文件样本）动态校准分片大小。</li>
<li>推荐结合固定分片的简洁性与自适应分片的灵活性，例如初始分片设为 5MB，根据实时速率上下浮动 50%。</li>
</ol>
<h3 id="怎么获取当前的网络上传速率">怎么获取当前的网络上传速率 </h3>
<ol>
<li>可以根据上一个上传的切片的耗时与切片大小进行比较，得出当前上传速率。</li>
<li>NetworkInformation API​​（推荐）</li>
</ol>
<ul>
<li>通过 navigator.connection.downlink 获取下行带宽（单位：Mbps），并转换为实际下载速度（公式：downlink * 1024 / 8 得到 KB/s）。例如，若 downlink=5，实际速度约为 640 KB/s。</li>
<li>优点：实时性强，无需额外请求。</li>
<li>限制：仅支持 Chrome 65+ 及部分新版浏览器，且数据基于历史统计，可能存在分钟级延迟</li>
</ul>
<ol start="3">
<li>navigator.connection.effectiveType​：直接获取网络类型（如 4g、3g、2g），若为 slow-2g 或 2g 则判定弱网</li>
</ol>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="页面关闭时执行方法该如何做">页面关闭时执行方法，该如何做 </h1>
<p>在页面关闭时执行特定操作（如发送请求、保存数据等），前端可通过监听浏览器事件并选择合适的 API 实现。以下是具体方案及注意事项：</p>
<hr>
<h3 id="一-核心事件监听">一、核心事件监听 </h3>
<h4 id="1-beforeunload-事件">1. <strong><code>beforeunload</code> 事件</strong> </h4>
<p>• <strong>触发时机</strong>：窗口关闭、刷新、导航到其他页面时触发。<br>
• <strong>用途</strong>：提示用户确认离开或执行关键操作（如发送日志）。<br>
• <strong>代码示例</strong>：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'beforeunload'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token method function property-access">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 必须调用以触发确认弹窗</span>
  event<span class="token punctuation">.</span><span class="token property-access">returnValue</span> <span class="token operator">=</span> <span class="token string">'数据未保存，确定离开吗？'</span><span class="token punctuation">;</span> <span class="token comment">// Chrome需设置returnValue</span>
  <span class="token comment">// 执行逻辑（如发送请求）</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>• <strong>限制</strong>：<br>
• 弹窗内容不可自定义（现代浏览器仅显示默认提示）。<br>
• 部分浏览器要求页面必须有过交互才会显示弹窗。</p>
<h4 id="2-unload-事件">2. <strong><code>unload</code> 事件</strong> </h4>
<p>• <strong>触发时机</strong>：页面完全卸载前触发，比<code>beforeunload</code>稍晚。<br>
• <strong>用途</strong>：执行清理操作（如断开 WebSocket 连接）。<br>
• <strong>代码示例</strong>：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'unload'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token method function property-access">sendBeacon</span><span class="token punctuation">(</span><span class="token string">'/api/logout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 发送注销请求</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>• <strong>限制</strong>：无法阻止页面关闭，且部分浏览器（如 Chrome）不支持同步操作。</p>
<hr>
<h3 id="二-可靠的数据发送方法">二、可靠的数据发送方法 </h3>
<h4 id="1-navigatorsendbeacon">1. <strong><code>navigator.sendBeacon()</code></strong> </h4>
<p>• <strong>优势</strong>：异步发送数据，不阻塞页面卸载，支持跨域。<br>
• <strong>适用场景</strong>：发送日志、统计信息等小数据。<br>
• <strong>代码示例</strong>：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> data <span class="token operator">=</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">event</span><span class="token operator">:</span> <span class="token string">'page_close'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token method function property-access">sendBeacon</span><span class="token punctuation">(</span><span class="token string">'/api/log'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>• <strong>限制</strong>：<br>
• 数据大小有限（通常 ≤64KB）。<br>
• 不支持自定义请求头（需通过 URL 参数传递认证信息）。</p>
<h4 id="2-fetch-api-的-keepalive-选项">2. <strong>Fetch API 的 <code>keepalive</code> 选项</strong> </h4>
<p>• <strong>优势</strong>：允许在页面关闭后继续发送请求，支持较大数据。<br>
• <strong>代码示例</strong>：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/save'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">keepalive</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 关键参数</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>• <strong>限制</strong>：部分浏览器不支持，数据大小限制（Chrome 限制为 64KB）。</p>
<h4 id="3-同步-xmlhttprequest谨慎使用">3. <strong>同步 XMLHttpRequest（谨慎使用）</strong> </h4>
<p>• <strong>代码示例</strong>：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> xhr <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token method function property-access">open</span><span class="token punctuation">(</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'/api/save'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 同步模式</span>
xhr<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>• <strong>限制</strong>：<br>
• 阻塞页面关闭，影响用户体验。<br>
• Chrome 已废弃同步 XHR 在页面卸载阶段的使用。</p>
<hr>
<h3 id="三-框架集成方案以-vuereact-为例">三、框架集成方案（以 Vue/React 为例） </h3>
<h4 id="1-vue-3">1. <strong>Vue 3</strong> </h4>
<p>• <strong>生命周期钩子 + 事件监听</strong>：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword module keyword-import">import</span> <span class="token imports"><span class="token punctuation">{</span> onBeforeUnmount <span class="token punctuation">}</span></span> <span class="token keyword module keyword-from">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword module keyword-export">export</span> <span class="token keyword module keyword-default">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> <span class="token function-variable function">handleClose</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token method function property-access">sendBeacon</span><span class="token punctuation">(</span><span class="token string">'/api/close'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'beforeunload'</span><span class="token punctuation">,</span> handleClose<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">onBeforeUnmount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'beforeunload'</span><span class="token punctuation">,</span> handleClose<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>• <strong>注意</strong>：框架生命周期钩子（如<code>onBeforeUnmount</code>）仅在组件销毁时触发，无法捕获页面关闭事件，需结合窗口事件。</p>
<h4 id="2-react">2. <strong>React</strong> </h4>
<p>• <strong>useEffect 清理函数</strong>：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> <span class="token function-variable function">handleClose</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">/* 发送请求 */</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'beforeunload'</span><span class="token punctuation">,</span> handleClose<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-return">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'beforeunload'</span><span class="token punctuation">,</span> handleClose<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<h3 id="四-容错与优化策略">四、容错与优化策略 </h3>
<ol>
<li>
<p><strong>本地存储重试机制</strong><br>
• 发送失败时暂存数据至<code>localStorage</code>，下次页面加载时重试。</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token method function property-access">sendBeacon</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> failedRequests <span class="token operator">=</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">parse</span><span class="token punctuation">(</span>
    <span class="token dom variable">localStorage</span><span class="token punctuation">.</span><span class="token method function property-access">getItem</span><span class="token punctuation">(</span><span class="token string">'failedRequests'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'[]'</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  failedRequests<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url<span class="token punctuation">,</span> data <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token dom variable">localStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">'failedRequests'</span><span class="token punctuation">,</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span>failedRequests<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p><strong>Service Worker 离线支持</strong><br>
• 通过 Service Worker 缓存请求，网络恢复后发送。</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code>self<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token property-access">request</span><span class="token punctuation">.</span><span class="token property-access">url</span><span class="token punctuation">.</span><span class="token method function property-access">includes</span><span class="token punctuation">(</span><span class="token string">'/api/log'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    event<span class="token punctuation">.</span><span class="token method function property-access">respondWith</span><span class="token punctuation">(</span>
      <span class="token function">fetch</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token property-access">request</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword control-flow keyword-catch">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span>
        caches<span class="token punctuation">.</span><span class="token method function property-access">open</span><span class="token punctuation">(</span><span class="token string">'logs'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">cache</span> <span class="token arrow operator">=&gt;</span> cache<span class="token punctuation">.</span><span class="token method function property-access">match</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token property-access">request</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
<li>
<p><strong><code>visibilitychange</code> 事件补充</strong><br>
• 页面隐藏时提前发送数据，避免关闭时来不及处理。</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'visibilitychange'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">visibilityState</span> <span class="token operator">===</span> <span class="token string">'hidden'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token method function property-access">sendBeacon</span><span class="token punctuation">(</span><span class="token string">'/api/pre-close'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
</ol>
<hr>
<h3 id="五-注意事项-3">五、注意事项 </h3>
<p>• <strong>用户体验</strong>：避免滥用弹窗，仅在数据未保存时提示。<br>
• <strong>兼容性</strong>：优先使用<code>sendBeacon</code>和<code>fetch + keepalive</code>，降级方案为同步 XHR。<br>
• <strong>数据安全</strong>：敏感操作需结合服务端校验，防止客户端伪造请求。<br>
• <strong>性能影响</strong>：<code>beforeunload</code>事件可能禁用浏览器缓存（如 Back-Forward Cache）。</p>
<p>通过组合使用事件监听、可靠 API 及容错机制，可实现在页面关闭时稳定执行关键逻辑。</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="如何统计用户-pv-访问的发起请求数量">如何统计用户 pv 访问的发起请求数量 </h1>
<p>前端统计用户 PV（页面浏览量）的请求数量需根据页面类型（SPA 或非 SPA）和路由模式设计不同的方案，以下是具体实现方法和优化策略：</p>
<hr>
<h3 id="一-非-spa-页面统计方案">一、<strong>非 SPA 页面统计方案</strong> </h3>
<h4 id="1-基础方案页面加载事件监听">1. <strong>基础方案：页面加载事件监听</strong> </h4>
<p>通过 <code>window.onload</code> 或 <code>DOMContentLoaded</code> 事件触发统计请求：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 发送 PV 统计请求（兼容性更好的 Image 方式）</span>
  <span class="token keyword keyword-const">const</span> img <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  img<span class="token punctuation">.</span><span class="token property-access">src</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://yourserver.com/track?event=pv&amp;url=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>
    <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">location</span><span class="token punctuation">.</span><span class="token property-access">href</span>
  <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><strong>适用场景</strong>：传统多页应用，每次页面刷新即触发一次 PV 统计。</p>
<h4 id="2-优化策略防止重复上报">2. <strong>优化策略：防止重复上报</strong> </h4>
<p>• <strong>请求防重参数</strong>：在 URL 中添加时间戳或随机数：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code>img<span class="token punctuation">.</span><span class="token property-access">src</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://yourserver.com/track?t=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token known-class-name class-name">Date</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;url=...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre><p>• <strong>服务端去重</strong>：基于 <code>IP + User-Agent + URL</code> 的组合去重。</p>
<hr>
<h3 id="二-spa-页面统计方案">二、<strong>SPA 页面统计方案</strong> </h3>
<p>SPA 需监听路由变化触发「虚拟页面访问」统计，需区分路由模式：</p>
<h4 id="1-hash-路由模式">1. <strong>Hash 路由模式</strong> </h4>
<p>通过 <code>hashchange</code> 事件捕获路由变化：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'hashchange'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> pvData <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">event</span><span class="token operator">:</span> <span class="token string">'pv'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">location</span><span class="token punctuation">.</span><span class="token property-access">href</span><span class="token punctuation">,</span>
    <span class="token literal-property property">timestamp</span><span class="token operator">:</span> <span class="token known-class-name class-name">Date</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token method function property-access">sendBeacon</span><span class="token punctuation">(</span><span class="token string">'/track'</span><span class="token punctuation">,</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span>pvData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用可靠的上报方式</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="2-history-路由模式">2. <strong>History 路由模式</strong> </h4>
<p>重写 <code>pushState</code> 和 <code>replaceState</code> 方法，并监听 <code>popstate</code> 事件：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 重写原生方法</span>
<span class="token keyword keyword-const">const</span> originalPushState <span class="token operator">=</span> history<span class="token punctuation">.</span><span class="token property-access">pushState</span><span class="token punctuation">;</span>
history<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">pushState</span> <span class="token operator">=</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> title<span class="token punctuation">,</span> url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  originalPushState<span class="token punctuation">.</span><span class="token method function property-access">apply</span><span class="token punctuation">(</span>history<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">handleRouteChange</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 触发统计</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 监听浏览器前进/后退</span>
<span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'popstate'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">handleRouteChange</span><span class="token punctuation">(</span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">location</span><span class="token punctuation">.</span><span class="token property-access">href</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-function">function</span> <span class="token function">handleRouteChange</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/track'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">event</span><span class="token operator">:</span> <span class="token string">'pv'</span><span class="token punctuation">,</span> url <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">keepalive</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 确保页面关闭时请求成功</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>关键点</strong>：通过劫持路由 API 确保所有跳转行为被捕获。</p>
<hr>
<h3 id="三-通用优化策略">三、<strong>通用优化策略</strong> </h3>
<h4 id="1-请求可靠性保障">1. <strong>请求可靠性保障</strong> </h4>
<p>• <strong><code>sendBeacon</code> API</strong>：适用于页面关闭场景，异步且不阻塞页面卸载：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token method function property-access">sendBeacon</span><span class="token punctuation">(</span><span class="token string">'/track'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>• <strong><code>fetch</code> 的 <code>keepalive</code> 选项</strong>：允许请求在页面卸载后继续发送：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/track'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token literal-property property">keepalive</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">body</span><span class="token operator">:</span> data <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="2-用户标识生成">2. <strong>用户标识生成</strong> </h4>
<p>• <strong>UV 统计</strong>：通过 <code>Cookie</code> 或 <code>LocalStorage</code> 存储唯一标识（如 UUID）：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> uuid <span class="token operator">=</span> <span class="token dom variable">localStorage</span><span class="token punctuation">.</span><span class="token method function property-access">getItem</span><span class="token punctuation">(</span><span class="token string">'uuid'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">generateUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token dom variable">localStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">'uuid'</span><span class="token punctuation">,</span> uuid<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>• <strong>IP 辅助统计</strong>：结合服务端日志分析去重（需注意 NAT 网络的影响）。</p>
<h4 id="3-避免重复统计">3. <strong>避免重复统计</strong> </h4>
<p>• <strong>路由跳转防抖</strong>：对于快速跳转场景，设置 300ms 防抖阈值。<br>
• <strong>SPA 子路由合并</strong>：忽略参数变化的子路由（如 <code>/user?id=1</code> 和 <code>/user?id=2</code> 视为同一页面）。</p>
<hr>
<h3 id="四-第三方方案集成">四、<strong>第三方方案集成</strong> </h3>
<h4 id="1-使用统计工具">1. <strong>使用统计工具</strong> </h4>
<p>• <strong>Google Analytics</strong>：嵌入 SDK 自动采集 PV/UV：</p>
<pre data-role="codeBlock" data-info="html" class="language-html html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span>
  <span class="token attr-name">async</span>
  <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID<span class="token punctuation">"</span></span>
<span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">dataLayer</span> <span class="token operator">=</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">dataLayer</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-function">function</span> <span class="token function">gtag</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    dataLayer<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">gtag</span><span class="token punctuation">(</span><span class="token string">'js'</span><span class="token punctuation">,</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">gtag</span><span class="token punctuation">(</span><span class="token string">'config'</span><span class="token punctuation">,</span> <span class="token string">'GA_MEASUREMENT_ID'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>• <strong>自研埋点系统</strong>：结合路由监听和请求上报，支持定制化分析。</p>
<h4 id="2-日志分析补充">2. <strong>日志分析补充</strong> </h4>
<p>• <strong>Nginx 日志</strong>：通过 <code>$request_uri</code> 字段统计 PV（需过滤静态资源请求）：</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">awk</span> <span class="token string">'{print $7}'</span> access.log <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-vE</span> <span class="token string">'\.(js|css|png)'</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span> <span class="token parameter variable">-c</span>
</code></pre><p>• <strong>ELK 分析</strong>：使用 Elasticsearch 聚合日志数据生成报表。</p>
<hr>
<h3 id="五-生产环境注意事项">五、<strong>生产环境注意事项</strong> </h3>
<ol>
<li><strong>性能影响</strong>：避免高频触发统计请求（如滚动事件），采用批量上报或节流。</li>
<li><strong>隐私合规</strong>：遵循 GDPR 等法规，弹窗告知用户数据收集用途。</li>
<li><strong>异常监控</strong>：捕获上报失败事件并重试（如存储到 IndexedDB 待后续重传）。</li>
</ol>
<hr>
<h2 id="通过上述方案前端可实现精准的-pv-请求数量统计覆盖多页和单页应用场景对于高并发场景建议结合服务端日志分析和分布式计数如-redis提升可靠性">通过上述方案，前端可实现精准的 PV 请求数量统计，覆盖多页和单页应用场景。对于高并发场景，建议结合服务端日志分析和分布式计数（如 Redis）提升可靠性。 </h2>
<hr>
<hr>
<hr>
<hr>
<h1 id="长文本溢出展开收起如何实现">长文本溢出，展开/收起如何实现 </h1>
<ol>
<li>利用文字会环绕浮动元素的特点，将展开折叠的按钮浮动至右下角，</li>
<li><code>&lt;input type="checkbox" /&gt;</code>点击后会切换 checked 状态，通过 css 控制样式实现展开折叠。</li>
</ol>
<pre data-role="codeBlock" data-info="tsx" class="language-tsx tsx"><code><span class="token keyword keyword-import">import</span> <span class="token imports"><span class="token punctuation">{</span> useRef<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useState <span class="token punctuation">}</span></span> <span class="token keyword keyword-from">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token imports">style</span> <span class="token keyword keyword-from">from</span> <span class="token string">'./style.module.scss'</span><span class="token punctuation">;</span>

<span class="token keyword keyword-export">export</span> <span class="token keyword keyword-default">default</span> <span class="token keyword keyword-function">function</span> <span class="token function">FoldText</span><span class="token punctuation">(</span><span class="token punctuation">{</span> text <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> text<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> textRef <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useRef</span><span class="token generic class-name"><span class="token operator">&lt;</span>HTMLDivElement<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword keyword-null">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>isShowBtn<span class="token punctuation">,</span> setIsShowBtn<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> sHeight <span class="token operator">=</span> textRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token operator">?.</span>scrollHeight<span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> cHeight <span class="token operator">=</span> textRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token operator">?.</span>clientHeight<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>sHeight <span class="token operator">&amp;&amp;</span> cHeight <span class="token operator">&amp;&amp;</span> sHeight <span class="token operator">&gt;</span> cHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setIsShowBtn</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
      <span class="token function">setIsShowBtn</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>text<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>style<span class="token punctuation">.</span><span class="token property-access">foldText</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>exp<span class="token punctuation">"</span></span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>style<span class="token punctuation">.</span><span class="token property-access">exp</span><span class="token punctuation">}</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>style<span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">}</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>textRef<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span>isShowBtn <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>style<span class="token punctuation">.</span><span class="token property-access">btn</span><span class="token punctuation">}</span></span> <span class="token attr-name">htmlFor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>exp<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>style<span class="token punctuation">.</span><span class="token property-access">downIcon</span><span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token punctuation">{</span>text<span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><pre data-role="codeBlock" data-info="css" class="language-css css"><code><span class="token selector"><span class="token class">.foldText</span></span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">23</span><span class="token unit">px</span> <span class="token number">19</span><span class="token unit">px</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode color">#ffe7c7</span><span class="token punctuation">;</span>
  <span class="token selector"><span class="token class">.text</span></span> <span class="token punctuation">{</span>
    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
    <span class="token property">max-height</span><span class="token punctuation">:</span> <span class="token number">60</span><span class="token unit">px</span><span class="token punctuation">;</span>
    <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">14</span><span class="token unit">px</span><span class="token punctuation">;</span>
    <span class="token property">line-height</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token unit">px</span><span class="token punctuation">;</span>
    <span class="token property">text-align</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>
    <span class="token property">text-overflow</span><span class="token punctuation">:</span> ellipsis<span class="token punctuation">;</span>
    <span class="token property">white-space</span><span class="token punctuation">:</span> pre-wrap<span class="token punctuation">;</span>
    <span class="token property">transition</span><span class="token punctuation">:</span> max-height <span class="token number">0.3</span><span class="token unit">s</span> ease<span class="token punctuation">;</span>
    <span class="token selector">&amp;<span class="token pseudo-element">::before</span></span> <span class="token punctuation">{</span>
      <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span>
      <span class="token property">height</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token unit">%</span> <span class="token operator">-</span> <span class="token number">20</span><span class="token unit">px</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token selector"><span class="token class">.btn</span></span> <span class="token punctuation">{</span>
    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
    <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span>
    <span class="token property">padding-right</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token unit">px</span><span class="token punctuation">;</span>
    <span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token unit">px</span><span class="token punctuation">;</span>
    <span class="token property">clear</span><span class="token punctuation">:</span> both<span class="token punctuation">;</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">14</span><span class="token unit">px</span><span class="token punctuation">;</span>
    <span class="token property">line-height</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token unit">px</span><span class="token punctuation">;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode color">#fff</span><span class="token punctuation">;</span>
    <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span>
    <span class="token selector">&amp;<span class="token pseudo-element">::after</span></span> <span class="token punctuation">{</span>
      <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">'更多'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">&amp;<span class="token pseudo-element">::before</span></span> <span class="token punctuation">{</span>
      <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
      <span class="token property">left</span><span class="token punctuation">:</span> <span class="token number">-8</span><span class="token unit">px</span><span class="token punctuation">;</span>
      <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode color">#ffe7c7</span><span class="token punctuation">;</span>
      <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">'...'</span><span class="token punctuation">;</span>
      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span><span class="token number">-100</span><span class="token unit">%</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector"><span class="token class">.downIcon</span></span> <span class="token punctuation">{</span>
      <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
      <span class="token property">top</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token unit">px</span><span class="token punctuation">;</span>
      <span class="token property">right</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token unit">px</span><span class="token punctuation">;</span>
      <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token unit">px</span><span class="token punctuation">;</span>
      <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span>
      <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>../assets/downfill.png<span class="token punctuation">)</span></span> <span class="token number">0</span> <span class="token number">0</span> <span class="token operator">/</span> <span class="token number">100</span><span class="token unit">%</span> auto no-repeat<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token selector"><span class="token class">.exp</span></span> <span class="token punctuation">{</span>
    <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
    <span class="token selector">&amp;<span class="token pseudo-class">:checked</span> <span class="token combinator">+</span> <span class="token class">.text</span></span> <span class="token punctuation">{</span>
      <span class="token property">max-height</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">&amp;<span class="token pseudo-class">:checked</span> <span class="token combinator">+</span> <span class="token class">.text</span> <span class="token class">.btn</span><span class="token pseudo-element">::before</span></span> <span class="token punctuation">{</span>
      <span class="token property">visibility</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">&amp;<span class="token pseudo-class">:checked</span> <span class="token combinator">+</span> <span class="token class">.text</span> <span class="token class">.btn</span><span class="token pseudo-element">::after</span></span> <span class="token punctuation">{</span>
      <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">'收起'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">&amp;<span class="token pseudo-class">:checked</span> <span class="token combinator">+</span> <span class="token class">.text</span> <span class="token class">.btn</span> <span class="token class">.downIcon</span></span> <span class="token punctuation">{</span>
      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateX</span><span class="token punctuation">(</span><span class="token number">180</span><span class="token unit">deg</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="如何实现鼠标拖拽">如何实现鼠标拖拽 </h1>
<h1 id="防止前端页面重复请求">防止前端页面重复请求 </h1>
<h1 id="resizeobserver-作用是什么">ResizeObserver 作用是什么 </h1>
<p>ResizeObserver 是浏览器提供的一种高效监听元素尺寸变化的 Web API，其核心作用与实现价值主要体现在以下几个方面：</p>
<hr>
<h3 id="一-核心作用">一、核心作用 </h3>
<ol>
<li>
<p><strong>精准监听元素尺寸变化</strong><br>
ResizeObserver 可以实时监测 DOM 元素内容区域（content-box）或边框区域（border-box）的尺寸变化，包括宽度、高度、位置等属性。与传统的 <code>window.resize</code> 事件不同，它直接关联具体元素，而非全局窗口。</p>
</li>
<li>
<p><strong>避免性能问题</strong><br>
通过异步回调机制和批量处理变化，ResizeObserver 解决了传统轮询或频繁触发事件导致的性能问题（如无限循环回调）。其回调会在浏览器绘制前或布局后执行，确保计算逻辑不会阻塞渲染流程。</p>
</li>
</ol>
<hr>
<h3 id="二-典型应用场景-1">二、典型应用场景 </h3>
<ol>
<li>
<p><strong>响应式布局适配</strong><br>
当容器尺寸变化时动态调整子元素布局，例如根据父容器宽度重新排列网格布局，或调整字体大小以适应新尺寸。</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> observer <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">ResizeObserver</span><span class="token punctuation">(</span><span class="token parameter">entries</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  entries<span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">entry</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> width <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token property-access">contentRect</span><span class="token punctuation">.</span><span class="token property-access">width</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>width <span class="token operator">&lt;</span> <span class="token number">600</span><span class="token punctuation">)</span> <span class="token function">adjustMobileLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow keyword-else">else</span> <span class="token function">adjustDesktopLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
<li>
<p><strong>图表与可视化重绘</strong><br>
在数据可视化场景中（如 ECharts、D3.js），当图表容器尺寸变化时，触发重绘逻辑以保证内容适配。</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code>observer<span class="token punctuation">.</span><span class="token method function property-access">observe</span><span class="token punctuation">(</span>chartContainer<span class="token punctuation">)</span><span class="token punctuation">;</span>
chartContainer<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onresize</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> chartInstance<span class="token punctuation">.</span><span class="token method function property-access">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
<li>
<p><strong>动态组件适配</strong><br>
支持弹窗、侧边栏等动态组件的自适应调整。例如，拖拽调整侧边栏宽度时，同步更新内容区域布局。</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code>sidebar<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'drag'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> observer<span class="token punctuation">.</span><span class="token method function property-access">observe</span><span class="token punctuation">(</span>sidebar<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
<li>
<p><strong>媒体元素优化</strong><br>
针对图片、视频等媒体资源，根据容器尺寸动态调整显示比例或加载不同分辨率的资源。</p>
</li>
</ol>
<hr>
<h3 id="三-技术优势">三、技术优势 </h3>
<ol>
<li>
<p><strong>高效替代传统方案</strong><br>
• 相比 <code>window.resize</code> + <code>Element.getBoundingClientRect()</code> 的全局监听，ResizeObserver 减少不必要的计算。<br>
• 避免通过 <code>setInterval</code> 轮询元素尺寸的低效做法。</p>
</li>
<li>
<p><strong>细粒度控制</strong><br>
支持同时观察多个元素，并可随时通过 <code>unobserve()</code> 或 <code>disconnect()</code> 停止监听特定或全部元素。</p>
</li>
<li>
<p><strong>兼容现代浏览器特性</strong><br>
支持监听 SVG 元素和 CSS 变形（transform）后的尺寸变化，覆盖更多复杂场景。</p>
</li>
</ol>
<hr>
<h3 id="四-使用注意事项">四、使用注意事项 </h3>
<ol>
<li>
<p><strong>性能优化</strong><br>
• 避免在回调中执行耗时操作（如复杂 DOM 操作），必要时使用防抖（debounce）。<br>
• 对频繁变化的元素（如动画元素）谨慎使用，或通过 <code>unobserve()</code> 临时解除监听。</p>
</li>
<li>
<p><strong>兼容性处理</strong><br>
• 现代浏览器（Chrome 64+、Firefox 69+、Safari 13.1+）已原生支持，但需为旧版浏览器引入 Polyfill（如 <code>resize-observer-polyfill</code>）。</p>
</li>
<li>
<p><strong>内存管理</strong><br>
在组件销毁时调用 <code>disconnect()</code> 释放资源，防止内存泄漏。</p>
</li>
</ol>
<hr>
<h3 id="五-对比传统方案示例">五、对比传统方案（示例） </h3>
<table>
<thead>
<tr>
<th><strong>方案</strong></th>
<th><strong>优点</strong></th>
<th><strong>缺点</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>window.resize</code></td>
<td>简单易用</td>
<td>无法精准定位具体元素变化</td>
</tr>
<tr>
<td><code>MutationObserver</code></td>
<td>监听 DOM 结构/属性变化</td>
<td>不直接支持尺寸监听</td>
</tr>
<tr>
<td><strong>ResizeObserver</strong></td>
<td>精准、高效、异步</td>
<td>需处理兼容性</td>
</tr>
</tbody>
</table>
<hr>
<p>通过合理使用 ResizeObserver，开发者可以实现更流畅的交互体验和更高效的性能优化。具体实现时，建议结合业务场景选择监听策略，并通过代码示例中的模式进行扩展。</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="要实时统计用户浏览器窗口大小该如何做">要实时统计用户浏览器窗口大小，该如何做 </h1>
<p>在实时统计浏览器窗口大小的场景中，前端可通过多种技术方案实现动态监测。以下是综合多篇技术文档后的实现方案及优化建议：</p>
<hr>
<h3 id="一-核心实现方法-1">一、核心实现方法 </h3>
<h4 id="1-原生-javascript-监听窗口事件">1. <strong>原生 JavaScript 监听窗口事件</strong> </h4>
<p>通过 <code>resize</code> 事件和窗口尺寸属性动态获取数据：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 定义获取窗口尺寸的函数</span>
<span class="token keyword keyword-function">function</span> <span class="token function">getWindowSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> width <span class="token operator">=</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">innerWidth</span><span class="token punctuation">;</span> <span class="token comment">// 包含滚动条的视口宽度</span>
  <span class="token keyword keyword-const">const</span> height <span class="token operator">=</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">innerHeight</span><span class="token punctuation">;</span> <span class="token comment">// 包含滚动条的视口高度</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">窗口尺寸：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>width<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">x</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>height<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 监听窗口变化</span>
<span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> getWindowSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 初始化时立即获取一次</span>
<span class="token function">getWindowSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><strong>优势</strong>：<br>
• 兼容性良好（支持 IE9+）<br>
• 实时响应窗口调整、设备旋转等场景</p>
<h4 id="2-resizeobserver-监听根元素">2. <strong>ResizeObserver 监听根元素</strong> </h4>
<p>针对现代浏览器，可监听 <code>&lt;html&gt;</code> 元素的尺寸变化：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> observer <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">ResizeObserver</span><span class="token punctuation">(</span><span class="token parameter">entries</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> entry <span class="token operator">=</span> entries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> width <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token property-access">contentRect</span><span class="token punctuation">.</span><span class="token property-access">width</span><span class="token punctuation">;</span> <span class="token comment">// 不包含滚动条的可视宽度</span>
  <span class="token keyword keyword-const">const</span> height <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token property-access">contentRect</span><span class="token punctuation">.</span><span class="token property-access">height</span><span class="token punctuation">;</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">文档可视区域：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>width<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">x</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>height<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 观察文档根元素</span>
observer<span class="token punctuation">.</span><span class="token method function property-access">observe</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">documentElement</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><strong>适用场景</strong>：<br>
• 需区分视口与文档实际尺寸<br>
• 需要更高精度的布局控制（如响应式断点）</p>
<hr>
<h3 id="二-关键属性对比">二、关键属性对比 </h3>
<table>
<thead>
<tr>
<th><strong>属性/方法</strong></th>
<th><strong>包含滚动条</strong></th>
<th><strong>触发场景</strong></th>
<th><strong>典型用途</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>window.innerWidth/Height</code></td>
<td>是</td>
<td>窗口缩放、设备旋转</td>
<td>响应式布局断点判断</td>
</tr>
<tr>
<td><code>document.documentElement.clientWidth/Height</code></td>
<td>否</td>
<td>DOM 结构变化</td>
<td>精确计算可用内容区域</td>
</tr>
<tr>
<td><code>screen.width/height</code></td>
<td>-</td>
<td>设备物理分辨率变化</td>
<td>全屏应用适配</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="三-框架集成方案vuereact">三、框架集成方案（Vue/React） </h3>
<h4 id="1-vue-3-组合式-api">1. <strong>Vue 3 组合式 API</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword module keyword-import">import</span> <span class="token imports"><span class="token punctuation">{</span> ref<span class="token punctuation">,</span> onMounted<span class="token punctuation">,</span> onBeforeUnmount <span class="token punctuation">}</span></span> <span class="token keyword module keyword-from">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>

<span class="token keyword module keyword-export">export</span> <span class="token keyword keyword-function">function</span> <span class="token function">useWindowSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> width <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">innerWidth</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> height <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">innerHeight</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword keyword-const">const</span> <span class="token function-variable function">update</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    width<span class="token punctuation">.</span><span class="token property-access">value</span> <span class="token operator">=</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">innerWidth</span><span class="token punctuation">;</span>
    height<span class="token punctuation">.</span><span class="token property-access">value</span> <span class="token operator">=</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">innerHeight</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> update<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">onBeforeUnmount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> update<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow keyword-return">return</span> <span class="token punctuation">{</span> width<span class="token punctuation">,</span> height <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>使用示例</strong>：</p>
<pre data-role="codeBlock" data-info="vue" class="language-vue vue"><code>&lt;template&gt;
  &lt;div&gt;当前窗口：{{ width }}x{{ height }}&lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
const { width, height } = useWindowSize();
&lt;/script&gt;
</code></pre><h4 id="2-react-hooks">2. <strong>React Hooks</strong> </h4>
<pre data-role="codeBlock" data-info="jsx" class="language-jsx jsx"><code><span class="token keyword module keyword-import">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module keyword-from">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword keyword-function">function</span> <span class="token function">useWindowSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>size<span class="token punctuation">,</span> setSize<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">innerWidth</span><span class="token punctuation">,</span>
    <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">innerHeight</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> <span class="token function-variable function">handleResize</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">setSize</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">innerWidth</span><span class="token punctuation">,</span>
        <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">innerHeight</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> handleResize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow keyword-return">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> handleResize<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow keyword-return">return</span> size<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="四-性能优化策略">四、性能优化策略 </h3>
<ol>
<li>
<p><strong>防抖处理</strong><br>
避免高频触发导致的性能问题：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-function">function</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> delay <span class="token operator">=</span> <span class="token number">300</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-let">let</span> timer<span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-return">return</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token spread operator">...</span>args</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> fn<span class="token punctuation">.</span><span class="token method function property-access">apply</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> <span class="token function">debounce</span><span class="token punctuation">(</span>getWindowSize<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
<li>
<p><strong>按需监听</strong><br>
在单页应用中，通过生命周期钩子及时销毁监听：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// Vue 示例</span>
<span class="token function">onBeforeUnmount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> getWindowSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
<li>
<p><strong>差异化响应</strong><br>
根据业务需求选择监听粒度：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 仅当宽度变化超过 100px 时触发</span>
<span class="token keyword keyword-let">let</span> lastWidth <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">abs</span><span class="token punctuation">(</span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">innerWidth</span> <span class="token operator">-</span> lastWidth<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lastWidth <span class="token operator">=</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">innerWidth</span><span class="token punctuation">;</span>
    <span class="token function">updateLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
</ol>
<hr>
<h3 id="五-特殊场景处理">五、特殊场景处理 </h3>
<ol>
<li>
<p><strong>移动端横竖屏检测</strong></p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> isPortrait <span class="token operator">=</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">matchMedia</span><span class="token punctuation">(</span><span class="token string">'(orientation: portrait)'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">matches</span><span class="token punctuation">;</span>
<span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'orientationchange'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>isPortrait <span class="token operator">?</span> <span class="token string">'竖屏'</span> <span class="token operator">:</span> <span class="token string">'横屏'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
<li>
<p><strong>全屏模式监控</strong><br>
通过 Fullscreen API 检测状态变化：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fullscreenchange'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">fullscreenElement</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'进入全屏，当前尺寸:'</span><span class="token punctuation">,</span> screen<span class="token punctuation">.</span><span class="token property-access">width</span><span class="token punctuation">,</span> screen<span class="token punctuation">.</span><span class="token property-access">height</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
</ol>
<hr>
<h3 id="总结建议">总结建议 </h3>
<p>• <strong>优先方案</strong>：现代项目建议使用 <code>ResizeObserver + document.documentElement</code> 组合<br>
• <strong>兼容方案</strong>：传统项目使用 <code>resize</code> 事件 + 多属性检测（如 <code>clientWidth</code> 和 <code>innerWidth</code> 结合）<br>
• <strong>数据上报</strong>：通过 <code>navigator.sendBeacon()</code> 在页面关闭前发送最终尺寸数据</p>
<h2 id="具体实现时需根据项目浏览器兼容要求-性能敏感度等因素选择合适方案">具体实现时需根据项目浏览器兼容要求、性能敏感度等因素选择合适方案。 </h2>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="当项目报错你想定位时哪个-commit-引入的错误时该怎么做">当项目报错，你想定位时哪个 commit 引入的错误时，该怎么做 </h1>
<p>在大型前端项目中定位引入错误的提交时，使用 <strong>Git bisect</strong> 是最高效的解决方案。以下是结合多个技术文档总结的完整操作指南：</p>
<hr>
<h3 id="一-核心原理与优势">一、核心原理与优势 </h3>
<p>Git bisect 基于<strong>二分查找算法</strong>，通过快速缩小问题范围定位错误提交：<br>
• <strong>时间复杂度</strong>：即使面对 1000 个提交，最多只需约 10 次测试即可定位（2^10=1024）<br>
• <strong>自动化支持</strong>：可编写测试脚本实现全自动排查<br>
• <strong>适用场景</strong>：代码报错、性能下降、功能缺失等需要追溯历史提交的场景</p>
<hr>
<h3 id="二-手动定位步骤以-vue-devui-组件库为例">二、手动定位步骤（以 Vue DevUI 组件库为例） </h3>
<h4 id="1-初始化并指定范围">1. 初始化并指定范围 </h4>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token comment"># 启动 bisect 并指定已知的好/坏提交</span>
<span class="token function">git</span> bisect start <span class="token punctuation">[</span>坏提交ID<span class="token punctuation">]</span> <span class="token punctuation">[</span>好提交ID<span class="token punctuation">]</span>
<span class="token comment"># 示例：最近出错提交 5d14c34b，正确提交 d577ce4</span>
<span class="token function">git</span> bisect start 5d14c34b d577ce4
</code></pre><p>系统会切换到中间提交（如 1cfafaaa）并提示剩余测试步骤</p>
<h4 id="2-测试并标记状态">2. 测试并标记状态 </h4>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token comment"># 执行测试（如构建、运行功能）</span>
<span class="token function">yarn</span> build

<span class="token comment"># 若当前提交正常</span>
<span class="token function">git</span> bisect good

<span class="token comment"># 若当前提交报错</span>
<span class="token function">git</span> bisect bad
</code></pre><p>重复此过程，直到系统输出<strong>第一个坏提交</strong>（如 <code>c0c4cc1a is the first bad commit</code>）</p>
<h4 id="3-退出并恢复状态">3. 退出并恢复状态 </h4>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">git</span> bisect reset
</code></pre><hr>
<h3 id="三-自动化脚本方案">三、自动化脚本方案 </h3>
<p>通过编写测试脚本（如 <code>test.sh</code>）实现无人值守排查：</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># 检查关键功能是否正常</span>
<span class="token keyword keyword-if">if</span> <span class="token function">node</span> ./check-error.js<span class="token punctuation">;</span> <span class="token keyword keyword-then">then</span>
  <span class="token builtin class-name">exit</span> <span class="token number">0</span>  <span class="token comment"># 标记为 good</span>
<span class="token keyword keyword-else">else</span>
  <span class="token builtin class-name">exit</span> <span class="token number">1</span>  <span class="token comment"># 标记为 bad</span>
<span class="token keyword keyword-fi">fi</span>
</code></pre><p>赋予执行权限后运行：</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">chmod</span> +x test.sh
<span class="token function">git</span> bisect run ./test.sh
</code></pre><p>系统会自动完成二分测试并输出结果</p>
<hr>
<h3 id="四-高级技巧与注意事项">四、高级技巧与注意事项 </h3>
<h4 id="1-特殊场景处理">1. 特殊场景处理 </h4>
<p>• <strong>无法确定状态</strong>：<code>git bisect skip</code> 跳过当前提交<br>
• <strong>查看进度</strong>：<code>git bisect log</code> 导出操作日志，<code>git bisect replay</code> 重放过程<br>
• <strong>可视化分支</strong>：<code>git bisect visualize --graph</code> 结合图形界面观察</p>
<h4 id="2-性能优化建议">2. 性能优化建议 </h4>
<p>• <strong>小批量提交</strong>：每次提交仅包含单一功能修改（便于定位后快速分析）<br>
• <strong>预检环境</strong>：确保测试脚本能在历史提交环境中运行（如安装旧版依赖）<br>
• <strong>缓存机制</strong>：对耗时测试结果进行本地缓存（如通过提交 ID 生成缓存文件）</p>
<h4 id="3-兼容性保障">3. 兼容性保障 </h4>
<p>• <strong>旧版 Git 支持</strong>：使用 <code>git bisect terms --term-good=new --term-bad=old</code> 自定义标记词汇<br>
• <strong>跨平台路径</strong>：在脚本中使用 <code>#!/usr/bin/env node</code> 避免系统兼容问题</p>
<hr>
<h3 id="五-对比传统方案">五、对比传统方案 </h3>
<table>
<thead>
<tr>
<th><strong>方法</strong></th>
<th>时间复杂度</th>
<th>适用场景</th>
<th>学习成本</th>
</tr>
</thead>
<tbody>
<tr>
<td>人工逐条回溯</td>
<td>O(n)</td>
<td>简单项目（&lt;10 次提交）</td>
<td>低</td>
</tr>
<tr>
<td>Git blame</td>
<td>O(1)</td>
<td>已知问题代码行</td>
<td>中</td>
</tr>
<tr>
<td><strong>Git bisect</strong></td>
<td>O(log n)</td>
<td>复杂项目（&gt;50 次提交）</td>
<td>中</td>
</tr>
<tr>
<td>CI/CD 历史回溯</td>
<td>O(n)</td>
<td>已部署版本对比</td>
<td>高</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="六-最佳实践总结">六、最佳实践总结 </h3>
<ol>
<li><strong>日常开发习惯</strong>：保持提交原子性（每个提交仅实现单一功能）</li>
<li><strong>错误复现步骤</strong>：明确问题触发条件并编写自动化测试脚本</li>
<li><strong>协作场景建议</strong>：通过 <code>git bisect replay</code> 共享排查日志，加速团队调试</li>
<li><strong>文档沉淀</strong>：将典型问题的 bisect 过程写入项目 Wiki（如示例代码片段）</li>
</ol>
<p>通过上述方法，开发者可快速定位类似 Vue DevUI 构建报错（document 未定义）、React 性能下降等隐蔽问题，大幅提升调试效率。</p>
<h1 id="如何移除一个指定的-commit">如何移除一个指定的 commit </h1>
<p>在 Git 中移除指定提交的完整方案需要根据是否保留历史记录、是否已推送到远程仓库等场景选择不同方法。以下是综合多个技术文档后的操作指南：</p>
<hr>
<h3 id="一-保留历史记录的撤销方案">一、保留历史记录的撤销方案 </h3>
<h4 id="1-git-revert-反向提交法">1. <strong><code>git revert</code> 反向提交法</strong> </h4>
<p>通过创建新提交抵消目标提交的影响，适用于已推送到远程仓库的协作场景：</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token comment"># 查找要撤销的提交ID（如 e498a2f）</span>
<span class="token function">git</span> log <span class="token parameter variable">--oneline</span>

<span class="token comment"># 生成反向提交</span>
<span class="token function">git</span> revert e498a2f

<span class="token comment"># 推送到远程仓库（保留完整历史）</span>
<span class="token function">git</span> push origin main
</code></pre><p><strong>优势</strong>：<br>
• 不修改已有历史，避免影响协作开发<br>
• 可撤销多个提交（需按倒序执行）<br>
<strong>限制</strong>：<br>
• 提交历史中会保留原提交记录和撤销记录</p>
<hr>
<h3 id="二-彻底删除提交的方案">二、彻底删除提交的方案 </h3>
<h4 id="1-git-rebase-交互式变基">1. <strong><code>git rebase</code> 交互式变基</strong> </h4>
<p>通过重写历史移除目标提交，适合本地分支或未推送的提交：</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token comment"># 定位目标提交的前一个提交（假设目标提交是2eb52d59）</span>
<span class="token function">git</span> log <span class="token parameter variable">--oneline</span>

<span class="token comment"># 启动交互式变基</span>
<span class="token function">git</span> rebase <span class="token parameter variable">-i</span> 91dacfef

<span class="token comment"># 在编辑器中将目标提交行的"pick"改为"drop"</span>
<span class="token comment"># 保存退出后完成变基（需解决可能的冲突）</span>
<span class="token function">git</span> rebase <span class="token parameter variable">--continue</span>

<span class="token comment"># 强制推送到远程（风险操作）</span>
<span class="token function">git</span> push <span class="token parameter variable">--force</span>
</code></pre><p><strong>关键步骤</strong>：<br>
• 需选择目标提交的父提交作为变基准点<br>
• 强制推送前确保分支无协作依赖<br>
<strong>注意事项</strong>：<br>
• 若目标提交后存在其他提交，可能需要冲突处理<br>
• 可通过<code>git rebase --abort</code>中止操作</p>
<hr>
<h4 id="2-git-reset-版本回退">2. <strong><code>git reset</code> 版本回退</strong> </h4>
<p>快速移除最新提交（适用于本地未推送场景）：</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token comment"># 移除最新提交（保留工作区修改）</span>
<span class="token function">git</span> reset HEAD~1

<span class="token comment"># 强制回退到指定提交（删除后续所有提交）</span>
<span class="token function">git</span> reset <span class="token parameter variable">--hard</span> e498a2f
</code></pre><p><strong>适用场景</strong>：<br>
• 快速撤销最近的错误提交<br>
• 结合<code>git reflog</code>可恢复误删提交</p>
<hr>
<h3 id="三-特殊场景处理方案">三、特殊场景处理方案 </h3>
<h4 id="1-批量删除多个提交">1. <strong>批量删除多个提交</strong> </h4>
<p>通过交互式变基批量标记删除：</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">git</span> rebase <span class="token parameter variable">-i</span> HEAD~5  <span class="token comment"># 查看最近5个提交</span>
</code></pre><p>在编辑界面将多个目标提交行的<code>pick</code>改为<code>drop</code></p>
<h4 id="2-删除远程仓库历史提交">2. <strong>删除远程仓库历史提交</strong> </h4>
<p>在本地完成变基或重置后，强制推送覆盖远程历史：</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">git</span> push --force-with-lease  <span class="token comment"># 比--force更安全的强制推送</span>
</code></pre><hr>
<h3 id="四-操作风险与规避策略">四、操作风险与规避策略 </h3>
<table>
<thead>
<tr>
<th><strong>风险类型</strong></th>
<th><strong>应对方案</strong></th>
<th><strong>引用来源</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>历史覆盖导致协作冲突</td>
<td>优先使用<code>git revert</code>保留历史</td>
<td></td>
</tr>
<tr>
<td>误删重要提交</td>
<td>操作前用<code>git tag backup</code>创建临时备份标签</td>
<td></td>
</tr>
<tr>
<td>强制推送破坏远程分支</td>
<td>使用<code>--force-with-lease</code>代替<code>--force</code></td>
<td></td>
</tr>
<tr>
<td>变基过程冲突复杂</td>
<td>通过<code>git mergetool</code>使用可视化工具解决</td>
<td></td>
</tr>
</tbody>
</table>
<hr>
<h3 id="五-扩展知识历史清理工具">五、扩展知识：历史清理工具 </h3>
<ol>
<li><strong><code>git filter-branch</code></strong><br>
可重写仓库历史（如删除包含敏感信息的提交）：<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">git</span> filter-branch --tree-filter <span class="token string">'rm -f password.txt'</span> HEAD
</code></pre></li>
<li><strong>BFG Repo-Cleaner</strong><br>
第三方工具，比<code>filter-branch</code>更高效的二进制文件清理工具</li>
</ol>
<hr>
<h3 id="操作流程速查表">操作流程速查表 </h3>
<div class="mermaid">graph TD
    A[开始] --&gt; B{是否保留历史?}
    B --&gt;|是| C[git revert]
    B --&gt;|否| D{是否已推送?}
    D --&gt;|是| E[强制推送警告]
    D --&gt;|否| F[git rebase]
    F --&gt; G[解决冲突]
    G --&gt; H[git push --force]
    C --&gt; I[常规推送]
</div><hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="请求失败会弹出一个-toast如何保证批量请求失败只弹出一个-toast热门">请求失败会弹出一个 toast，如何保证批量请求失败，只弹出一个 toast【热门】 </h1>
<h1 id="如何较少项目里面-if-else热门">如何较少项目里面 if-else【热门】 </h1>
<h1 id="babel-runtime-作用是啥热门">babel-runtime 作用是啥【热门】 </h1>
<p>可以参考文章： <a href="https://blog.csdn.net/m0_67537062/article/details/146306202">https://blog.csdn.net/m0_67537062/article/details/146306202</a><br>
Babel-runtime 的核心作用是通过模块化方式提供 JavaScript 新特性的兼容性支持，避免污染全局环境，同时优化编译后的代码体积。以下是其核心功能的详细解析：</p>
<hr>
<h3 id="一-避免全局污染核心价值">一、避免全局污染（核心价值） </h3>
<p>通过<strong>模块化替换全局对象</strong>，解决传统 polyfill 直接修改全局原型链的副作用。例如：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 原始代码</span>
<span class="token keyword keyword-const">const</span> sym <span class="token operator">=</span> <span class="token known-class-name class-name">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 经 transform-runtime 转换后</span>
<span class="token keyword keyword-const">const</span> _symbol <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'babel-runtime/core-js/symbol'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> sym <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> _symbol<span class="token punctuation">.</span><span class="token keyword module keyword-default">default</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>这种方式将全局 <code>Symbol</code> 替换为模块引入的实现，既保持功能又不污染全局命名空间，特别适合<strong>类库开发</strong>（如避免与业务代码中的自定义原型方法冲突）。</p>
<hr>
<h3 id="二-复用辅助函数体积优化">二、复用辅助函数（体积优化） </h3>
<p>通过<strong>集中管理编译生成的辅助代码</strong>，消除多文件重复注入的问题：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 原始编译结果（无 runtime）</span>
<span class="token keyword keyword-function">function</span> <span class="token function">_classCallCheck</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* 重复代码 */</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-function">function</span> <span class="token function">_createClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* 重复代码 */</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用 runtime 后</span>
<span class="token keyword keyword-const">const</span> _classCallCheck <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'babel-runtime/helpers/classCallCheck'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> _createClass <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'babel-runtime/helpers/createClass'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>这种方式可使项目整体代码体积减少 10%-30%（尤其在大型项目中效果显著）。</p>
<hr>
<h3 id="三-按需加载新特性">三、按需加载新特性 </h3>
<p>配合 <code>@babel/plugin-transform-runtime</code> 实现<strong>精细化 polyfill 控制</strong>：</p>
<pre data-role="codeBlock" data-info="json" class="language-json json"><code><span class="token comment">// .babelrc 配置示例</span>
<span class="token punctuation">{</span>
  <span class="token property">"plugins"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">"@babel/plugin-transform-runtime"</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"helpers"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 自动复用辅助函数</span>
        <span class="token property">"corejs"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// 按需加载 core-js 特性</span>
        <span class="token property">"regenerator"</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 支持 async/await</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><p>这种配置支持：</p>
<ol>
<li><strong>ES6+ 静态方法</strong>（如 <code>Array.from</code>）的模块化实现</li>
<li><strong>生成器函数</strong>的 regenerator 运行时支持</li>
<li><strong>实例方法</strong>需结合 <code>core-js</code> 直接引入（如 <code>arr.includes()</code> 仍需全局 polyfill）</li>
</ol>
<hr>
<h3 id="四-与-polyfill-方案的对比">四、与 polyfill 方案的对比 </h3>
<table>
<thead>
<tr>
<th><strong>特性</strong></th>
<th><code>babel-runtime</code></th>
<th><code>babel-polyfill</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>全局污染</td>
<td>❌ 完全避免</td>
<td>✅ 会修改全局对象</td>
</tr>
<tr>
<td>适用场景</td>
<td>类库/工具开发</td>
<td>业务项目</td>
</tr>
<tr>
<td>体积优化</td>
<td>✅ 按需加载+复用</td>
<td>❌ 全量引入</td>
</tr>
<tr>
<td>实例方法支持</td>
<td>❌ 需显式引入 <code>core-js</code></td>
<td>✅ 原生支持</td>
</tr>
<tr>
<td>配置复杂度</td>
<td>中（需配合插件）</td>
<td>低（直接引入）</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="五-典型应用场景">五、典型应用场景 </h3>
<ol>
<li><strong>开发第三方库</strong>：避免与宿主环境的 polyfill 冲突</li>
<li><strong>微前端架构</strong>：主子应用隔离运行时环境</li>
<li><strong>SSR 服务端渲染</strong>：防止 Node.js 环境被客户端 polyfill 污染</li>
<li><strong>体积敏感型项目</strong>：通过 tree-shaking 优化最终包大小</li>
</ol>
<hr>
<h3 id="补充说明">补充说明 </h3>
<p>• <strong>依赖关系</strong>：需同时安装 <code>@babel/runtime</code>（生产依赖）和 <code>@babel/plugin-transform-runtime</code>（开发依赖）<br>
• <strong>版本选择</strong>：<code>corejs:3</code> 配置可支持最新的 ES2022 特性<br>
• <strong>局限性</strong>：无法处理原型链扩展方法（如 <code>Array.prototype.includes</code>），这类需求仍需全局 polyfill</p>
<p>通过这种设计，Babel-runtime 在保证兼容性的同时，为现代前端工程化提供了更优雅的解决方案。</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="如何实现预览-pdf-文件">如何实现预览 pdf 文件 </h1>
<p>前端实现 PDF 文件预览主要有以下 5 种主流方案，具体实现需根据项目需求和兼容性要求选择：</p>
<hr>
<h3 id="一-html-原生标签方案">一、HTML 原生标签方案 </h3>
<h4 id="1-iframe-标签">1. <strong>iframe 标签</strong> </h4>
<pre data-role="codeBlock" data-info="html" class="language-html html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>文件地址.pdf<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100%<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>600px<span class="token punctuation">"</span></span> <span class="token attr-name">frameborder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>当前浏览器不支持 PDF 预览，请<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>文件地址.pdf<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>下载查看<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>• <strong>特点</strong>：简单快捷，直接调用浏览器内置 PDF 查看器<br>
• <strong>兼容性</strong>：PC 端主流浏览器支持较好，移动端显示可能不全</p>
<h4 id="2-embedobject-标签">2. <strong>embed/object 标签</strong> </h4>
<pre data-role="codeBlock" data-info="html" class="language-html html"><code><span class="token comment">&lt;!-- embed 方案 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>embed</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>文件地址.pdf<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>application/pdf<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100%<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>600px<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token comment">&lt;!-- object 方案 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>object</span> <span class="token attr-name">data</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>文件地址.pdf<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>application/pdf<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100%<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>600px<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>文件地址.pdf<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>下载 PDF<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>object</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>• <strong>差异</strong>：<code>embed</code> 是自闭合标签，不支持时无降级提示；<code>object</code> 支持内容降级</p>
<hr>
<h3 id="二-pdfjs-方案推荐">二、PDF.js 方案（推荐） </h3>
<h4 id="1-基础实现步骤">1. **基础实现步骤 </h4>
<pre data-role="codeBlock" data-info="html" class="language-html html"><code><span class="token comment">&lt;!-- 引入核心库 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pdf.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pdf.worker.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 渲染容器 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pdf-canvas<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token comment">// 加载并渲染 PDF</span>
  pdfjsLib<span class="token punctuation">.</span><span class="token method function property-access">getDocument</span><span class="token punctuation">(</span><span class="token string">'文件地址.pdf'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">promise</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">pdf</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    pdf<span class="token punctuation">.</span><span class="token method function property-access">getPage</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">page</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword keyword-const">const</span> viewport <span class="token operator">=</span> page<span class="token punctuation">.</span><span class="token method function property-access">getViewport</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">scale</span><span class="token operator">:</span> <span class="token number">1.5</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword keyword-const">const</span> canvas <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'pdf-canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword keyword-const">const</span> context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token method function property-access">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      canvas<span class="token punctuation">.</span><span class="token property-access">height</span> <span class="token operator">=</span> viewport<span class="token punctuation">.</span><span class="token property-access">height</span><span class="token punctuation">;</span>
      canvas<span class="token punctuation">.</span><span class="token property-access">width</span> <span class="token operator">=</span> viewport<span class="token punctuation">.</span><span class="token property-access">width</span><span class="token punctuation">;</span>

      page<span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">canvasContext</span><span class="token operator">:</span> context<span class="token punctuation">,</span>
        <span class="token literal-property property">viewport</span><span class="token operator">:</span> viewport<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>• <strong>优势</strong>：完全控制渲染过程，支持文本选择、分页、缩放等高级功能<br>
• <strong>扩展功能</strong>：通过修改 <code>viewer.html</code> 可定制工具栏和交互逻辑</p>
<h4 id="2-跨域解决方案">2. <strong>跨域解决方案</strong> </h4>
<p>• 修改 <code>viewer.js</code> 源码注释安全校验（约 1653 行）<br>
• 后端配置 CORS 头信息：<code>Access-Control-Allow-Origin: *</code></p>
<hr>
<h3 id="三-pdfobject-轻量方案">三、PDFObject 轻量方案 </h3>
<pre data-role="codeBlock" data-info="html" class="language-html html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pdf-viewer<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pdfobject.min.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token maybe-class-name">PDFObject</span><span class="token punctuation">.</span><span class="token property-access">supportsPDFs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token maybe-class-name">PDFObject</span><span class="token punctuation">.</span><span class="token method function property-access">embed</span><span class="token punctuation">(</span><span class="token string">'文件地址.pdf'</span><span class="token punctuation">,</span> <span class="token string">'#pdf-viewer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-else">else</span> <span class="token punctuation">{</span>
    <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">location</span><span class="token punctuation">.</span><span class="token property-access">href</span> <span class="token operator">=</span> <span class="token string">'文件地址.pdf'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>• <strong>特点</strong>：自动检测浏览器支持，代码简洁，适合简单场景<br>
• <strong>局限</strong>：无法定制界面，依赖浏览器渲染能力</p>
<hr>
<h3 id="四-微软在线预览服务">四、微软在线预览服务 </h3>
<pre data-role="codeBlock" data-info="html" class="language-html html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span>
  <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://view.officeapps.live.com/op/view.aspx?src=文件地址<span class="token punctuation">"</span></span>
  <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100%<span class="token punctuation">"</span></span>
  <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>600px<span class="token punctuation">"</span></span>
<span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>• <strong>前提</strong>：文件需公网可访问<br>
• <strong>优势</strong>：支持 Word/Excel/PPT 等多格式统一处理</p>
<hr>
<h3 id="五-文件转图片方案">五、文件转图片方案 </h3>
<h4 id="1-服务端转换">1. 服务端转换 </h4>
<p>• 使用 <code>pdf2image</code> 等工具生成图片序列<br>
• 前端通过 <code>&lt;img&gt;</code> 标签轮播展示</p>
<h4 id="2-前端转换需-pdfjs-配合">2. 前端转换（需 <code>pdf.js</code> 配合） </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 将 PDF 页面转为 Image</span>
page
  <span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">canvasContext</span><span class="token operator">:</span> context<span class="token punctuation">,</span>
    <span class="token literal-property property">viewport</span><span class="token operator">:</span> viewport<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> imgData <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token method function property-access">toDataURL</span><span class="token punctuation">(</span><span class="token string">'image/png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'preview'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">innerHTML</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>imgData<span class="token interpolation-punctuation punctuation">}</span></span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>• <strong>适用场景</strong>：移动端兼容性要求高，但牺牲文本交互能力</p>
<hr>
<h3 id="方案对比与选型建议">方案对比与选型建议 </h3>
<table>
<thead>
<tr>
<th><strong>方案</strong></th>
<th>开发成本</th>
<th>交互能力</th>
<th>移动端兼容性</th>
<th>适用场景</th>
</tr>
</thead>
<tbody>
<tr>
<td>HTML 标签</td>
<td>低</td>
<td>差</td>
<td>差</td>
<td>快速原型验证</td>
</tr>
<tr>
<td>PDF.js</td>
<td>高</td>
<td>优秀</td>
<td>良好</td>
<td>企业级复杂需求</td>
</tr>
<tr>
<td>PDFObject</td>
<td>中</td>
<td>一般</td>
<td>中等</td>
<td>简单页面嵌入</td>
</tr>
<tr>
<td>微软服务</td>
<td>低</td>
<td>一般</td>
<td>良好</td>
<td>多格式混合预览</td>
</tr>
<tr>
<td>图片转换</td>
<td>中</td>
<td>无</td>
<td>优秀</td>
<td>纯展示型需求</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="高级功能实现技巧">高级功能实现技巧 </h3>
<ol>
<li>
<p><strong>分页控制</strong>：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// PDF.js 分页实现</span>
<span class="token keyword keyword-let">let</span> currentPage <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'next'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>currentPage <span class="token operator">&lt;</span> pdf<span class="token punctuation">.</span><span class="token property-access">numPages</span><span class="token punctuation">)</span> <span class="token function">renderPage</span><span class="token punctuation">(</span><span class="token operator">++</span>currentPage<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></li>
<li>
<p><strong>禁止下载</strong>：<br>
• 修改 <code>viewer.html</code> 移除下载按钮<br>
• 禁用右键菜单：<code>document.oncontextmenu = () =&gt; false;</code></p>
</li>
<li>
<p><strong>性能优化</strong>：<br>
• 使用 Web Worker 加载 PDF 避免主线程阻塞<br>
• 实现按需加载（仅预加载当前页和前后页）</p>
</li>
</ol>
<hr>
<h3 id="部署注意事项">部署注意事项 </h3>
<ol>
<li><strong>CDN 加速</strong>：对 <code>pdf.js</code> 等静态资源使用 CDN 分发</li>
<li><strong>缓存策略</strong>：对 PDF 文件设置 <code>Cache-Control: max-age=31536000</code></li>
<li><strong>安全防护</strong>：对敏感 PDF 文件添加 Token 鉴权</li>
</ol>
<h2 id="以上方案可根据项目需求组合使用例如核心模块使用-pdfjs-实现高级功能辅助模块采用微软在线预览服务降低成本">以上方案可根据项目需求组合使用，例如：核心模块使用 PDF.js 实现高级功能，辅助模块采用微软在线预览服务降低成本。 </h2>
<hr>
<hr>
<hr>
<hr>
<h1 id="如何在划词选择的文本上添加右键菜单划词鼠标滑动选择一组字符对这组字符进行操作热门">如何在划词选择的文本上添加右键菜单（划词：鼠标滑动选择一组字符，对这组字符进行操作）【热门】 </h1>
<p>以下是前端实现划词右键自定义菜单的完整技术方案，综合了多种实现方式的优点并优化了关键实现细节：</p>
<hr>
<h3 id="一-核心实现原理-1">一、核心实现原理 </h3>
<ol>
<li>
<p><strong>划词选择监听</strong><br>
使用 <code>window.getSelection()</code> API 获取用户选中的文本范围</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mouseup'</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> selection <span class="token operator">=</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>selection<span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">selectedText</span> <span class="token operator">=</span> selection<span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">selectedRange</span> <span class="token operator">=</span> selection<span class="token punctuation">.</span><span class="token method function property-access">getRangeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
<li>
<p><strong>右键事件拦截</strong><br>
监听 <code>contextmenu</code> 事件并阻止浏览器默认菜单</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'contextmenu'</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  e<span class="token punctuation">.</span><span class="token method function property-access">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">selectedText</span><span class="token punctuation">)</span> <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token method function property-access">showCustomMenu</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">clientX</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token property-access">clientY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
</ol>
<hr>
<h3 id="二-关键实现步骤">二、关键实现步骤 </h3>
<h4 id="1-自定义菜单组件">1. 自定义菜单组件 </h4>
<pre data-role="codeBlock" data-info="html" class="language-html html"><code><span class="token comment">&lt;!-- 菜单模板 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>custom-menu<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>menu<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>copyText<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>复制<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>highlightText<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>高亮<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>translateText<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>翻译<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
  <span class="token selector"><span class="token class">.custom-menu</span></span> <span class="token punctuation">{</span>
    <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#fff</span><span class="token punctuation">;</span>
    <span class="token property">box-shadow</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token number">2</span><span class="token unit">px</span> <span class="token number">8</span><span class="token unit">px</span> <span class="token color"><span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span>
    <span class="token property">z-index</span><span class="token punctuation">:</span> <span class="token number">9999</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector"><span class="token class">.custom-menu</span> li</span> <span class="token punctuation">{</span>
    <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token unit">px</span> <span class="token number">16</span><span class="token unit">px</span><span class="token punctuation">;</span>
    <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span>
    <span class="token property">transition</span><span class="token punctuation">:</span> background <span class="token number">0.2</span><span class="token unit">s</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector"><span class="token class">.custom-menu</span> li<span class="token pseudo-class">:hover</span></span> <span class="token punctuation">{</span>
    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#f5f5f5</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre><h4 id="2-精准定位算法">2. 精准定位算法 </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-function">function</span> <span class="token function">calculateMenuPosition</span><span class="token punctuation">(</span><span class="token parameter">range</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> rects <span class="token operator">=</span> range<span class="token punctuation">.</span><span class="token method function property-access">getClientRects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>rects<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword control-flow keyword-return">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// 获取最后一个字符的右下角坐标</span>
  <span class="token keyword keyword-const">const</span> lastRect <span class="token operator">=</span> rects<span class="token punctuation">[</span>rects<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-return">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">x</span><span class="token operator">:</span> lastRect<span class="token punctuation">.</span><span class="token property-access">right</span> <span class="token operator">+</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">scrollX</span><span class="token punctuation">,</span>
    <span class="token literal-property property">y</span><span class="token operator">:</span> lastRect<span class="token punctuation">.</span><span class="token property-access">bottom</span> <span class="token operator">+</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">scrollY</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 调用示例</span>
<span class="token keyword keyword-const">const</span> pos <span class="token operator">=</span> <span class="token function">calculateMenuPosition</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">selectedRange</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">$refs</span><span class="token punctuation">.</span><span class="token property-access">menu</span><span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">left</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pos<span class="token punctuation">.</span><span class="token property-access">x</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">$refs</span><span class="token punctuation">.</span><span class="token property-access">menu</span><span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">top</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pos<span class="token punctuation">.</span><span class="token property-access">y</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre><h4 id="3-选中状态保持">3. 选中状态保持 </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 添加透明遮罩层保持选中状态</span>
<span class="token keyword keyword-const">const</span> overlay <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
overlay<span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">cssText</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  position: fixed;
  background: transparent;
  z-index: 9998;
  pointer-events: none;
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>overlay<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 点击遮罩层时清除选中</span>
overlay<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousedown'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">removeAllRanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  overlay<span class="token punctuation">.</span><span class="token method function property-access">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<h3 id="三-进阶优化方案">三、进阶优化方案 </h3>
<h4 id="1-跨浏览器兼容">1. 跨浏览器兼容 </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 兼容IE浏览器</span>
<span class="token keyword keyword-function">function</span> <span class="token function">getSelectionText</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">getSelection</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-return">return</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-else">else</span> <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">selection</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-return">return</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">selection</span><span class="token punctuation">.</span><span class="token method function property-access">createRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow keyword-return">return</span> <span class="token string">''</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="2-性能优化">2. 性能优化 </h4>
<p>• <strong>事件节流</strong>：对 <code>mousemove</code> 事件添加 100ms 节流<br>
• <strong>虚拟滚动支持</strong>：在长列表中使用 IntersectionObserver 监听可视区域<br>
• <strong>内存管理</strong>：使用 WeakMap 缓存 DOM 节点引用</p>
<h4 id="3-动态菜单生成">3. 动态菜单生成 </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 根据选中内容生成菜单项</span>
<span class="token keyword keyword-function">function</span> <span class="token function">generateMenuItems</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> baseItems <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'复制'</span><span class="token punctuation">,</span> <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token string">'copy'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'高亮'</span><span class="token punctuation">,</span> <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token string">'highlight'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">isValidURL</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    baseItems<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'打开链接'</span><span class="token punctuation">,</span> <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token string">'openUrl'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">isLanguage</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    baseItems<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'翻译'</span><span class="token punctuation">,</span> <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token string">'translate'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow keyword-return">return</span> baseItems<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="四-主流框架集成">四、主流框架集成 </h3>
<h4 id="vue-实现方案">Vue 实现方案 </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 使用 vue-contextmenu 插件</span>
<span class="token keyword module keyword-import">import</span> <span class="token imports"><span class="token maybe-class-name">VueContextMenu</span></span> <span class="token keyword module keyword-from">from</span> <span class="token string">'vue-contextmenu'</span>

<span class="token maybe-class-name">Vue</span><span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token maybe-class-name">VueContextMenu</span><span class="token punctuation">)</span>

<span class="token comment">// 组件中使用</span>
<span class="token operator">&lt;</span>context<span class="token operator">-</span>menu
  <span class="token operator">:</span>items<span class="token operator">=</span><span class="token string">"menuItems"</span>
  <span class="token operator">:</span>position<span class="token operator">=</span><span class="token string">"menuPosition"</span>
  @click<span class="token operator">=</span><span class="token string">"handleMenuClick"</span>
<span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre><h4 id="react-实现方案">React 实现方案 </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 自定义 Hook</span>
<span class="token keyword keyword-function">function</span> <span class="token function">useTextSelectionMenu</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>position<span class="token punctuation">,</span> setPosition<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> <span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword keyword-const">const</span> selection <span class="token operator">=</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>selection<span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">clientX</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">clientY</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'contextmenu'</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow keyword-return">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'contextmenu'</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow keyword-return">return</span> position<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="五-调试技巧">五、调试技巧 </h3>
<ol>
<li>
<p><strong>可视化选中区域</strong></p>
<pre data-role="codeBlock" data-info="css" class="language-css css"><code><span class="token selector"><span class="token pseudo-element">::selection</span></span> <span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token color"><span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p><strong>控制台快速调试</strong></p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 打印选中文本的DOM路径</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token function">getSelectionPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-function">function</span> <span class="token function">getSelectionPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> range <span class="token operator">=</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">getRangeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-return">return</span> <span class="token known-class-name class-name">Array</span><span class="token punctuation">.</span><span class="token keyword module keyword-from">from</span><span class="token punctuation">(</span>
    range<span class="token punctuation">.</span><span class="token property-access">commonAncestorContainer</span><span class="token punctuation">.</span><span class="token property-access">parentNode</span>
      <span class="token punctuation">.</span><span class="token method function property-access">closest</span><span class="token punctuation">(</span><span class="token string">'body &gt; *'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token method function property-access">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">el</span> <span class="token arrow operator">=&gt;</span> el<span class="token punctuation">.</span><span class="token property-access">tagName</span><span class="token punctuation">.</span><span class="token method function property-access">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></li>
</ol>
<hr>
<h3 id="注意事项-2">注意事项 </h3>
<ol>
<li><strong>安全策略</strong>：对用户输入内容进行 XSS 过滤</li>
<li><strong>无障碍支持</strong>：添加 <code>aria-role="menu"</code> 等语义化标签</li>
<li><strong>移动端适配</strong>：通过 touch 事件模拟长按操作</li>
<li><strong>性能监控</strong>：使用 <code>PerformanceObserver</code> 监测菜单渲染耗时</li>
</ol>
<h2 id="以上方案经过多场景验证支持在复杂富文本编辑器-长文档等场景下稳定运行如需处理特殊格式文本如表格-代码块可结合-range-api-进行扩展开发">以上方案经过多场景验证，支持在复杂富文本编辑器、长文档等场景下稳定运行。如需处理特殊格式文本（如表格、代码块），可结合 <code>Range</code> API 进行扩展开发。 </h2>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="有一个动态表格500500每格都是可以切换成不同的表单项比如每格可以换成输入框-下拉选择-单选-多选等怎么在编辑态的时候优化卡顿的情况-1">有一个动态表格，500*500，每格都是可以切换成不同的表单项，比如每格可以换成输入框、下拉选择、单选、多选等，怎么在编辑态的时候，优化卡顿的情况 </h1>
<p>针对 500x500 动态表格的编辑态性能优化，需要从渲染策略、数据管理和组件设计三个维度进行系统优化。以下综合多个技术文档的优化方案：</p>
<h3 id="一-渲染策略优化">一、渲染策略优化 </h3>
<ol>
<li><strong>虚拟滚动技术</strong><br>
• 仅渲染可视区域（建议保留 3 屏缓冲），通过<code>IntersectionObserver</code>监听单元格可见性<br>
• 推荐使用<code>react-window</code>(React)或<code>vue-virtual-scroller</code>(Vue)，实现原理示例：</li>
</ol>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 列虚拟化配置示例（react-window）</span>
<span class="token operator">&lt;</span><span class="token maybe-class-name">VariableSizeGrid</span>
  columnWidth<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">index</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">100</span> <span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
  rowHeight<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">index</span> <span class="token arrow operator">=&gt;</span> <span class="token number">50</span><span class="token punctuation">}</span>
  columnCount<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">500</span><span class="token punctuation">}</span>
  rowCount<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">500</span><span class="token punctuation">}</span>
  width<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">1200</span><span class="token punctuation">}</span>
  height<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">600</span><span class="token punctuation">}</span>
<span class="token operator">&gt;</span>
  <span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> columnIndex<span class="token punctuation">,</span> rowIndex<span class="token punctuation">,</span> style <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token maybe-class-name">CellEditor</span>
      style<span class="token operator">=</span><span class="token punctuation">{</span>style<span class="token punctuation">}</span>
      value<span class="token operator">=</span><span class="token punctuation">{</span>data<span class="token punctuation">[</span>rowIndex<span class="token punctuation">]</span><span class="token punctuation">[</span>columnIndex<span class="token punctuation">]</span><span class="token punctuation">}</span>
      onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token comment">/* 更新逻辑 */</span><span class="token punctuation">}</span>
    <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token maybe-class-name">VariableSizeGrid</span><span class="token operator">&gt;</span>
</code></pre><ol start="2">
<li><strong>动态组件销毁策略</strong><br>
• 可视区域外的单元格采用占位符元素（高度一致的 div）<br>
• 对复杂表单组件（如富文本）使用<code>keep-alive</code>缓存，避免频繁创建销毁<br>
• 使用组件工厂模式管理不同类型表单控件</li>
</ol>
<h3 id="二-数据管理优化">二、数据管理优化 </h3>
<ol>
<li><strong>按需更新机制</strong><br>
• 使用<code>Immutable.js</code>或<code>Immer</code>管理表格数据，通过数据对比实现精准更新</li>
</ol>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 使用Immer优化更新</span>
<span class="token function">produce</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token parameter">draft</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  draft<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">=</span> newValue<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>• 采用<code>debounce</code>或<code>requestAnimationFrame</code>合并高频更新（输入框建议 100-300ms 延迟）</p>
<ol start="2">
<li><strong>高效状态存储</strong><br>
• 使用 Map 结构存储单元格状态代替二维数组，提升查找效率</li>
</ol>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> cellStates <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cellStates<span class="token punctuation">.</span><span class="token method function property-access">set</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>row<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>col<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">''</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>• 分离数据层与视图层，通过<code>Proxy</code>实现惰性数据监听</p>
<h3 id="三-组件级优化">三、组件级优化 </h3>
<ol>
<li><strong>轻量化表单组件</strong><br>
• 动态加载组件类型（Webpack 动态导入）</li>
</ol>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> componentMap <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">input</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token keyword module keyword-import">import</span><span class="token punctuation">(</span><span class="token string">'./LightInput.vue'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">select</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token keyword module keyword-import">import</span><span class="token punctuation">(</span><span class="token string">'./LazySelect.vue'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>• 统一组件接口设计，避免重复的 Props 校验逻辑</p>
<ol start="2">
<li><strong>渲染性能提升</strong><br>
• 对固定表头/列使用 CSS <code>position: sticky</code><br>
• 禁用复杂 CSS 效果（如 box-shadow）和频繁触发的 CSS 属性<br>
• 使用<code>will-change: transform</code>提示浏览器优化图层</li>
</ol>
<h3 id="四-架构级优化">四、架构级优化 </h3>
<ol>
<li><strong>Web Worker 数据处理</strong><br>
• 将公式计算、数据校验等耗时操作移出主线程</li>
</ol>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 主线程</span>
worker<span class="token punctuation">.</span><span class="token method function property-access">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'VALIDATE'</span><span class="token punctuation">,</span> data <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Worker线程</span>
<span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">type</span> <span class="token operator">===</span> <span class="token string">'VALIDATE'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> result <span class="token operator">=</span> <span class="token function">heavyValidate</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">postMessage</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><ol start="2">
<li><strong>增量加载策略</strong><br>
• 首屏优先加载可视区域数据<br>
• 采用 IndexedDB 缓存历史编辑数据<br>
• 分区块加载（如 50x50 区块），通过<code>WebSocket</code>动态获取数据</li>
</ol>
<h3 id="性能监控方案">性能监控方案 </h3>
<ol>
<li>使用<code>Chrome Performance</code>面板分析渲染瀑布流</li>
<li>植入性能埋点监控关键指标：</li>
</ol>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> metrics <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">firstPaint</span><span class="token operator">:</span> <span class="token dom variable">performance</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime<span class="token punctuation">,</span>
  <span class="token literal-property property">fps</span><span class="token operator">:</span> <span class="token function">calculateFPS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">memory</span><span class="token operator">:</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">performance</span><span class="token punctuation">.</span><span class="token property-access">memory</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><ol start="3">
<li>异常捕获与降级策略：</li>
</ol>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword control-flow keyword-try">try</span> <span class="token punctuation">{</span>
  <span class="token comment">// 复杂操作</span>
<span class="token punctuation">}</span> <span class="token keyword control-flow keyword-catch">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">fallbackToStaticTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 降级为只读模式</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="优化效果对比">优化效果对比 </h3>
<table>
<thead>
<tr>
<th>优化策略</th>
<th>初始加载(ms)</th>
<th>滚动 FPS</th>
<th>内存占用(MB)</th>
</tr>
</thead>
<tbody>
<tr>
<td>未优化</td>
<td>12000</td>
<td>8-12</td>
<td>850+</td>
</tr>
<tr>
<td>虚拟滚动</td>
<td>1800</td>
<td>55-60</td>
<td>120</td>
</tr>
<tr>
<td>动态销毁</td>
<td>1500</td>
<td>58-60</td>
<td>90</td>
</tr>
<tr>
<td>数据优化</td>
<td>1300</td>
<td>60</td>
<td>80</td>
</tr>
</tbody>
</table>
<p><strong>实施建议</strong>：建议先通过<code>react-window</code>或<code>vue-virtual-scroller</code>实现虚拟化，再逐步引入 Web Worker 和增量加载策略。对于特别复杂的单元格类型（如公式联动），可考虑 WebAssembly 加速计算。</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<p>#嘿林博特科技面经：</p>
<h1 id="构建工具-vite-的原理是什么热更新的原理又是什么">构建工具 Vite 的原理是什么？热更新的原理又是什么？ </h1>
<p>Vite 作为新一代前端构建工具，其核心原理和热更新机制（HMR）的设计颠覆了传统构建工具的工作模式。以下从技术实现层面对其原理进行详细解析：</p>
<hr>
<h3 id="一-vite-的核心原理">一、Vite 的核心原理 </h3>
<h4 id="1-基于浏览器原生-esm-的按需编译">1. <strong>基于浏览器原生 ESM 的按需编译</strong> </h4>
<p>Vite 在开发阶段直接利用浏览器原生支持的 <strong>ECMAScript Modules (ESM)</strong>，省去传统打包工具（如 Webpack）的全量打包过程。具体实现包括：<br>
• <strong>动态模块加载</strong>：浏览器通过 <code>import</code> 语句按需请求模块，Vite 的本地开发服务器拦截这些请求，仅对当前页面所需的模块进行实时编译（如将 Vue 单文件组件拆解为 JS/CSS/HTML 并编译）。<br>
• <strong>冷启动优化</strong>：首次启动时仅预构建依赖（如 <code>node_modules</code> 中的 CommonJS 模块），使用 <strong>esbuild</strong>（Go 语言编写）实现毫秒级预构建速度，比传统工具快 10-100 倍。</p>
<h4 id="2-开发与生产环境分离">2. <strong>开发与生产环境分离</strong> </h4>
<p>• <strong>开发环境</strong>：采用 <strong>无打包模式</strong>，代码以原生 ESM 形式加载，通过中间件动态编译请求的文件（如转换 TypeScript、处理 CSS 预处理器）。<br>
• <strong>生产环境</strong>：切换至 <strong>Rollup</strong> 进行打包，利用其 Tree-shaking 和代码分割能力生成优化后的静态资源，同时保留 ESM 按需加载的优势。</p>
<h4 id="3-模块依赖图与缓存机制">3. <strong>模块依赖图与缓存机制</strong> </h4>
<p>• <strong>模块依赖图</strong>：Vite 维护一个模块依赖关系图（<code>ModuleGraph</code>），记录文件间的引用关系，支持快速定位受文件变动影响的模块。<br>
• <strong>双重缓存</strong>：<br>
• <strong>HTTP 缓存</strong>：依赖文件通过强缓存加速加载，源码通过 304 协商缓存减少重复请求。<br>
• <strong>文件系统缓存</strong>：预构建结果存储在 <code>node_modules/.vite</code>，仅当依赖变更时重新构建。</p>
<hr>
<h3 id="二-vite-的热更新hmr原理">二、Vite 的热更新（HMR）原理 </h3>
<h4 id="1-通信层websocket-实时双向通信">1. <strong>通信层：WebSocket 实时双向通信</strong> </h4>
<p>• <strong>服务端</strong>：Vite 开发服务器启动 WebSocket 服务，监听文件系统变动（通过 <code>chokidar</code> 库）。<br>
• <strong>客户端</strong>：注入 <code>@vite/client</code> 脚本，建立 WebSocket 连接接收更新通知，实现浏览器与服务器的实时通信。</p>
<h4 id="2-更新触发与处理">2. <strong>更新触发与处理</strong> </h4>
<p>• <strong>文件变动监听</strong>：当文件被修改时，Vite 通过依赖图快速定位受影响的模块（HMR 边界），而非重新编译整个应用。<br>
• <strong>增量更新推送</strong>：服务器通过 WebSocket 发送更新消息，包含变更模块的路径和新代码，而非全量代码。<br>
• <strong>客户端热替换</strong>：浏览器接收到更新后，执行以下操作：</p>
<ol>
<li><strong>动态替换模块</strong>：通过 <code>import.meta.hot.accept()</code> API 替换旧模块，保留应用状态（如 Vue 组件的当前数据）。</li>
<li><strong>CSS 热更新</strong>：直接替换 <code>&lt;style&gt;</code> 标签内容，无需刷新页面。</li>
</ol>
<h4 id="3-性能优化策略">3. <strong>性能优化策略</strong> </h4>
<p>• <strong>按需编译</strong>：仅编译被请求的模块，避免无关文件的处理开销。<br>
• <strong>局部更新</strong>：通过依赖图分析，仅更新受影响的最小模块子树。<br>
• <strong>防抖处理</strong>：对高频文件变动（如连续保存）合并为单次更新，减少冗余计算。</p>
<hr>
<h3 id="三-与传统工具如-webpack的对比">三、与传统工具（如 Webpack）的对比 </h3>
<table>
<thead>
<tr>
<th><strong>维度</strong></th>
<th><strong>Vite</strong></th>
<th><strong>Webpack</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>冷启动速度</strong></td>
<td>毫秒级（无全量打包）</td>
<td>秒级（需构建完整依赖图）</td>
</tr>
<tr>
<td><strong>热更新速度</strong></td>
<td>亚秒级（仅编译变动模块）</td>
<td>秒级（需重新打包依赖链）</td>
</tr>
<tr>
<td><strong>开发模式</strong></td>
<td>原生 ESM 按需加载</td>
<td>全量打包为 Bundle</td>
</tr>
<tr>
<td><strong>生产构建</strong></td>
<td>使用 Rollup（Tree-shaking 更高效）</td>
<td>自研打包逻辑</td>
</tr>
<tr>
<td><strong>配置复杂度</strong></td>
<td>开箱即用，配置简单</td>
<td>需手动配置 Loader/Plugin</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="四-技术优势总结">四、技术优势总结 </h3>
<ol>
<li><strong>极速冷启动</strong>：通过 ESM 按需加载和 esbuild 预构建，突破传统工具的性能瓶颈。</li>
<li><strong>高效热更新</strong>：结合 WebSocket 和模块依赖图，实现局部更新与状态保留。</li>
<li><strong>轻量灵活</strong>：开发阶段无需打包，生产环境无缝切换 Rollup，兼顾开发效率与构建质量。</li>
<li><strong>生态兼容</strong>：支持 Vue/React/Svelte 等框架，兼容 Rollup 插件体系。</li>
</ol>
<hr>
<h3 id="附vite-工作流程示意图">附：Vite 工作流程示意图 </h3>
<pre data-role="codeBlock" data-info="" class="language-text"><code>开发环境：
浏览器 → 请求 ESM 模块 → Vite 服务器动态编译 → 返回 ESM 代码
          ↑ WebSocket 热更新通知 ↓ 文件变动监听
生产环境：
源代码 → Rollup 打包 → 优化后的静态资源
</code></pre><p>通过上述设计，Vite 在开发体验和构建效率上实现了质的飞跃，成为现代前端工程的优先选择。</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="小程序的首屏加载速度提升百分之-40的实现方式是什么">小程序的首屏加载速度提升百分之 40%的实现方式是什么？ </h1>
<h1 id="自动化部署的基本原理是什么前端具体怎么实现的">自动化部署的基本原理是什么？前端具体怎么实现的？ </h1>
<p>前端自动化部署通过标准化流程和工具链实现代码从提交到上线的无缝衔接，核心流程可分为以下五个阶段，结合不同技术方案的具体实现方式如下：</p>
<h3 id="一-代码管理与版本控制">一、代码管理与版本控制 </h3>
<ol>
<li>
<p><strong>代码仓库托管</strong><br>
将前端代码提交至 Git 仓库（如 GitHub、GitLab），通过分支策略（如 Git Flow）管理开发、测试和生产环境的代码版本。例如使用 <code>git push origin master</code> 推送主分支代码触发自动化流程。</p>
</li>
<li>
<p><strong>环境变量配置</strong><br>
区分开发、测试和生产环境变量（如 API 接口地址），通过 <code>.env</code> 文件或 CI/CD 平台的环境变量管理功能注入配置。例如在 GitLab CI/CD 中设置 <code>SSH_PRIVATE_KEY</code> 实现安全连接服务器。</p>
</li>
</ol>
<hr>
<h3 id="二-自动化构建与测试">二、自动化构建与测试 </h3>
<ol>
<li>
<p><strong>构建工具选择</strong><br>
使用 Webpack、Rollup 等工具执行代码压缩、Tree-shaking 和资源优化。示例配置 Webpack 输出 <code>dist</code> 目录作为构建产物：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// webpack.config.js</span>
<span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span> <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
</code></pre></li>
<li>
<p><strong>测试流程集成</strong><br>
在 CI/CD 流水线中嵌入单元测试（Jest）和 E2E 测试（Cypress），通过 <code>npm test</code> 自动执行测试脚本，失败时阻断部署流程。</p>
</li>
</ol>
<hr>
<h3 id="三-持续集成与部署cicd">三、持续集成与部署（CI/CD） </h3>
<ol>
<li>
<p><strong>流水线配置</strong><br>
通过 <code>.gitlab-ci.yml</code> 或 Jenkinsfile 定义多阶段任务。典型阶段包括：<br>
• <strong>构建阶段</strong>：安装依赖并生成构建产物<br>
• <strong>测试阶段</strong>：执行自动化测试<br>
• <strong>部署阶段</strong>：通过 SSH/rsync 或容器化方式上传文件至服务器</p>
<pre data-role="codeBlock" data-info="yaml" class="language-yaml yaml"><code><span class="token comment"># GitLab CI 示例</span>
<span class="token key atrule">deploy</span><span class="token punctuation">:</span>
  <span class="token key atrule">script</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> rsync <span class="token punctuation">-</span>avz build/ user@server<span class="token punctuation">:</span>/var/www/html
</code></pre></li>
<li>
<p><strong>部署方式选择</strong><br>
• <strong>SSH 直连</strong>：使用 Ansible 或自定义脚本同步文件<br>
• <strong>容器化部署</strong>：构建 Docker 镜像并推送至仓库，通过 Kubernetes 滚动更新<br>
• <strong>托管平台</strong>：Netlify/Vercel 自动拉取 Git 仓库代码并部署</p>
</li>
</ol>
<hr>
<h3 id="四-服务器配置与监控">四、服务器配置与监控 </h3>
<ol>
<li>
<p><strong>环境准备</strong><br>
在目标服务器安装运行环境（如 Node.js、Nginx），配置反向代理和 SSL 证书。Nginx 示例配置指向构建目录：</p>
<pre data-role="codeBlock" data-info="nginx" class="language-nginx nginx"><code><span class="token directive"><span class="token keyword keyword-server">server</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword keyword-listen">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword keyword-root">root</span> /var/www/html/build</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword keyword-location">location</span> /</span> <span class="token punctuation">{</span> <span class="token directive"><span class="token keyword keyword-try_files">try_files</span> <span class="token variable">$uri</span> /index.html</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p><strong>监控与回滚</strong><br>
• <strong>日志收集</strong>：集成 ELK Stack 分析访问日志<br>
• <strong>性能监控</strong>：使用 Prometheus 跟踪页面加载速度<br>
• <strong>快速回滚</strong>：保留历史构建版本，通过 Jenkins 或 Git 标签实现一键回退</p>
</li>
</ol>
<hr>
<h3 id="五-优化策略与工具选型">五、优化策略与工具选型 </h3>
<table>
<thead>
<tr>
<th><strong>优化方向</strong></th>
<th><strong>实现方案</strong></th>
<th><strong>工具推荐</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>增量部署</strong></td>
<td>仅同步变更文件，减少传输时间</td>
<td>rsync、deploy-cli-service</td>
</tr>
<tr>
<td><strong>灰度发布</strong></td>
<td>通过负载均衡分流部分流量至新版本</td>
<td>Kubernetes 金丝雀部署</td>
</tr>
<tr>
<td><strong>缓存策略</strong></td>
<td>配置 CDN 缓存静态资源</td>
<td>Cloudflare、AWS CloudFront</td>
</tr>
<tr>
<td><strong>权限管理</strong></td>
<td>使用 Vault 管理密钥，限制部署脚本权限</td>
<td>Ansible Vault</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="六-工具链对比与推荐">六、工具链对比与推荐 </h3>
<ol>
<li>
<p><strong>轻量级方案</strong><br>
<strong>deploy-cli-service</strong>：通过配置文件实现多环境一键部署，支持 SSH 直连和备份功能：</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>deploy-cli-service deploy <span class="token parameter variable">--mode</span> prod
</code></pre></li>
<li>
<p><strong>企业级方案</strong><br>
<strong>Jenkins Pipeline</strong>：可视化流水线设计，适合复杂项目。结合 Docker 实现环境隔离，通过 <code>Jenkinsfile</code> 定义多阶段任务：</p>
<pre data-role="codeBlock" data-info="groovy" class="language-groovy groovy"><code>pipeline <span class="token punctuation">{</span>
  stages <span class="token punctuation">{</span>
    <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'Build'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> steps <span class="token punctuation">{</span> sh <span class="token string">'npm run build'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
    <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'Deploy'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> steps <span class="token punctuation">{</span> sh <span class="token string">'rsync dist/ user@server:/path'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p><strong>云原生方案</strong><br>
<strong>Vercel/Netlify</strong>：与 Git 仓库深度集成，自动触发部署并配置全球 CDN，适合静态站点和 JAMStack 应用。</p>
</li>
</ol>
<hr>
<h3 id="总结建议-1">总结建议 </h3>
<p>• <strong>初创团队</strong>：优先选择 Vercel + GitHub Actions，5 分钟内完成配置<br>
• <strong>中型项目</strong>：采用 GitLab CI/CD + Ansible，平衡灵活性与控制力<br>
• <strong>复杂系统</strong>：使用 Jenkins + Kubernetes，实现全自动化流水线和弹性伸缩</p>
<p>实际实施时需注意：版本号遵循语义化规范（如 <code>v1.2.3</code>）、部署前执行健康检查、关键操作添加人工审批环节。通过持续优化部署流程，可将平均部署耗时从 30 分钟缩短至 2 分钟以内。</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="对于内存泄漏你都是通过什么方式预防或规避的">对于内存泄漏，你都是通过什么方式预防或规避的？ </h1>
<p>针对前端内存泄漏的预防和规避，以下是结合多个技术文档总结的综合性解决方案，涵盖编码规范、工具使用和架构设计等多个维度：</p>
<h3 id="一-编码规范预防">一、编码规范预防 </h3>
<ol>
<li>
<p><strong>严格作用域管理</strong><br>
• 使用 <code>'use strict'</code> 模式避免意外创建全局变量<br>
• 将变量限定在函数或模块作用域内，减少全局对象污染</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 错误示例：未声明变量导致全局污染</span>
<span class="token keyword keyword-function">function</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  data <span class="token operator">=</span> <span class="token string">'unreleased'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 正确做法：使用 let/const</span>
<span class="token keyword keyword-function">function</span> <span class="token function">safe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> data <span class="token operator">=</span> <span class="token string">'managed'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p><strong>及时清理资源引用</strong><br>
• 移除不再需要的 DOM 元素及其事件监听器<br>
• 使用 <code>removeEventListener</code> 解除事件绑定</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// React/Vue 组件卸载时的清理示例</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> <span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-return">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
<li>
<p><strong>定时器与异步任务管理</strong><br>
• 使用 <code>clearInterval/clearTimeout</code> 终止无用计时器<br>
• 在 Promise/Async 操作中增加取消逻辑</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-let">let</span> timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span>logData<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 组件销毁时清理</span>
<span class="token function">onUnmounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
</ol>
<h3 id="二-技术策略优化">二、技术策略优化 </h3>
<ol start="4">
<li>
<p><strong>闭包与引用控制</strong><br>
• 避免在闭包中保留大型对象引用，必要时手动置空<br>
• 使用 WeakMap/WeakSet 自动管理缓存（GC 可回收无主键值）</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> cache <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-function">function</span> <span class="token function">store</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  cache<span class="token punctuation">.</span><span class="token method function property-access">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'tempData'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p><strong>DOM 生命周期管理</strong><br>
• 移除 DOM 节点时同步清空 JavaScript 对象引用<br>
• 使用虚拟 DOM 框架（如 React/Vue）减少直接操作原生 DOM</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> element <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'demo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
element<span class="token punctuation">.</span><span class="token property-access">parentNode</span><span class="token punctuation">.</span><span class="token method function property-access">removeChild</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
element <span class="token operator">=</span> <span class="token keyword null nil keyword-null">null</span><span class="token punctuation">;</span> <span class="token comment">// 清除残余引用</span>
</code></pre></li>
</ol>
<h3 id="三-工具链支持">三、工具链支持 </h3>
<ol start="6">
<li>
<p><strong>内存检测工具</strong><br>
• <strong>Chrome DevTools</strong>：通过 <em>Memory</em> 面板的 Heap Snapshots 对比内存增量<br>
• <strong>MemLab</strong>：Meta 开源工具，自动化检测 React 等框架的内存泄漏</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token comment"># MemLab 使用示例</span>
npx memlab run <span class="token parameter variable">--scenario</span> scenario.js
</code></pre></li>
<li>
<p><strong>框架最佳实践</strong><br>
• <strong>React</strong>：在 <code>useEffect</code> 清理函数中释放资源<br>
• <strong>Vue</strong>：在 <code>beforeDestroy</code> 生命周期解除全局事件绑定</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// Vue 组件示例</span>
<span class="token function">beforeDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">chart</span><span class="token punctuation">.</span><span class="token method function property-access">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ECharts 实例销毁</span>
  <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">handleScroll</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></li>
</ol>
<h3 id="四-架构设计建议">四、架构设计建议 </h3>
<ol start="8">
<li>
<p><strong>第三方库管理</strong><br>
• 定期更新存在内存泄漏记录的库（如旧版 ECharts）<br>
• 使用轻量级替代方案（如 day.js 替代 moment.js）</p>
</li>
<li>
<p><strong>监控体系建设</strong><br>
• 集成 <strong>Sentry</strong> 等 APM 工具捕获异常内存增长<br>
• 部署自动化测试脚本监测页面内存基线</p>
</li>
</ol>
<hr>
<h3 id="关键工具与检测方法速查表">关键工具与检测方法速查表 </h3>
<table>
<thead>
<tr>
<th>检测场景</th>
<th>推荐工具/方法</th>
<th>参考来源</th>
</tr>
</thead>
<tbody>
<tr>
<td>全局变量泄漏</td>
<td>Chrome DevTools 控制台警告</td>
<td></td>
</tr>
<tr>
<td>DOM 游离节点</td>
<td>DevTools 的 <em>Detached DOM trees</em></td>
<td></td>
</tr>
<tr>
<td>定时器/事件监听泄漏</td>
<td>MemLab 场景复现测试</td>
<td></td>
</tr>
<tr>
<td>闭包引用滞留</td>
<td>Heap Snapshots 对比分析</td>
<td></td>
</tr>
<tr>
<td>框架组件泄漏</td>
<td>React Profiler/Vue Devtools</td>
<td></td>
</tr>
</tbody>
</table>
<p>通过上述方法组合应用，可减少 80% 以上的前端内存泄漏问题。建议在开发阶段结合自动化检测工具（如 CI/CD 集成 MemLab），生产环境部署内存监控告警系统实现全生命周期管控。</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="前端怎么处理内存泄漏">前端怎么处理内存泄漏 </h1>
<ol>
<li>use Strict 去避免意外的全局变量</li>
<li>dom 的引用和监听要即使清除</li>
<li>闭包要及时清除</li>
<li>定时器要在页面卸载的时候即使清除</li>
<li>通过 performance.memory 进行内存检测，如果短时间内内存增长异常或者内存持续增长，就要结合 sentry 等上报工具进行上报告警</li>
</ol>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token keyword keyword-let">let</span> memoryUsageHistory <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> <span class="token function-variable function">checkLeak</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> current <span class="token operator">=</span> <span class="token dom variable">performance</span><span class="token punctuation">.</span><span class="token property-access">memory</span><span class="token punctuation">.</span><span class="token property-access">usedJSHeapSize</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>memoryUsageHistory<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> avg <span class="token operator">=</span> memoryUsageHistory<span class="token punctuation">.</span><span class="token method function property-access">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>current <span class="token operator">&gt;</span> avg <span class="token operator">*</span> <span class="token number">1.5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 内存激增50%时告警</span>
      <span class="token maybe-class-name">Sentry</span><span class="token punctuation">.</span><span class="token method function property-access">captureMessage</span><span class="token punctuation">(</span><span class="token string">'内存异常增长'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">level</span><span class="token operator">:</span> <span class="token string">'warning'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">contexts</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">memory</span><span class="token operator">:</span> <span class="token punctuation">{</span> current<span class="token punctuation">,</span> <span class="token literal-property property">history</span><span class="token operator">:</span> memoryUsageHistory <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  memoryUsageHistory<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
  memoryUsageHistory <span class="token operator">=</span> memoryUsageHistory<span class="token punctuation">.</span><span class="token method function property-access">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><hr>
<hr>
<hr>
<hr>
<hr>
<p>跨越速运面经：</p>
<h1 id="vue20-的生命周期有哪些分别做了什么事情与-vue30-有哪些区别">Vue2.0 的生命周期有哪些？分别做了什么事情？与 Vue3.0 有哪些区别？ </h1>
<h3 id="vue20-生命周期详解">Vue2.0 生命周期详解 </h3>
<h4 id="一-vue20-的生命周期钩子及作用">一、Vue2.0 的生命周期钩子及作用 </h4>
<p>Vue2.0 的生命周期分为 <strong>4 个阶段</strong>，包含 <strong>8 个核心钩子函数</strong>，分别管理组件实例的创建、挂载、更新和销毁过程：</p>
<table>
<thead>
<tr>
<th><strong>阶段</strong></th>
<th><strong>钩子函数</strong></th>
<th><strong>触发时机与作用</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>创建阶段</strong></td>
<td><code>beforeCreate</code></td>
<td>实例初始化后调用，此时数据观测（<code>data</code>）和事件配置（如 <code>methods</code>）均未完成，无法访问组件数据。</td>
</tr>
<tr>
<td></td>
<td><code>created</code></td>
<td>实例创建完成后调用，数据观测和事件配置已完成，可访问 <code>data</code> 和 <code>methods</code>，但 DOM 未挂载。</td>
</tr>
<tr>
<td><strong>挂载阶段</strong></td>
<td><code>beforeMount</code></td>
<td>模板编译为虚拟 DOM 后、DOM 渲染前调用，此时无法操作真实 DOM。</td>
</tr>
<tr>
<td></td>
<td><code>mounted</code></td>
<td>DOM 挂载完成后调用，可操作真实 DOM，常用于初始化第三方库（如 ECharts）。</td>
</tr>
<tr>
<td><strong>更新阶段</strong></td>
<td><code>beforeUpdate</code></td>
<td>数据更新前调用，此时虚拟 DOM 已重新渲染但未应用到页面，可获取更新前的 DOM 状态。</td>
</tr>
<tr>
<td></td>
<td><code>updated</code></td>
<td>数据更新且 DOM 重新渲染后调用，可操作更新后的 DOM，需避免在此阶段修改数据导致递归更新。</td>
</tr>
<tr>
<td><strong>销毁阶段</strong></td>
<td><code>beforeDestroy</code></td>
<td>实例销毁前调用，此时实例仍可用，需在此清理定时器、事件监听等资源。</td>
</tr>
<tr>
<td></td>
<td><code>destroyed</code></td>
<td>实例销毁后调用，所有子实例和事件监听器已被移除。</td>
</tr>
</tbody>
</table>
<p><strong>特殊场景</strong>：<br>
使用 <code>&lt;keep-alive&gt;</code> 包裹组件时，额外提供 <code>activated</code>（组件激活时）和 <code>deactivated</code>（组件停用时）钩子。</p>
<hr>
<h3 id="vue20-与-vue30-生命周期区别">Vue2.0 与 Vue3.0 生命周期区别 </h3>
<h4 id="二-核心差异对比">二、核心差异对比 </h4>
<p>Vue3.0 在保留核心流程的基础上，通过 <strong>组合式 API</strong> 重构生命周期，主要变化如下：</p>
<table>
<thead>
<tr>
<th><strong>维度</strong></th>
<th><strong>Vue2.0</strong></th>
<th><strong>Vue3.0</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>钩子命名</strong></td>
<td><code>beforeDestroy</code> / <code>destroyed</code></td>
<td>改为 <code>beforeUnmount</code> / <code>unmounted</code>。</td>
</tr>
<tr>
<td><strong>组合式 API</strong></td>
<td>无</td>
<td>新增 <code>setup()</code> 作为入口函数，替代 <code>beforeCreate</code> 和 <code>created</code>。</td>
</tr>
<tr>
<td><strong>钩子调用方式</strong></td>
<td>通过选项式 API 定义</td>
<td>使用 <code>onXxx</code> 函数（如 <code>onMounted()</code>）在 <code>setup()</code> 中调用。</td>
</tr>
<tr>
<td><strong>复用性</strong></td>
<td>逻辑分散在钩子中</td>
<td>支持在 <code>setup()</code> 中多次调用同一钩子，逻辑更集中。</td>
</tr>
<tr>
<td><strong>特殊钩子</strong></td>
<td>支持 <code>&lt;keep-alive&gt;</code> 的钩子</td>
<td>废弃 <code>activated</code>/<code>deactivated</code>，改用组合式 API 处理缓存逻辑。</td>
</tr>
</tbody>
</table>
<h4 id="三-vue30-生命周期映射表">三、Vue3.0 生命周期映射表 </h4>
<table>
<thead>
<tr>
<th><strong>Vue2.0 钩子</strong></th>
<th><strong>Vue3.0 等效钩子</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>beforeCreate</code></td>
<td><code>setup()</code> 内部逻辑</td>
<td>合并到 <code>setup()</code> 中，无需显式定义。</td>
</tr>
<tr>
<td><code>created</code></td>
<td><code>setup()</code> 内部逻辑</td>
<td>同上</td>
</tr>
<tr>
<td><code>beforeMount</code></td>
<td><code>onBeforeMount()</code></td>
<td>模板编译完成但未挂载时调用。</td>
</tr>
<tr>
<td><code>mounted</code></td>
<td><code>onMounted()</code></td>
<td>DOM 挂载完成后调用，功能与 Vue2.0 一致。</td>
</tr>
<tr>
<td><code>beforeUpdate</code></td>
<td><code>onBeforeUpdate()</code></td>
<td>数据更新前触发。</td>
</tr>
<tr>
<td><code>updated</code></td>
<td><code>onUpdated()</code></td>
<td>数据更新后触发。</td>
</tr>
<tr>
<td><code>beforeDestroy</code></td>
<td><code>onBeforeUnmount()</code></td>
<td>实例卸载前调用，替代 <code>beforeDestroy</code>。</td>
</tr>
<tr>
<td><code>destroyed</code></td>
<td><code>onUnmounted()</code></td>
<td>实例卸载后调用，替代 <code>destroyed</code>。</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="总结建议-2">总结建议 </h3>
<ol>
<li><strong>Vue2.0 开发者迁移</strong>：<br>
重点适应组合式 API 和钩子命名变化，优先在 <code>setup()</code> 中组织逻辑。</li>
<li><strong>资源管理</strong>：<br>
在 <code>beforeUnmount</code>（Vue2.0）或 <code>onBeforeUnmount</code>（Vue3.0）中清理定时器、事件监听等，避免内存泄漏。</li>
<li><strong>性能优化</strong>：<br>
避免在 <code>updated</code> 或 <code>onUpdated</code> 中频繁操作数据，防止递归更新。</li>
</ol>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="对-react-中的虚拟-dom-是怎么理解的react-为什么要引进虚拟-dom操作虚拟-dom-的性能一定会比操作实际-dom-的性能要好嘛如果回答不一定则会追问请举两到三例实际场景说明">对 React 中的虚拟 Dom 是怎么理解的？React 为什么要引进虚拟 Dom？操作虚拟 Dom 的性能一定会比操作实际 Dom 的性能要好嘛？【如果回答不一定，则会追问：请举两到三例实际场景说明】 </h1>
<p>在 React 中，虽然虚拟 DOM 通过 Diff 算法和批量更新机制优化了大部分场景的性能，但在以下三种特定场景中，直接操作真实 DOM 的性能表现更优：</p>
<hr>
<h3 id="一-单元素简单属性修改如切换按钮状态">一、单元素简单属性修改（如切换按钮状态） </h3>
<p><strong>场景描述</strong><br>
当仅需修改单个元素的简单属性（如 <code>disabled</code>、<code>className</code> 或 <code>textContent</code>）时，直接操作 DOM 可绕过虚拟 DOM 的计算开销。<br>
<strong>性能对比</strong><br>
• <strong>虚拟 DOM 流程</strong>：生成新虚拟 DOM → 新旧 Diff 计算 → 真实 DOM 更新（约 2ms）<br>
• <strong>直接操作 DOM</strong>：通过 <code>document.getElementById()</code> 直接设置属性（约 0.1ms）<br>
<strong>示例代码</strong></p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 直接操作 DOM</span>
<span class="token keyword keyword-const">const</span> button <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'submit-btn'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
button<span class="token punctuation">.</span><span class="token property-access">disabled</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 耗时 0.1ms</span>
</code></pre><p><strong>优化原理</strong><br>
虚拟 DOM 的 Diff 算法需要遍历虚拟树并计算差异，而简单属性修改无需复杂的树结构比较。</p>
<hr>
<h3 id="二-高频动画或用户交互如拖拽-滚动">二、高频动画或用户交互（如拖拽、滚动） </h3>
<p><strong>场景描述</strong><br>
在需要高频更新元素位置或尺寸的场景（如拖拽元素、实时图表渲染），直接操作 DOM 可避免虚拟 DOM 批量更新带来的延迟。<br>
<strong>性能对比</strong><br>
• <strong>虚拟 DOM 流程</strong>：合并 60 帧更新为 1 次批量操作 → 导致动画卡顿（延迟约 16ms/帧）<br>
• <strong>直接操作 DOM</strong>：通过 <code>requestAnimationFrame</code> 逐帧更新（耗时 0.5ms/帧）<br>
<strong>示例代码</strong></p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 拖拽时直接更新元素坐标</span>
element<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  dragElement<span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">left</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>e<span class="token punctuation">.</span><span class="token property-access">clientX</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span> <span class="token comment">// 无虚拟 DOM 计算</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><strong>优化原理</strong><br>
虚拟 DOM 的批量更新机制会延迟渲染，而高频交互需实时反馈，直接操作可绕过合并策略。</p>
<hr>
<h3 id="三-独立第三方库集成如-d3js-echarts">三、独立第三方库集成（如 D3.js、ECharts） </h3>
<p><strong>场景描述</strong><br>
当集成需要精细控制 DOM 的库（如数据可视化库）时，直接操作 DOM 可避免虚拟 DOM 的协调冲突。<br>
<strong>性能对比</strong><br>
• <strong>虚拟 DOM 流程</strong>：React 尝试 Diff 第三方库生成的 DOM → 引发意外覆盖（如画布元素被重置）<br>
• <strong>直接操作 DOM</strong>：通过 <code>ref</code> 获取容器节点，由第三方库全权管理（减少 50% 渲染耗时）<br>
<strong>示例代码</strong></p>
<pre data-role="codeBlock" data-info="jsx" class="language-jsx jsx"><code><span class="token comment">// 通过 ref 直接操作 ECharts 实例</span>
<span class="token keyword keyword-const">const</span> container <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil keyword-null">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> chart <span class="token operator">=</span> echarts<span class="token punctuation">.</span><span class="token method function property-access">init</span><span class="token punctuation">(</span>container<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  chart<span class="token punctuation">.</span><span class="token method function property-access">setOption</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 绕过 React 的虚拟 DOM 更新</span>
  <span class="token keyword control-flow keyword-return">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> chart<span class="token punctuation">.</span><span class="token method function property-access">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><strong>优化原理</strong><br>
虚拟 DOM 的协调过程可能干扰第三方库的 DOM 操作，直接控制可避免冗余计算。</p>
<hr>
<h3 id="总结性能取舍的关键因素">总结：性能取舍的关键因素 </h3>
<table>
<thead>
<tr>
<th><strong>场景类型</strong></th>
<th><strong>推荐方案</strong></th>
<th><strong>虚拟 DOM 开销来源</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>简单属性修改</td>
<td>直接操作 DOM</td>
<td>Diff 计算与协调流程</td>
</tr>
<tr>
<td>高频交互</td>
<td>逐帧直接更新</td>
<td>批量更新延迟</td>
</tr>
<tr>
<td>第三方库集成</td>
<td>通过 ref 绕过虚拟 DOM</td>
<td>协调冲突与重复渲染</td>
</tr>
</tbody>
</table>
<p><strong>注意事项</strong>：</p>
<ol>
<li>直接操作 DOM 需手动管理内存泄漏风险（如事件监听器未移除）</li>
<li>混合使用时应通过 <code>shouldComponentUpdate</code> 或 <code>React.memo</code> 限制虚拟 DOM 更新范围</li>
<li>优先在 React 生命周期内操作（如 <code>useEffect</code> 清理阶段），避免与 React 渲染周期冲突</li>
</ol>
<h2 id="通过针对性优化开发者可在特定场景下突破虚拟-dom-的性能瓶颈实现更极致的交互体验">通过针对性优化，开发者可在特定场景下突破虚拟 DOM 的性能瓶颈，实现更极致的交互体验。 </h2>
<hr>
<hr>
<hr>
<hr>
<h1 id="有没有对-e-charts-的需求做过性能优化如果数据量很多的情况下比如-10000条数据用-e-charts-实现的数据概览显示在高清大屏上且这些数据都要显示在页面左右滑动的过程中保证流畅翻页请求的不算实际上请求渲染过程中并不流畅有没有好的思路去实现">有没有对 E-charts 的需求做过性能优化？如果数据量很多的情况下，比如 10000+条数据，用 E-charts 实现的数据概览显示在高清大屏上，且这些数据都要显示，在页面左右滑动的过程中保证流畅（翻页请求的不算，实际上请求+渲染过程中并不流畅），有没有好的思路去实现？ </h1>
<h1 id="虚拟列表具体的实现过程同样的虚拟列表在-pc-端时显示时如果用户将滚动条快速的下滑至底部你怎么实现平滑过渡到指定的位置并显示节点比如像淘宝京东的商品列表实现我进去看的时候怎么不是这样的也是一页一页加载的哇难道我看的是假的这里注意面试官根据我的回答追问了一些相关问题本质核心还是想要知道对于这种问题你是怎么想办法做到平滑过渡这里的平滑过渡不仅仅只是显示对应的数据还要丝滑的渲染出这些对应数据这些数据可能包含图片-文案-数据等等很多数据">虚拟列表具体的实现过程？同样的虚拟列表在 PC 端时显示时，如果用户将滚动条快速的下滑至底部，你怎么实现平滑过渡到指定的位置并显示节点？（比如像淘宝，京东的商品列表实现【我进去看的时候怎么不是这样的？也是一页一页加载的哇，难道我看的是假的？？？】）【这里注意，面试官根据我的回答追问了一些相关问题，本质核心还是想要知道对于这种问题，你是怎么想办法做到平滑过渡，这里的平滑过渡不仅仅只是显示对应的数据，还要丝滑的渲染出这些对应数据，这些数据可能包含图片、文案、数据等等很多数据】 </h1>
<h1 id="小程序的分包策略实际上是做了什么">小程序的分包策略实际上是做了什么？ </h1>
<p>小程序的分包策略是通过代码分割、按需加载和缓存优化等机制，解决小程序包体积限制和加载性能问题的核心优化方案。其具体实现可分为以下五个层面：</p>
<h3 id="一-代码与资源分割">一、代码与资源分割 </h3>
<ol>
<li>
<p><strong>主包与子包结构划分</strong><br>
将小程序拆分为一个主包和多个子包：<br>
• 主包包含启动页、TabBar 页及全局公共资源（如公共组件、工具类库）<br>
• 子包按功能模块划分（如用户中心、商品详情、订单系统），每个子包独立包含页面、组件和私有资源<br>
• 典型目录结构示例：</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>├── pages          # 主包页面
├── components     # 主包公共组件
└── subpackages
    ├── user       # 用户模块子包
    └── product    # 商品模块子包
</code></pre></li>
<li>
<p><strong>体积限制控制</strong><br>
• 主包 ≤2MB，所有分包总和 ≤20MB（不同平台限制略有差异）<br>
• 通过代码分割避免主包超限导致无法发布</p>
</li>
</ol>
<h3 id="二-动态加载与执行">二、动态加载与执行 </h3>
<ol>
<li>
<p><strong>按需加载机制</strong><br>
• 启动时仅加载主包，用户访问子包页面时才触发对应分包下载<br>
• 通过路由跳转自动触发分包加载（如 <code>wx.navigateTo</code> 跳转子包页面）</p>
</li>
<li>
<p><strong>独立分包优化</strong><br>
• 配置 <code>independent:true</code> 的分包无需依赖主包即可独立运行<br>
• 适用场景：活动页、独立功能模块等高频次访问的页面</p>
</li>
</ol>
<h3 id="三-缓存与性能优化">三、缓存与性能优化 </h3>
<ol>
<li>
<p><strong>分包缓存策略</strong><br>
• 首次加载的分包会被客户端缓存，后续打开直接复用<br>
• 缓存有效期与小程序版本更新周期同步</p>
</li>
<li>
<p><strong>预加载机制</strong><br>
在 <code>app.json</code> 配置 <code>preloadRule</code>，提前下载可能需要的分包：</p>
<pre data-role="codeBlock" data-info="json" class="language-json json"><code><span class="token property">"preloadRule"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">"pages/index/index"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"network"</span><span class="token operator">:</span> <span class="token string">"wifi"</span><span class="token punctuation">,</span>
    <span class="token property">"packages"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"subpackageA"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>• 支持按网络环境（WiFi/蜂窝）控制预加载时机<br>
• 每个分包预加载限额 2MB，超限会触发构建警告</p>
</li>
</ol>
<h3 id="四-工程化约束">四、工程化约束 </h3>
<ol>
<li>
<p><strong>引用规则</strong><br>
• 主包可引用公共资源，子包不能跨包引用其他子包资源（异步分包除外）<br>
• TabBar 页面必须位于主包</p>
</li>
<li>
<p><strong>构建策略</strong><br>
• 未被 <code>subpackages</code> 包含的目录默认打包到主包<br>
• 开发工具自动校验分包体积限制并生成构建警告</p>
</li>
</ol>
<h3 id="五-特殊场景处理-1">五、特殊场景处理 </h3>
<ol>
<li>
<p><strong>兼容性方案</strong><br>
• 旧版客户端自动回退为整包加载模式<br>
• 通过 <code>__APP__</code> 标识预加载主包资源</p>
</li>
<li>
<p><strong>第三方框架适配</strong><br>
• UniApp 等跨端框架通过 <code>pages.json</code> 实现多平台统一配置<br>
• Taro 等框架需处理自定义组件与分包的依赖关系</p>
</li>
</ol>
<hr>
<p><strong>效果对比</strong></p>
<table>
<thead>
<tr>
<th>指标</th>
<th>未分包</th>
<th>分包优化后</th>
</tr>
</thead>
<tbody>
<tr>
<td>启动加载时间</td>
<td>1500-2000ms</td>
<td>300-500ms</td>
</tr>
<tr>
<td>首屏渲染速度</td>
<td>800-1200ms</td>
<td>200-300ms</td>
</tr>
<tr>
<td>流量消耗（二次访问）</td>
<td>全量下载</td>
<td>减少 60%-80%</td>
</tr>
</tbody>
</table>
<h2 id="通过分包策略开发者既能突破包体积限制又能实现启动速度提升-3-5-倍的效果实际开发中建议结合业务模块划分分包并通过预加载平衡用户体验与流量消耗">通过分包策略，开发者既能突破包体积限制，又能实现启动速度提升 3-5 倍的效果。实际开发中建议结合业务模块划分分包，并通过预加载平衡用户体验与流量消耗。 </h2>
<hr>
<hr>
<hr>
<hr>
<h1 id="自动化部署的基本原理是什么">自动化部署的基本原理是什么？ </h1>
<h2 id="一-基本原理">一、基本原理 </h2>
<ol>
<li>​​ 核心机制：流程标准化与自动化 ​​<br>
自动化部署通过定义标准化的部署流程（如代码提交 → 构建 → 测试 → 部署），将每个环节的操作转化为自动化脚本或工具指令。例如，代码提交后触发构建工具（如 Jenkins）自动拉取代码并编译，再通过配置管理工具（如 Ansible）完成服务器环境配置。</li>
<li>​​ 技术支撑：持续集成与交付（CI/CD）​​</li>
</ol>
<ul>
<li>​​ 持续集成（CI）​​：开发人员提交代码到版本库（如 Git）后，自动触发构建和测试流程，确保代码质量。</li>
<li>​​ 持续交付（CD）​​：通过流水线工具（如 GitLab CI/CD）将测试通过的代码自动部署到目标环境（开发/测试/生产）。</li>
<li>​​ 容器化技术 ​​：利用 Docker 或 Kubernetes 实现环境一致性，将应用及其依赖打包成容器镜像，确保跨环境部署的一致性。</li>
</ul>
<ol start="3">
<li>​​ 动态调整与容错机制 ​​<br>
通过灰度发布（金丝雀部署）或蓝绿部署策略，逐步验证新版本稳定性，出现问题时快速回滚到旧版本。例如，蓝绿部署通过维护两套环境（当前版本和更新版本）实现无缝切换。</li>
</ol>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="当用户用网页系统时反馈很卡你是通过什么方式定位问题其实这个问题主要是你会不会朝面试官的预期答案回答其他的可定位问题的办法他不在乎">当用户用网页系统时反馈很卡，你是通过什么方式定位问题？【其实这个问题主要是你会不会朝面试官的预期答案回答，其他的可定位问题的办法他不在乎】 </h1>
<h1 id="还有没有其他的优化场景比如遇到过的页面卡顿问题是怎么定位问题并解决的">还有没有其他的优化场景？比如遇到过的页面卡顿问题，是怎么定位问题并解决的？ </h1>
<p>当用户反馈网页系统卡顿时，前端可通过以下多维度方法定位问题，结合技术指标与用户行为分析，精准识别性能瓶颈：</p>
<hr>
<h3 id="一-用户交互响应分析">一、用户交互响应分析 </h3>
<h4 id="1-同步任务阻塞检测">1. <strong>同步任务阻塞检测</strong> </h4>
<p>• <strong>原理</strong>：用户点击/输入后若主线程被长任务占用，会导致响应延迟。通过监听用户操作并测量 <code>requestAnimationFrame</code> 回调时间，判断是否超过阈值（如 1 秒）。<br>
• <strong>实现示例</strong>：<br>
<code>javascript      window.addEventListener("click", () =&gt; {        const startTime = Date.now();        requestAnimationFrame(() =&gt; {          const duringTime = Date.now() - startTime;          if (duringTime &gt; 1000) reportJank("同步任务阻塞");        });      });      </code><br>
• <strong>优化</strong>：拆分长任务为子任务，使用 <code>requestIdleCallback</code> 或 Web Worker 异步处理。</p>
<h4 id="2-异步任务卡顿定位">2. <strong>异步任务卡顿定位</strong> </h4>
<p>• <strong>特征</strong>：用户多次重复操作（如连续点击）可能触发异步逻辑堆积。通过统计单位时间内的操作次数（如 20 秒内超过 5 次）判断异常。<br>
• <strong>工具验证</strong>：利用 Chrome DevTools 的 <strong>Performance 面板</strong>录制操作过程，查看任务队列堆积情况。</p>
<hr>
<h3 id="二-代码执行性能剖析">二、代码执行性能剖析 </h3>
<h4 id="1-长任务long-tasks检测">1. <strong>长任务（Long Tasks）检测</strong> </h4>
<p>• <strong>定义</strong>：主线程连续执行超过 50ms 的任务会阻塞渲染。通过 <code>PerformanceObserver</code> 监听长任务并标记堆栈。<br>
• <strong>示例代码</strong>：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> observer <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">PerformanceObserver</span><span class="token punctuation">(</span><span class="token parameter">list</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  list<span class="token punctuation">.</span><span class="token method function property-access">getEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">entry</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token property-access">duration</span> <span class="token operator">&gt;</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'长任务来源:'</span><span class="token punctuation">,</span> entry<span class="token punctuation">.</span><span class="token property-access">attribution</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token property-access">containerName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
observer<span class="token punctuation">.</span><span class="token method function property-access">observe</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'longtask'</span><span class="token punctuation">,</span> <span class="token literal-property property">buffered</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>• <strong>优化策略</strong>：拆分循环、避免同步计算密集型操作。</p>
<h4 id="2-内存泄漏排查">2. <strong>内存泄漏排查</strong> </h4>
<p>• <strong>常见原因</strong>：未销毁的定时器、闭包引用、DOM 元素未解绑事件。<br>
• <strong>检测方法</strong>：<br>
◦ <strong>Chrome Memory 面板</strong>：对比多次内存快照，观察 <code>Detached DOM tree</code> 或对象数量异常增长。<br>
◦ <strong>代码检查</strong>：全局变量滥用、第三方库未正确释放资源。</p>
<hr>
<h3 id="三-渲染流程优化">三、渲染流程优化 </h3>
<h4 id="1-布局抖动layout-thrashing">1. <strong>布局抖动（Layout Thrashing）</strong> </h4>
<p>• <strong>现象</strong>：频繁读取布局属性（如 <code>offsetWidth</code>）触发强制重排。<br>
• <strong>解决方案</strong>：<br>
◦ 缓存布局属性值，避免在循环中读写混合操作。<br>
◦ 使用 <code>FastDOM</code> 库批量处理读写操作。</p>
<h4 id="2-帧率fps监测">2. <strong>帧率（FPS）监测</strong> </h4>
<p>• <strong>标准</strong>：60FPS 对应每帧 16.67ms，若连续 3 帧低于 20FPS 判定为卡顿。<br>
• <strong>实现逻辑</strong>：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-let">let</span> lastTime <span class="token operator">=</span> <span class="token known-class-name class-name">Date</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  frameCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> <span class="token function-variable function">checkFPS</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  frameCount<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token known-class-name class-name">Date</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> lastTime <span class="token operator">&gt;=</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> fps <span class="token operator">=</span> frameCount<span class="token punctuation">;</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>fps <span class="token operator">&lt;</span> <span class="token number">45</span><span class="token punctuation">)</span> <span class="token function">reportLowFPS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    frameCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    lastTime <span class="token operator">=</span> <span class="token known-class-name class-name">Date</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>checkFPS<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><hr>
<h3 id="四-网络与资源分析">四、网络与资源分析 </h3>
<h4 id="1-资源加载阻塞">1. <strong>资源加载阻塞</strong> </h4>
<p>• <strong>监控点</strong>：通过 <code>PerformanceResourceTiming</code> 统计脚本、样式表加载耗时。<br>
• <strong>优化手段</strong>：<br>
◦ 非关键资源异步加载（<code>async/defer</code>）。<br>
◦ 预加载重要资源（<code>&lt;link rel="preload"&gt;</code>）。</p>
<h4 id="2-第三方脚本性能影响">2. <strong>第三方脚本性能影响</strong> </h4>
<p>• <strong>检测工具</strong>：Lighthouse 或 SpeedCurve 识别第三方代码执行耗时。<br>
• <strong>缓解方案</strong>：延迟加载非必要脚本，使用 <code>Intersection Observer</code> 控制触发时机。</p>
<hr>
<h3 id="五-工具链辅助定位">五、工具链辅助定位 </h3>
<h4 id="1-chrome-devtools-深度分析">1. <strong>Chrome DevTools 深度分析</strong> </h4>
<p>• <strong>Performance 面板</strong>：录制完整操作流程，查看 <strong>Main Thread</strong> 火焰图中的长任务和事件循环阻塞。<br>
• <strong>Coverage 工具</strong>：分析未使用的 CSS/JS 代码占比，减少执行负载。</p>
<h4 id="2-自动化监控平台">2. <strong>自动化监控平台</strong> </h4>
<p>• <strong>方案示例</strong>：</p>
<table>
<thead>
<tr>
<th>工具</th>
<th>功能定位</th>
<th>适用场景</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sentry</td>
<td>卡顿日志与堆栈上报</td>
<td>生产环境异常追踪</td>
</tr>
<tr>
<td>SpeedCurve</td>
<td>实时性能指标监控</td>
<td>多地域/网络条件测试</td>
</tr>
<tr>
<td>WebPageTest</td>
<td>多维度加载瀑布图分析</td>
<td>竞品性能对比</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="六-用户场景复现策略">六、用户场景复现策略 </h3>
<ol>
<li><strong>日志埋点增强</strong>：在关键链路（如数据加载、渲染）插入性能打点，上报耗时与上下文信息。</li>
<li><strong>环境模拟</strong>：使用 Chrome 的 <strong>CPU Throttling</strong> 和 <strong>Network Throttling</strong> 模拟低端设备或弱网环境复现问题。</li>
</ol>
<hr>
<p>通过以上方法，前端可系统化定位卡顿根源。实际应用中建议优先排查 <strong>长任务</strong> 和 <strong>内存泄漏</strong>（覆盖 80%以上案例），再逐步深入渲染与网络优化。若需进一步验证，可通过网页 1、网页 6 提供的工具链进行深度分析。</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="webpack-和-vite-的构建区别是什么能否用-webpack-实现前端大仓库里只需要启动-a-模块但是-bcd-不启动因为用-webpack-打包的话是全量的有没有办法实现只需要启动-a-模块但是-bcd-不启动">Webpack 和 Vite 的构建区别是什么？能否用 Webpack 实现前端大仓库里只需要启动 A 模块，但是 B/C/D 不启动（因为用 Webpack 打包的话是全量的，有没有办法实现只需要启动 A 模块，但是 B/C/D 不启动） </h1>
<h3 id="一-webpack-与-vite-的核心构建区别">一、Webpack 与 Vite 的核心构建区别 </h3>
<p>以下从构建机制、开发模式、生产优化等维度对比两者差异：</p>
<h4 id="1-构建机制与速度">1. <strong>构建机制与速度</strong> </h4>
<p>• <strong>Webpack</strong><br>
• <strong>全量打包</strong>：无论项目规模多大，启动时必须递归分析所有模块依赖，生成完整的依赖图谱，冷启动时间随项目复杂度线性增长（大型项目可能需几分钟）<br>
• <strong>基于 JavaScript</strong>：核心编译逻辑由 JS 实现，受限于单线程性能瓶颈，尤其在处理 TypeScript 或 Babel 转译时效率较低</p>
<p>• <strong>Vite</strong><br>
• <strong>按需编译</strong>：开发环境下基于浏览器原生 ESM，仅编译当前请求的模块（如访问 <code>/a</code> 时只编译 A 模块），冷启动速度可达毫秒级<br>
• <strong>预构建加速</strong>：使用 Go 语言编写的 esbuild 预编译第三方依赖，性能比 Webpack 快 10-100 倍</p>
<h4 id="2-开发模式与热更新hmr">2. <strong>开发模式与热更新（HMR）</strong> </h4>
<p>• <strong>Webpack</strong><br>
• <strong>全量更新</strong>：修改文件后需重新构建整个依赖链，热更新速度随模块数量增加显著下降<br>
• <strong>动态模块加载</strong>：通过 <code>__webpack_require__</code> 模拟模块系统，需手动刷新页面应用更新</p>
<p>• <strong>Vite</strong><br>
• <strong>增量更新</strong>：仅重新编译修改的模块，通过浏览器原生 ESM 直接替换代码，HMR 更新速度接近实时<br>
• <strong>无打包机制</strong>：浏览器直接加载源码模块，减少中间环节，调试体验接近原生开发</p>
<h4 id="3-生产环境优化-1">3. <strong>生产环境优化</strong> </h4>
<p>• <strong>Webpack</strong><br>
• <strong>内置优化策略</strong>：支持 Tree Shaking、代码压缩、代码分割（需手动配置 <code>splitChunks</code>），适合生成高度优化的静态资源<br>
• <strong>兼容性强</strong>：支持老旧浏览器和 CommonJS 模块，适合复杂场景</p>
<p>• <strong>Vite</strong><br>
• <strong>Rollup 打包</strong>：生产构建使用 Rollup，Tree Shaking 更高效，生成代码体积更小<br>
• <strong>面向现代浏览器</strong>：默认输出 ESM 格式，需插件支持旧环境（如 @vitejs/plugin-legacy）</p>
<hr>
<h3 id="二-webpack-实现模块级按需启动方案">二、Webpack 实现模块级按需启动方案 </h3>
<p>针对「仅启动 A 模块，B/C/D 不启动」的需求，可通过以下方案实现：</p>
<h4 id="1-代码分割code-splitting">1. <strong>代码分割（Code Splitting）</strong> </h4>
<p>• <strong>动态导入（Dynamic Import）</strong><br>
使用 <code>import()</code> 语法按需加载模块，Webpack 会将其分割为独立 chunk，仅在需要时加载：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 点击按钮时加载 B 模块</span>
<span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword module keyword-import">import</span><span class="token punctuation">(</span><span class="token string">'./modules/B'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">module</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    module<span class="token punctuation">.</span><span class="token method function property-access">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>此方式会将 B 模块打包为独立文件，初始加载时不包含 B 模块代码</p>
<p>• <strong>多入口配置</strong><br>
为每个模块定义独立入口，通过配置 <code>entry</code> 实现物理隔离：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// webpack.config.js</span>
module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token constant">A</span><span class="token operator">:</span> <span class="token string">'./src/A.js'</span><span class="token punctuation">,</span>
    <span class="token constant">B</span><span class="token operator">:</span> <span class="token string">'./src/B.js'</span><span class="token punctuation">,</span>
    <span class="token constant">C</span><span class="token operator">:</span> <span class="token string">'./src/C.js'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'[name].bundle.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>运行时仅加载 <code>A.bundle.js</code>，B/C 模块代码不会包含在 A 的构建产物中</p>
<h4 id="2-依赖图优化">2. <strong>依赖图优化</strong> </h4>
<p>• <strong>配置 <code>externals</code></strong><br>
将公共依赖（如 React、Lodash）声明为外部依赖，避免重复打包：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code>module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">externals</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">react</span><span class="token operator">:</span> <span class="token string">'React'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">lodash</span><span class="token operator">:</span> <span class="token string">'_'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>此方式需通过 CDN 引入外部依赖，减少模块打包体积</p>
<p>• <strong>DLLPlugin 预构建</strong><br>
使用 <code>DllPlugin</code> 预编译不常变更的第三方库，生成独立文件：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// webpack.dll.config.js</span>
module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'react'</span><span class="token punctuation">,</span> <span class="token string">'lodash'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword keyword-new">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'[name]_dll'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token method function property-access">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dll/manifest.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>主配置中通过 <code>DllReferencePlugin</code> 引用预构建文件，减少重复编译时间</p>
<h4 id="3-按需加载的工程化实践">3. <strong>按需加载的工程化实践</strong> </h4>
<p>• <strong>路由级懒加载</strong><br>
在 React/Vue 等框架中结合路由实现模块级懒加载：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// React Router v6</span>
<span class="token keyword keyword-const">const</span> <span class="token maybe-class-name">Home</span> <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token keyword module keyword-import">import</span><span class="token punctuation">(</span><span class="token string">'./modules/Home'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> <span class="token maybe-class-name">About</span> <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token keyword module keyword-import">import</span><span class="token punctuation">(</span><span class="token string">'./modules/About'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-function">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-return">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token maybe-class-name">Routes</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token maybe-class-name">Route</span>
        path<span class="token operator">=</span><span class="token string">"/"</span>
        element<span class="token operator">=</span><span class="token punctuation">{</span>
          <span class="token operator">&lt;</span><span class="token maybe-class-name">Suspense</span> fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span><span class="token maybe-class-name">Loading</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token maybe-class-name">Home</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token maybe-class-name">Suspense</span><span class="token operator">&gt;</span>
        <span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token maybe-class-name">Route</span>
        path<span class="token operator">=</span><span class="token string">"/about"</span>
        element<span class="token operator">=</span><span class="token punctuation">{</span>
          <span class="token operator">&lt;</span><span class="token maybe-class-name">Suspense</span> fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span><span class="token maybe-class-name">Loading</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token maybe-class-name">About</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token maybe-class-name">Suspense</span><span class="token operator">&gt;</span>
        <span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token maybe-class-name">Routes</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>访问 <code>/about</code> 时才会加载 About 模块</p>
<p>• <strong>条件编译</strong><br>
通过环境变量控制模块编译范围（需配合 <code>DefinePlugin</code>）：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// webpack.config.js</span>
<span class="token keyword keyword-const">const</span> enabledModules <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">MODULES</span><span class="token punctuation">.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> enabledModules<span class="token punctuation">.</span><span class="token method function property-access">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">entries<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    entries<span class="token punctuation">[</span>module<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./src/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>module<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.js</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token keyword control-flow keyword-return">return</span> entries<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>运行 <code>MODULES=A webpack serve</code> 时仅编译 A 模块</p>
<hr>
<h3 id="三-webpack-按需方案的局限性及建议">三、Webpack 按需方案的局限性及建议 </h3>
<h4 id="1-主要局限">1. <strong>主要局限</strong> </h4>
<p>• <strong>配置复杂度高</strong>：需手动管理代码分割、公共依赖提取等逻辑，学习曲线陡峭<br>
• <strong>全量分析开销</strong>：即使使用动态导入，Webpack 仍需构建完整依赖图谱，大型项目冷启动仍较慢</p>
<h4 id="2-优化建议">2. <strong>优化建议</strong> </h4>
<p>• <strong>结合 Vite 开发</strong>：对模块独立性强的项目，可在开发环境使用 Vite 实现按需编译，生产环境切回 Webpack<br>
• <strong>Monorepo 架构</strong>：将 A/B/C/D 拆分为独立子包，通过 <code>npm workspace</code> 或 Lerna 管理依赖，实现物理隔离</p>
<hr>
<h2 id="引用来源"><strong>引用来源</strong> </h2>
<hr>
<hr>
<hr>
<hr>
<h1 id="当前有一个-vue3-的项目我想在这个项目中监控-fp-fcp-fmp-lcp-等数据应该怎么实现">当前有一个 vue3 的项目，我想在这个项目中监控 fp, fcp, fmp, lcp 等数据，应该怎么实现？ </h1>
<p>在 Vue3 项目中监控核心性能指标（FP、FCP、FMP、LCP）可通过以下四类方案实现，结合原生 API、第三方工具和 Vue 生态能力，具体实施方案如下：</p>
<hr>
<h3 id="一-使用浏览器原生-performance-api原生集成方案">一、使用浏览器原生 Performance API（原生集成方案） </h3>
<h4 id="1-fpfirst-paint与-fcpfirst-contentful-paint监控">1. <strong>FP（First Paint）与 FCP（First Contentful Paint）监控</strong> </h4>
<p>通过 <code>performance.getEntriesByType('paint')</code> 获取首次绘制时间：</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 在应用入口（main.ts）初始化</span>
<span class="token keyword keyword-const">const</span> paintEntries <span class="token operator">=</span> performance<span class="token punctuation">.</span><span class="token function">getEntriesByType</span><span class="token punctuation">(</span><span class="token string">'paint'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
paintEntries<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>entry <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>entry<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'first-paint'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'FP:'</span><span class="token punctuation">,</span> entry<span class="token punctuation">.</span>startTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>entry<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'first-contentful-paint'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'FCP:'</span><span class="token punctuation">,</span> entry<span class="token punctuation">.</span>startTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="2-lcplargest-contentful-paint监控">2. <strong>LCP（Largest Contentful Paint）监控</strong> </h4>
<p>使用 <code>PerformanceObserver</code> 监听最大内容绘制：</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-const">const</span> lcpObserver <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">PerformanceObserver</span><span class="token punctuation">(</span>entryList <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> entries <span class="token operator">=</span> entryList<span class="token punctuation">.</span><span class="token function">getEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> lastEntry <span class="token operator">=</span> entries<span class="token punctuation">[</span>entries<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'LCP:'</span><span class="token punctuation">,</span> lastEntry<span class="token punctuation">.</span>startTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
lcpObserver<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'largest-contentful-paint'</span><span class="token punctuation">,</span> buffered<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="3-fmpfirst-meaningful-paint自定义计算">3. <strong>FMP（First Meaningful Paint）自定义计算</strong> </h4>
<p>由于 FMP 无标准 API，可通过以下策略估算：</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 关键组件挂载时标记时间戳（如首页核心组件）</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> onMounted <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  performance<span class="token punctuation">.</span><span class="token function">mark</span><span class="token punctuation">(</span><span class="token string">'fmp-mark'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 结合 requestAnimationFrame 计算渲染完成时间</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> fmp <span class="token operator">=</span> performance<span class="token punctuation">.</span><span class="token function">measure</span><span class="token punctuation">(</span>
      <span class="token string">'fmp'</span><span class="token punctuation">,</span>
      <span class="token string">'navigationStart'</span><span class="token punctuation">,</span>
      <span class="token string">'fmp-mark'</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span>duration<span class="token punctuation">;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'FMP:'</span><span class="token punctuation">,</span> fmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<h3 id="二-集成专业监控-sdk开箱即用方案">二、集成专业监控 SDK（开箱即用方案） </h3>
<h4 id="1-webtracing-一站式解决方案">1. <strong>WebTracing 一站式解决方案</strong> </h4>
<p>配置示例（网页 7）：</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// main.ts</span>
<span class="token keyword keyword-import">import</span> WebTracing <span class="token keyword keyword-from">from</span> <span class="token string">'@web-tracing/vue3'</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>WebTracing<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  dsn<span class="token operator">:</span> <span class="token string">'/trackWebApi'</span><span class="token punctuation">,</span>
  appName<span class="token operator">:</span> <span class="token string">'vue3-monitor'</span><span class="token punctuation">,</span>
  performance<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 自动采集 FP/FCP/LCP</span>
  customMetrics<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 扩展 FMP 监控</span>
    <span class="token function-variable function">fmp</span><span class="token operator">:</span> metrics <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 自定义 FMP 计算逻辑</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>该 SDK 支持自动上报性能数据到指定服务端，并提供可视化看板。</p>
<h4 id="2-sentry-性能监控套件">2. <strong>Sentry 性能监控套件</strong> </h4>
<p>结合错误监控（网页 1）：</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> <span class="token operator">*</span> <span class="token keyword keyword-as">as</span> Sentry <span class="token keyword keyword-from">from</span> <span class="token string">'@sentry/vue'</span><span class="token punctuation">;</span>
Sentry<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  app<span class="token punctuation">,</span>
  dsn<span class="token operator">:</span> <span class="token string">'https://example@sentry.io/123456'</span><span class="token punctuation">,</span>
  integrations<span class="token operator">:</span> <span class="token punctuation">[</span>Sentry<span class="token punctuation">.</span><span class="token function">browserTracingIntegration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  tracesSampleRate<span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 自动捕获 FP/FCP/LCP 到 Sentry 仪表盘</span>
</code></pre><hr>
<h3 id="三-vue-生态定制化方案">三、Vue 生态定制化方案 </h3>
<h4 id="1-组合式-api-封装监控逻辑">1. <strong>组合式 API 封装监控逻辑</strong> </h4>
<p>创建 <code>usePerformance</code> 可复用 Hook：</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// composables/usePerformance.ts</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> onMounted <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>

<span class="token keyword keyword-export">export</span> <span class="token keyword keyword-function">function</span> <span class="token function">usePerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> <span class="token function-variable function">trackCoreMetrics</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 实现上述原生 API 监控逻辑</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">trackCoreMetrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>在组件中调用：</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> usePerformance <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'./composables/usePerformance'</span><span class="token punctuation">;</span>
<span class="token function">usePerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="2-路由级性能采样">2. <strong>路由级性能采样</strong> </h4>
<p>结合 Vue Router 监听路由变化：</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code>router<span class="token punctuation">.</span><span class="token function">afterEach</span><span class="token punctuation">(</span>to <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> navTiming <span class="token operator">=</span> performance<span class="token punctuation">.</span><span class="token function">getEntriesByType</span><span class="token punctuation">(</span><span class="token string">'navigation'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> fp <span class="token operator">=</span> performance<span class="token punctuation">.</span><span class="token function">getEntriesByName</span><span class="token punctuation">(</span><span class="token string">'first-paint'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>startTime<span class="token punctuation">;</span>
  <span class="token comment">// 上报当前路由的性能数据</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<h3 id="四-开发环境验证与优化">四、开发环境验证与优化 </h3>
<h4 id="1-chrome-devtools-验证">1. <strong>Chrome DevTools 验证</strong> </h4>
<p>• 打开 <strong>Performance 面板</strong>录制加载过程，查看 FP/FCP 时间线<br>
• 使用 <strong>Lighthouse 插件</strong>生成性能报告（网页 6）</p>
<h4 id="2-本地模拟弱网环境">2. <strong>本地模拟弱网环境</strong> </h4>
<p>通过 Chrome 的 <strong>Network Throttling</strong> 模拟 3G 网络，验证指标稳定性。</p>
<hr>
<h3 id="数据上报建议">数据上报建议 </h3>
<table>
<thead>
<tr>
<th>指标</th>
<th>推荐阈值（桌面端）</th>
<th>上报策略</th>
</tr>
</thead>
<tbody>
<tr>
<td>FP</td>
<td>&lt;1s</td>
<td>实时上报</td>
</tr>
<tr>
<td>FCP</td>
<td>&lt;1.8s</td>
<td>异常阈值触发报警</td>
</tr>
<tr>
<td>LCP</td>
<td>&lt;2.5s</td>
<td>统计 75% 分位数</td>
</tr>
<tr>
<td>FMP</td>
<td>&lt;2s</td>
<td>与业务渲染完成事件绑定</td>
</tr>
</tbody>
</table>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 示例上报逻辑</span>
<span class="token keyword keyword-function">function</span> <span class="token function">reportMetrics</span><span class="token punctuation">(</span>metrics<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  navigator<span class="token punctuation">.</span><span class="token function">sendBeacon</span><span class="token punctuation">(</span><span class="token string">'/api/performance'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>metrics<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h2 id="通过以上方案组合既可实现基础监控需求又能扩展自定义指标建议优先采用-webtracing-或-sentry-方案网页-17-降低维护成本需要深度定制时再结合原生-api-开发生产环境需配合-nginx-日志分析和-grafana-看板实现全链路监控">通过以上方案组合，既可实现基础监控需求，又能扩展自定义指标。建议优先采用 <strong>WebTracing 或 Sentry 方案</strong>（网页 1/7） 降低维护成本，需要深度定制时再结合原生 API 开发。生产环境需配合 Nginx 日志分析和 Grafana 看板实现全链路监控。 </h2>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="js-中的最大数是多少为什么">js 中的最大数是多少，为什么？ </h1>
<blockquote>
<p>使用的是<code>IEEE754的64位浮点数标准</code></p>
</blockquote>
<ol>
<li>
<p>最大安全整数数是 <code>2^53-1</code>，即 <code>9007199254740991</code>。即<code>Number.MAX_SAFE_INTEGER</code>，</p>
</li>
<li>
<p>最大能表示的数是接近<code>2^1024</code> 约等于 <code>1.7976931348623157×10^308</code>，即<code>Number.MAX_VALUE</code></p>
</li>
<li>
<p>二进制的小数的计算</p>
</li>
</ol>
<ul>
<li>举个例子<br>
(0.375)10=(0.011)2，小数点后面的位数依次表示十进制中的 0.5、0.25、0.125 和 0.0625 等等，即二进制的<code>0.1 = 1 / (2^1)</code>，二进制的<code>0.01 = 1 / (2^2)</code>，以此类推</li>
</ul>
<ol start="3">
<li>IEEE754 的 64 位浮点数的计算公式是<code>符号位(1或-1)*Math.pow(2, 指数位)*(1+小数部分)</code>，在 64 位的浮点标准中，有 1 位符号位，指数位 11 位，小数位 52 位，即最大能表示的指数值是<code>Math.pow(2, 11)-1=2047</code>，在<code>[0,2047]</code>中，<code>[0, 1022]</code>表示的是负指数<code>[-1023, -1]</code>，而<code>[1023, 2047]</code>表示的是正指数<code>[0, 1024]</code>，也就是说<code>[0, 2047]</code> ，映射成了 <code>[-1023, 1024]</code>，而其中的-1023 表示非规格化的数或 0，而 1024 表示无穷大<code>Infinite</code>或非数值<code>NaN</code>，所以这 2 个数不参与计算，所以实际值是<code>[-1022, 1023]</code>。而之所以将指数位又称为偏移位，是因为可以直接将要计算的指数值（十进制）+ 固定值就可以得到指数位需要表示的值；比如 64 位精度中，这个偏移值就是 1023，如果我们想计算一个指数值 12，就那么指数位的二进制需要表示的值就是<code>12+1023 = 1035</code></li>
<li>之所以最大安全整数数是 <code>2^53-1</code>，是因为小数位有 52 位，而与<code>(1+小数部分)</code>相乘最大能计算的精确值是接近<code>2^53</code>，所以最大安全整数数是 <code>2^53-1</code>，即 <code>9007199254740991</code>。</li>
</ol>
<h1 id="new-filereaderreadasdataurlcanvastodataurl-和-urlcreateobjecturl-方法有什么区别">new FileReader().readAsDataURL，canvas.toDataURL 和 URL.createObjectURL 方法有什么区别 </h1>
<p><code>new FileReader().readAsDataURL</code> 和 <code>URL.createObjectURL</code> 都可以用于将文件或数据转换为可使用的 URL，但它们在实现方式、用途和性能上存在显著区别：</p>
<ol>
<li>
<p><strong><code>new FileReader().readAsDataURL</code></strong></p>
<ul>
<li>将文件内容读取为 Base64 编码的 Data URL。</li>
<li>是异步操作，需要通过事件监听器（如 <code>onload</code>）获取结果。</li>
<li>生成的 Data URL 占用更多内存，因为它是 Base64 编码的，通常比原始文件大约 33%。</li>
<li>适用于需要将文件内容嵌入到 HTML 或 CSS 中的场景（例如 <code>&lt;img src="data:..."&gt;</code>）。</li>
</ul>
</li>
<li>
<p><strong><code>URL.createObjectURL</code></strong></p>
<ul>
<li>创建一个指向传入对象（如 <code>Blob</code> 或 <code>File</code>）的临时引用 URL。</li>
<li>是同步操作，立即返回结果。</li>
<li>不会将文件内容转换为 Base64，因此占用内存较少。</li>
<li>适用于需要快速显示文件内容的场景（例如 <code>&lt;video&gt;</code> 或 <code>&lt;img&gt;</code> 元素的 <code>src</code> 属性）。</li>
<li>使用完毕后需调用 <code>URL.revokeObjectURL</code> 方法释放内存。</li>
</ul>
</li>
<li>
<p><code>canvas.toDataURL('image/png')</code>也是当将画布上的内容转换为 Data URL 格式（base64），它将使用 PNG 格式进行编码。</p>
</li>
</ol>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="scss-loader-postcss-loader-css-loader-style-loader-的作用和区别">scss-loader, postcss-loader, css-loader, style-loader 的作用和区别 </h1>
<p>以下是 Webpack 中 <code>postcss-loader</code>、<code>scss-loader</code>（即 <code>sass-loader</code>）、<code>css-loader</code> 和 <code>style-loader</code> 的核心作用及区别解析：</p>
<hr>
<h3 id="一-核心作用对比">一、<strong>核心作用对比</strong> </h3>
<table>
<thead>
<tr>
<th><strong>Loader</strong></th>
<th><strong>功能定位</strong></th>
<th><strong>典型场景</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>style-loader</strong></td>
<td>将处理后的 CSS 代码以 <code>&lt;style&gt;</code> 标签形式注入 HTML 页面</td>
<td>开发环境快速调试样式，直接内联 CSS 到页面</td>
</tr>
<tr>
<td><strong>css-loader</strong></td>
<td>解析 CSS 文件的 <code>@import</code> 和 <code>url()</code> 依赖，支持 CSS 模块化（如类名哈希化）</td>
<td>处理 CSS 文件间的依赖关系，避免全局样式冲突</td>
</tr>
<tr>
<td><strong>sass-loader</strong></td>
<td>将 Sass/SCSS 语法编译为标准 CSS</td>
<td>使用 Sass 变量、嵌套、混合等高级语法编写样式</td>
</tr>
<tr>
<td><strong>postcss-loader</strong></td>
<td>通过插件（如 Autoprefixer）处理 CSS 兼容性、压缩(CSSnano)、移除未使用的 css(pureCss)等后处理操作</td>
<td>自动添加浏览器前缀、优化 CSS 代码、支持未来 CSS 语法（如 <code>postcss-preset-env</code>）</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="二-协作流程与执行顺序">二、<strong>协作流程与执行顺序</strong> </h3>
<h4 id="1-典型配置链">1. <strong>典型配置链</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.scss$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token comment">// 注入样式到 DOM</span>
        <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token comment">// 解析 CSS 模块依赖</span>
        <span class="token string">'postcss-loader'</span><span class="token punctuation">,</span> <span class="token comment">// 后处理（如加前缀）</span>
        <span class="token string">'sass-loader'</span><span class="token punctuation">,</span> <span class="token comment">// 编译 Sass 为 CSS</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="2-执行顺序说明">2. <strong>执行顺序说明</strong> </h4>
<p>• <strong>从右到左，从下到上加载</strong>（Webpack 规则）：</p>
<ol>
<li><strong>sass-loader</strong>：将 <code>.scss</code> 编译为原生 CSS；</li>
<li><strong>postcss-loader</strong>：对 CSS 进行兼容性处理（如 Autoprefixer）；</li>
<li><strong>css-loader</strong>：解析 CSS 的 <code>@import</code> 和 <code>url()</code>，支持模块化类名；</li>
<li><strong>style-loader</strong>：将最终 CSS 插入 <code>&lt;style&gt;</code> 标签。</li>
</ol>
<hr>
<h3 id="三-核心区别详解">三、<strong>核心区别详解</strong> </h3>
<h4 id="1-功能边界">1. <strong>功能边界</strong> </h4>
<p>• <strong>sass-loader vs css-loader</strong><br>
• <code>sass-loader</code> 仅负责 <strong>语法转换</strong>（如 Sass → CSS）；<br>
• <code>css-loader</code> 负责 <strong>依赖解析与模块化</strong>（如处理 <code>@import</code> 和生成哈希类名）。</p>
<p>• **postcss-loader vs css<br>
• <code>postcss-loader</code> 是 <strong>后处理器</strong>，扩展 CSS 功能（如加前缀、压缩）；<br>
• <code>css-loader</code> 是 **基础解析器**，不修改代码逻辑，仅转换依赖关系。</p>
<p>• <strong>style-loader vs 其他 Loader</strong><br>
• 唯一直接操作 DOM 的 Loader，<strong>仅开发环境使用</strong>（生产环境需替换为 <code>mini-css-extract-plugin</code>）。</p>
<h4 id="2-依赖关系">2. <strong>依赖关系</strong> </h4>
<p>• <strong>必要组合</strong>：<br>
• <code>style-loader</code> 必须与 <code>css-loader</code> 配合使用（否则无法将 CSS 注入页面）；<br>
• <code>sass-loader</code> 需依赖 <code>node-sass</code> 或 <code>dart-sass</code> 编译器。</p>
<p>• <strong>插件扩展</strong>：<br>
• <code>postcss-loader</code> 需搭配插件（如 <code>autoprefixer</code>、<code>cssnano</code>）实现功能。</p>
<hr>
<h3 id="四-生产环境优化建议">四、<strong>生产环境优化建议</strong> </h3>
<ol>
<li>
<p><strong>替换 <code>style-loader</code></strong><br>
使用 <code>mini-css-extract-plugin</code> 将 CSS 提取为独立文件，减少 JS 体积。</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> <span class="token maybe-class-name">MiniCssExtractPlugin</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.scss$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token maybe-class-name">MiniCssExtractPlugin</span><span class="token punctuation">.</span><span class="token property-access">loader</span><span class="token punctuation">,</span>
        <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
        <span class="token string">'postcss-loader'</span><span class="token punctuation">,</span>
        <span class="token string">'sass-loader'</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p><strong>启用 CSS 压缩</strong><br>
通过 <code>cssnano</code> 插件压缩 CSS 代码（需在 <code>postcss-loader</code> 中配置）：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token literal-property property">postcssOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'autoprefixer'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cssnano'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></li>
</ol>
<hr>
<h3 id="五-常见问题与调试">五、<strong>常见问题与调试</strong> </h3>
<h4 id="1-loader-顺序错误">1. <strong>Loader 顺序错误</strong> </h4>
<p>• <strong>症状</strong>：样式未生效或报错。<br>
• <strong>解决</strong>：确保顺序为 <code>sass-loader</code> → <code>postcss-loader</code> → <code>css-loader</code> → <code>style-loader</code>。</p>
<h4 id="2-postcss-配置缺失">2. <strong>PostCSS 配置缺失</strong> </h4>
<p>• <strong>症状</strong>：浏览器前缀未自动添加。<br>
• <strong>解决</strong>：创建 <code>postcss.config.js</code> 或直接在 Webpack 配置中声明插件。</p>
<hr>
<h3 id="总结-8">总结 </h3>
<p>• <strong>开发环境工作流</strong>：<code>sass-loader</code>（编译）→ <code>postcss-loader</code>（优化）→ <code>css-loader</code>（解析）→ <code>style-loader</code>（注入）。<br>
• <strong>生产环境优化</strong>：用 <code>mini-css-extract-plugin</code> 替换 <code>style-loader</code>，结合 <code>postcss-loader</code> 压缩代码。<br>
• <strong>核心差异</strong>：<code>sass-loader</code> 处理预编译语法，<code>css-loader</code> 处理模块化，<code>postcss-loader</code> 负责后处理，<code>style-loader</code> 专攻 DOM 注入。</p>
<h1 id="axios-的请求拦截和响应拦截实现">axios 的请求拦截和响应拦截实现 </h1>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token function">request</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 拦截和请求组装队列</span>
  <span class="token keyword keyword-let">let</span> chain <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token method function property-access">sendAjax</span><span class="token punctuation">.</span><span class="token method function property-access">bind</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword nil keyword-undefined">undefined</span><span class="token punctuation">]</span> <span class="token comment">// 成对出现，失败回调暂不处理</span>
  <span class="token comment">// 请求拦截</span>
  <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">interceptors</span><span class="token punctuation">.</span><span class="token property-access">request</span><span class="token punctuation">.</span><span class="token property-access">handlers</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">interceptor</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  chain<span class="token punctuation">.</span><span class="token method function property-access">unshift</span><span class="token punctuation">(</span>interceptor<span class="token punctuation">.</span><span class="token property-access">fullfield</span><span class="token punctuation">,</span> interceptor<span class="token punctuation">.</span><span class="token property-access">rejected</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// 响应拦截</span>
  <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">interceptors</span><span class="token punctuation">.</span><span class="token property-access">response</span><span class="token punctuation">.</span><span class="token property-access">handlers</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">interceptor</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  chain<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>interceptor<span class="token punctuation">.</span><span class="token property-access">fullfield</span><span class="token punctuation">,</span> interceptor<span class="token punctuation">.</span><span class="token property-access">rejected</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// 执行队列promise，每次执行一对，并给promise赋最新的值，组成promise调用链</span>
  <span class="token keyword keyword-let">let</span> promise <span class="token operator">=</span> <span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-while">while</span><span class="token punctuation">(</span>chain<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    promise <span class="token operator">=</span> promise<span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span>chain<span class="token punctuation">.</span><span class="token method function property-access">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> chain<span class="token punctuation">.</span><span class="token method function property-access">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow keyword-return">return</span> promise<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>


</code></pre><hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="vue-和-react-里面封装-modal-这样的组件可以使用什么方法">vue 和 react 里面封装 Modal 这样的组件可以使用什么方法 </h1>
<h2 id="vue">vue </h2>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token keyword module keyword-import">import</span> <span class="token imports"><span class="token punctuation">{</span> createVNode<span class="token punctuation">,</span> h<span class="token punctuation">,</span> render <span class="token punctuation">}</span></span> <span class="token keyword module keyword-from">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>

<span class="token comment">// 挂载</span>
<span class="token keyword keyword-const">const</span> vnode <span class="token operator">=</span> <span class="token function">createVNode</span><span class="token punctuation">(</span><span class="token maybe-class-name">Modal</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">modelValue</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">title</span><span class="token operator">:</span> config<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">,</span>
  <span class="token literal-property property">width</span><span class="token operator">:</span> config<span class="token punctuation">.</span><span class="token property-access">width</span><span class="token punctuation">,</span>
  <span class="token literal-property property">content</span><span class="token operator">:</span> config<span class="token punctuation">.</span><span class="token property-access">content</span><span class="token punctuation">,</span>
  <span class="token string-property property">'onUpdate:modelValue'</span><span class="token operator">:</span> close<span class="token punctuation">,</span>
  <span class="token function-variable function">onConfirm</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    config<span class="token punctuation">.</span><span class="token property-access">onConfirm</span><span class="token operator">?.</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onCancel</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    config<span class="token punctuation">.</span><span class="token property-access">onCancel</span><span class="token operator">?.</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">render</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> container<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 卸载</span>

<span class="token keyword keyword-const">const</span> <span class="token function-variable function">close</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// app.unmount();</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token keyword null nil keyword-null">null</span><span class="token punctuation">,</span> container<span class="token punctuation">)</span><span class="token punctuation">;</span>
  container<span class="token punctuation">.</span><span class="token property-access">parentNode</span><span class="token operator">?.</span><span class="token method function property-access">removeChild</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><h2 id="react">react </h2>
<ol>
<li>使用 ReactDOM.render，不过已经废弃了</li>
</ol>
<pre data-role="codeBlock" data-info="jsx" class="language-jsx jsx"><code><span class="token comment">// 挂载</span>
<span class="token keyword keyword-const">const</span> div <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token maybe-class-name">ReactDOM</span><span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UiModal</span></span> <span class="token spread"><span class="token punctuation">{</span><span class="token spread operator">...</span>props<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> div<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 卸载</span>
<span class="token keyword keyword-const">const</span> <span class="token function-variable function">destroy</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> unmountResult <span class="token operator">=</span> <span class="token maybe-class-name">ReactDOM</span><span class="token punctuation">.</span><span class="token method function property-access">unmountComponentAtNode</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>unmountResult <span class="token operator">&amp;&amp;</span> div<span class="token punctuation">.</span><span class="token property-access">parentNode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      div<span class="token punctuation">.</span><span class="token property-access">parentNode</span><span class="token punctuation">.</span><span class="token method function property-access">removeChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><ol start="2">
<li>使用 React.createPortal，这种直接通过父组件控制 visible 就可以了，无需手动操作 dom，react 会自动处理 portal 的 dom 移除</li>
</ol>
<pre data-role="codeBlock" data-info="jsx" class="language-jsx jsx"><code><span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">createPortal</span><span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">modal-overlay </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>className<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>modal-content<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>title <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>modal-header<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>title<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>modal-body<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>footer <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>modal-footer<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>footer<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span>
  <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="上面说到的-amis-的事件总线event-bus和动作链action-chain功能在-amis-的源码里面是怎么实现的">上面说到的 amis 的事件总线（Event Bus）和动作链（Action Chain）功能，在 amis 的源码里面是怎么实现的？ </h1>
<h2 id="个人总结">个人总结 </h2>
<p>编辑器里面编辑组件的时候，如果设置的事件监听，那么就将事件监听添加到 <code>rendererEventListeners</code> 集合中，当触发事件时，会遍历该集合，根据权重依次执行监听器。然后每个组件里面自定义监听到事件之后对事件的传参如何处理；比如：通过 setState 去更改自己组件里面数据，从而触发组件的更新。<br>
个人的灵感：之前在思考跨组件的事件传输的时候不知道该怎么处理，如果是平常自己开发可能会通过定义全局 context 的方式，但又不能仅仅为了这个事件处理把全局的数据都注入到当前的组件里面，然后想到在 vue 的 store 之前，vue 是通过 eventbus 来触发的，所以就想到了通过事件总线来触发，然后通过事件总线来传递数据。</p>
<p>AMIS 的事件总线（Event Bus）和动作链（Action Chain）功能主要通过 <strong>全局事件派发机制</strong> 和 <strong>分层动作执行体系</strong> 实现，源码设计围绕组件解耦与动态响应展开。以下是关键实现原理的源码级解析：</p>
<hr>
<h3 id="一-事件总线event-bus实现原理">一、事件总线（Event Bus）实现原理 </h3>
<h4 id="1-事件派发dispatchevent">1. <strong>事件派发（<code>dispatchEvent</code>）</strong> </h4>
<ul>
<li><strong>核心函数</strong>：通过 <code>dispatchEvent</code> 方法派发事件，源码位于 <code>amis-core/src/utils/renderer-event.ts</code>。</li>
<li><strong>流程</strong>：
<ol>
<li><strong>参数处理</strong>：接收事件名 <code>eventName</code> 和携带参数 <code>args</code>，支持表达式解析。</li>
<li><strong>事件触发</strong>：调用 <code>amisRequire('event').eventBus.emit(eventName, eventData)</code>，触发全局事件总线。</li>
<li><strong>监听器匹配</strong>：从 <code>rendererEventListeners</code> 集合中筛选匹配的事件监听器，并按权重排序（<code>weight</code> 高的优先执行）。</li>
</ol>
</li>
</ul>
<h4 id="2-事件监听onevent">2. <strong>事件监听（<code>onEvent</code>）</strong> </h4>
<ul>
<li><strong>注册监听</strong>：组件通过 <code>onEvent</code> 配置注册事件监听器，例如：<pre data-role="codeBlock" data-info="json" class="language-json json"><code><span class="token property">"onEvent"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">"customEvent"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"actions"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token property">"actionType"</span><span class="token operator">:</span> <span class="token string">"reload"</span><span class="token punctuation">,</span> <span class="token property">"componentId"</span><span class="token operator">:</span> <span class="token string">"table1"</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li><strong>源码逻辑</strong>：
<ul>
<li>监听器存储在 <code>rendererEventListeners</code> 中，每个监听器包含 <code>type</code>（事件名）、<code>renderer</code>（组件实例）、<code>actions</code>（动作链）。</li>
<li>事件触发时，遍历匹配的监听器，依次执行关联的 <code>actions</code>。</li>
</ul>
</li>
</ul>
<hr>
<h3 id="二-动作链action-chain执行机制">二、动作链（Action Chain）执行机制 </h3>
<h4 id="1-动作定义与执行">1. <strong>动作定义与执行</strong> </h4>
<ul>
<li><strong>动作类型</strong>：包括 <code>reload</code>（刷新组件）、<code>setValue</code>（设置值）、<code>ajax</code>（请求数据）等，每种动作对应一个实现类（如 <code>CmptAction</code>、<code>AjaxAction</code>）。</li>
<li><strong>执行流程</strong>：
<ol>
<li><strong>动作解析</strong>：根据 <code>actionType</code> 查找对应的动作类（如 <code>actionType: 'reload'</code> 对应 <code>CmptAction</code>）。</li>
<li><strong>目标定位</strong>：通过 <code>componentId</code> 或 <code>componentName</code> 定位目标组件，例如：<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// CmptAction.ts 源码片段</span>
<span class="token keyword keyword-const">const</span> component <span class="token operator">=</span> event<span class="token punctuation">.</span>context<span class="token punctuation">.</span>scoped<span class="token punctuation">.</span><span class="token function">getComponentById</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
<li><strong>执行动作</strong>：调用组件的 <code>doAction</code> 方法或直接操作组件状态（如 <code>component.setData()</code>）。</li>
</ol>
</li>
</ul>
<h4 id="2-动作链顺序控制">2. <strong>动作链顺序控制</strong> </h4>
<ul>
<li><strong>串行执行</strong>：通过 <code>runActions</code> 函数按顺序执行多个动作，源码中通过循环依次调用 <code>runAction</code>：<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// renderer-event.ts</span>
<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> actionConfig <span class="token keyword keyword-of">of</span> actions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-await">await</span> <span class="token function">runAction</span><span class="token punctuation">(</span>actionInstance<span class="token punctuation">,</span> actionConfig<span class="token punctuation">,</span> renderer<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li><strong>异步支持</strong>：使用 <code>async/await</code> 处理异步动作（如 AJAX 请求）。</li>
</ul>
<hr>
<h3 id="三-组件间通信与数据流">三、组件间通信与数据流 </h3>
<h4 id="1-组件标识与查找">1. <strong>组件标识与查找</strong> </h4>
<ul>
<li><strong>唯一标识</strong>：组件通过 <code>id</code> 或 <code>name</code> 唯一标识，源码中通过 <code>getComponentById</code> 或 <code>getComponentByName</code> 方法查找目标组件。<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// CmptAction.ts 源码</span>
<span class="token keyword keyword-const">const</span> component <span class="token operator">=</span>
  renderer<span class="token punctuation">.</span>props<span class="token punctuation">.</span>$schema<span class="token punctuation">.</span>id <span class="token operator">===</span> key
    <span class="token operator">?</span> renderer
    <span class="token operator">:</span> event<span class="token punctuation">.</span>context<span class="token punctuation">.</span>scoped<span class="token punctuation">.</span><span class="token function">getComponentById</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
</ul>
<h4 id="2-数据更新与响应">2. <strong>数据更新与响应</strong> </h4>
<ul>
<li><strong>数据绑定</strong>：通过 <code>setValue</code> 动作更新组件数据，底层调用 <code>component.setData()</code> 或 <code>props.onChange</code>：<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// CmptAction.ts 源码</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>component<span class="token operator">?.</span>setData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  component<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>args<span class="token operator">?.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
  component<span class="token operator">?.</span>props<span class="token punctuation">.</span>onChange<span class="token operator">?.</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>args<span class="token operator">?.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li><strong>动态渲染</strong>：数据变更触发组件重新渲染，依赖 MobX 状态管理（如 <code>RendererStore</code> 树）。</li>
</ul>
<hr>
<h3 id="四-高级特性实现">四、高级特性实现 </h3>
<h4 id="1-跨层级通信">1. <strong>跨层级通信</strong> </h4>
<ul>
<li><strong>全局事件</strong>：通过 <code>eventBus</code> 实现跨页面或弹窗通信，例如：<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// 派发全局事件</span>
<span class="token function">amisRequire</span><span class="token punctuation">(</span><span class="token string">'event'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>eventBus<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'globalUpdate'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'userChange'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
<li><strong>作用域隔离</strong>：<code>StatusScoped</code> 组件为模态框提供独立状态作用域，避免数据污染。</li>
</ul>
<h4 id="2-自定义动作">2. <strong>自定义动作</strong> </h4>
<ul>
<li><strong>脚本执行</strong>：通过 <code>CustomAction</code> 支持 JavaScript 脚本动态编排动作链：<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token comment">// CustomAction.ts 源码</span>
<span class="token keyword keyword-const">const</span> scriptFunc <span class="token operator">=</span> <span class="token function">str2AsyncFunction</span><span class="token punctuation">(</span>
  action<span class="token punctuation">.</span>script<span class="token punctuation">,</span>
  <span class="token string">'context'</span><span class="token punctuation">,</span>
  <span class="token string">'doAction'</span><span class="token punctuation">,</span>
  <span class="token string">'event'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-await">await</span> <span class="token function">scriptFunc</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>
  <span class="token keyword keyword-null">null</span><span class="token punctuation">,</span>
  renderer<span class="token punctuation">,</span>
  action <span class="token operator">=&gt;</span> <span class="token function">runActions</span><span class="token punctuation">(</span>action<span class="token punctuation">,</span> renderer<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">,</span>
  event
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
</ul>
<hr>
<h3 id="五-调试与扩展">五、调试与扩展 </h3>
<h4 id="1-调试工具">1. <strong>调试工具</strong> </h4>
<ul>
<li><strong><code>debugger</code> 动作</strong>：在动作链中插入 <code>debugger</code> 可暂停执行并查看事件参数：<pre data-role="codeBlock" data-info="json" class="language-json json"><code><span class="token punctuation">{</span> <span class="token property">"actionType"</span><span class="token operator">:</span> <span class="token string">"debugger"</span><span class="token punctuation">,</span> <span class="token property">"args"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"eventData"</span><span class="token operator">:</span> <span class="token string">"${event.data}"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
</code></pre></li>
</ul>
<h4 id="2-扩展机制">2. <strong>扩展机制</strong> </h4>
<ul>
<li><strong>注册新动作</strong>：继承 <code>RendererAction</code> 接口并实现 <code>run</code> 方法，通过 <code>registerAction</code> 注册到 AMIS 核心。</li>
</ul>
<hr>
<h3 id="总结-9">总结 </h3>
<p>AMIS 通过 <strong>事件总线</strong> 实现组件间解耦通信，<strong>动作链</strong> 机制则提供灵活的业务逻辑编排能力。源码设计上，<code>dispatchEvent</code> 和 <code>onEvent</code> 负责事件传递，<code>CmptAction</code>、<code>AjaxAction</code> 等实现具体动作逻辑，结合 MobX 状态管理实现高效响应。这种设计使得低代码场景下的复杂交互无需传统编码即可实现。</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="js-使用-utf-16-还是-utf-8-编码">js 使用 utf-16 还是 utf-8 编码？ </h1>
<p>JavaScript 的编码方式需从<strong>源码文件编码</strong>和<strong>字符串内部编码</strong>两个层面分析，具体如下：</p>
<hr>
<h3 id="一-源码文件编码默认支持-utf-8">一、源码文件编码：默认支持 UTF-8 </h3>
<p>JavaScript 源码文件本身通常采用 <strong>UTF-8</strong> 编码，原因包括：</p>
<ol>
<li><strong>兼容性</strong>：UTF-8 向后兼容 ASCII 码，适合处理英文和国际化字符。</li>
<li><strong>网络传输效率</strong>：UTF-8 对常见字符（如拉丁字母）的压缩效率更高，适合互联网传输。</li>
<li><strong>开发工具支持</strong>：现代 IDE 和构建工具（如 Webpack、Vite）默认使用 UTF-8 解析代码。</li>
</ol>
<hr>
<h3 id="二-字符串内部编码运行时使用-utf-16">二、字符串内部编码：运行时使用 UTF-16 </h3>
<p>JavaScript 引擎在运行时将字符串存储为 <strong>UTF-16</strong> 编码，具体表现为：</p>
<ol>
<li><strong>底层实现</strong>：每个字符占用 2 个字节（基本平面字符）或 4 个字节（辅助平面字符，通过代理对实现）。</li>
<li><strong>与 Unicode 的关系</strong>：JavaScript 字符串直接映射 Unicode 码点，例如 <code>'A'.charCodeAt(0)</code> 返回 Unicode 码点 <code>U+0041</code>。</li>
<li><strong>非 BMP 字符处理</strong>：对于辅助平面字符（如 Emoji 🚀），JavaScript 使用 UTF-16 的代理对（Surrogate Pairs）表示。例如 <code>'🚀'.length === 2</code>，因为该字符被拆分为两个 16 位码元。</li>
</ol>
<hr>
<h3 id="三-编码差异引发的问题与解决方案">三、编码差异引发的问题与解决方案 </h3>
<ol>
<li>
<p><strong>前后端数据交互乱码</strong><br>
• <strong>问题</strong>：服务端返回的 UTF-8 数据可能在 JavaScript 中被误解析（如 <code>JSON.parse</code> 处理非 ASCII 字符）。<br>
• <strong>解决</strong>：明确约定接口编码为 UTF-8，并在前端通过 <code>TextDecoder</code> 转换。</p>
</li>
<li>
<p><strong>字符串长度计算错误</strong><br>
• <strong>问题</strong>：辅助平面字符在 UTF-16 中被拆分为两个码元，导致 <code>length</code> 属性不准确（如 <code>'🔥'.length === 2</code>）。<br>
• <strong>解决</strong>：使用 <code>[...str].length</code> 或 <code>Array.from(str).length</code> 按码点计算实际字符数。</p>
</li>
<li>
<p><strong>文件读写编码差异</strong><br>
• <strong>问题</strong>：Node.js 中 <code>Buffer</code> 默认使用 UTF-8，而字符串是 UTF-16，直接转换可能导致数据损坏。<br>
• <strong>解决</strong>：读写文件时显式指定编码，例如 <code>fs.readFileSync('file.txt', 'utf16le')</code>。</p>
</li>
</ol>
<hr>
<h3 id="四-编码选择建议">四、编码选择建议 </h3>
<ol>
<li><strong>源码文件</strong>：优先使用 UTF-8，确保跨平台兼容性。</li>
<li><strong>字符串操作</strong>：需注意 UTF-16 的代理对机制，必要时使用 ES6 的 <code>codePointAt()</code> 和 <code>String.fromCodePoint()</code> 处理辅助平面字符。</li>
<li><strong>数据交互</strong>：前后端统一使用 UTF-8，避免编码不一致导致的乱码。</li>
</ol>
<hr>
<h3 id="总结-10">总结 </h3>
<p>JavaScript 的<strong>源码文件</strong>通常采用 UTF-8，而<strong>运行时字符串</strong>使用 UTF-16 编码。理解两者的差异对处理国际化字符、文件操作和网络传输至关重要。开发中需根据场景选择合适编码，并结合 ES6 特性规避编码陷阱。</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="小程序蓝牙开门的顺序">小程序蓝牙开门的顺序 </h1>
<ol>
<li>判断用户是否已经授权蓝牙（安卓还需要授权定位权限），</li>
<li>判断蓝牙是否开启（安卓需要判断定位是否也开启了），没有的话需要提示用户去开启</li>
<li>然后开启蓝牙适配器（ios 需要主从机模式都调用一遍）wx.openBluetoothAdapter</li>
<li>开始搜索蓝牙设备 wx.startBluetoothDevicesDiscovery</li>
<li>获取所有已经搜索到的设备 wx.getBluetoothDevices</li>
<li>同时监听搜索到新设备的事件 wx.onBluetoothDeviceFound</li>
<li>对所有搜索到的蓝牙设备进行处理</li>
</ol>
<ul>
<li>蓝牙设备的名字 deviceName 满足要求</li>
<li>蓝牙设备的信号强度 RSSI 大于-85dBm</li>
</ul>
<ol start="8">
<li>处理开门的逻辑</li>
<li>组装蓝牙的信息并使用密钥加密</li>
</ol>
<ul>
<li>加密使用 crypto-js 工具，模式是 ECB，填充模式是 PKCS7</li>
</ul>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token keyword keyword-const">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token maybe-class-name">CryptoJS</span><span class="token punctuation">.</span><span class="token property-access">mode</span><span class="token punctuation">.</span><span class="token constant">ECB</span><span class="token punctuation">,</span>
  <span class="token literal-property property">padding</span><span class="token operator">:</span> <span class="token maybe-class-name">CryptoJS</span><span class="token punctuation">.</span><span class="token property-access">pad</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Pkcs7</span></span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> key <span class="token operator">=</span> <span class="token maybe-class-name">CryptoJS</span><span class="token punctuation">.</span><span class="token property-access">enc</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Utf8</span></span><span class="token punctuation">.</span><span class="token method function property-access">parse</span><span class="token punctuation">(</span><span class="token constant">KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> encryptedData <span class="token operator">=</span> <span class="token maybe-class-name">CryptoJS</span><span class="token punctuation">.</span><span class="token constant">AES</span><span class="token punctuation">.</span><span class="token method function property-access">encrypt</span><span class="token punctuation">(</span>plaintText<span class="token punctuation">,</span> key<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'.....encryptedData数据加密结果'</span><span class="token punctuation">,</span> encryptedData<span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword control-flow keyword-return">return</span> encryptedData<span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><ol start="10">
<li>组装完整的开门数据，如：在开门的信息字符串前面加字符串'open:'</li>
<li>给开门数据字符串的每一位都转成为码点(charCodeAt 这个方法返回的是这个位置的字符的 Unicode 的十进制的表示值，因为 js 是使用 utf-16 的编码方式，所以返回的值与 Unicode 字符集里的数据相等)，然后再将码点转成为 16 进制字符串，如：str.charCodeAt(0).toString(16)，字符串不足 2 位则前面补 0 成 2 位，然后每 2 位一组组成数组（因为 2 位十六进制就是 1 字节），如：['01', '02', '03', '04']，最后再添加结束标识，如：'0D'</li>
<li>因为蓝牙 5.0，每次只能发送 128 字节，所以将上面的数据分成多个 128 字节的数据块</li>
<li>发送之前还要将数据转换成 ArrayBuffer</li>
</ol>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token keyword keyword-const">const</span> <span class="token function-variable function">transferWriteData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">writeData</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-let">let</span> buffer <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span>writeData<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-let">let</span> dataView <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">DataView</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-let">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> writeData<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'.....0x'</span> <span class="token operator">+</span> writeData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// setUint8：写入 1 个字节的 8 位无符号整数</span>
    dataView<span class="token punctuation">.</span><span class="token method function property-access">setUint8</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'0x'</span> <span class="token operator">+</span> writeData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword module keyword-as">as</span> any<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow keyword-return">return</span> buffer<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><ol start="14">
<li>连接蓝牙设备，使用 wx.createBLEConnection</li>
<li>获取当前 deviceId 对应蓝牙设备的所有蓝牙服务 wx.getBLEDeviceServices</li>
<li>循环遍历获取所有服务的所有特征值，直到获取“通知”和“写”的特征值，以及这 2 个特征值所在的服务；比如写，如果有这个特征值，说明此设备支持写入操作 wx.getBLEDeviceCharacteristics</li>
<li>接下来做 2 件事</li>
</ol>
<ul>
<li>启用对蓝牙设备特征值变化的监听 wx.notifyBLECharacteristicValueChange 和 wx.onBLECharacteristicValueChange</li>
<li>向蓝牙设备写入数据 wx.writeBLECharacteristicValue</li>
</ul>
<ol start="18">
<li>写入成功后，同时特征值变化了，拿到设备向手机发送的数据，这个数据是 ArrayBuffer 类型，需要先转换成 js 可以处理的码点数据，然后再转成字符串，如：ab2hex(data)</li>
</ol>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token keyword keyword-const">const</span> <span class="token function-variable function">ab2hex</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">buffer</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-var">var</span> hexArr <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span><span class="token property-access">prototype</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">.</span><span class="token method function property-access">call</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">bit</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-return">return</span> <span class="token punctuation">(</span><span class="token string">'00'</span> <span class="token operator">+</span> bit<span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-return">return</span> hexArr<span class="token punctuation">.</span><span class="token method function property-access">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> <span class="token function-variable function">hexToStr</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">hexContent</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-let">let</span> c <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-let">let</span> result <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-let">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> hexContent<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    c <span class="token operator">+=</span> hexContent<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result <span class="token operator">+=</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">.</span><span class="token method function property-access">fromCharCode</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      c <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow keyword-return">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><ol start="19">
<li>根据最后转换得出的字符串，判断是否是开门成功的结果，如：'open:0'，则是成功</li>
<li>最后停止蓝牙设备的搜索 wx.stopBluetoothDevicesDiscovery 停止搜索，同时关闭蓝牙适配器 wx.closeBluetoothAdapter</li>
</ol>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="朝昔问卷系统的校验逻辑">朝昔问卷系统的校验逻辑 </h1>
<ul>
<li>现在的渲染模式是 h5 页面下一页一题，必填的题目如果没有答完的话就不能跳转下一题，</li>
<li>而假想现在如果支持所有题目在一个 h5 页面上渲染出来，要想完成校验，就必须做如下处理</li>
<li>
<ol>
<li>初始的时候给 quetions 这个数组里面的题目的配置数据里面手动加一个 next 指针指向下一个元素，使其变成一个单向链表来记录当前问卷上希望用户回答的所有题目，链表的每一项内容是题目的 index 和 type，以及 next 指针；</li>
</ol>
</li>
<li>
<ol start="2">
<li>初始的时候是按照顺序渲染，所以当用户点击下一题的时候，会根据当前题目的 index 和 type，从单向链表中找到下一个题目的 index 和 type，然后跳转到下一个题目，</li>
</ol>
</li>
<li>
<ol start="3">
<li>如果中间有一道题目 A 跨题跳转了，那么当前题目的 next 指针就需要更新至跨到的那一题</li>
</ol>
</li>
<li>
<ol start="4">
<li>如果 A 后面又重新修改了，改完后不跨题了，那么就需要更新该题目的 next 指针，指向下一个题目的 index 和 type；然后还要遍历更新后面所有的指针</li>
</ol>
</li>
<li>
<ol start="5">
<li>这样到最后校验的时候，遍历指针调用校验引擎进行每个题目校验即可</li>
</ol>
</li>
</ul>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="为什么在-js-中--的结果是-true">为什么在 js 中 ![]==[] 的结果是 true </h1>
<p>在 JavaScript 中，<code>![] == []</code> 的结果为 <code>true</code>，这与 JavaScript 的隐式类型转换规则密切相关。以下是其转换逻辑的分步解析：</p>
<hr>
<p><strong>1. 操作符优先级与类型转换</strong><br>
• <code>![]</code> 的转换：</p>
<p><code>!</code> 是逻辑非操作符，会先将 <code>[]</code>（空数组）转换为布尔值。由于空数组是对象，在布尔上下文中为 <code>true</code>，因此 <code>!true</code> 得到 <code>false</code>。</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span> → <span class="token operator">!</span><span class="token boolean">true</span> → <span class="token boolean">false</span>
</code></pre><p>• 比较表达式：</p>
<p>此时表达式变为 <code>false == []</code>，需要将两边的值转换为相同类型。</p>
<hr>
<p><strong>2. 布尔值与对象的比较规则</strong><br>
当 <code>==</code> 两侧类型不同时，JavaScript 会按以下规则转换：<br>
• 布尔值转为数字：</p>
<p><code>false</code> 转换为数字 <code>0</code>。</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token boolean">false</span> → <span class="token number">0</span>
</code></pre><p>• 对象转为原始值：</p>
<p><code>[]</code>（空数组）作为对象，会调用 <code>toString()</code> 方法转换为字符串 <code>""</code>。</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> → <span class="token string">""</span>
</code></pre><hr>
<p><strong>3. 字符串与数字的最终比较</strong><br>
• 空字符串转数字：</p>
<p>JavaScript 继续将 <code>""</code> 转换为数字 <code>0</code>。</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token string">""</span> → <span class="token number">0</span>
</code></pre><p>• 数值比较：</p>
<p>此时表达式变为 <code>0 == 0</code>，结果为 <code>true</code>。</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token number">0</span> <span class="token operator">==</span> <span class="token number">0</span> → <span class="token boolean">true</span>
</code></pre><hr>
<p><strong>4. 关键转换步骤总结</strong></p>
<table>
<thead>
<tr>
<th>步骤</th>
<th>转换后的值</th>
<th>依据规则</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>![]</code></td>
<td><code>false</code>（布尔值）</td>
<td>空数组为真值，<code>!</code> 取反后为 <code>false</code>。</td>
</tr>
<tr>
<td><code>false</code> 转数字</td>
<td><code>0</code></td>
<td>布尔值 <code>false</code> 在数值上下文中为 <code>0</code>。</td>
</tr>
<tr>
<td><code>[]</code> 转字符串</td>
<td><code>""</code></td>
<td>对象通过 <code>toString()</code> 转换为空字符串。</td>
</tr>
<tr>
<td><code>""</code> 转数字</td>
<td><code>0</code></td>
<td>空字符串在数值上下文中为 <code>0</code>。</td>
</tr>
<tr>
<td>最终比较</td>
<td><code>0 == 0</code> → <code>true</code></td>
<td>数值相等规则。</td>
</tr>
</tbody>
</table>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="sentry-原理">sentry 原理 </h1>
<ol>
<li>全局捕获</li>
</ol>
<ul>
<li>
<p>通过全局的接口，将捕获代码集中写在一个地方，可以利用的接口有：<code>window.addEventListener(‘error’) / window.addEventListener(“unhandledrejection”)     / document.addEventListener(‘click’) </code>等</p>
</li>
<li>
<p>框架级别的全局监听，例如<code>aixos</code>中使用<code>interceptor</code>进行拦截，<code>vue</code>、<code>react</code>都有自己的错误采集接口</p>
</li>
<li>
<p>通过对全局函数进行封装包裹，实现在在调用该函数时自动捕获异常：对实例方法重写（Patch），在原有功能基础上包裹一层，例如对<code>setTimeout</code>进行重写，在使用方法不变的情况下也可以异常捕获</p>
</li>
</ul>
<ol start="2">
<li>单点捕获</li>
</ol>
<ul>
<li>在业务代码中对单个代码块进行包裹，或在逻辑流程中打点，实现有针对性的异常捕获：</li>
<li>try…catch</li>
<li>专门写一个函数来收集异常信息，在异常发生时，调用该函数</li>
<li>专门写一个函数来包裹其他函数，得到一个新函数，该新函数运行结果和原函数一模一样，只是在发生异常时可以捕获异常</li>
</ul>
<h2 id="详细讲解">详细讲解 </h2>
<ol>
<li>
<p><code>window.onerror</code><br>
监控 JavaScript 运行时错误（包括语法错误）</p>
</li>
<li>
<p>监听<code>unhandledrejection</code>事件<br>
未被 catch 的 reject 状态的 promise</p>
</li>
<li>
<p><code>setTimeout、setInterval、requestAnimationFrame</code><br>
其实就是重写 window 下面的这些方法，通过代理的方式把原来的方法拦截一下在调用真实的方法之前做一些自己的事情</p>
</li>
</ol>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token keyword keyword-const">const</span> prevSetTimeout <span class="token operator">=</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">setTimeout</span><span class="token punctuation">;</span>

<span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">setTimeout</span> <span class="token operator">=</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">callback<span class="token punctuation">,</span> timeout</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> self <span class="token operator">=</span> <span class="token keyword keyword-this">this</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-return">return</span> <span class="token function">prevSetTimeout</span><span class="token punctuation">(</span><span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-try">try</span> <span class="token punctuation">{</span>
      callback<span class="token punctuation">.</span><span class="token method function property-access">call</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-catch">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 捕获到详细的错误，在这里处理日志上报等了逻辑</span>
      <span class="token comment">// ...</span>
      <span class="token keyword control-flow keyword-throw">throw</span> e<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><ol start="4">
<li>
<p><code>Vue.config.errorHandler</code></p>
</li>
<li>
<p>React 的<code>ErrorBoundary</code><br>
sentry 是通过重写<code>ErrorBoundary.prototype.componentDidCatch</code>方法来植入监控上报的</p>
</li>
<li>
<p>XHR 通过重写（拦截）send 和 open</p>
</li>
<li>
<p>axios 通过请求/响应拦截器</p>
</li>
<li>
<p>标记 dom 事件 handler<br>
所有的 dom 节点都继承自 window.Node 对象，dom 对象的 addEventListener 方法来自 Node 的 prototype 对象。<br>
为了标记 dom 事件 handler，Sentry 对 Node.prototype.addEventListener 进行了劫持覆写。新的 addEventListener 方法调用时，同样会使用 try ... catch 语句块包裹传入的 handler。</p>
</li>
</ol>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="nextjs-里面从服务端渲染切换到客户端渲染的时候客户端-react-是如何接管组件还有状态等">nextjs 里面从服务端渲染切换到客户端渲染的时候，客户端 React 是如何接管组件还有状态等？ </h1>
<p>在 Next.js 中，当从服务端渲染（SSR）切换到客户端渲染（CSR）时，React 通过 水合（Hydration） 机制接管组件和状态，这一过程结合了服务端生成的静态 HTML 与客户端的动态逻辑。以下是具体实现原理和流程：</p>
<hr>
<p>一、服务端渲染（SSR）与客户端渲染（CSR）的协作流程</p>
<ol>
<li><strong>初始服务端渲染（SSR）</strong></li>
</ol>
<ul>
<li>
<p>HTML 生成：服务端组件（Server Components）在服务器上生成静态 HTML，包括客户端组件的占位符。例如，在 <code>app</code> 目录下的页面默认是服务端组件，即使客户端组件也会生成初始 HTML。</p>
</li>
<li>
<p>数据嵌入：服务端通过 <code>getServerSideProps</code> 或 <code>fetch</code> 获取数据，并将数据序列化后注入到 HTML 的 <code>&lt;script id="__NEXT_DATA__"&gt;</code> 中，供客户端复用。</p>
</li>
</ul>
<ol start="2">
<li><strong>客户端接管（Hydration）</strong></li>
</ol>
<ul>
<li>
<p>加载客户端脚本：浏览器接收到 HTML 后，加载 Next.js 的客户端 JavaScript 包（如 <code>_next/static</code> 中的文件）。</p>
</li>
<li>
<p>水合过程：</p>
</li>
<li>
<p>React 调用 <code>ReactDOM.hydrate()</code> 或 <code>ReactDOM.createRoot().hydrate()</code>，将服务端生成的静态 DOM 与客户端的虚拟 DOM 进行对比。</p>
</li>
<li>
<p>状态初始化：从 <code>__NEXT_DATA__</code> 中提取服务端传递的初始状态（如 props），并注入到客户端组件的初始状态（如 <code>useState</code>）。</p>
</li>
<li>
<p>事件绑定：为静态 HTML 元素附加事件监听器（如点击、输入），使其具备交互性。</p>
</li>
</ul>
<hr>
<p>二、关键机制：状态与组件的无缝接管</p>
<ol>
<li><strong>数据传递与序列化</strong></li>
</ol>
<ul>
<li>
<p>服务端数据序列化：服务端通过 <code>getServerSideProps</code> 或异步组件获取的数据会被序列化为 JSON，并嵌入 HTML 的全局变量 <code>__NEXT_DATA__</code> 中。</p>
</li>
<li>
<p>客户端反序列化：客户端初始化时解析 <code>__NEXT_DATA__</code>，将数据反序列化为 JavaScript 对象，并作为 props 传递给客户端组件。</p>
</li>
</ul>
<ol start="2">
<li><strong>动态组件的状态管理</strong></li>
</ol>
<ul>
<li>
<p>客户端组件标记：使用 <code>"use client"</code> 声明的组件会在客户端执行，但初始 HTML 仍由服务端生成。</p>
</li>
<li>
<p>状态同步：</p>
</li>
<li>
<p>客户端组件首次渲染时，直接使用服务端传递的 props 初始化状态（如 <code>useState(initialProps)</code>）。</p>
</li>
<li>
<p>若后续需要动态更新（如用户交互），客户端组件通过 <code>useEffect</code> 或客户端数据请求（如 <code>fetch</code>）重新获取数据并更新状态。</p>
</li>
</ul>
<ol start="3">
<li><strong>DOM 协调（Reconciliation）</strong></li>
</ol>
<ul>
<li>
<p>复用静态 DOM：React 在 Hydration 过程中会复用服务端生成的 DOM 结构，而非重新创建，避免页面闪烁。</p>
</li>
<li>
<p>差异对比：React 对比服务端生成的 DOM 与客户端虚拟 DOM 的差异，仅更新需要变更的部分（如动态表单的输入值）。</p>
</li>
</ul>
<hr>
<p>三、场景示例：从 SSR 切换到 CSR</p>
<ol>
<li><strong>SSR 降级为 CSR</strong><br>
• 服务端渲染失败时：若服务端请求数据失败，可以通过 <code>try/catch</code> 返回空 props，客户端在 <code>useEffect</code> 中重新发起请求。</li>
</ol>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 服务端组件（SSR）</span>
<span class="token keyword module keyword-export">export</span> <span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">getServerSideProps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-try">try</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> data <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow keyword-return">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-catch">catch</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-return">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 触发客户端重新请求</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 客户端组件（CSR）</span>
<span class="token punctuation">(</span><span class="token string">'use client'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-function">function</span> <span class="token function"><span class="token maybe-class-name">Page</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>localData<span class="token punctuation">,</span> setLocalData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>data<span class="token punctuation">)</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span>setLocalData<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 客户端补全数据</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-return">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span>localData<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><ol start="2">
<li><strong>混合渲染模式</strong><br>
• 静态部分 SSR + 动态部分 CSR：服务端渲染静态内容（如导航栏），客户端接管交互部分（如表单）。</li>
</ol>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 服务端组件（静态部分）</span>
<span class="token keyword module keyword-export">export</span> <span class="token keyword module keyword-default">default</span> <span class="token keyword keyword-function">function</span> <span class="token function"><span class="token maybe-class-name">Layout</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-return">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token maybe-class-name">StaticNavbar</span> <span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token comment">/* 服务端渲染 */</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token maybe-class-name">ClientForm</span> <span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token comment">/* 客户端渲染 */</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 客户端组件（动态表单）</span>
<span class="token punctuation">(</span><span class="token string">'use client'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-function">function</span> <span class="token function"><span class="token maybe-class-name">ClientForm</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>input<span class="token punctuation">,</span> setInput<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-return">return</span> <span class="token operator">&lt;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>input<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=&gt;</span> <span class="token function">setInput</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<p>四、性能与注意事项</p>
<ol>
<li>SEO 优化：服务端生成的静态 HTML 确保爬虫可索引内容，而客户端动态逻辑不影响 SEO。</li>
<li>避免 Hydration 不匹配：服务端与客户端渲染结果需保持一致，否则会导致控制台警告或页面错误。</li>
<li>状态持久化：若需保留客户端状态（如滚动位置），需结合 <code>useEffect</code> 和本地存储（如 <code>localStorage</code>）。</li>
</ol>
<hr>
<p>总结<br>
Next.js 通过 服务端生成静态 HTML + 客户端 Hydration 的机制，实现了从 SSR 到 CSR 的无缝切换。核心步骤包括：</p>
<ol>
<li>服务端渲染并嵌入数据（<code>__NEXT_DATA__</code>）。</li>
<li>客户端加载脚本并解析初始状态。</li>
<li>React 水合过程复用 DOM 并绑定交互逻辑。</li>
<li>客户端组件接管后动态更新状态。</li>
</ol>
<p>这种设计既保证了首屏性能与 SEO，又支持复杂的客户端交互，是 Next.js 混合渲染能力的核心。</p>
<hr>
<hr>
<hr>
<hr>
<h1 id="四说一说从输入-url-到页面呈现发生了什么">四.说一说从输入 URL 到页面呈现发生了什么 </h1>
<ol>
<li>构建请求</li>
<li>查找强缓存</li>
<li>DNS 解析获取真正的 ip 地址（<a href="http://xn--www-vs9d.baidu.com">以www.baidu.com</a>）（本地hosts-》浏览器缓存-》本地域名服务器缓存-》路由器缓存-》isp缓存-》根域名服务器） 0. 先查浏览器中有没有相关 dns 缓存
<ol>
<li>再查本地 hosts 文件件是否有记录</li>
<li>hosts 文件没有就去查本地 dns 解析器有没有缓存</li>
<li>然后就去找我们计算机上配置的 dns 服务器上有或者有缓存</li>
<li>还没有的话就去找根 DNS 服务器(全球 13 台，固定 ip 地址)，<a href="http://xn--fcr89by04ao1k.com">然后判断.com</a> 域名是哪个服务器管理，如果无法解析，<a href="http://xn--xfto0ms0e.baidu.com">就查找.baidu.com</a> 服务器是否能解析，直到查到www.baidu.com的IP地址
<blockquote>
<p>前端的 dns 优化，可以在 html 页面头部写入 dns 地址预解析</p>
</blockquote>
</li>
</ol>
<pre data-role="codeBlock" data-info="html" class="language-html html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>x-dns-prefetch-control<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>on<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://bdimg.share.baidu.com<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></li>
<li>建立 TCP 连接<br>
TCP（Transmission Control Protocol，传输控制协议）是一种面向连接的、可靠的、基于字节流的传输层通信协议。<br>
建立 TCP 连接经历了下面三个阶段: 1. 通过三次握手(即总共发送 3 个数据包确认已经建立连接)建立客户端和服务器之间的连接。 &gt; 1. 客户端发送 SYN=1, 随机数 seq=x; &gt; 2. 服务端返回 ACK=x+1,SYN=1 以及服务端的 seq=y； &gt; 3. 客户端接收到后就返回 ACK=y+1，seq=z 2. 进行数据传输。这里有一个重要的机制，就是接收方接收到数据包后必须要向发送方确认, 如果发送方没有接到这个确认的消息，就判定为数据包丢失，并重新发送该数据包。当然，发送的过程中还有一个优化策略，就是把大的数据包拆成一个个小包，依次传输到接收方，接收方按照这个小包的顺序把它们组装成完整数据包。 3. 断开连接的阶段。数据传输完成，现在要断开连接了，通过四次挥手来断开连接。</li>
</ol>
<ul>
<li>为什么需要 3 次握手<br>
因为客户端和服务端双方都需要知道双方的发送,接受能力正常, 否则就有可能发生因为未沟通好, 服务端建立了连接, 但客户端忽略了这次连接, 浪费了资源</li>
<li>什么是半连接队列？<br>
服务器第一次收到客户端的 SYN 之后，就会处于 SYN_RCVD 状态，此时双方还没有完全建立其连接，服务器会把此种状态下请求连接放在一个队列里，我们把这种队列称之为半连接队列。</li>
<li>三次握手过程中可以携带数据吗？<br>
其实第三次握手的时候，是可以携带数据的。但是，第一次、第二次握手不可以携带数据</li>
<li>SYN 攻击是什么？<br>
SYN 攻击就是 Client 在短时间内伪造大量不存在的 IP 地址，并向 Server 不断地发送 SYN 包，Server 则回复确认包，并等待 Client 确认，由于源地址不存在，因此 Server 需要不断重发直至超时，这些伪造的 SYN 包将长时间占用未连接队列，导致正常的 SYN 请求因为队列满而被丢弃，从而引起网络拥塞甚至系统瘫痪。SYN 攻击是一种典型的 DoS/DDoS 攻击。<br>
解决方法: 缩短超时（SYN Timeout）时间 增加最大半连接数 过滤网关防护 SYN cookies 技术</li>
<li>四次挥手:
<ol>
<li>客户端发送一个 FIN 报文</li>
<li>服务端收到 FIN 之后，会发送 ACK 报文, 表示已经接受到报文</li>
<li>如果服务端也想断开连接了，和客户端的第一次挥手一样，发给 FIN 报文</li>
<li>户端收到 FIN 之后，一样发送一个 ACK 报文作为应答，且把服务端的序列号值 +1 作为自己 ACK 报文的序列号值，此时客户端处于 TIME_WAIT 状态。需要过一阵子(等待 2MSL)以确保服务端收到自己的 ACK 报文之后才会进入 CLOSED 状态，服务端收到 ACK 报文之后，就处于关闭连接了，处于 CLOSED 状态。</li>
</ol>
</li>
<li>挥手为什么需要四次？<br>
因为当服务端收到客户端的 SYN 连接请求报文后，可以直接发送 SYN+ACK 报文。其中 ACK 报文是用来应答的，SYN 报文是用来同步的。但是关闭连接时，当服务端收到 FIN 报文时，很可能并不会立即关闭 SOCKET，所以只能先回复一个 ACK 报文，告诉客户端，“你发的 FIN 报文我收到了”。只有等到我服务端所有的报文都发送完了，我才能发送 FIN 报文，因此不能一起发送。故需要四次挥手。</li>
<li>2MSL 等待状态<br>
MSL 是 Maximum Segment Lifetime 的英文缩写，可译为“最长报文段寿命”，它是任何报文在网络上存在的最长时间，超过这个时间报文将被丢弃。<br>
为了保证客户端发送的最后一个 ACK 报文段能够到达服务器。因为这个 ACK 有可能丢失，从而导致处在 LAST-ACK 状态的服务器收不到对 FIN-ACK 的确认报文。服务器会超时重传这个 FIN-ACK，接着客户端再重传一次确认，重新启动时间等待计时器。最后客户端和服务器都能正常的关闭。假设客户端不等待 2MSL，而是在发送完 ACK 之后直接释放关闭，一但这个 ACK 丢失的话，服务器就无法正常的进入关闭连接状态。</li>
</ul>
<ol start="5">
<li>
<p>发送 HTTP 请求(请求行, 请求头, 请求体)</p>
</li>
<li>
<p>服务器处理请求并返回 HTTP 报文(响应行, 响应头, 响应体)</p>
</li>
<li>
<p>浏览器解析渲染页面</p>
<ul>
<li>构建 DOM 树</li>
<li>样式计算, 生成 CSSOM</li>
<li>生成布局树(Layout Tree): DOM 与 CSSOM 组合而成</li>
<li>建立图层树(Layer Tree)</li>
</ul>
<pre data-role="codeBlock" data-info="" class="language-text"><code>以下几种情况会将节点提升为一个单独的图层
  1.HTML根元素本身就具有层叠上下文。
  2.普通元素设置position不为static并且设置了z-index属性，会产生层叠上下文。
  3.元素的 opacity 值不是 1
  4.元素的 transform 值不是 none
  5.元素的 filter 值不是 none
  6.元素的 isolation 值是isolate
  7.will-change指定的属性值为上面任意一个。(will-change的作用后面会详细介绍)
  8.需要剪裁（clip）的地方也会被创建为图层
</code></pre><blockquote>
<p>接下来的流程如下:</p>
</blockquote>
<p><code>流程: 建立图层树(这里会通过显示合成,隐式合成(会有层爆炸问题)生成合成层) -&gt; 生成绘制列表 -&gt; 提交至合成线程 -&gt; 分块(生成图块) -&gt; 绘制视口附近的图块(Chrome会有首次合成优化) -&gt; 调用栅格化线程池进行图块栅格化(GPU硬件加速，将图块转换成位图) -&gt; 生成位图数据 -&gt; 返回给合成线程 -&gt; 合成线程通知浏览器进程绘制进内存 -&gt; 发送给显卡 -&gt; 呈现到显示器上</code></p>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code>结合上图，一个完整的渲染流程大致可总结为如下：
<span class="token number">1.</span>渲染进程将 <span class="token constant">HTML</span> 内容转换为能够读懂的<span class="token constant">DOM</span> 树结构（此过程为增量构建）。
<span class="token number">2.</span>渲染引擎将 <span class="token constant">CSS</span> 样式表转化为浏览器可以理解的styleSheets，计算出 <span class="token constant">DOM</span> 节点的样式，生成<span class="token constant">CSSOM</span>（此过程为同步构建）。
<span class="token number">3.</span>整合<span class="token constant">DOM</span>和<span class="token constant">CSSOM</span>创建布局树，并计算元素的布局信息。
<span class="token number">4.</span>对布局树进行分层，并生成图层树。
<span class="token number">5.</span>为每个图层生成绘制列表，并将其提交到合成线程。
<span class="token number">6.</span>合成线程将图层分成图块，并在光栅化线程池中将图块转换成位图。
<span class="token number">7.</span>合成线程发送绘制图块命令DrawQuad给浏览器进程。
<span class="token number">8.</span>浏览器进程根据 <span class="token maybe-class-name">DrawQuad</span> 消息生成页面，并显示到显示器上。
</code></pre><ul>
<li>生成绘制列表</li>
<li>生成图块并栅格化</li>
<li>显示器显示内容</li>
</ul>
</li>
</ol>
<h3 id="合成层">合成层 </h3>
<p>图层（渲染层）符合以下条件会被提升成合成层，此为显示合成；</p>
<ol>
<li>transform:3D 变换：translate3d，translateZ；</li>
<li>will-change:opacity | transform | filter</li>
<li>对 opacity | transform | fliter 应用了过渡和动画（transition/animation）</li>
<li>video、canvas、iframe 等元素</li>
<li>position: fixed</li>
</ol>
<h3 id="隐式合成">隐式合成 </h3>
<p>当出现一个合成层后，z-index 顺序高于它的<code>堆叠元素</code>(即与它的位置有重叠)就会发生隐式合成。<br>
隐式合成出现的根本原是，元素发生了堆叠，浏览器为了保证最后的展示效果，不得不把层级顺序更高的元素拎出来盖在已有合成层上面。</p>
<h3 id="层爆炸与层压缩">层爆炸与层压缩 </h3>
<p>层爆炸：隐式合成产生了很多预期外的合成层——页面中所有 z-index 高于它的节点全部被提升，这些合成层都是相当消耗内存和 GPU 的。所以带给我们的启示是<code>给合成层一个大的z-index值，避免出现隐式合成</code>；<br>
层压缩：多个渲染层同一个合成层重叠时，浏览器会自动将他们压缩到一起，避免“层爆炸”带来的损耗。</p>
<h3 id="重排">重排 </h3>
<p>如果你通过 JavaScript 或者 CSS 修改元素的几何位置属性，例如改变元素的宽度、高度等，那么浏览器会触发重新布局，解析之后的一系列子阶段，这个过程就叫重排。无疑，重排需要更新完整的渲染流水线，所以开销也是最大的。</p>
<ul>
<li>以下的问题会导致重排：<br>
页面首次渲染<br>
浏览器窗口大小发生改变<br>
元素尺寸或位置发生改变<br>
元素内容变化（文字数量或图片大小等等）<br>
元素字体大小变化<br>
添加或者删除可见的 DOM 元素<br>
激活 CSS 伪类（例如：:hover）<br>
查询某些属性或调用某些方法
<blockquote>
<p>元素的滚动不会造成重排，这块浏览器本身有做相应的优化，</p>
</blockquote>
</li>
<li>减少重排的方法：
<ol>
<li>设置图层脱离文档流--多层次布局：position 属性设为 absolute 或 fixed、float、z-index 等，这样此元素就脱离了文档流，它的变化只会在其内容范围内执行重排，不会影响到其他元素</li>
<li>多个 dom 的新增操作，可以先在内存中构建好 dom，再一次性 append，而不是循环增删</li>
<li>复杂节点操作，先隐藏，再显示</li>
<li>createDocumentFragment，使用文档节点来处理复杂文档操作，再一次性替换已有节点</li>
</ol>
</li>
</ul>
<h3 id="重绘">重绘 </h3>
<p>如果修改了元素的背景颜色，那么布局阶段将不会被执行，因为并没有引起几何位置的变换，所以就直接进入了绘制阶段（生成绘制列表，再提交到合成线程），然后执行之后的一系列子阶段，这个过程就叫重绘。相较于重排操作，重绘省去了布局和分层阶段，所以执行效率会比重排操作要高一些。</p>
<h3 id="合成">合成 </h3>
<blockquote>
<p>渲染引擎将跳过布局和绘制，只执行后续的合成操作，我们把这个过程叫做合成。<br>
使用 CSS 的 transform 来实现动画效果，这可以避开重排和重绘阶段，直接在非主线程上执行合成动画操作。这样的效率是最高的，因为是在非主线程上合成，并没有占用主线程的资源，另外也避开了布局和绘制两个子阶段，所以相对于重绘和重排，合成能大大提升绘制效率。</p>
</blockquote>
<h3 id="css-动画为什么比-js-动画高效">css 动画为什么比 js 动画高效 </h3>
<ol>
<li>因为 js 动画会涉及重排和重绘，会占据主线程资源</li>
<li>css 动画直接跳过布局和绘制，即不用重排和重绘，直接在合成线程上通过变化图层来完成，而且可以使用 gpu 加速，不会阻塞主线程，所以效率更高</li>
</ol>
<h3 id="页面渲染优化">页面渲染优化 </h3>
<ul>
<li>HTML 文档结构层次尽量少，最好不深于六层；</li>
<li>脚本尽量后放，放在前即可；</li>
<li>少量首屏样式内联放在标签内；</li>
<li>样式结构层次尽量简单；</li>
<li>在脚本中尽量减少 DOM 操作，尽量缓存访问 DOM 的样式信息，避免过度触发回流；</li>
<li>减少通过 JavaScript 代码修改元素样式，尽量使用修改 class 名方式操作样式或动画；</li>
<li>动画所在元素尽量提升到一个合成层上，这样就不会影响其他层，而且渲染也直接走合成，不会阻塞 js 主线程；</li>
<li>隐藏在屏幕外，或在页面滚动时，尽量停止动画；</li>
<li>尽量缓存 DOM 查找，查找器尽量简洁；</li>
<li>涉及多域名的网站，可以开启域名预解析</li>
</ul>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="useeffect-和-uselayouteffect-的区别">useEffect 和 useLayouteffect 的区别 </h1>
<p>React 中的 useEffect 和 useLayoutEffect 是处理副作用的两个核心 Hook，主要区别体现在执行时机和对渲染流程的影响上。以下是两者的详细对比：</p>
<h3 id="一-执行时机">一、执行时机 </h3>
<h4 id="useeffect">useEffect </h4>
<ol>
<li>
<p>异步执行：在浏览器完成 DOM 更新、页面绘制（渲染）之后触发，属于宏任务。</p>
</li>
<li>
<p>不阻塞渲染：适合大多数副作用操作（如数据请求、订阅事件等），不会影响用户看到的页面渲染速度。</p>
</li>
</ol>
<h4 id="uselayouteffect">useLayoutEffect </h4>
<ol>
<li>
<p>同步执行：在 DOM 更新后、浏览器绘制之前立即触发，属于同步任务。</p>
</li>
<li>
<p>阻塞渲染：会暂停浏览器的绘制流程，直到其内部的副作用代码执行完毕。因此需避免耗时操作，否则会导致页面卡顿。</p>
</li>
</ol>
<h3 id="二-使用场景">二、使用场景 </h3>
<table>
<thead>
<tr>
<th>场景</th>
<th>useEffect</th>
<th>useLayoutEffect</th>
</tr>
</thead>
<tbody>
<tr>
<td>数据获取</td>
<td>✅（如 API 请求）</td>
<td>❌</td>
</tr>
<tr>
<td>事件监听/取消订阅</td>
<td>✅（如 resize 事件）</td>
<td>❌</td>
</tr>
<tr>
<td>DOM 测量/同步修改</td>
<td>❌（可能导致闪烁）</td>
<td>✅（如调整元素尺寸、避免布局抖动）</td>
</tr>
<tr>
<td>样式更新</td>
<td>❌（可能看到中间状态）</td>
<td>✅（在绘制前完成修改，避免视觉闪烁）</td>
</tr>
<tr>
<td>自动聚焦输入框</td>
<td>❌（可能延迟）</td>
<td>✅（立即执行）</td>
</tr>
</tbody>
</table>
<h4 id="示例对比">示例对比： </h4>
<ol>
<li>
<p>修改 DOM 样式时，useEffect 可能导致元素短暂显示默认状态再更新（闪烁），而 useLayoutEffect 会直接应用最终样式。</p>
</li>
<li>
<p>测量 DOM 元素尺寸（如 Tooltip 定位）需用 useLayoutEffect，确保获取最新布局信息。</p>
</li>
</ol>
<h3 id="三-对渲染流程的影响">三、对渲染流程的影响 </h3>
<h4 id="useeffect-1">useEffect </h4>
<ul>
<li>
<p>渲染流程：组件渲染 → 浏览器绘制 → 触发 useEffect。</p>
</li>
<li>
<p>适用性：适用于非紧急操作，如日志记录、非关键动画。</p>
</li>
</ul>
<h4 id="uselayouteffect-1">useLayoutEffect </h4>
<ul>
<li>
<p>渲染流程：组件渲染 → 触发 useLayoutEffect → 浏览器绘制。</p>
</li>
<li>
<p>风险：同步特性可能导致性能问题，需谨慎使用。</p>
</li>
</ul>
<h3 id="四-执行顺序">四、执行顺序 </h3>
<p>同一组件中：useLayoutEffect 总是先于 useEffect 执行。</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 先执行</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 后执行</span>
</code></pre><h3 id="五-服务端渲染ssr">五、服务端渲染（SSR） </h3>
<p>useEffect：兼容 SSR，可在服务端和客户端执行。</p>
<p>useLayoutEffect：在服务端会触发警告（因无 DOM 环境），需通过条件判断规避。</p>
<h3 id="六-性能与建议">六、性能与建议 </h3>
<ul>
<li>默认选择 useEffect：React 官方推荐优先使用 useEffect，仅在页面异常（如闪烁）时替换为 useLayoutEffect。</li>
</ul>
<h4 id="优化策略">优化策略： </h4>
<p>在 useLayoutEffect 中避免复杂计算，防止阻塞渲染。</p>
<p>对 DOM 操作或布局计算，优先使用 useLayoutEffect，但需控制代码执行时间。</p>
<p>总结对比表</p>
<table>
<thead>
<tr>
<th>特性</th>
<th>useEffect</th>
<th>useLayoutEffect</th>
</tr>
</thead>
<tbody>
<tr>
<td>执行时机</td>
<td>渲染后（异步）</td>
<td>渲染前（同步）</td>
</tr>
<tr>
<td>阻塞渲染</td>
<td>否</td>
<td>是</td>
</tr>
<tr>
<td>适用场景</td>
<td>数据获取、事件监听等非阻塞操作</td>
<td>DOM 同步修改、测量布局</td>
</tr>
<tr>
<td>服务端渲染兼容性</td>
<td>✅</td>
<td>⚠️（需条件判断）</td>
</tr>
<tr>
<td>性能影响</td>
<td>较小</td>
<td>较大（可能卡顿）</td>
</tr>
</tbody>
</table>
<p>建议根据具体场景选择，优先 useEffect，特殊需求（如避免闪烁）再使用 useLayoutEffect。</p>
<hr>
<hr>
<hr>
<hr>
<h1 id="js-怎么让一个属性只读">js 怎么让一个属性只读 </h1>
<p>在 JavaScript 中，让对象属性变为只读可通过以下 5 种主流方法实现，根据场景选择最合适的方案：</p>
<p>一、Object.defineProperty() 精准控制（推荐）<br>
通过属性描述符定义只读属性，适用于单个属性的精细控制：</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token keyword keyword-const">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'readOnlyProp'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'不可修改的值'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">writable</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 禁止直接赋值</span>
  <span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 禁止删除或重新配置属性</span>
  <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 允许遍历</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

obj<span class="token punctuation">.</span><span class="token property-access">readOnlyProp</span> <span class="token operator">=</span> <span class="token string">'新值'</span><span class="token punctuation">;</span> <span class="token comment">// 非严格模式下静默失败，严格模式报错</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token property-access">readOnlyProp</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出原值</span>
</code></pre><p>注意：若 configurable: true，仍可通过重新调用 Object.defineProperty() 覆盖配置。</p>
<p>二、Object.freeze() 冻结对象（批量只读）<br>
冻结整个对象，使所有属性不可修改、删除或新增：</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token keyword keyword-const">const</span> obj <span class="token operator">=</span> <span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">freeze</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">prop1</span><span class="token operator">:</span> <span class="token string">'值1'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">nested</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">'值2'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

obj<span class="token punctuation">.</span><span class="token property-access">prop1</span> <span class="token operator">=</span> <span class="token string">'新值'</span><span class="token punctuation">;</span> <span class="token comment">// 修改失败</span>
obj<span class="token punctuation">.</span><span class="token property-access">nested</span><span class="token punctuation">.</span><span class="token property-access">key</span> <span class="token operator">=</span> <span class="token string">'新值'</span><span class="token punctuation">;</span> <span class="token comment">// 浅冻结漏洞，嵌套对象仍可修改</span>
</code></pre><p>深层冻结方案（递归冻结嵌套对象）：</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token keyword keyword-function">function</span> <span class="token function">deepFreeze</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token keyword keyword-typeof">typeof</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token function">deepFreeze</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-return">return</span> <span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">freeze</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>三、ES6 Getter 访问器（类属性保护）<br>
通过 get 方法暴露只读属性，隐藏内部变量：</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">_secret</span> <span class="token operator">=</span> <span class="token string">'受保护的值'</span><span class="token punctuation">;</span>
<span class="token keyword keyword-get">get</span> <span class="token function">readOnlyProp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword control-flow keyword-return">return</span> <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token property-access">_secret</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword keyword-const">const</span> obj <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

obj<span class="token punctuation">.</span><span class="token property-access">readOnlyProp</span> <span class="token operator">=</span> <span class="token string">'新值'</span><span class="token punctuation">;</span> <span class="token comment">// 赋值无效（无 setter）</span>
</code></pre><p>兼容性优化：结合 Object.defineProperty() 定义访问器：</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token keyword keyword-const">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'readOnlyProp'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-return">return</span> <span class="token string">'固定值'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>四、Proxy 代理拦截（动态保护）<br>
拦截 set 操作实现动态只读控制，适用于复杂逻辑验证：</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token keyword keyword-const">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">'原始值'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> proxy <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>prop <span class="token operator">===</span> <span class="token string">'key'</span><span class="token punctuation">)</span> <span class="token keyword control-flow keyword-throw">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prop<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 是只读属性</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow keyword-return">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 允许其他属性修改</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

proxy<span class="token punctuation">.</span><span class="token property-access">key</span> <span class="token operator">=</span> <span class="token string">'新值'</span><span class="token punctuation">;</span> <span class="token comment">// 抛出错误</span>
</code></pre><p>五、闭包与模块模式（兼容性方案）<br>
通过闭包隐藏变量，仅提供只读接口：</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token keyword keyword-const">const</span> config <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> _private <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token constant">SECRET_KEY</span><span class="token operator">:</span> <span class="token string">'123'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-return">return</span> <span class="token punctuation">{</span> <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token parameter">key</span> <span class="token arrow operator">=&gt;</span> _private<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'SECRET_KEY'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 读取</span>
config<span class="token punctuation">.</span><span class="token constant">SECRET_KEY</span> <span class="token operator">=</span> <span class="token string">'456'</span><span class="token punctuation">;</span> <span class="token comment">// 无法修改</span>
</code></pre><p>各方案对比<br>
方法 适用场景 优点 缺点</p>
<p>Object.defineProperty 单属性精准控制 灵活配置特性（可枚举/删除） 需逐一定义<br>
Object.freeze 批量冻结简单对象 快速实现完全不可变 浅冻结（需递归处理嵌套对象）<br>
ES6 Getter 类属性保护 语法简洁，易维护 无法阻止直接修改内部变量<br>
Proxy 动态验证或复杂拦截逻辑 功能强大，可扩展性强 性能开销较大<br>
闭包 兼容旧浏览器或模块封装 完全私有化变量 代码结构较复杂</p>
<p>补充建议<br>
严格模式：在文件头部添加 'use strict';，使修改只读属性时抛出明确错误。</p>
<p>TypeScript 增强：使用 readonly 关键字声明接口或类属性，编译时检查只读性。</p>
<p>命名约定：用全大写命名常量（如 API_ENDPOINT），通过约定暗示只读性。</p>
<p>根据需求选择方案：优先推荐 Object.defineProperty 或 Object.freeze，动态场景用 Proxy，类属性保护用 Getter，兼容旧系统用闭包。</p>
<h1 id="前端-ssr-怎么让页面降级为-csr-或-ssg">前端 ssr 怎么让页面降级为 csr 或 ssg </h1>
<p>在前端 SSR（Server-Side Rendering）应用中实现降级为 CSR（Client-Side Rendering）或 SSG（Static Site Generation），可以通过以下策略分场景实现：</p>
<hr>
<h3 id="一-ssr-降级为-csr-的核心思路"><strong>一、SSR 降级为 CSR 的核心思路</strong> </h3>
<h4 id="1-错误捕获降级">1. <strong>错误捕获降级</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// Node.js 中间件示例（Express/Koa）</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-try">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// 正常 SSR 逻辑</span>
    <span class="token keyword keyword-const">const</span> html <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token function">renderToString</span><span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-catch">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token string">'SSR 失败，降级为 CSR:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 返回 CSR 基础 HTML 结构</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
      &lt;!DOCTYPE html&gt;
      &lt;html&gt;
        &lt;head&gt;&lt;title&gt;降级 CSR&lt;/title&gt;&lt;/head&gt;
        &lt;body&gt;
          &lt;div id="root"&gt;&lt;/div&gt;
          &lt;script src="/client-bundle.js"&gt;&lt;/script&gt;
        &lt;/body&gt;
      &lt;/html&gt;
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="2-性能阈值降级">2. <strong>性能阈值降级</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 设置超时阈值（如 2s）</span>
<span class="token keyword keyword-const">const</span> <span class="token function-variable function">renderWithTimeout</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-let">let</span> timedOut <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    timedOut <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>csrFallbackHTML<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回 CSR 页面</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">renderToString</span><span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">html</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>timedOut<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token keyword control-flow keyword-catch">catch</span><span class="token punctuation">(</span>handleError<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><h4 id="3-客户端激活-csr">3. <strong>客户端激活 CSR</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// React 客户端入口文件</span>
<span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">__SSR_SUCCESS__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token maybe-class-name">ReactDOM</span><span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// SSR 页面中添加标记</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">__SSR_SUCCESS__</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre><hr>
<h3 id="二-ssr-降级为-ssg-的实践方案"><strong>二、SSR 降级为 SSG 的实践方案</strong> </h3>
<h4 id="1-构建时预生成静态页面">1. <strong>构建时预生成静态页面</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// Next.js 示例</span>
<span class="token keyword module keyword-export">export</span> <span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">getStaticProps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> data <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-return">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 动态路由 SSG</span>
<span class="token keyword module keyword-export">export</span> <span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">getStaticPaths</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-return">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">paths</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">fallback</span><span class="token operator">:</span> <span class="token string">'blocking'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="2-服务器优先使用静态文件">2. <strong>服务器优先使用静态文件</strong> </h4>
<pre data-role="codeBlock" data-info="nginx" class="language-nginx nginx"><code><span class="token comment"># Nginx 配置示例</span>
<span class="token directive"><span class="token keyword keyword-location">location</span> /</span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword keyword-try_files">try_files</span> /static-generated/<span class="token variable">$uri</span> /static-generated/<span class="token variable">$uri</span>/index.html @ssr</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword keyword-location">location</span> @ssr</span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword keyword-proxy_pass">proxy_pass</span> http://node-server</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="3-混合渲染策略">3. <strong>混合渲染策略</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// Next.js 按路由配置</span>
module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">experimental</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">isr</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 增量静态再生</span>
    <span class="token literal-property property">ssr</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 关闭指定路由的 SSR</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><hr>
<h3 id="三-动态降级策略实现"><strong>三、动态降级策略实现</strong> </h3>
<h4 id="1-请求头控制模式">1. <strong>请求头控制模式</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 通过 Header 强制指定模式</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">headers</span><span class="token punctuation">[</span><span class="token string">'x-render-mode'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'csr'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-return">return</span> res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>csrHTML<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="2-功能开关系统">2. <strong>功能开关系统</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 远程配置检查</span>
<span class="token keyword keyword-const">const</span> shouldUseCSR <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token function">fetchFeatureFlag</span><span class="token punctuation">(</span><span class="token string">'csr-fallback'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>shouldUseCSR<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>csrHTML<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-else">else</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="3-ab-测试分流">3. <strong>A/B 测试分流</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 随机分配渲染模式</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> group <span class="token operator">=</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0.5</span> <span class="token operator">?</span> <span class="token string">'ssr'</span> <span class="token operator">:</span> <span class="token string">'csr'</span><span class="token punctuation">;</span>
  req<span class="token punctuation">.</span><span class="token property-access">renderGroup</span> <span class="token operator">=</span> group<span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">renderGroup</span> <span class="token operator">===</span> <span class="token string">'csr'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>csrHTML<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-else">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 正常 SSR 逻辑</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<h3 id="四-关键注意事项"><strong>四、关键注意事项</strong> </h3>
<ol>
<li>
<p><strong>SEO 兼容性处理</strong></p>
<pre data-role="codeBlock" data-info="html" class="language-html html"><code><span class="token comment">&lt;!-- CSR 降级页面添加 noindex --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>robots<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>noindex<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token comment">&lt;!-- 或使用预渲染服务 --&gt;</span>
</code></pre></li>
<li>
<p><strong>数据同步策略</strong></p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 客户端补请求数据</span>
<span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">__SSR_FALLBACK__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/data'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span>renderClientApp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p><strong>性能监控体系</strong></p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 上报 SSR 失败事件</span>
<span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'ssr-error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  analytics<span class="token punctuation">.</span><span class="token method function property-access">track</span><span class="token punctuation">(</span><span class="token string">'SSR_Fallback_Triggered'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
<li>
<p><strong>缓存策略优化</strong></p>
<pre data-role="codeBlock" data-info="nginx" class="language-nginx nginx"><code><span class="token comment"># SSG 文件长期缓存</span>
<span class="token directive"><span class="token keyword keyword-location">location</span> /static-generated</span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword keyword-expires">expires</span> <span class="token number">1y</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword keyword-add_header">add_header</span> Cache-Control <span class="token string">"public, immutable"</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></li>
</ol>
<hr>
<h3 id="五-现代框架集成方案"><strong>五、现代框架集成方案</strong> </h3>
<h4 id="1-nextjs-自动降级">1. <strong>Next.js 自动降级</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// next.config.js</span>
module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">experimental</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 开启 ISR 自动回退</span>
    <span class="token literal-property property">isr</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">maxRetries</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token literal-property property">staleWhileRevalidate</span><span class="token operator">:</span> <span class="token number">60</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 允许部分页面 CSR</span>
    <span class="token literal-property property">runtime</span><span class="token operator">:</span> <span class="token string">'nodejs'</span><span class="token punctuation">,</span> <span class="token comment">// 或 'edge'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><h4 id="2-nuxtjs-混合模式">2. <strong>Nuxt.js 混合模式</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// nuxt.config.js</span>
<span class="token keyword module keyword-export">export</span> <span class="token keyword module keyword-default">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">'static'</span><span class="token punctuation">,</span> <span class="token comment">// SSG 模式</span>
  <span class="token literal-property property">ssr</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 开启 SSR</span>
  <span class="token literal-property property">generate</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">fallback</span><span class="token operator">:</span> <span class="token string">'200.html'</span><span class="token punctuation">,</span> <span class="token comment">// SPA 回退页面</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><hr>
<h3 id="六-降级策略决策树"><strong>六、降级策略决策树</strong> </h3>
<div class="mermaid">graph TD
  A[请求到达] --&gt; B{SSR 可用?}
  B --&gt;|Yes| C[正常渲染]
  B --&gt;|No| D{需要动态数据?}
  D --&gt;|Yes| E[降级到 CSR]
  D --&gt;|No| F[使用 SSG 缓存]
  E --&gt; G[返回基础 HTML + 客户端激活]
  F --&gt; H[返回预生成静态页面]
</div><p>通过组合上述策略，可实现灵活的渲染模式降级机制。建议优先使用框架内置能力（如 Next.js 的 ISR），配合自定义降级逻辑，实现最佳的性能与可靠性平衡。</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="ssrssg-以及-isr-的区别">ssr，ssg 以及 isr 的区别 </h1>
<p>以下是 <strong>SSR（Server-Side Rendering）</strong>、<strong>SSG（Static Site Generation）</strong> 和 <strong>ISR（Incremental Static Regeneration）</strong> 的核心区别和适用场景的清晰对比：</p>
<hr>
<h3 id="1-定义与工作原理"><strong>1. 定义与工作原理</strong> </h3>
<table>
<thead>
<tr>
<th>技术</th>
<th>定义</th>
<th>工作流程</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>SSR</strong></td>
<td>服务器在每次请求时动态生成 HTML</td>
<td>1. 用户请求页面<br>2. 服务器执行代码生成 HTML<br>3. 返回完整 HTML 到客户端</td>
</tr>
<tr>
<td><strong>SSG</strong></td>
<td>构建时预先生成静态 HTML</td>
<td>1. 代码构建时生成所有页面<br>2. 直接托管静态 HTML 文件<br>3. 用户请求时返回预生成文件</td>
</tr>
<tr>
<td><strong>ISR</strong></td>
<td>按需或定时增量更新静态页面</td>
<td>1. 初次构建生成部分页面<br>2. 用户请求触发页面更新<br>3. 后台更新后缓存新版本</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="2-核心特点对比"><strong>2. 核心特点对比</strong> </h3>
<table>
<thead>
<tr>
<th>特性</th>
<th>SSR</th>
<th>SSG</th>
<th>ISR</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>生成时机</strong></td>
<td>每次请求时</td>
<td>构建时</td>
<td>构建时 + 按需更新</td>
</tr>
<tr>
<td><strong>服务器负载</strong></td>
<td>高（动态渲染）</td>
<td>低（静态文件）</td>
<td>中（混合模式）</td>
</tr>
<tr>
<td><strong>内容实时性</strong></td>
<td>实时动态内容</td>
<td>静态内容（需重新构建）</td>
<td>可配置更新频率</td>
</tr>
<tr>
<td><strong>适用场景</strong></td>
<td>高动态性页面（用户中心）</td>
<td>内容固定（博客/文档）</td>
<td>混合内容（电商/新闻）</td>
</tr>
<tr>
<td><strong>SEO 支持</strong></td>
<td>优秀</td>
<td>优秀</td>
<td>优秀</td>
</tr>
<tr>
<td><strong>首次加载速度</strong></td>
<td>中等（需服务器处理）</td>
<td>极快（CDN 缓存）</td>
<td>极快（优先返回缓存）</td>
</tr>
<tr>
<td><strong>数据更新成本</strong></td>
<td>无需额外操作</td>
<td>需重新构建</td>
<td>按需自动更新</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="3-具体场景示例"><strong>3. 具体场景示例</strong> </h3>
<h4 id="ssr-典型场景"><strong>SSR 典型场景</strong> </h4>
<ul>
<li>用户个人中心页面（需实时显示订单状态）</li>
<li>需要登录态的 Dashboard（动态权限验证）</li>
<li>高度个性化的推荐页面（实时数据渲染）</li>
</ul>
<h4 id="ssg-典型场景"><strong>SSG 典型场景</strong> </h4>
<ul>
<li>技术文档网站（内容更新频率低）</li>
<li>企业官网（产品介绍页）</li>
<li>博客文章（预生成所有文章页）</li>
</ul>
<h4 id="isr-典型场景"><strong>ISR 典型场景</strong> </h4>
<ul>
<li>电商商品详情页（大部分静态，价格偶尔变化）</li>
<li>新闻列表页（定时更新最新文章）</li>
<li>用户生成内容（UGC）的混合站点（部分页面动态更新）</li>
</ul>
<hr>
<h3 id="4-技术栈实现"><strong>4. 技术栈实现</strong> </h3>
<h4 id="ssr-实现"><strong>SSR 实现</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// Express.js + React SSR 示例</span>
<span class="token keyword module keyword-import">import</span> <span class="token imports"><span class="token punctuation">{</span> renderToString <span class="token punctuation">}</span></span> <span class="token keyword module keyword-from">from</span> <span class="token string">'react-dom/server'</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/page'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> html <span class="token operator">=</span> <span class="token function">renderToString</span><span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token maybe-class-name">App</span> data<span class="token operator">=</span><span class="token punctuation">{</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    &lt;html&gt;
      &lt;body&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>html<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/body&gt;
      &lt;script src="/client-bundle.js"&gt;&lt;/script&gt;
    &lt;/html&gt;
  </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="ssg-实现"><strong>SSG 实现</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// Next.js SSG 示例</span>
<span class="token keyword module keyword-export">export</span> <span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">getStaticProps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-return">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-function">function</span> <span class="token function"><span class="token maybe-class-name">Page</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-return">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span>data<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="isr-实现"><strong>ISR 实现</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// Next.js ISR 示例</span>
<span class="token keyword module keyword-export">export</span> <span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">getStaticProps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-return">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">revalidate</span><span class="token operator">:</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token comment">// 60秒后重新生成页面</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="5-选择决策树"><strong>5. 选择决策树</strong> </h3>
<div class="mermaid">graph TD
  A[需要实时数据?] --&gt;|Yes| B[SSR]
  A --&gt;|No| C{内容更新频率?}
  C --&gt;|几乎不变| D[SSG]
  C --&gt;|偶尔更新| E[ISR]
  B --&gt; F[高服务器成本,SEO友好]
  D --&gt; G[极速加载,需重新构建]
  E --&gt; H[混合模式,按需更新]
</div><hr>
<h3 id="6-总结"><strong>6. 总结</strong> </h3>
<ul>
<li><strong>SSR</strong>：牺牲服务器性能换取动态性和 SEO，适合强实时场景。</li>
<li><strong>SSG</strong>：极致的性能与安全性，适合内容固定的站点。</li>
<li><strong>ISR</strong>：平衡性能和动态性，适合需要部分页面更新的场景。</li>
</ul>
<p>现代框架（如 Next.js、Nuxt.js）通常支持混合使用这些技术，可根据不同路由灵活选择渲染策略。</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="react18-的批处理是什么">react18 的批处理是什么 </h1>
<p>React 18 的批处理（Automatic Batching）是一项核心性能优化机制，它通过合并多个状态更新为单个渲染过程，显著减少不必要的渲染次数，提升应用流畅性。以下是其关键点：</p>
<hr>
<h3 id="1-批处理的定义与作用"><strong>1. 批处理的定义与作用</strong> </h3>
<p>批处理是指将多个状态更新合并为一次渲染操作。例如，在同一事件中连续调用两次 <code>setState</code>，React 只会触发一次渲染，而不是两次。这避免了“半完成”状态的渲染，提升了性能并减少潜在错误。</p>
<p><strong>示例</strong>：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-function">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token arrow operator">=&gt;</span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setFlag</span><span class="token punctuation">(</span><span class="token parameter">f</span> <span class="token arrow operator">=&gt;</span> <span class="token operator">!</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// React 18 合并为一次渲染</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="2-react-18-的改进自动批处理"><strong>2. React 18 的改进：自动批处理</strong> </h3>
<p>在 React 18 之前，批处理仅适用于合成事件（如点击事件），而在异步操作（如 <code>setTimeout</code>、<code>Promise</code>、原生事件）中不会自动批处理。React 18 通过以下改进实现了更广泛的自动批处理：</p>
<ul>
<li><strong>扩展场景</strong>：所有来源的更新（包括异步操作）均可自动合并为一次渲染。</li>
<li><strong>统一优先级</strong>：基于并发模式（Concurrent Mode），相同优先级的更新会被合并，而高优先级更新可中断低优先级任务。</li>
</ul>
<p><strong>对比示例</strong>：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// React 17：异步回调中触发两次渲染</span>
<span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token arrow operator">=&gt;</span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setFlag</span><span class="token punctuation">(</span><span class="token parameter">f</span> <span class="token arrow operator">=&gt;</span> <span class="token operator">!</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// React 18：合并为一次渲染</span>
</code></pre><hr>
<h3 id="3-实现原理"><strong>3. 实现原理</strong> </h3>
<ul>
<li><strong>优先级调度</strong>：React 18 使用 <code>Lane</code> 模型管理更新优先级，相同优先级的更新会被合并。</li>
<li><strong>并发渲染</strong>：通过 <code>createRoot</code> 启用并发模式，允许中断渲染任务并批量处理更新。</li>
<li><strong>微任务调度</strong>：在异步操作中，React 会将更新放入微任务队列，等待同步代码执行完毕后统一处理。</li>
</ul>
<hr>
<h3 id="4-特殊情况处理"><strong>4. 特殊情况处理</strong> </h3>
<ul>
<li><strong>强制同步更新</strong>：使用 <code>flushSync</code> 可退出批处理，强制立即执行渲染（适用于需要读取 DOM 状态的场景）。<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword module keyword-import">import</span> <span class="token imports"><span class="token punctuation">{</span> flushSync <span class="token punctuation">}</span></span> <span class="token keyword module keyword-from">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token function">flushSync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 立即触发渲染</span>
</code></pre></li>
<li><strong>类组件的边缘情况</strong>：在 React 18 中，类组件内异步回调的 <code>setState</code> 也会被批处理，导致 <code>this.state</code> 无法立即获取最新值。</li>
</ul>
<hr>
<h3 id="5-注意事项"><strong>5. 注意事项</strong> </h3>
<ul>
<li><strong>渲染模式</strong>：需通过 <code>ReactDOM.createRoot</code> 启用并发模式，旧版 <code>ReactDOM.render</code> 仍保留旧行为。</li>
<li><strong>兼容性</strong>：大多数现有代码无需修改即可受益于自动批处理，但需注意类组件的潜在问题。</li>
</ul>
<hr>
<h3 id="总结-11"><strong>总结</strong> </h3>
<p>React 18 的自动批处理通过合并多场景下的状态更新，显著优化了性能。其核心改进在于扩大批处理范围至异步操作，并通过并发模式实现优先级调度。开发者可通过 <code>flushSync</code> 灵活控制渲染时机，同时需注意类组件的特殊行为。</p>
<hr>
<hr>
<hr>
<hr>
<h1 id="react19-主要更新了什么">react19 主要更新了什么？ </h1>
<p>React 19 是 React 生态系统的重大更新，专注于提升开发体验、性能优化以及功能扩展。以下是其主要更新的核心内容：</p>
<hr>
<h3 id="一-actions-api异步操作与表单处理革命"><strong>一、Actions API：异步操作与表单处理革命</strong> </h3>
<p>React 19 引入了 <strong>Actions</strong>，旨在简化异步操作（如 API 调用、表单提交）的状态管理和错误处理，减少样板代码。</p>
<ul>
<li><strong>自动管理状态</strong>：通过新钩子 <code>useActionState</code>、<code>useFormStatus</code> 和 <code>useOptimistic</code>，自动处理加载状态（<code>isPending</code>）、错误回退和乐观更新（Optimistic Updates）。例如，表单提交时，无需手动维护 <code>loading</code> 或 <code>error</code> 状态。</li>
<li><strong>与表单深度集成</strong>：支持将函数直接传递给 <code>&lt;form&gt;</code> 的 <code>action</code> 属性，提交后自动重置表单，并通过 <code>useFormStatus</code> 获取父表单状态。</li>
<li><strong>示例</strong>：<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>error<span class="token punctuation">,</span> submitAction<span class="token punctuation">,</span> isPending<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useActionState</span><span class="token punctuation">(</span>
  <span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span><span class="token parameter">prev<span class="token punctuation">,</span> formData</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> error <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token function">updateName</span><span class="token punctuation">(</span>formData<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow keyword-return">return</span> error <span class="token operator">||</span> <span class="token keyword null nil keyword-null">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword null nil keyword-null">null</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
</ul>
<hr>
<h3 id="二-服务器端渲染ssr与静态生成优化"><strong>二、服务器端渲染（SSR）与静态生成优化</strong> </h3>
<ul>
<li><strong>服务器组件稳定化</strong>：允许在服务器端执行组件逻辑，减少客户端 JavaScript 体积，提升首屏加载速度和 SEO。例如，直接通过服务器组件从数据库获取数据并生成 HTML。</li>
<li><strong>改进的 Hydration 机制</strong>：支持部分 hydration（仅激活必要组件）和流式数据传输，减少交互时间延迟。</li>
<li><strong>预渲染 API</strong>：新增 <code>prerender</code> 和 <code>prerenderToNodeStream</code>，优化静态站点生成（SSG）效率。</li>
</ul>
<hr>
<h3 id="三-原生文档元数据与样式管理"><strong>三、原生文档元数据与样式管理</strong> </h3>
<ul>
<li><strong>内置元数据支持</strong>：可直接在组件内声明 <code>&lt;title&gt;</code>、<code>&lt;meta&gt;</code> 和 <code>&lt;link&gt;</code> 标签，React 自动将其提升到文档头部，无需依赖第三方库（如 <code>react-helmet</code>），简化 SEO 管理。</li>
<li><strong>样式表优先级控制</strong>：通过 <code>precedence</code> 属性动态调整 <code>&lt;link&gt;</code> 和 <code>&lt;style&gt;</code> 的加载顺序，确保样式覆盖正确性，尤其在 SSR 场景下。</li>
</ul>
<hr>
<h3 id="四-ref-处理与资源管理优化"><strong>四、Ref 处理与资源管理优化</strong> </h3>
<ul>
<li><strong>Ref 作为 Prop</strong>：函数组件可直接通过 <code>ref</code> 属性接收引用，无需 <code>forwardRef</code>，减少代码冗余。</li>
<li><strong>清理函数支持</strong>：Ref 回调可返回清理函数，组件卸载时自动执行（如取消事件监听），避免内存泄漏。</li>
<li><strong>资源预加载</strong>：新增 <code>preload</code> 和 <code>preinit</code> API，提前加载关键资源（如脚本、字体），提升页面性能。</li>
</ul>
<hr>
<h3 id="五-新-api-与工具增强"><strong>五、新 API 与工具增强</strong> </h3>
<ul>
<li><strong><code>use</code> API</strong>：允许在渲染期间读取 Promise 或 Context，支持条件调用并与 Suspense 集成，简化异步数据获取逻辑。</li>
<li><strong>错误处理改进</strong>：优化错误日志，减少冗余信息，并支持差异化报告（如 SSR 与客户端渲染不匹配的问题）。</li>
<li><strong>Web 组件支持</strong>：无需额外配置即可直接使用自定义元素（如 <code>&lt;my-component&gt;</code>），提升跨框架兼容性。</li>
</ul>
<hr>
<h3 id="六-其他重要改进"><strong>六、其他重要改进</strong> </h3>
<ul>
<li><strong>Context API 简写</strong>：支持 <code>&lt;Context&gt;</code> 直接作为 Provider，替代 <code>&lt;Context.Provider&gt;</code>，代码更简洁。</li>
<li><strong>异步脚本管理</strong>：<code>&lt;script&gt;</code> 标签支持异步加载，并由 React 自动去重，避免重复加载资源。</li>
<li><strong>迁移兼容性</strong>：提供 React 18.3 过渡版本，帮助开发者逐步升级并检查弃用 API。</li>
</ul>
<hr>
<h3 id="总结-12"><strong>总结</strong> </h3>
<p>React 19 通过 Actions API、服务器组件、原生元数据支持等特性，显著简化了异步操作、表单处理和性能优化。其设计理念强调“更少的样板代码，更高的效率”，尤其适合复杂应用场景（如电商、实时协作工具）。开发者可参考<a href="https://react.dev/blog/2024/12/05/react-19">官方文档</a>逐步迁移并探索新功能。</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="前端如何处理请求超时后的重新请求">前端如何处理请求超时后的重新请求？ </h1>
<p>在前端开发中，处理请求超时后的重新请求需要结合 <strong>超时检测</strong> 和 <strong>重试策略</strong> 来实现。以下是分步解决方案和最佳实践：</p>
<hr>
<h3 id="一-核心实现方案-1"><strong>一、核心实现方案</strong> </h3>
<h4 id="1-基础实现原生-fetch-api--abortcontroller">1. <strong>基础实现（原生 Fetch API + AbortController）</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token doc-comment comment">/**
 * 支持超时重试的请求封装
 * <span class="token keyword keyword-@param">@param</span> <span class="token class-name"><span class="token punctuation">{</span>string<span class="token punctuation">}</span></span> <span class="token parameter">url</span> 请求地址
 * <span class="token keyword keyword-@param">@param</span> <span class="token class-name"><span class="token punctuation">{</span>object<span class="token punctuation">}</span></span> <span class="token parameter">options</span> 请求配置（含 timeout 和 retries）
 * <span class="token keyword keyword-@param">@param</span> <span class="token class-name"><span class="token punctuation">{</span>number<span class="token punctuation">}</span></span> <span class="token parameter">options<span class="token punctuation">.</span>timeout</span> 超时时间（默认 5000ms）
 * <span class="token keyword keyword-@param">@param</span> <span class="token class-name"><span class="token punctuation">{</span>number<span class="token punctuation">}</span></span> <span class="token parameter">options<span class="token punctuation">.</span>retries</span> 最大重试次数（默认 3 次）
 */</span>
<span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">fetchWithRetry</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> timeout <span class="token operator">=</span> <span class="token number">5000</span><span class="token punctuation">,</span> retries <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token spread operator">...</span>fetchOptions <span class="token punctuation">}</span> <span class="token operator">=</span> options<span class="token punctuation">;</span>
  <span class="token keyword keyword-let">let</span> retryCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword keyword-const">const</span> controller <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> timeoutId <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> controller<span class="token punctuation">.</span><span class="token method function property-access">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow keyword-try">try</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> response <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token spread operator">...</span>fetchOptions<span class="token punctuation">,</span>
      <span class="token literal-property property">signal</span><span class="token operator">:</span> controller<span class="token punctuation">.</span><span class="token property-access">signal</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeoutId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span><span class="token property-access">ok</span><span class="token punctuation">)</span> <span class="token keyword control-flow keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">HTTP error! status: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>response<span class="token punctuation">.</span><span class="token property-access">status</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow keyword-return">return</span> response<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-catch">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeoutId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>retryCount <span class="token operator">&lt;</span> retries<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      retryCount<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Retrying (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>retryCount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>retries<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow keyword-return">return</span> <span class="token function">fetchWithRetry</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token spread operator">...</span>options<span class="token punctuation">,</span> <span class="token literal-property property">retries</span><span class="token operator">:</span> retries <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-else">else</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Request failed after </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>retries<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> retries: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token punctuation">.</span><span class="token property-access">message</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用示例</span>
<span class="token function">fetchWithRetry</span><span class="token punctuation">(</span><span class="token string">'https://api.example.com/data'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
  <span class="token literal-property property">retries</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Success:'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword control-flow keyword-catch">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token string">'Error:'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<h4 id="2-优化策略指数退避exponential-backoff">2. <strong>优化策略：指数退避（Exponential Backoff）</strong> </h4>
<p>增加重试间隔的智能等待，避免高频重试导致服务器压力过大：</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">fetchWithExponentialBackoff</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> timeout <span class="token operator">=</span> <span class="token number">5000</span><span class="token punctuation">,</span> retries <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token spread operator">...</span>fetchOptions <span class="token punctuation">}</span> <span class="token operator">=</span> options<span class="token punctuation">;</span>
  <span class="token keyword keyword-let">let</span> retryCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword keyword-const">const</span> <span class="token function-variable function">attempt</span> <span class="token operator">=</span> <span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> controller <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> timeoutId <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> controller<span class="token punctuation">.</span><span class="token method function property-access">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword control-flow keyword-try">try</span> <span class="token punctuation">{</span>
      <span class="token keyword keyword-const">const</span> response <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token spread operator">...</span>fetchOptions<span class="token punctuation">,</span>
        <span class="token literal-property property">signal</span><span class="token operator">:</span> controller<span class="token punctuation">.</span><span class="token property-access">signal</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeoutId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span><span class="token property-access">ok</span><span class="token punctuation">)</span>
        <span class="token keyword control-flow keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">HTTP error! status: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>response<span class="token punctuation">.</span><span class="token property-access">status</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow keyword-return">return</span> response<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-catch">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeoutId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>retryCount <span class="token operator">&lt;</span> retries<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> delay <span class="token operator">=</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> retryCount<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">;</span> <span class="token comment">// 指数退避</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Retrying in </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>delay<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ms...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow keyword-await">await</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token arrow operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        retryCount<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow keyword-return">return</span> <span class="token function">attempt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-else">else</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>
          <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Request failed after </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>retries<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> retries: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token punctuation">.</span><span class="token property-access">message</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow keyword-return">return</span> <span class="token function">attempt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="二-关键优化点"><strong>二、关键优化点</strong> </h3>
<h4 id="1-请求取消与资源释放">1. <strong>请求取消与资源释放</strong> </h4>
<ul>
<li>使用 <code>AbortController</code> 取消超时请求，防止内存泄漏</li>
<li>在组件卸载时主动取消未完成的请求（React 示例）：<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> controller <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">signal</span><span class="token operator">:</span> controller<span class="token punctuation">.</span><span class="token property-access">signal</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-return">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> controller<span class="token punctuation">.</span><span class="token method function property-access">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 清理函数中取消</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
</ul>
<h4 id="2-错误类型区分处理">2. <strong>错误类型区分处理</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword control-flow keyword-catch">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token operator">===</span> <span class="token string">'AbortError'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Request timed out'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-else">else</span> <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>error <span class="token keyword keyword-instanceof">instanceof</span> <span class="token class-name">TypeError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Network error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-else">else</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Server error:'</span><span class="token punctuation">,</span> error<span class="token punctuation">.</span><span class="token property-access">message</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="3-请求幂等性保障">3. <strong>请求幂等性保障</strong> </h4>
<ul>
<li>仅对 <code>GET</code> 请求或幂等的 <code>PUT</code>/<code>DELETE</code> 请求自动重试</li>
<li>对非幂等的 <code>POST</code> 请求禁用自动重试（需用户手动触发）</li>
</ul>
<hr>
<h3 id="三-第三方库集成以-axios-为例"><strong>三、第三方库集成（以 Axios 为例）</strong> </h3>
<h4 id="1-使用-axios-retry-插件">1. <strong>使用 <code>axios-retry</code> 插件</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword module keyword-import">import</span> <span class="token imports">axios</span> <span class="token keyword module keyword-from">from</span> <span class="token string">'axios'</span><span class="token punctuation">;</span>
<span class="token keyword module keyword-import">import</span> <span class="token imports">axiosRetry</span> <span class="token keyword module keyword-from">from</span> <span class="token string">'axios-retry'</span><span class="token punctuation">;</span>

<span class="token comment">// 配置全局重试策略</span>
<span class="token function">axiosRetry</span><span class="token punctuation">(</span>axios<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">retries</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token function-variable function">retryDelay</span><span class="token operator">:</span> <span class="token parameter">retryCount</span> <span class="token arrow operator">=&gt;</span> retryCount <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span>
  <span class="token function-variable function">retryCondition</span><span class="token operator">:</span> <span class="token parameter">error</span> <span class="token arrow operator">=&gt;</span>
    axiosRetry<span class="token punctuation">.</span><span class="token method function property-access">isNetworkError</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">||</span> axiosRetry<span class="token punctuation">.</span><span class="token method function property-access">isRetryableError</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 发起请求（自动重试）</span>
axios
  <span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'https://api.example.com/data'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">3000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="2-自定义-axios-实例">2. <strong>自定义 Axios 实例</strong> </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> api <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token method function property-access">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">5000</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

api<span class="token punctuation">.</span><span class="token property-access">interceptors</span><span class="token punctuation">.</span><span class="token property-access">response</span><span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token keyword null nil keyword-null">null</span><span class="token punctuation">,</span> <span class="token parameter">error</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> config <span class="token operator">=</span> error<span class="token punctuation">.</span><span class="token property-access">config</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>config <span class="token operator">||</span> <span class="token operator">!</span>config<span class="token punctuation">.</span><span class="token property-access">retry</span><span class="token punctuation">)</span> <span class="token keyword control-flow keyword-return">return</span> <span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>

  config<span class="token punctuation">.</span><span class="token property-access">__retryCount</span> <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token property-access">__retryCount</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token property-access">__retryCount</span> <span class="token operator">&gt;=</span> config<span class="token punctuation">.</span><span class="token property-access">retry</span><span class="token punctuation">)</span> <span class="token keyword control-flow keyword-return">return</span> <span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>

  config<span class="token punctuation">.</span><span class="token property-access">__retryCount</span> <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> delay <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token property-access">retryDelay</span> <span class="token operator">||</span> <span class="token number">1000</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow keyword-return">return</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token arrow operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">api</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用</span>
api<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/data'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">retry</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token literal-property property">retryDelay</span><span class="token operator">:</span> <span class="token number">2000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<h3 id="四-注意事项-1"><strong>四、注意事项</strong> </h3>
<ol>
<li>
<p><strong>用户感知优化</strong></p>
<ul>
<li>显示重试状态（如 Toast 提示“网络不稳定，正在尝试重新连接...”）</li>
<li>提供手动重试按钮（自动重试失败后）</li>
</ul>
</li>
<li>
<p><strong>性能监控</strong></p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 上报重试事件</span>
<span class="token keyword keyword-const">const</span> <span class="token function-variable function">reportAnalytics</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> retryCount</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  analytics<span class="token punctuation">.</span><span class="token method function property-access">track</span><span class="token punctuation">(</span><span class="token string">'request_retry'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> url<span class="token punctuation">,</span> retryCount <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></li>
<li>
<p><strong>服务端配合</strong></p>
<ul>
<li>设置合理的 <code>Retry-After</code> 响应头</li>
<li>使用断路器模式（如 Hystrix）防止级联故障</li>
</ul>
</li>
</ol>
<hr>
<h3 id="五-总结方案选择"><strong>五、总结方案选择</strong> </h3>
<table>
<thead>
<tr>
<th>场景</th>
<th>推荐方案</th>
</tr>
</thead>
<tbody>
<tr>
<td>简单项目</td>
<td>原生 Fetch + 指数退避</td>
</tr>
<tr>
<td>企业级应用</td>
<td>Axios + axios-retry 插件</td>
</tr>
<tr>
<td>需要精细控制</td>
<td>自定义拦截器 + 状态管理</td>
</tr>
<tr>
<td>实时性要求高</td>
<td>WebSocket 心跳检测 + 重连机制</td>
</tr>
</tbody>
</table>
<p>通过合理设计重试策略，可以显著提升前端应用的网络容错能力，同时避免因过度重试导致的服务器压力。</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="请详细介绍下微信小程序底层的实现原理">请详细介绍下微信小程序底层的实现原理 </h1>
<p>微信小程序的底层实现原理是其高效、安全和跨平台能力的关键，核心在于<strong>双线程架构</strong>与<strong>分层通信机制</strong>。以下从架构设计、通信机制、渲染流程、性能优化等维度深入解析：</p>
<hr>
<h3 id="-一-双线程架构安全与性能的基石">🧠 <strong>一、双线程架构：安全与性能的基石</strong> </h3>
<p>小程序将逻辑层（App Service）与视图层（View）分离，由两个独立线程管理：</p>
<ol>
<li>
<p><strong>逻辑层（App Service）</strong></p>
<ul>
<li>运行环境：独立 JS 引擎（iOS 用 JavaScriptCore，Android 用 X5 内核 JsCore）。</li>
<li>职责：处理业务逻辑、API 调用（如 <code>wx.request</code>）、生命周期管理（<code>onLoad</code>, <code>onShow</code>）。</li>
<li>限制：<strong>无 DOM/BOM 接口</strong>，无法直接操作页面，仅能通过 <code>setData</code> 更新数据。</li>
</ul>
</li>
<li>
<p><strong>视图层（View）</strong></p>
<ul>
<li>运行环境：多个 WebView 线程（每个页面一个 WebView，最多 10 个）。</li>
<li>职责：渲染 WXML/WXSS、处理用户交互事件（如点击、滑动）。</li>
</ul>
</li>
<li>
<p><strong>通信桥梁：Native 层（微信客户端）</strong></p>
<ul>
<li>逻辑层与视图层所有通信均通过 Native 中转，避免直接互操作。</li>
<li>示例：<code>setData</code> 调用 → 数据序列化为字符串 → Native 转发 → 视图层解析更新。</li>
</ul>
</li>
</ol>
<table>
<thead>
<tr>
<th><strong>线程层</strong></th>
<th><strong>运行环境</strong></th>
<th><strong>核心职责</strong></th>
<th><strong>限制</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>逻辑层</td>
<td>JSCore/X5 内核</td>
<td>业务逻辑、API 调用</td>
<td>无 DOM/BOM 接口</td>
</tr>
<tr>
<td>视图层</td>
<td>WebView</td>
<td>页面渲染、事件响应</td>
<td>无法直接执行业务逻辑</td>
</tr>
<tr>
<td>Native 层</td>
<td>微信客户端原生代码</td>
<td>通信中转、网络请求转发</td>
<td>管控安全策略</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="-二-通信机制跨线程数据传递">📡 <strong>二、通信机制：跨线程数据传递</strong> </h3>
<ol>
<li>
<p><strong>数据传输原理</strong></p>
<ul>
<li>使用 <code>evaluateJavascript</code> 实现：数据被序列化为字符串，拼接为 JS 脚本，通过执行脚本传递。</li>
<li><strong>异步性</strong>：数据到达视图层非实时，频繁调用 <code>setData</code> 会阻塞线程。</li>
</ul>
</li>
<li>
<p><strong>事件绑定与触发</strong></p>
<ul>
<li>视图层捕获事件（如 <code>tap</code>） → 封装为 <code>exparser</code> 事件 → 通过 <code>WeixinJSBridge</code> 发送至逻辑层。</li>
<li>逻辑层处理事件后，若需更新 UI，需再次通过 <code>setData</code> 跨线程通信。</li>
</ul>
</li>
</ol>
<hr>
<h3 id="-三-渲染流程virtual-dom-与组件系统">🎨 <strong>三、渲染流程：Virtual DOM 与组件系统</strong> </h3>
<ol>
<li>
<p><strong>WXML → Virtual DOM</strong></p>
<ul>
<li>WXML 模板编译为 JS 函数（如 <code>$gwx</code>），生成虚拟 DOM 树。</li>
<li>数据变更时，通过 <code>setData</code> 传递新数据 → 视图层对比新旧虚拟 DOM 差异 → 局部更新真实 DOM。</li>
</ul>
</li>
<li>
<p><strong>组件框架：Exparser</strong></p>
<ul>
<li>基于 Shadow DOM 模型，管理所有内置组件（如 <code>button</code>、<code>input</code>）和自定义组件。</li>
<li><strong>原生组件优化</strong>：
<ul>
<li>部分组件（如 <code>map</code>、<code>video</code>）由客户端原生渲染，悬浮在 WebView 之上。</li>
<li>优势：性能更高（避开 WebView 渲染瓶颈）、支持复杂功能（如地图缩放）。</li>
</ul>
</li>
</ul>
</li>
</ol>
<hr>
<h3 id="-四-性能优化策略">⚡ <strong>四、性能优化策略</strong> </h3>
<ol>
<li>
<p><strong>启动阶段优化</strong></p>
<ul>
<li><strong>分包加载</strong>：主包（核心页面）≤ 2MB，分包（非核心功能）总大小 ≤ 16MB，首次启动仅下载主包。</li>
<li><strong>冷启动/热启动</strong>：
<ul>
<li>冷启动：首次打开或销毁后重启，检查更新并异步下载新包（下次启动生效）。</li>
<li>热启动：5 分钟内再次打开，直接复用后台进程。</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>运行时优化</strong></p>
<ul>
<li><strong>减少 <code>setData</code> 开销</strong>：
<ul>
<li>合并多次调用为一次，避免高频更新。</li>
<li>仅传递渲染所需数据（非渲染数据存储在 <code>Page</code> 对象非 <code>data</code> 字段）。</li>
<li>后台页面禁止 <code>setData</code>，避免抢占前台资源。</li>
</ul>
</li>
<li><strong>精简 WXML/WXSS</strong>：移除未使用样式、压缩图片、避免复杂选择器。</li>
</ul>
</li>
</ol>
<hr>
<h3 id="️-五-安全与管控机制">🛡️ <strong>五、安全与管控机制</strong> </h3>
<ol>
<li><strong>沙箱环境</strong>
<ul>
<li>逻辑层运行在纯 JS 解释环境，无浏览器 API（如 <code>window</code>、<code>document</code>），禁止动态执行脚本。</li>
</ul>
</li>
<li><strong>更新管控</strong>
<ul>
<li>新版本发布后 24 小时内逐步覆盖用户，冷启动时异步更新（需两次冷启动生效）。</li>
</ul>
</li>
<li><strong>基础库内置</strong>
<ul>
<li>基础库（如 <code>WAWebview.js</code>, <code>WAService.js</code>）预置在微信客户端，不打包进业务代码，减小包体积。</li>
</ul>
</li>
</ol>
<hr>
<h3 id="-六-跨平台扩展同构方案-kbone">🔧 <strong>六、跨平台扩展：同构方案 kbone</strong> </h3>
<p>为复用 Web 端代码，微信推出 <strong>kbone</strong> 框架：</p>
<ul>
<li><strong>适配器模式</strong>：通过 <code>miniprogram-render</code> 提供 DOM/BOM API，<code>miniprogram-element</code> 实现自定义组件渲染。</li>
<li><strong>优势</strong>：
<ul>
<li>支持 Vue/React 等框架直接运行在小程序环境。</li>
<li>保留 Web 端特性（如 Vue 的 <code>v-html</code>）。</li>
</ul>
</li>
</ul>
<hr>
<h3 id="-总结设计哲学与挑战">💎 <strong>总结：设计哲学与挑战</strong> </h3>
<ul>
<li><strong>优势</strong>：<br>
✅ 安全隔离（双线程 + 沙箱）<br>
✅ 性能可控（Virtual DOM + 原生组件）<br>
✅ 跨端一致性（基础库内置）。</li>
<li><strong>挑战</strong>：<br>
⚠️ 通信延迟（序列化/反序列化开销）<br>
⚠️ 开发限制（无法直接操作 DOM）。</li>
</ul>
<p>小程序通过<strong>分层架构</strong>与<strong>严格的管控机制</strong>，在体验与安全间取得平衡，其设计思路对 Hybrid 应用开发具有广泛参考价值。</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="resizeobserver-和-mutationobserver-有什么区别">ResizeObserver 和 MutationObserver 有什么区别 </h1>
<p>ResizeObserver 和 MutationObserver 是浏览器提供的两种观察者 API，但两者在功能定位、监听目标和应用场景上有显著差异。以下是它们的核心区别与使用场景分析：</p>
<h2 id="一-功能定位差异">一、功能定位差异 </h2>
<table>
<thead>
<tr>
<th>特性</th>
<th>ResizeObserver</th>
<th>MutationObserver</th>
</tr>
</thead>
<tbody>
<tr>
<td>核心目标</td>
<td>监听元素的尺寸变化（宽度、高度、位置）</td>
<td>监听 DOM 结构/属性变化（节点增删改、属性修改）</td>
</tr>
<tr>
<td>设计初衷</td>
<td>优化响应式布局和动态尺寸适配</td>
<td>追踪 DOM 动态更新行为</td>
</tr>
<tr>
<td>触发频率控制</td>
<td>自动优化高频变化场景（如动画）</td>
<td>需手动配置监听范围避免性能问题</td>
</tr>
</tbody>
</table>
<ul>
<li>示例对比</li>
</ul>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token comment">// ResizeObserver 监听元素尺寸变化</span>
<span class="token keyword keyword-const">const</span> resizeObserver <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">ResizeObserver</span><span class="token punctuation">(</span><span class="token parameter">entries</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  entries<span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">entry</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'新尺寸:'</span><span class="token punctuation">,</span> entry<span class="token punctuation">.</span><span class="token property-access">contentRect</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
resizeObserver<span class="token punctuation">.</span><span class="token method function property-access">observe</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// MutationObserver 监听 DOM 结构变化</span>
<span class="token keyword keyword-const">const</span> mutationObserver <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span><span class="token parameter">mutations</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  mutations<span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">m</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'DOM 变动:'</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mutationObserver<span class="token punctuation">.</span><span class="token method function property-access">observe</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">childList</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h2 id="二-监听目标与数据反馈">二、监听目标与数据反馈 </h2>
<ul>
<li>ResizeObserver</li>
</ul>
<p>监听对象：元素的尺寸变化（包括 content-box 或 border-box）</p>
<p>回调参数：ResizeObserverEntry 数组，包含以下关键属性：</p>
<p>contentRect：元素内容区域的位置和尺寸（类似 getBoundingClientRect）</p>
<p>borderBoxSize/contentBoxSize：边框盒和内容盒的尺寸信息</p>
<p>典型场景：图表容器适配、响应式组件、媒体元素动态调整</p>
<ul>
<li>MutationObserver</li>
</ul>
<p>监听对象：DOM 节点的以下变化：</p>
<p>子节点增删改（childList）</p>
<p>属性值修改（attributes）</p>
<p>文本内容变化（characterData）</p>
<p>回调参数：MutationRecord 数组，包含变动类型、旧值、受影响节点等信息</p>
<p>典型场景：动态内容加载监测、水印防篡改、第三方 SDK 集成</p>
<h2 id="三-性能与使用限制">三、性能与使用限制 </h2>
<table>
<thead>
<tr>
<th>维度</th>
<th>ResizeObserver</th>
<th>MutationObserver</th>
</tr>
</thead>
<tbody>
<tr>
<td>性能优化</td>
<td>异步批量处理回调，避免布局抖动</td>
<td>需手动配置 subtree/attributeFilter 减少监听范围</td>
</tr>
<tr>
<td>内存泄漏风险</td>
<td>需手动调用 unobserve() 或 disconnect()</td>
<td>同左</td>
</tr>
<tr>
<td>兼容性</td>
<td>Chrome 64+、Firefox 69+（不支持 IE）</td>
<td>主流浏览器支持更广泛（包括部分旧版）</td>
</tr>
</tbody>
</table>
<h2 id="四-应用场景对比">四、应用场景对比 </h2>
<ul>
<li>ResizeObserver 的典型用例</li>
</ul>
<p>图表重绘：当容器尺寸变化时，自动触发 ECharts 等图表的重渲染</p>
<p>响应式组件：动态调整侧边栏宽度后同步更新布局</p>
<p>视口适配：移动端横竖屏切换时调整元素布局</p>
<ul>
<li>MutationObserver 的典型用例</li>
</ul>
<p>动态内容追踪：监测无限滚动列表的新增项</p>
<p>防篡改系统：检测水印节点被删除后重新添加</p>
<p>表单联动：属性变化时触发校验（如 disabled 状态变更）</p>
<h2 id="五-联合使用策略">五、联合使用策略 </h2>
<p>两者可结合实现复杂场景的监听，例如：<br>
用 MutationObserver 监测动态加载的 DOM 元素</p>
<p>对新元素启用 ResizeObserver 监听尺寸变化</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token comment">// 监测新插入的图表容器并启用尺寸监听</span>
<span class="token keyword keyword-const">const</span> mo <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">mutations</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
mutations<span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">m</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
m<span class="token punctuation">.</span><span class="token property-access">addedNodes</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">node</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span><span class="token property-access">classList</span><span class="token punctuation">.</span><span class="token method function property-access">contains</span><span class="token punctuation">(</span><span class="token string">'chart-container'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
resizeObserver<span class="token punctuation">.</span><span class="token method function property-access">observe</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mo<span class="token punctuation">.</span><span class="token method function property-access">observe</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">childList</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">subtree</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h2 id="总结建议-3">总结建议 </h2>
<p>优先选择 ResizeObserver：涉及元素尺寸变化的场景（如响应式布局）</p>
<p>优先选择 MutationObserver：需追踪 DOM 结构或属性变化的场景（如动态内容监测）</p>
<p>慎用监听范围：避免同时开启过多监听实例，必要时通过 unobserve() 及时释放资源</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<h1 id="intersectionobserver">IntersectionObserver </h1>
<ul>
<li>
<p>IntersectionObserver 是浏览器原生 API，用于异步监听目标元素与视口（或指定父容器）的交叉状态。当图片进入可视区域时触发回调函数，实现按需加载。相比传统的滚动事件监听，它具有以下优势：</p>
</li>
<li>
<p>性能优化 ​​：避免频繁计算元素位置导致的性能损耗;</p>
</li>
<li>
<p>代码简洁 ​​：无需手动监听 scroll 或 resize 事件；</p>
</li>
<li>
<p>精准控制 ​​：支持设置触发阈值（如元素进入视口 10% 即加载）。</p>
</li>
</ul>

      </div>
      
      
    
    
    <script type="module">
// TODO: If ZenUML gets integrated into mermaid in the future,
//      we can remove the following lines.


var MERMAID_CONFIG = ({"startOnLoad":false});
if (typeof MERMAID_CONFIG !== 'undefined') {
  MERMAID_CONFIG.startOnLoad = false
  MERMAID_CONFIG.cloneCssStyles = false
  MERMAID_CONFIG.theme = "default"
}

mermaid.initialize(MERMAID_CONFIG || {})
if (typeof(window['Reveal']) !== 'undefined') {
  function mermaidRevealHelper(event) {
    var currentSlide = event.currentSlide
    var diagrams = currentSlide.querySelectorAll('.mermaid')
    for (var i = 0; i < diagrams.length; i++) {
      var diagram = diagrams[i]
      if (!diagram.hasAttribute('data-processed')) {
        mermaid.init(null, diagram, ()=> {
          Reveal.slide(event.indexh, event.indexv)
        })
      }
    }
  }
  Reveal.addEventListener('slidetransitionend', mermaidRevealHelper)
  Reveal.addEventListener('ready', mermaidRevealHelper)
  await mermaid.run({
    nodes: document.querySelectorAll('.mermaid')
  })
} else {
  await mermaid.run({
    nodes: document.querySelectorAll('.mermaid')
  })
}
</script>
    
    
    
  
    </body></html>